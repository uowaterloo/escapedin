{"ast":null,"code":"var _jsxFileName = \"/Users/raghavsethi/Desktop/mappedin/software/webspring/src/components/apps/map-view/index.js\";\nimport React, { useContext } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { useHistory } from \"react-router-dom\";\nimport Mappedin from \"@mappedin/mappedin-js/builds/mappedin\";\nimport Keys from \"../../../keys\";\nimport Spinner from \"../../shared/spinner\";\nimport MappedinMap from \"./MappedinMapview\";\nimport Markers from \"./markers\";\nimport { useSequentialSelections, useMarkerManager, getLocationForPolygon, getPolygonForLocation } from \"./utils\";\nimport { Wrapper, Row, LoadingScreen, StyledStatusBar, InterfaceContainer } from \"./index.style\";\nimport { StateContext, ActionTypes } from \"../../util/useApplicationState\";\nconst SelectionOrder = [\"5b1a820697e366793c000083\", //ptolemy\n\"5b1a81db97e366793c000081\", //mercator\n\"5b1a817c97e366793c000080\", //da vinci\n\"5b1a814f97e366793c00007f\", //tomlinson\n\"5b1a821c97e366793c000084\", //massey\n\"5b1a81f097e366793c000082\" //ortelius\n]; //5f529bb1b20a327b7a000001 values wall\n//5f529c43b20a327b7a00000d pet wall\n//5b1a84ed97e366793c000091 server room\n//5b196e3b97e366793c000007 hongwei's office\n\nexport default function MapScreen() {\n  const [isFullyLoaded, setFullyLoaded] = React.useState(false);\n  const [selectedMap, setSelectedMap] = React.useState(null);\n  const [sdkData, setSdkData] = React.useState(null);\n  const [selectedLocation, setSelectedLocation] = React.useState(null); //const [navigationNodes, setNavigationNodes] = React.useState([]);\n\n  const {\n    dispatch\n  } = useContext(StateContext);\n  const history = useHistory();\n  const markers = [{\n    key: \"fantasy-wall\",\n    location: \"5fd2799106d5276c37000000\",\n    component: /*#__PURE__*/React.createElement(Markers.LocationRedirectMarker, {\n      onActivate: () => {\n        history.push(\"fantasy_wall\");\n      }\n    })\n  }, {\n    key: \"values-wall\",\n    location: \"5f529bb1b20a327b7a000001\",\n    component: /*#__PURE__*/React.createElement(Markers.LocationRedirectMarker, {\n      onActivate: () => {\n        history.push(\"values_wall\");\n      }\n    })\n  }, {\n    key: \"pet-wall\",\n    location: \"5f529c43b20a327b7a00000d\",\n    component: /*#__PURE__*/React.createElement(Markers.LocationRedirectMarker, {\n      onActivate: () => {\n        history.push(\"pet_wall\");\n      }\n    })\n  }, {\n    key: \"server-room\",\n    location: \"5b1a84ed97e366793c000091\",\n    component: /*#__PURE__*/React.createElement(Markers.LocationRedirectMarker, {\n      onActivate: () => {\n        history.push(\"door_puzzle\");\n      }\n    })\n  }, {\n    key: \"bookcase\",\n    location: \"5b1a834697e366793c000087\",\n    component: /*#__PURE__*/React.createElement(Markers.LocationRedirectMarker, {\n      onActivate: () => {\n        history.push(\"bookcase\");\n      }\n    })\n  }];\n  const markerManager = useMarkerManager(sdkData === null || sdkData === void 0 ? void 0 : sdkData.mapview, selectedMap, markers, isFullyLoaded);\n  const [sequentialLocations, setSequentialLocations] = useSequentialSelections(SelectionOrder);\n  const options = {\n    mapview: {\n      antialias: \"AUTO\",\n      //auto apply antialiasing\n      mode: Mappedin.modes.TEST,\n      //automatically test for 3d or 2d mode\n      onDataLoaded: () => console.log(\"Data loaded\"),\n      onFirstMapLoaded: () => {\n        setFullyLoaded(true);\n        console.log(\"fully loaded\");\n      }\n    },\n    venue: { ...Keys,\n      perspective: \"Website\",\n      //pick the perspective you would like to load\n      things: {\n        //fetch some data\n        venue: [\"slug\", \"name\"],\n        maps: [\"name\", \"elevation\", \"shortName\"]\n      },\n      venue: \"410-albert\"\n    }\n  };\n\n  const loadingCallback = data => {\n    setSdkData(data);\n    setSelectedMap(data.mapview.currentMap);\n    data.mapview.addInteractivePolygonsForAllLocations();\n    data.mapview.labelAllLocations();\n  };\n\n  const onPolygonClicked = React.useCallback(polygonId => {\n    const location = getLocationForPolygon(polygonId, sdkData.mapview);\n    sdkData.mapview.clearAllPolygonColors();\n    setSelectedLocation(location.id);\n    setSequentialLocations(location.id);\n  }, [sdkData, selectedMap]); //Respond to update of sequential locations\n\n  React.useEffect(() => {\n    if (sdkData && sequentialLocations.length > 0) {\n      sequentialLocations.forEach(locationID => {\n        const polygon = getPolygonForLocation(locationID, sdkData.mapview);\n\n        if (polygon) {\n          sdkData.mapview.setPolygonColor(polygon, 0xbf4320);\n        }\n      });\n\n      if (sequentialLocations.length === SelectionOrder.length) {\n        history.push(\"sphinx_code\");\n        dispatch({\n          type: ActionTypes.completePuzzle,\n          payload: \"MEETING_ROOM\"\n        });\n      }\n    }\n  }, [sequentialLocations, sdkData, selectedMap]); //Avoid a stale closure by wrapping the function assignment in a useEffect and callback function in useCallback\n\n  React.useEffect(() => {\n    if (sdkData && sdkData.mapview) {\n      sdkData.mapview.onPolygonClicked = onPolygonClicked;\n    }\n  }, [sdkData, onPolygonClicked]);\n  return /*#__PURE__*/React.createElement(Wrapper, {\n    key: \"map-container\"\n  }, /*#__PURE__*/React.createElement(StyledStatusBar, null), !isFullyLoaded && /*#__PURE__*/React.createElement(LoadingScreen, null, /*#__PURE__*/React.createElement(Spinner, null)), /*#__PURE__*/React.createElement(MappedinMap, {\n    selectedMap: selectedMap,\n    options: options,\n    onLoad: loadingCallback\n  }));\n}","map":{"version":3,"sources":["/Users/raghavsethi/Desktop/mappedin/software/webspring/src/components/apps/map-view/index.js"],"names":["React","useContext","ReactDOM","useHistory","Mappedin","Keys","Spinner","MappedinMap","Markers","useSequentialSelections","useMarkerManager","getLocationForPolygon","getPolygonForLocation","Wrapper","Row","LoadingScreen","StyledStatusBar","InterfaceContainer","StateContext","ActionTypes","SelectionOrder","MapScreen","isFullyLoaded","setFullyLoaded","useState","selectedMap","setSelectedMap","sdkData","setSdkData","selectedLocation","setSelectedLocation","dispatch","history","markers","key","location","component","push","markerManager","mapview","sequentialLocations","setSequentialLocations","options","antialias","mode","modes","TEST","onDataLoaded","console","log","onFirstMapLoaded","venue","perspective","things","maps","loadingCallback","data","currentMap","addInteractivePolygonsForAllLocations","labelAllLocations","onPolygonClicked","useCallback","polygonId","clearAllPolygonColors","id","useEffect","length","forEach","locationID","polygon","setPolygonColor","type","completePuzzle","payload"],"mappings":"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","sourcesContent":["import React, { useContext } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { useHistory } from \"react-router-dom\";\n\nimport Mappedin from \"@mappedin/mappedin-js/builds/mappedin\";\n\nimport Keys from \"../../../keys\";\nimport Spinner from \"../../shared/spinner\";\nimport MappedinMap from \"./MappedinMapview\";\n\nimport Markers from \"./markers\";\n\nimport {\n  useSequentialSelections,\n  useMarkerManager,\n  getLocationForPolygon,\n  getPolygonForLocation,\n} from \"./utils\";\n\nimport {\n  Wrapper,\n  Row,\n  LoadingScreen,\n  StyledStatusBar,\n  InterfaceContainer,\n} from \"./index.style\";\nimport { StateContext, ActionTypes } from \"../../util/useApplicationState\";\n\nconst SelectionOrder = [\n  \"5b1a820697e366793c000083\", //ptolemy\n  \"5b1a81db97e366793c000081\", //mercator\n  \"5b1a817c97e366793c000080\", //da vinci\n  \"5b1a814f97e366793c00007f\", //tomlinson\n  \"5b1a821c97e366793c000084\", //massey\n  \"5b1a81f097e366793c000082\", //ortelius\n];\n\n//5f529bb1b20a327b7a000001 values wall\n//5f529c43b20a327b7a00000d pet wall\n//5b1a84ed97e366793c000091 server room\n//5b196e3b97e366793c000007 hongwei's office\n\nexport default function MapScreen() {\n  const [isFullyLoaded, setFullyLoaded] = React.useState(false);\n  const [selectedMap, setSelectedMap] = React.useState(null);\n  const [sdkData, setSdkData] = React.useState(null);\n  const [selectedLocation, setSelectedLocation] = React.useState(null);\n  //const [navigationNodes, setNavigationNodes] = React.useState([]);\n  const { dispatch } = useContext(StateContext);\n\n  const history = useHistory();\n\n  const markers = [\n    {\n      key: \"fantasy-wall\",\n      location: \"5fd2799106d5276c37000000\",\n      component: (\n        <Markers.LocationRedirectMarker\n          onActivate={() => {\n            history.push(\"fantasy_wall\");\n          }}\n        />\n      ),\n    },\n    {\n      key: \"values-wall\",\n      location: \"5f529bb1b20a327b7a000001\",\n      component: (\n        <Markers.LocationRedirectMarker\n          onActivate={() => {\n            history.push(\"values_wall\");\n          }}\n        />\n      ),\n    },\n    {\n      key: \"pet-wall\",\n      location: \"5f529c43b20a327b7a00000d\",\n      component: (\n        <Markers.LocationRedirectMarker\n          onActivate={() => {\n            history.push(\"pet_wall\");\n          }}\n        />\n      ),\n    },\n    {\n      key: \"server-room\",\n      location: \"5b1a84ed97e366793c000091\",\n      component: (\n        <Markers.LocationRedirectMarker\n          onActivate={() => {\n            history.push(\"door_puzzle\");\n          }}\n        />\n      ),\n    },\n    {\n      key: \"bookcase\",\n      location: \"5b1a834697e366793c000087\",\n      component: (\n        <Markers.LocationRedirectMarker\n          onActivate={() => {\n            history.push(\"bookcase\");\n          }}\n        />\n      ),\n    },\n  ];\n\n  const markerManager = useMarkerManager(\n    sdkData?.mapview,\n    selectedMap,\n    markers,\n    isFullyLoaded\n  );\n\n  const [sequentialLocations, setSequentialLocations] = useSequentialSelections(\n    SelectionOrder\n  );\n\n  const options = {\n    mapview: {\n      antialias: \"AUTO\", //auto apply antialiasing\n      mode: Mappedin.modes.TEST, //automatically test for 3d or 2d mode\n      onDataLoaded: () => console.log(\"Data loaded\"),\n      onFirstMapLoaded: () => {\n        setFullyLoaded(true);\n        console.log(\"fully loaded\");\n      },\n    },\n    venue: {\n      ...Keys,\n      perspective: \"Website\", //pick the perspective you would like to load\n      things: {\n        //fetch some data\n        venue: [\"slug\", \"name\"],\n        maps: [\"name\", \"elevation\", \"shortName\"],\n      },\n      venue: \"410-albert\",\n    },\n  };\n\n  const loadingCallback = (data) => {\n    setSdkData(data);\n    setSelectedMap(data.mapview.currentMap);\n\n    data.mapview.addInteractivePolygonsForAllLocations();\n    data.mapview.labelAllLocations();\n  };\n\n  const onPolygonClicked = React.useCallback(\n    (polygonId) => {\n      const location = getLocationForPolygon(polygonId, sdkData.mapview);\n\n      sdkData.mapview.clearAllPolygonColors();\n      setSelectedLocation(location.id);\n      setSequentialLocations(location.id);\n    },\n    [sdkData, selectedMap]\n  );\n\n  //Respond to update of sequential locations\n  React.useEffect(() => {\n    if (sdkData && sequentialLocations.length > 0) {\n      sequentialLocations.forEach((locationID) => {\n        const polygon = getPolygonForLocation(locationID, sdkData.mapview);\n        if (polygon) {\n          sdkData.mapview.setPolygonColor(polygon, 0xbf4320);\n        }\n      });\n\n      if (sequentialLocations.length === SelectionOrder.length) {\n        history.push(\"sphinx_code\");\n        dispatch({ type: ActionTypes.completePuzzle, payload: \"MEETING_ROOM\" });\n      }\n    }\n  }, [sequentialLocations, sdkData, selectedMap]);\n\n  //Avoid a stale closure by wrapping the function assignment in a useEffect and callback function in useCallback\n  React.useEffect(() => {\n    if (sdkData && sdkData.mapview) {\n      sdkData.mapview.onPolygonClicked = onPolygonClicked;\n    }\n  }, [sdkData, onPolygonClicked]);\n\n  return (\n    <Wrapper key=\"map-container\">\n      <StyledStatusBar />\n      {!isFullyLoaded && (\n        <LoadingScreen>\n          <Spinner />\n        </LoadingScreen>\n      )}\n\n      <MappedinMap\n        selectedMap={selectedMap}\n        options={options}\n        onLoad={loadingCallback}\n      />\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}