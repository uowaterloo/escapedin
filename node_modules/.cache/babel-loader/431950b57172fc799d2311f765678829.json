{"ast":null,"code":"import React from \"react\";\nimport ReactDOM from \"react-dom\";\nexport { default as useSequentialSelections } from \"../../util/useSequentialSelections\";\nexport const getLocationForPolygon = (polygonId, mapview) => {\n  return mapview.venue.locations.find(location => location.polygons.some(polygon => polygon.id === polygonId));\n};\nexport const getPolygonForLocation = (locationId, mapview) => {\n  const polygons = mapview.venue.locations.find(location => location.id === locationId).polygons;\n  const desiredPolygon = polygons.find(polygon => polygon.layer === \"Polygon\");\n  return desiredPolygon ? desiredPolygon : polygons[0];\n};\nexport const useMarkerManager = (mapview, selectedMap, markers, fullyLoaded = false) => {\n  /* \n    Hook for managing a set of markers on a map. When we initialize a React component as a marker they end up in different stacking contexts making it difficult to control their layer order. This hook provides functionality to create an interactive marker with toggleable expansion state that automatically hides any other non-opened markers.\n     Props: \n      mapview: the MapView3D object returned from Mappedin SDK\n      selectedMap: ID of the current map\n      markers: Array with configurations of markers -> { \n        (key): A unique key to identify the marker; \n        (location || polygon): Location or Polygon ID to pin the marker to; \n        (component): A React component to render \n      }\n  */\n  const [allMarkers, setAllMarkers] = React.useState(markers);\n  const [openLocation, setOpenLocation] = React.useState(null);\n  const [activeMarkers, setActiveMarkers] = React.useState({});\n\n  const onCloseHandler = id => {\n    setOpenLocation(null);\n  };\n\n  const onOpenHandler = id => {\n    setOpenLocation(id);\n  };\n\n  const resetMarkers = () => {\n    setOpenLocation(null);\n    setActiveMarkers({});\n    mapview.removeAllMarkers();\n  };\n\n  const addMarker = marker => {\n    setAllMarkers(prevVal => [...prevVal, marker]);\n  };\n\n  const deleteMarker = key => {\n    const marker = Object.values(activeMarkers).find(item => item.key === key);\n    setAllMarkers(prevState => {\n      return prevState.filter(item => item.key !== key);\n    });\n\n    if (marker && (marker === null || marker === void 0 ? void 0 : marker.markerData)) {\n      removeMarker(marker);\n    }\n  };\n\n  const createMarker = React.useCallback(markerData => {\n    var _markerData$polygon, _ref, _mapview$getPositionP;\n\n    if (activeMarkers[markerData.key]) {\n      throw new Error(\"marker key already exists\");\n    }\n\n    let polygon = (_markerData$polygon = markerData.polygon) !== null && _markerData$polygon !== void 0 ? _markerData$polygon : getPolygonForLocation(markerData.location, mapview);\n    const position = (_ref = (_mapview$getPositionP = mapview.getPositionPolygon(polygon)) !== null && _mapview$getPositionP !== void 0 ? _mapview$getPositionP : mapview.getPositionNode(polygon)) !== null && _ref !== void 0 ? _ref : {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n    const marker = mapview.createMarker(\"<div>Marker</div>\", position, selectedMap, \"\");\n    const clonedElement = React.cloneElement(markerData.component, {\n      onOpen: onOpenHandler,\n      onClose: onCloseHandler,\n      id: markerData.key\n    });\n    setActiveMarkers(prevState => {\n      prevState[markerData.key] = {\n        key: markerData.key,\n        mappedinMarker: marker,\n        reactElement: clonedElement\n      };\n      return prevState;\n    });\n    ReactDOM.render(clonedElement, marker.div);\n  }, [mapview, selectedMap, setActiveMarkers, activeMarkers]);\n  const removeMarker = React.useCallback(markerData => {\n    mapview.removeMarker(markerData.mappedinMarker);\n    setActiveMarkers(prevState => {\n      delete prevState[markerData.key];\n      return prevState;\n    });\n  }, // eslint-disable-next-line\n  [mapview, setActiveMarkers, resetMarkers]); //Determine which markers to show and hide\n\n  React.useEffect(() => {\n    if (fullyLoaded && mapview && selectedMap && allMarkers) {\n      if (openLocation) {\n        allMarkers.forEach(details => {\n          if (details.key !== openLocation) {\n            removeMarker(activeMarkers[details.key]);\n          }\n        });\n      } else {\n        allMarkers.forEach(details => {\n          if (!activeMarkers[details.key]) {\n            createMarker(details);\n          }\n        });\n      }\n    }\n  }, [mapview, selectedMap, allMarkers, fullyLoaded, openLocation, createMarker, removeMarker, activeMarkers]);\n  return {\n    resetMarkers,\n    addMarker,\n    deleteMarker\n  };\n};","map":{"version":3,"sources":["/Users/raghavsethi/Desktop/mappedin/software/webspring/src/components/apps/map-view/utils.js"],"names":["React","ReactDOM","default","useSequentialSelections","getLocationForPolygon","polygonId","mapview","venue","locations","find","location","polygons","some","polygon","id","getPolygonForLocation","locationId","desiredPolygon","layer","useMarkerManager","selectedMap","markers","fullyLoaded","allMarkers","setAllMarkers","useState","openLocation","setOpenLocation","activeMarkers","setActiveMarkers","onCloseHandler","onOpenHandler","resetMarkers","removeAllMarkers","addMarker","marker","prevVal","deleteMarker","key","Object","values","item","prevState","filter","markerData","removeMarker","createMarker","useCallback","Error","position","getPositionPolygon","getPositionNode","x","y","z","clonedElement","cloneElement","component","onOpen","onClose","mappedinMarker","reactElement","render","div","useEffect","forEach","details"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nexport { default as useSequentialSelections } from \"../../util/useSequentialSelections\";\n\nexport const getLocationForPolygon = (polygonId, mapview) => {\n  return mapview.venue.locations.find((location) =>\n    location.polygons.some((polygon) => polygon.id === polygonId)\n  );\n};\n\nexport const getPolygonForLocation = (locationId, mapview) => {\n  const polygons = mapview.venue.locations.find(\n    (location) => location.id === locationId\n  ).polygons;\n  const desiredPolygon = polygons.find(\n    (polygon) => polygon.layer === \"Polygon\"\n  );\n  return desiredPolygon ? desiredPolygon : polygons[0];\n};\n\nexport const useMarkerManager = (\n  mapview,\n  selectedMap,\n  markers,\n  fullyLoaded = false\n) => {\n  /* \n    Hook for managing a set of markers on a map. When we initialize a React component as a marker they end up in different stacking contexts making it difficult to control their layer order. This hook provides functionality to create an interactive marker with toggleable expansion state that automatically hides any other non-opened markers.\n\n    Props: \n      mapview: the MapView3D object returned from Mappedin SDK\n      selectedMap: ID of the current map\n      markers: Array with configurations of markers -> { \n        (key): A unique key to identify the marker; \n        (location || polygon): Location or Polygon ID to pin the marker to; \n        (component): A React component to render \n      }\n  */\n\n  const [allMarkers, setAllMarkers] = React.useState(markers);\n  const [openLocation, setOpenLocation] = React.useState(null);\n  const [activeMarkers, setActiveMarkers] = React.useState({});\n\n  const onCloseHandler = (id) => {\n    setOpenLocation(null);\n  };\n\n  const onOpenHandler = (id) => {\n    setOpenLocation(id);\n  };\n\n  const resetMarkers = () => {\n    setOpenLocation(null);\n    setActiveMarkers({});\n    mapview.removeAllMarkers();\n  };\n\n  const addMarker = (marker) => {\n    setAllMarkers((prevVal) => [...prevVal, marker]);\n  };\n\n  const deleteMarker = (key) => {\n    const marker = Object.values(activeMarkers).find(\n      (item) => item.key === key\n    );\n\n    setAllMarkers((prevState) => {\n      return prevState.filter((item) => item.key !== key);\n    });\n\n    if (marker && marker?.markerData) {\n      removeMarker(marker);\n    }\n  };\n\n  const createMarker = React.useCallback(\n    (markerData) => {\n      if (activeMarkers[markerData.key]) {\n        throw new Error(\"marker key already exists\");\n      }\n\n      let polygon =\n        markerData.polygon ??\n        getPolygonForLocation(markerData.location, mapview);\n\n      const position = mapview.getPositionPolygon(polygon) ??\n        mapview.getPositionNode(polygon) ?? { x: 0, y: 0, z: 0 };\n\n      const marker = mapview.createMarker(\n        \"<div>Marker</div>\",\n        position,\n        selectedMap,\n        \"\"\n      );\n\n      const clonedElement = React.cloneElement(markerData.component, {\n        onOpen: onOpenHandler,\n        onClose: onCloseHandler,\n        id: markerData.key,\n      });\n\n      setActiveMarkers((prevState) => {\n        prevState[markerData.key] = {\n          key: markerData.key,\n          mappedinMarker: marker,\n          reactElement: clonedElement,\n        };\n        return prevState;\n      });\n\n      ReactDOM.render(clonedElement, marker.div);\n    },\n    [mapview, selectedMap, setActiveMarkers, activeMarkers]\n  );\n\n  const removeMarker = React.useCallback(\n    (markerData) => {\n      mapview.removeMarker(markerData.mappedinMarker);\n      setActiveMarkers((prevState) => {\n        delete prevState[markerData.key];\n        return prevState;\n      });\n    },\n    // eslint-disable-next-line\n    [mapview, setActiveMarkers, resetMarkers]\n  );\n\n  //Determine which markers to show and hide\n  React.useEffect(() => {\n    if (fullyLoaded && mapview && selectedMap && allMarkers) {\n      if (openLocation) {\n        allMarkers.forEach((details) => {\n          if (details.key !== openLocation) {\n            removeMarker(activeMarkers[details.key]);\n          }\n        });\n      } else {\n        allMarkers.forEach((details) => {\n          if (!activeMarkers[details.key]) {\n            createMarker(details);\n          }\n        });\n      }\n    }\n  }, [\n    mapview,\n    selectedMap,\n    allMarkers,\n    fullyLoaded,\n    openLocation,\n    createMarker,\n    removeMarker,\n    activeMarkers,\n  ]);\n\n  return { resetMarkers, addMarker, deleteMarker };\n};\n"]},"metadata":{},"sourceType":"module"}