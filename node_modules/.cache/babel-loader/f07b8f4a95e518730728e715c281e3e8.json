{"ast":null,"code":"import React from \"react\";\nimport ReactDOM from \"react-dom\";\nexport const getLocationForPolygon = (polygonId, mapview) => {\n  return mapview.venue.locations.find(location => location.polygons.some(polygon => polygon.id === polygonId));\n};\nexport const getPolygonForLocation = (locationId, mapview) => {\n  return mapview.venue.locations.find(location => location.id === locationId).polygons[0];\n};\nexport const useSequentialSelections = order => {\n  /*\n    Hook for validating a sequence of polygon clicks in a certain desired order. Returns an array containing the valid sequence of IDs that have been selected. Any attempt to add an ID that is not the next item in the sequence of IDs defined in `order` will result in the list of selected IDs being cleared.\n     order: an array of Location IDs\n  */\n  const [selectedLocations, setSelectedLocations] = React.useState([]);\n\n  const handlePolygonClick = polygonID => {\n    setSelectedLocations(prevLocations => {\n      const index = prevLocations.length;\n\n      if (order[index] === polygonID) {\n        return [...prevLocations, polygonID];\n      } else if (polygonID === order[0]) {\n        return [polygonID];\n      }\n\n      return [];\n    });\n  };\n\n  return [selectedLocations, handlePolygonClick];\n};\nexport const useMarkerManager = (mapview, selectedMap, markers, fullyLoaded = false) => {\n  /* \n    Hook for managing a set of markers on a map. When we initialize a React component as a marker they end up in different stacking contexts making it difficult to control their layer order. This hook provides functionality to create an interactive marker with toggleable expansion state that automatically hides any other non-opened markers.\n     Props: \n      mapview: the MapView3D object returned from Mappedin SDK\n      selectedMap: ID of the current map\n      markers: Array with configurations of markers -> { \n        (key): A unique key to identify the marker; \n        (location || polygon): Location or Polygon ID to pin the marker to; \n        (component): A React component to render \n      }\n  */\n  const [allMarkers, setAllMarkers] = React.useState(markers);\n  const [openLocation, setOpenLocation] = React.useState(null);\n  const [activeMarkers, setActiveMarkers] = React.useState({});\n\n  const onCloseHandler = id => {\n    setOpenLocation(null);\n  };\n\n  const onOpenHandler = id => {\n    setOpenLocation(id);\n  };\n\n  const resetMarkers = () => {\n    setOpenLocation(null);\n    setActiveMarkers({});\n    mapview.removeAllMarkers();\n  };\n\n  const addMarker = marker => {\n    setAllMarkers(prevVal => [...prevVal, marker]);\n  };\n\n  const deleteMarker = key => {\n    const marker = Object.values(activeMarkers).find(item => item.key === key);\n    setAllMarkers(prevState => {\n      return prevState.filter(item => item.key !== key);\n    });\n\n    if (marker && (marker === null || marker === void 0 ? void 0 : marker.markerData)) {\n      removeMarker(marker);\n    }\n\n    console.log(allMarkers);\n  };\n\n  const createMarker = React.useCallback(markerData => {\n    var _markerData$polygon, _ref, _mapview$getPositionP;\n\n    if (activeMarkers[markerData.key]) {\n      throw \"marker key already exists\";\n    }\n\n    let polygon = (_markerData$polygon = markerData.polygon) !== null && _markerData$polygon !== void 0 ? _markerData$polygon : getPolygonForLocation(markerData.location, mapview);\n    const position = (_ref = (_mapview$getPositionP = mapview.getPositionPolygon(polygon)) !== null && _mapview$getPositionP !== void 0 ? _mapview$getPositionP : mapview.getPositionNode(polygon)) !== null && _ref !== void 0 ? _ref : {\n      x: 0,\n      y: 0,\n      z: 0\n    };\n    const marker = mapview.createMarker(\"<div>Marker</div>\", position, selectedMap, \"\");\n    const clonedElement = React.cloneElement(markerData.component, {\n      onOpen: onOpenHandler,\n      onClose: onCloseHandler,\n      id: markerData.key\n    });\n    setActiveMarkers(prevState => {\n      prevState[markerData.key] = {\n        key: markerData.key,\n        mappedinMarker: marker,\n        reactElement: clonedElement\n      };\n      return prevState;\n    });\n    ReactDOM.render(clonedElement, marker.div);\n  }, [mapview, selectedMap, setActiveMarkers, activeMarkers]);\n  const removeMarker = React.useCallback(markerData => {\n    mapview.removeMarker(markerData.mappedinMarker);\n    setActiveMarkers(prevState => {\n      delete prevState[markerData.key];\n      return prevState;\n    });\n  }, [mapview, setActiveMarkers, resetMarkers]); //Determine which markers to show and hide\n\n  React.useEffect(() => {\n    if (fullyLoaded && mapview && selectedMap && allMarkers) {\n      if (openLocation) {\n        allMarkers.forEach(details => {\n          if (details.key !== openLocation) {\n            removeMarker(activeMarkers[details.key]);\n          }\n        });\n      } else {\n        allMarkers.forEach(details => {\n          if (!activeMarkers[details.key]) {\n            createMarker(details);\n          }\n        });\n      }\n    }\n  }, [mapview, selectedMap, allMarkers, fullyLoaded, openLocation, createMarker, removeMarker, activeMarkers]);\n  return {\n    resetMarkers,\n    addMarker,\n    deleteMarker\n  };\n};","map":{"version":3,"sources":["/Users/raghavsethi/Desktop/mappedin/software/webspring/src/components/apps/map-view/utils.js"],"names":["React","ReactDOM","getLocationForPolygon","polygonId","mapview","venue","locations","find","location","polygons","some","polygon","id","getPolygonForLocation","locationId","useSequentialSelections","order","selectedLocations","setSelectedLocations","useState","handlePolygonClick","polygonID","prevLocations","index","length","useMarkerManager","selectedMap","markers","fullyLoaded","allMarkers","setAllMarkers","openLocation","setOpenLocation","activeMarkers","setActiveMarkers","onCloseHandler","onOpenHandler","resetMarkers","removeAllMarkers","addMarker","marker","prevVal","deleteMarker","key","Object","values","item","prevState","filter","markerData","removeMarker","console","log","createMarker","useCallback","position","getPositionPolygon","getPositionNode","x","y","z","clonedElement","cloneElement","component","onOpen","onClose","mappedinMarker","reactElement","render","div","useEffect","forEach","details"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nexport const getLocationForPolygon = (polygonId, mapview) => {\n  return mapview.venue.locations.find((location) =>\n    location.polygons.some((polygon) => polygon.id === polygonId)\n  );\n};\n\nexport const getPolygonForLocation = (locationId, mapview) => {\n  return mapview.venue.locations.find((location) => location.id === locationId)\n    .polygons[0];\n};\n\nexport const useSequentialSelections = (order) => {\n  /*\n    Hook for validating a sequence of polygon clicks in a certain desired order. Returns an array containing the valid sequence of IDs that have been selected. Any attempt to add an ID that is not the next item in the sequence of IDs defined in `order` will result in the list of selected IDs being cleared.\n\n    order: an array of Location IDs\n  */\n\n  const [selectedLocations, setSelectedLocations] = React.useState([]);\n\n  const handlePolygonClick = (polygonID) => {\n    setSelectedLocations((prevLocations) => {\n      const index = prevLocations.length;\n\n      if (order[index] === polygonID) {\n        return [...prevLocations, polygonID];\n      } else if (polygonID === order[0]) {\n        return [polygonID];\n      }\n\n      return [];\n    });\n  };\n\n  return [selectedLocations, handlePolygonClick];\n};\n\nexport const useMarkerManager = (\n  mapview,\n  selectedMap,\n  markers,\n  fullyLoaded = false\n) => {\n  /* \n    Hook for managing a set of markers on a map. When we initialize a React component as a marker they end up in different stacking contexts making it difficult to control their layer order. This hook provides functionality to create an interactive marker with toggleable expansion state that automatically hides any other non-opened markers.\n\n    Props: \n      mapview: the MapView3D object returned from Mappedin SDK\n      selectedMap: ID of the current map\n      markers: Array with configurations of markers -> { \n        (key): A unique key to identify the marker; \n        (location || polygon): Location or Polygon ID to pin the marker to; \n        (component): A React component to render \n      }\n  */\n\n  const [allMarkers, setAllMarkers] = React.useState(markers);\n  const [openLocation, setOpenLocation] = React.useState(null);\n  const [activeMarkers, setActiveMarkers] = React.useState({});\n\n  const onCloseHandler = (id) => {\n    setOpenLocation(null);\n  };\n\n  const onOpenHandler = (id) => {\n    setOpenLocation(id);\n  };\n\n  const resetMarkers = () => {\n    setOpenLocation(null);\n    setActiveMarkers({});\n    mapview.removeAllMarkers();\n  };\n\n  const addMarker = (marker) => {\n    setAllMarkers((prevVal) => [...prevVal, marker]);\n  };\n\n  const deleteMarker = (key) => {\n    const marker = Object.values(activeMarkers).find(\n      (item) => item.key === key\n    );\n\n    setAllMarkers((prevState) => {\n      return prevState.filter((item) => item.key !== key);\n    });\n\n    if (marker && marker?.markerData) {\n      removeMarker(marker);\n    }\n\n    console.log(allMarkers);\n  };\n\n  const createMarker = React.useCallback(\n    (markerData) => {\n      if (activeMarkers[markerData.key]) {\n        throw \"marker key already exists\";\n      }\n\n      let polygon =\n        markerData.polygon ??\n        getPolygonForLocation(markerData.location, mapview);\n\n      const position = mapview.getPositionPolygon(polygon) ??\n        mapview.getPositionNode(polygon) ?? { x: 0, y: 0, z: 0 };\n\n      const marker = mapview.createMarker(\n        \"<div>Marker</div>\",\n        position,\n        selectedMap,\n        \"\"\n      );\n\n      const clonedElement = React.cloneElement(markerData.component, {\n        onOpen: onOpenHandler,\n        onClose: onCloseHandler,\n        id: markerData.key,\n      });\n\n      setActiveMarkers((prevState) => {\n        prevState[markerData.key] = {\n          key: markerData.key,\n          mappedinMarker: marker,\n          reactElement: clonedElement,\n        };\n        return prevState;\n      });\n\n      ReactDOM.render(clonedElement, marker.div);\n    },\n    [mapview, selectedMap, setActiveMarkers, activeMarkers]\n  );\n\n  const removeMarker = React.useCallback(\n    (markerData) => {\n      mapview.removeMarker(markerData.mappedinMarker);\n      setActiveMarkers((prevState) => {\n        delete prevState[markerData.key];\n        return prevState;\n      });\n    },\n    [mapview, setActiveMarkers, resetMarkers]\n  );\n\n  //Determine which markers to show and hide\n  React.useEffect(() => {\n    if (fullyLoaded && mapview && selectedMap && allMarkers) {\n      if (openLocation) {\n        allMarkers.forEach((details) => {\n          if (details.key !== openLocation) {\n            removeMarker(activeMarkers[details.key]);\n          }\n        });\n      } else {\n        allMarkers.forEach((details) => {\n          if (!activeMarkers[details.key]) {\n            createMarker(details);\n          }\n        });\n      }\n    }\n  }, [\n    mapview,\n    selectedMap,\n    allMarkers,\n    fullyLoaded,\n    openLocation,\n    createMarker,\n    removeMarker,\n    activeMarkers,\n  ]);\n\n  return { resetMarkers, addMarker, deleteMarker };\n};\n"]},"metadata":{},"sourceType":"module"}