import{Color}from"three";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function rgb2hsv(r,g,b){null==g&&(g=r.g,b=r.b,r=r.r);let maxIndex=0,max=r;g>r&&(maxIndex=1,max=g),b>g&&b>r&&(maxIndex=2,max=b);let min=r;g<r&&(min=g),b<g&&b<r&&(min=b);let h=0,s=0,v=0;return max!==min&&(h=0===maxIndex?60/360*(g-b)/(max-min):1===maxIndex?60/360*(2+(b-r)/(max-min)):60/360*(4+(r-g)/(max-min)),s=0===max?0:(max-min)/max),[h,s,v=max]}function hsv2rgb(h,s,v){const hh=360*h%360/60,sextant=0|hh,ff=hh-sextant,p=v*(1-s),q=v*(1-s*ff),t=v*(1-s*(1-ff));let r=0,g=0,b=0;switch(sextant){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}return new Color(r,g,b)}const SLIDER_HEIGHT=16;class DebugUIScalarSlider{constructor({minimum:minimum,maximum:maximum,step:step,current:current,onValueChanged:onValueChanged}){this._minimum=minimum,this._maximum=maximum,this._step=step,this._onValueChanged=onValueChanged,this._element=document.createElement("input"),this._element.type="range",this._element.min=this._minimum,this._element.max=this._maximum,null!=this._step&&(this._element.step=this._step),this._element.value=null!=current?current:this._minimum,null!=onValueChanged&&(this._element.addEventListener("input",e=>{onValueChanged(this._element.value)}),onValueChanged(this._element.value)),Object.assign(this._element.style,{height:SLIDER_HEIGHT+"px"})}destroy(){this._element=null,Object.setPrototypeOf(this,null)}addValueChangedListener(listener){this._element.addEventListener("input",e=>listener(this._element.value))}setValue(value){this._element.value=value}get element(){return this._element}get value(){return this._element.value}get displayedValue(){return""+this._element.value}get height(){return SLIDER_HEIGHT}}const CHECKBOX_SIZE=16;class DebugUICheckbox{constructor({current:current,onValueChanged:onValueChanged}){this._onValueChanged=onValueChanged,this._element=document.createElement("div"),this._titleElement=document.createElement("input"),this._titleElement.type="checkbox",this._titleElement.checked=current||!1,Object.assign(this._titleElement.style,{width:CHECKBOX_SIZE+"px",height:CHECKBOX_SIZE+"px",margin:"0px"}),null!=onValueChanged&&(this._titleElement.addEventListener("click",e=>{onValueChanged(this._titleElement.checked)}),onValueChanged(this._titleElement.checked))}destroy(){this._element=null,this._titleElement=null,Object.setPrototypeOf(this,null)}addValueChangedListener(listener){this._titleElement.addEventListener("click",e=>listener(this._titleElement.checked))}get element(){return this._element}get titleElement(){return this._titleElement}get value(){return this._titleElement.checked}get displayedValue(){return this._titleElement.checked?"true":"false"}get height(){return 0}get titleElementWidth(){return CHECKBOX_SIZE}}const DROPDOWN_HEIGHT=24;class DebugUIDropdown{constructor({values:values,current:current,onValueChanged:onValueChanged}){this._values=values,this._onValueChanged=onValueChanged,this._element=document.createElement("select");for(const value of values){const element=document.createElement("option");element.value=value,element.innerHTML=escapeHTML(value),element.selected=value===current?"selected":"unselected",this._element.appendChild(element)}null!=onValueChanged&&(this._element.addEventListener("change",e=>{onValueChanged(this._element.value)}),onValueChanged(this._element.value)),Object.assign(this._element.style,{height:DROPDOWN_HEIGHT+"px"})}destroy(){this._element=null,Object.setPrototypeOf(this,null)}addValueChangedListener(listener){this._element.addEventListener("change",e=>listener(this._element.value))}get element(){return this._element}get value(){return this._element.value}get displayedValue(){return this._element.value}get height(){return DROPDOWN_HEIGHT}}const BUTTON_HEIGHT=24;class DebugUIButton{constructor({label:label,onClick:onClick}){this._onClick=onClick,this._element=document.createElement("button"),this._element.innerHTML=escapeHTML(label),null!=onClick&&this._element.addEventListener("click",e=>{onClick()}),Object.assign(this._element.style,{height:DROPDOWN_HEIGHT+"px"})}destroy(){this._element=null,Object.setPrototypeOf(this,null)}addValueChangedListener(){}addClickListener(listener){this._element.addEventListener("click",e=>listener(this._element.value))}get element(){return this._element}get value(){return""}get displayedValue(){return""}get height(){return BUTTON_HEIGHT}}const COLOR_SWATCH_SIZE=12,COLOR_PICKER_INNER_SPACING=2,COLOR_PICKER_MAIN_SIZE=64,COLOR_PICKER_BOTTOM_SLIDER_SIZE=16,COLOR_PICKER_MODE_BUTTON_HEIGHT=24,COLOR_PICKER_MODE_BUTTON_WIDTH=48;class DebugUIColorPicker{constructor({current:current,onValueChanged:onValueChanged}){this._onValueChanged=onValueChanged,this._element=document.createElement("div"),this._titleElement=document.createElement("div"),this._color=current||new Color,this._listeners=[],Object.assign(this._element.style,{width:"100%",height:this.height+"px"}),Object.assign(this._titleElement.style,{width:COLOR_SWATCH_SIZE-2+"px",height:COLOR_SWATCH_SIZE-2+"px","border-radius":"2px"}),this._colorPickerMain=document.createElement("canvas"),this._colorPickerMain.height=COLOR_PICKER_MAIN_SIZE-2,Object.assign(this._colorPickerMain.style,{position:"absolute",left:"0px",right:"0px",top:"0px",height:COLOR_PICKER_MAIN_SIZE-2+"px"}),this._element.appendChild(this._colorPickerMain),this._colorPickerBottomSlider=document.createElement("canvas"),this._colorPickerBottomSlider.height=COLOR_PICKER_BOTTOM_SLIDER_SIZE-2,Object.assign(this._colorPickerBottomSlider.style,{position:"absolute",left:"0px",right:"0px",top:COLOR_PICKER_MAIN_SIZE+COLOR_PICKER_INNER_SPACING+"px",height:COLOR_PICKER_BOTTOM_SLIDER_SIZE-2+"px"}),this._element.appendChild(this._colorPickerBottomSlider),this._requestAnimationFrameHandle=null,this._requestAnimationFrameUpdate=this._requestAnimationFrameUpdate.bind(this),this._pickingMain=!1,this._pickingX=0,this._pickingY=0,this._colorPickerMain.addEventListener("pointerdown",e=>{this._pickingMain=!0,this._updateMain(e.offsetX,e.offsetY),this._notify(),this._moveListener=e=>{const x=e.clientX-this._colorPickerMain.getBoundingClientRect().x,y=e.clientY-this._colorPickerMain.getBoundingClientRect().y;this._pickingX=Math.min(Math.max(x,0),this._colorPickerMain.clientWidth),this._pickingY=Math.min(Math.max(y,0),this._colorPickerMain.clientHeight),this._requestAnimationFrame()},document.body.addEventListener("pointermove",this._moveListener),this._upListener=e=>{this._pickingMain=!1,this.redraw(),document.body.removeEventListener("pointermove",this._moveListener),document.body.removeEventListener("pointerup",this._upListener),delete this._moveListener,delete this._upListener},document.body.addEventListener("pointerup",this._upListener)}),this._pickingBottomSlider=!1,this._colorPickerBottomSlider.addEventListener("pointerdown",e=>{this._pickingBottomSlider=!0,this._updateBottomSlider(e.offsetX),this._notify(),this._bottomMoveListener=e=>{const x=e.clientX-this._colorPickerBottomSlider.getBoundingClientRect().x;this._pickingX=Math.min(Math.max(x,0),this._colorPickerMain.clientWidth),this._requestAnimationFrame()},document.body.addEventListener("pointermove",this._bottomMoveListener),this._bottomUpListener=e=>{this._pickingBottomSlider=!1,this.redraw(),document.body.removeEventListener("pointermove",this._bottomMoveListener),document.body.removeEventListener("pointerup",this._bottomUpListener),delete this._bottomMoveListener,delete this._bottomUpListener},document.body.addEventListener("pointerup",this._bottomUpListener)});let offset=0;const createModeButton=(identifier,label)=>{const button=document.createElement("button");return Object.assign(button.style,{position:"absolute",top:this.height-COLOR_PICKER_MODE_BUTTON_HEIGHT+"px",left:offset+"px",height:COLOR_PICKER_MODE_BUTTON_HEIGHT+"px",width:COLOR_PICKER_MODE_BUTTON_WIDTH+"px",color:"grey"}),button.innerHTML=label,offset+=COLOR_PICKER_MODE_BUTTON_WIDTH+COLOR_PICKER_INNER_SPACING,button.addEventListener("click",()=>{this._modeButtons[this._mode].style.color="grey",this._mode=identifier,button.style.color="black",this.redraw()}),this._element.appendChild(button),button};this._modeButtons={},this._modeButtons.hsv=createModeButton("hsv","HSV"),this._modeButtons.svh=createModeButton("svh","SVH"),this._modeButtons.rgb=createModeButton("rgb","RGB"),this._mode="hsv",this._modeButtons.hsv.style.color="black",this._requestAnimationFrame(),this._notify()}destroy(){document.body.removeEventListener("pointermove",this._moveListener),document.body.removeEventListener("pointerup",this._upListener),document.body.removeEventListener("pointermove",this._bottomMoveListener),document.body.removeEventListener("pointerup",this._bottomUpListener),this._element=null,this._titleElement=null,this._destroyed=!0,Object.setPrototypeOf(this,null)}addValueChangedListener(listener){this._listeners.push(listener)}setValue(color){this._color.copy(color),this.redraw(),this._notify()}_requestAnimationFrame(){null!=this._requestAnimationFrameHandle||this._destroyed||(this._requestAnimationFrameHandle=requestAnimationFrame(this._requestAnimationFrameUpdate))}_requestAnimationFrameUpdate(){this._pickingMain&&(this._updateMain(this._pickingX,this._pickingY),this._notify()),this._pickingBottomSlider&&(this._updateBottomSlider(this._pickingX),this._notify()),this._requestAnimationFrameHandle=null}_notify(){null!=this._onValueChanged&&this._onValueChanged(this._color);for(const listener of this._listeners)listener(this._color)}_updateMain(x,y){const width=this._colorPickerMain.clientWidth,height=COLOR_PICKER_MAIN_SIZE;this._pickingX=Math.min(Math.max(x,1),width-1)-1,this._pickingY=Math.min(Math.max(y,1),height-1)-1;const xt=this._pickingX/(width-1),yt=this._pickingY/(height-1);if("hsv"===this._mode){let[,,v]=rgb2hsv(this._color);this._color.set(hsv2rgb(xt,yt,v))}else if("svh"===this._mode){let[h,,]=rgb2hsv(this._color);this._color.set(hsv2rgb(h,xt,1-yt))}else this._color.r=xt,this._color.g=yt;this.redraw()}_updateBottomSlider(x){const width=this._colorPickerBottomSlider.clientWidth;this._pickingX=Math.min(Math.max(x,1),width-1)-1;const xt=this._pickingX/(width-1);if("hsv"===this._mode){let[h,s]=rgb2hsv(this._color);this._color.set(hsv2rgb(h,s,xt))}else if("svh"===this._mode){let[,s,v]=rgb2hsv(this._color);this._color.set(hsv2rgb(xt,s,v))}else this._color.b=xt;this.redraw()}redraw(){const width=this._element.clientWidth-2,mainHeight=COLOR_PICKER_MAIN_SIZE-2,bottomSliderHeight=COLOR_PICKER_BOTTOM_SLIDER_SIZE-2;this._colorPickerMain.width!==width&&(this._colorPickerMain.width=width);let[currentH,currentS,currentV]=rgb2hsv(this._color);const mainContext=this._colorPickerMain.getContext("2d");for(let yi=0;yi<mainHeight;++yi)for(let xi=0;xi<width;++xi){if("hsv"===this._mode){const h=xi/(width-1),s=yi/(mainHeight-1),v=currentV,{r:r,g:g,b:b}=hsv2rgb(h,s,v);mainContext.fillStyle=`rgb(${255*r},${255*g},${255*b})`}else if("svh"===this._mode){const s=xi/(width-1),v=1-yi/(mainHeight-1),h=currentH,{r:r,g:g,b:b}=hsv2rgb(h,s,v);mainContext.fillStyle=`rgb(${255*r},${255*g},${255*b})`}else{const r=xi/width*255,g=yi/mainHeight*255,b=255*this._color.b;mainContext.fillStyle=`rgb(${r},${g},${b})`}mainContext.fillRect(xi,yi,1,1)}this._pickingMain&&(mainContext.fillStyle="rgba(0,0,0,0.5)",mainContext.fillRect(0,this._pickingY,width,1),mainContext.fillRect(this._pickingX,0,1,mainHeight)),this._colorPickerBottomSlider.width!==width&&(this._colorPickerBottomSlider.width=width);const bottomSliderContext=this._colorPickerBottomSlider.getContext("2d");for(let xi=0;xi<width;++xi){if("hsv"===this._mode){const h=currentH,s=currentS,v=xi/(width-1),{r:r,g:g,b:b}=hsv2rgb(h,s,v);bottomSliderContext.fillStyle=`rgb(${255*r},${255*g},${255*b})`}else if("svh"===this._mode){const s=currentS,v=currentV,h=xi/(width-1),{r:r,g:g,b:b}=hsv2rgb(h,s,v);bottomSliderContext.fillStyle=`rgb(${255*r},${255*g},${255*b})`}else{const r=255*this._color.r,g=255*this._color.g,b=xi/(width-2)*255;bottomSliderContext.fillStyle=`rgb(${r},${g},${b})`}bottomSliderContext.fillRect(xi,0,1,bottomSliderHeight)}this._pickingBottomSlider&&(bottomSliderContext.fillStyle="rgba(0,0,0,0.5)",bottomSliderContext.fillRect(this._pickingX,0,1,bottomSliderHeight));const r=255*this._color.r,g=255*this._color.g,b=255*this._color.b,border=`1px solid rgb(${.9*r},${.9*g},${.9*b})`;Object.assign(this._colorPickerMain.style,{border:border}),Object.assign(this._colorPickerBottomSlider.style,{border:border}),Object.assign(this._titleElement.style,{"background-color":`rgb(${r},${g},${b})`,border:border})}get element(){return this._element}get titleElement(){return this._titleElement}get value(){return this._color}get displayedValue(){return"#"+this._color.getHexString().toUpperCase()}get height(){return COLOR_PICKER_MAIN_SIZE+COLOR_PICKER_INNER_SPACING+COLOR_PICKER_BOTTOM_SLIDER_SIZE+COLOR_PICKER_INNER_SPACING+COLOR_PICKER_MODE_BUTTON_HEIGHT}get titleElementWidth(){return COLOR_SWATCH_SIZE}}const CONTROL_TITLE_HEIGHT=16,CONTROL_TITLE_FONT_SIZE=12,CONTROL_TITLE_ELEMENT_SPACING=4,CONTROL_TEXT_FONT_SIZE=10,CONTROL_SPACING=12;class DebugUIPanel{constructor({name:name}){this._name=name,this._element=document.createElement("div"),this._entries=[],this._height=CONTROL_SPACING}destroy(){for(const entry of this._entries)entry.destroy();this._entries=null,this._element=null,Object.setPrototypeOf(this,null)}get element(){return this._element}get height(){return this._height}addControl(name,description,control){if(-1!==this._entries.findIndex(entry=>entry.name===name))return;const child=new DebugUIEntry({name:name,description:description,control:control});this._entries.push(child),this._element.appendChild(child.element),null!=control.redraw&&control.redraw()}removeControl(name){const index=this._entries.findIndex(entry=>entry.name===name);if(-1!==index){const[entry]=this._entries.splice(index,1);this._element.removeChild(entry.element),entry.destroy()}}_updateLayout(){this._height=0;for(const child of this._entries)child.element.style.top=this._height+"px",this._height+=child.height+CONTROL_SPACING;Object.assign(this._element.style,{height:this._height+"px"})}}class DebugUIEntry{constructor({name:name,description:description,control:control}){this._name=name,this._description=description,this._control=control,this._element=document.createElement("div"),this._element.title=description,Object.assign(this._element.style,{position:"absolute",left:"0px",right:"0px"}),this._element.appendChild(this._control.element),Object.assign(this._control.element.style,{position:"absolute",left:"0px",width:"100%",top:CONTROL_TITLE_HEIGHT+"px","font-size":CONTROL_TEXT_FONT_SIZE+"px"});let titleElementWidth=0;null!=this._control.titleElement&&(this._element.appendChild(this._control.titleElement),Object.assign(this._control.titleElement.style,{position:"absolute",left:"0px",top:"0px","font-size":CONTROL_TEXT_FONT_SIZE+"px"}),titleElementWidth=this._control.titleElementWidth+CONTROL_TITLE_ELEMENT_SPACING),this._control.addValueChangedListener(value=>{this._displayedValueElement.innerHTML=escapeHTML(this._control.displayedValue)}),this._nameElement=document.createElement("span"),this._nameElement.innerHTML=name,Object.assign(this._nameElement.style,{position:"absolute",left:titleElementWidth+"px",right:"0px",height:CONTROL_TITLE_HEIGHT+"px",color:"#666666","font-size":CONTROL_TITLE_FONT_SIZE+"px","text-align":"left","vertical-align":"middle"}),this._element.appendChild(this._nameElement),this._displayedValueElement=document.createElement("span"),this._displayedValueElement.innerHTML=escapeHTML(this._control.displayedValue),Object.assign(this._displayedValueElement.style,{position:"absolute",left:titleElementWidth+"px",right:"0px",height:CONTROL_TITLE_HEIGHT+"px","font-size":CONTROL_TITLE_FONT_SIZE+"px","text-align":"right","vertical-align":"middle"}),this._element.appendChild(this._displayedValueElement)}destroy(){this._element=null,this._nameElement=null,this._displayedValueElement=null,this._control.destroy(),Object.setPrototypeOf(this,null)}get name(){return this._name}get element(){return this._element}get value(){return this._control.value}get height(){return this._control.height+CONTROL_TITLE_HEIGHT}}function escapeHTML(value){return value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function PubSub(){}Object.assign(PubSub.prototype,{publish:function(eventName,data){this.subscribers&&this.subscribers[eventName]&&this.subscribers[eventName].forEach((function(fn){"function"==typeof fn&&fn(data)}))},on:function(eventName,fn){this.subscribers||(this.subscribers={}),this.subscribers[eventName]=this.subscribers[eventName]||[],this.subscribers[eventName].push(fn)},off:function(eventName,fn){if(this.subscribers&&this.subscribers[eventName]){var itemIdx=this.subscribers[eventName].indexOf(fn);-1!==itemIdx&&(this.subscribers[eventName][itemIdx]=void 0,this.subscribers[eventName].splice(itemIdx,1))}},destroy:function(){this.subscribers={}}});export{DebugUICheckbox as D,PubSub as P,_objectSpread2 as _,DebugUIPanel as a,DebugUIColorPicker as b,DebugUIScalarSlider as c,DebugUIButton as d,DebugUIDropdown as e};
