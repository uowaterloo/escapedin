import{_ as _createClass,a as _objectSpread2,b as _classCallCheck,P as PubSub,c as _defineProperty,D as DebugUICheckbox,d as DebugUIColorPicker,e as DebugUIScalarSlider,f as DebugUIButton,g as DebugUIDropdown,h as _slicedToArray,i as _typeof}from"./Mappedin.MapView3D-81974376.js";import{Color,Matrix4,Vector3,Vector4,Vector2,Matrix3,PerspectiveCamera}from"three";import"@tweenjs/tween.js";import"crypto";import"geodesy";import mapboxgl from"@mappedin/mapbox-gl";var amount,MapboxOutdoorContext=function(){function MapboxOutdoorContext(_ref){var _this=this,context=_ref.context,lngLat=_ref.lngLat,lngLatInMapSpace=_ref.lngLatInMapSpace,mapScale=_ref.mapScale,mapRotation=_ref.mapRotation,viewportSize=_ref.viewportSize;_classCallCheck(this,MapboxOutdoorContext),this._style=null,this._mockMap=null,this._changed=!0,this._needsReRender=!1,Object.assign(this,PubSub.prototype),window.MappedinDebug||(window.MappedinDebug={}),window.MappedinDebug.mapboxgl=mapboxgl,window.MappedinDebug.mapboxOutdoorContext=this,this._dispatcher=new mapboxgl.Dispatcher(mapboxgl.getWorkerPool(),this),this._eventHandler={listens:function(_event){return!0},fire:function(event){return _this._handleEvent(event)}};var mapboxContext=new mapboxgl.Context(context);this._transform=new MockTransform({lngLat:lngLat,lngLatInMapSpace:lngLatInMapSpace,mapScale:mapScale,mapRotation:mapRotation,viewportSize:viewportSize}),this._mockMap=new MockMap({context:mapboxContext,transform:this._transform}),this._style=new mapboxgl.Style(this._mockMap,{}),this._style.setEventedParent(this._eventHandler,{style:this._style});var xhr=new XMLHttpRequest,me=this;xhr.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var json=JSON.parse(this.responseText);me._style.loadJSON(json)}},xhr.open("GET","https://mi-tiles.mappedin.com/styles/klokantech-basic/style.json",!0),xhr.send(),this._mockMap.setStyle(this._style),this._tileRenderer=new TileRenderer({context:mapboxContext,map:this._mockMap}),this._onEvent=[],this._dispatcher.broadcast("setReferrer",mapboxgl.getReferrer())}return _createClass(MapboxOutdoorContext,[{key:"destroy",value:function(){this._style.remove(),delete this._style,this._mockMap.destroy(),this._tileRenderer.destroy(),this._dispatcher.remove(),PubSub.prototype.destroy.call(this),Object.setPrototypeOf(this,null)}},{key:"loaded",value:function(){return this._style.loaded()}},{key:"update",value:function(camera){this._transform.updateFromCamera(camera);var zoom=this._transform.zoom,now=performance.now();this._style.zoomHistory.update(zoom,now);var parameters=new mapboxgl.EvaluationParameters(zoom,{now:now,fadeDuration:this._mockMap._fadeDuration,zoomHistory:this._style.zoomHistory,transition:this._style.getTransition()});this._style.update(parameters),this._style._updateSources(this._transform)}},{key:"render",value:function(_ref2){var resolution=_ref2.resolution,camera=_ref2.camera;_ref2.renderTarget;this._tileRenderer.render({resolution:resolution,camera:camera,transform:this._transform,style:this._style}),this._needsReRender=this._tileRenderer.needsReRender}},{key:"setLngLat",value:function(lngLat,lngLatInMapSpace){this._transform.setLngLat(lngLat,lngLatInMapSpace)}},{key:"setMapScale",value:function(mapScale){this._transform.setMapScale(mapScale)}},{key:"setMapRotation",value:function(mapRotation){this._transform.setMapRotation(mapRotation)}},{key:"setViewportSize",value:function(viewportSize){this._transform.setViewportSize(viewportSize);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._style._order[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var layerId=_step.value;this._style._layers[layerId].resize()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"setOverlayColor",value:function(color,opacity){this._tileRenderer.setOverlayColor(color,opacity)}},{key:"setOverlayColorGradient",value:function(gradient,color,opacity){this._tileRenderer.setOverlayColorGradient(gradient,color,opacity)}},{key:"setShouldDrawTiles",value:function(shouldDrawTiles){this._tileRenderer.setShouldDrawTiles(shouldDrawTiles)}},{key:"addDebugControls",value:function(debugUI){var _this2=this,overlayColor=new Color,overlayOpacity=0,overlayGradient=!0,overlayColor2=new Color,overlayOpacity2=0;debugUI.addDebugControls(_defineProperty({},"Mapbox Outdoor Context",[{name:"Draw Debug Rectangle",description:"Draw a rectangle overtop of the viewport, to ensure rendering is occurring.",control:new DebugUICheckbox({current:!1,onValueChanged:function(value){_this2._tileRenderer._shouldDrawDebug=value,_this2.publish("render")}})},{name:"Overlay Color",description:"The color that will be used for the background overlay, or the first color stop for the gradient.",control:new DebugUIColorPicker({current:overlayColor,onValueChanged:function(color){overlayColor=color,_this2.setOverlayColor(overlayColor,overlayOpacity),_this2.publish("render")}})},{name:"Overlay Opacity",description:"The opacity that will be used for the background overlay, or the first color stop's opacity for the gradient.",control:new DebugUIScalarSlider({minimum:0,maximum:1,step:.01,current:0,onValueChanged:function(value){overlayOpacity=value,_this2.setOverlayColor(overlayColor,overlayOpacity),_this2.publish("render")}})},{name:"Overlay Gradient",description:"If true, the background overlay will be a gradient between the overlay color at the bottom and the overlay gradient color at the top.",control:new DebugUICheckbox({current:!1,onValueChanged:function(value){overlayGradient=value,_this2.setOverlayColorGradient(overlayGradient,overlayColor2,overlayOpacity2),_this2.publish("render")}})},{name:"Overlay Gradient Color",description:"The color of the overlay gradient bottom color stop.",control:new DebugUIColorPicker({current:overlayColor2,onValueChanged:function(color){overlayColor2=color,_this2.setOverlayColorGradient(overlayGradient,overlayColor2,overlayOpacity2),_this2.publish("render")}})},{name:"Overlay Gradient Opacity",description:"The opacity of the overlay gradient bottom color stop.",control:new DebugUIScalarSlider({minimum:0,maximum:1,step:.01,current:0,onValueChanged:function(value){overlayOpacity2=value,_this2.setOverlayColorGradient(overlayGradient,overlayColor2,overlayOpacity2),_this2.publish("render")}})}])),this._styleControlsAdded=!1,this._tryAddStyleControls(debugUI)}},{key:"removeDebugControls",value:function(debugUI){var _debugUI$removeDebugC;debugUI.removeDebugControls((_defineProperty(_debugUI$removeDebugC={},"Mapbox Outdoor Context",["Draw Debug Rectangle","Overlay Color","Overlay Opacity","Overlay Gradient","Overlay Gradient Color","Overlay Gradient Opacity"]),_defineProperty(_debugUI$removeDebugC,"Mapbox Outdoor Context Style",["Style Layer","Style Layer Color","Style Layer Opacity","Reset Style Layer Overrides"]),_debugUI$removeDebugC))}},{key:"_tryAddStyleControls",value:function(debugUI){var _this3=this;if(!this._styleControlsAdded)if(this._style.loaded&&Object.keys(this._style._layers).length>0){this._styleControlsAdded=!0;var styles=Object.keys(this._tileRenderer.getOverridableStyles(this._style));styles.sort();var currentStyleLayer=null,styleLayerColorPicker=new DebugUIColorPicker({current:new Color,onValueChanged:function(value){null!=currentStyleLayer&&(_this3._tileRenderer.setStyleOverride(currentStyleLayer,"color",value.clone()),_this3.publish("render"))}}),styleLayerOpacitySlider=new DebugUIScalarSlider({minimum:0,maximum:1,step:.01,current:1,onValueChanged:function(value){null!=currentStyleLayer&&(_this3._tileRenderer.setStyleOverride(currentStyleLayer,"opacity",value),_this3.publish("render"))}}),setControlValues=function(styleLayer){currentStyleLayer=null;var color=_this3._tileRenderer.getStyleOverrideOrDefault(_this3._style,styleLayer,"color");null!=color&&styleLayerColorPicker.setValue(color.clone());var opacity=_this3._tileRenderer.getStyleOverrideOrDefault(_this3._style,styleLayer,"opacity");null!=opacity&&styleLayerOpacitySlider.setValue(opacity),currentStyleLayer=styleLayer},styleLayerResetButton=new DebugUIButton({label:"Reset",onClick:function(value){null!=currentStyleLayer&&(_this3._tileRenderer.setStyleOverride(currentStyleLayer,"color",void 0),_this3._tileRenderer.setStyleOverride(currentStyleLayer,"opacity",void 0),_this3.publish("render"),setControlValues(currentStyleLayer))}}),styleLayerDropdown=new DebugUIDropdown({values:styles,current:null,onValueChanged:function(value){setControlValues(value)}});debugUI.addDebugControls(_defineProperty({},"Mapbox Outdoor Context Style",[{name:"Style Layer",description:"Which style layer will be edited by the style layer controls.",control:styleLayerDropdown},{name:"Style Layer Color",description:"The color of this style layer.",control:styleLayerColorPicker},{name:"Style Layer Opacity",description:"The opacity of this style layer.",control:styleLayerOpacitySlider},{name:"Reset Style Layer Overrides",description:"Return the values for this style layer to their default values.",control:styleLayerResetButton}]))}else this._onEvent.push(this._tryAddStyleControls.bind(this,debugUI))}},{key:"dumpDebug",value:function(){this._tileRenderer.dumpDebug()}},{key:"_handleEvent",value:function(event){"data"===event.type&&this.publish("render");var onEvents=this._onEvent;this._onEvent=[];var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=onEvents[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){(0,_step2.value)()}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"needsReRender",get:function(){return this._needsReRender}}]),MapboxOutdoorContext}(),MockMap=function(){function MockMap(_ref3){var context=_ref3.context,transform=_ref3.transform;_classCallCheck(this,MockMap),this._maxTileCacheSize=null,this._fadeDuration=300,this.style=null,this.painter=new MockPainter({context:context,transform:transform}),this._requestManager=new mapboxgl.RequestManager}return _createClass(MockMap,[{key:"setStyle",value:function(style){this.style=style,this.painter.style=style,this.style.painter=this.painter}},{key:"destroy",value:function(){this.painter.destroy(),Object.setPrototypeOf(this,null)}},{key:"_getMapId",value:function(){return 1}}]),MockMap}(),MockPainter=function(){function MockPainter(_ref4){var context=_ref4.context,transform=_ref4.transform;_classCallCheck(this,MockPainter),this._tileTextures={},this.context=context,this.transform=transform}return _createClass(MockPainter,[{key:"destroy",value:function(){Object.setPrototypeOf(this,null)}},{key:"getTileTexture",value:function(size){var textures=this._tileTextures[size];return textures&&textures.length>0?textures.pop():null}},{key:"saveTileTexture",value:function(texture){var textures=this._tileTextures[texture.size[0]];textures?textures.push(texture):this._tileTextures[texture.size[0]]=[texture]}},{key:"width",get:function(){return this.transform.width}},{key:"height",get:function(){return this.transform.height}}]),MockPainter}(),MockTransform=function(){function MockTransform(_ref5){var lngLat=_ref5.lngLat,lngLatInMapSpace=_ref5.lngLatInMapSpace,mapScale=_ref5.mapScale,mapRotation=_ref5.mapRotation,viewportSize=_ref5.viewportSize;_classCallCheck(this,MockTransform),this._changed=!0,this._inverseCameraProjection=new Matrix4,this._mercator=null,this._sdkToMercator=null,this._sinRotation=null,this._cosRotation=null,this.tileSize=512,this._lngLat=lngLat,this._lngLatInMapSpace=lngLatInMapSpace,this._mapScale=mapScale,this._mapRotation=mapRotation,this._viewportSize=viewportSize,this._mercatorToWebSDK=new Matrix4,this._mercatorToWebSDKVector=new Matrix3,this._webSDKToMercator=new Matrix4,this.center=mapboxgl.MercatorCoordinate.fromLngLat(this._lngLat,0),this._recalculate()}return _createClass(MockTransform,[{key:"setLngLat",value:function(lngLat,lngLatInMapSpace){this._lngLat=lngLat,this._lngLatInMapSpace=lngLatInMapSpace,this._changed=!0}},{key:"setMapScale",value:function(mapScale){this._mapScale=mapScale,this._changed=!0}},{key:"setMapRotation",value:function(mapRotation){this._mapRotation=mapRotation,this._changed=!0}},{key:"setViewportSize",value:function(viewportSize){this._viewportSize=viewportSize}},{key:"updateFromCamera",value:function(camera){this._changed&&this._recalculate(),camera.updateProjectionMatrix(),this._inverseCameraProjection.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),this._inverseCameraProjection.getInverse(this._inverseCameraProjection),this.cameraToCenterDistance=.5/Math.tan(camera.fov/2)*this._viewportSize.height,this.center=this._pointCoordinate(0,0)}},{key:"_recalculate",value:function(){this._mercator=mapboxgl.MercatorCoordinate.fromLngLat(this._lngLat,0),this._sdkToMercator=this._mercator.meterInMercatorCoordinateUnits()/this._mapScale,this._sinRotation=Math.sin(this._mapRotation),this._cosRotation=Math.cos(this._mapRotation),this._changed=!1,this._webSDKToMercator.makeTranslation(-this._lngLatInMapSpace.x,-this._lngLatInMapSpace.y,0),this._webSDKToMercator.premultiply((new Matrix4).makeRotationZ(this._mapRotation)),this._webSDKToMercator.premultiply((new Matrix4).makeScale(this._sdkToMercator,-this._sdkToMercator,1)),this._webSDKToMercator.premultiply((new Matrix4).makeTranslation(this._mercator.x,this._mercator.y,this._mercator.z)),this._mercatorToWebSDK.makeTranslation(-this._mercator.x,-this._mercator.y,-this._mercator.z),this._mercatorToWebSDK.premultiply((new Matrix4).makeScale(1/this._sdkToMercator,-1/this._sdkToMercator,1)),this._mercatorToWebSDK.premultiply((new Matrix4).makeRotationZ(-this._mapRotation)),this._mercatorToWebSDK.premultiply((new Matrix4).makeTranslation(this._lngLatInMapSpace.x,this._lngLatInMapSpace.y,0)),this._mercatorToWebSDKVector.setFromMatrix4(this._mercatorToWebSDK)}},{key:"webSDKCoordinatesToMercator",value:function(coords){var result=coords.clone();return result.applyMatrix4(this._webSDKToMercator),new mapboxgl.MercatorCoordinate(result.x,result.y,result.z)}},{key:"mercatorCoordinatesToWebSDK",value:function(coords){var result=new Vector3(coords.x,coords.y,coords.z);return result.applyMatrix4(this._mercatorToWebSDK),result}},{key:"_pointCoordinate",value:function(x,y){var worldSpaceCoordinate0=new Vector4(x,y,0,1),worldSpaceCoordinate1=new Vector4(x,y,1,1);worldSpaceCoordinate0.applyMatrix4(this._inverseCameraProjection),worldSpaceCoordinate1.applyMatrix4(this._inverseCameraProjection);var z0=worldSpaceCoordinate0.z/worldSpaceCoordinate0.w,t=(0-z0)/(worldSpaceCoordinate1.z/worldSpaceCoordinate1.w-z0);isNaN(t)&&(t=0);var x0=worldSpaceCoordinate0.x/worldSpaceCoordinate0.w,x1=worldSpaceCoordinate1.x/worldSpaceCoordinate1.w,y0=worldSpaceCoordinate0.y/worldSpaceCoordinate0.w,resultX=x0+t*(x1-x0),resultY=y0+t*(worldSpaceCoordinate1.y/worldSpaceCoordinate1.w-y0);return this.webSDKCoordinatesToMercator(new Vector3(resultX,resultY,0))}},{key:"tileMercatorPosition",value:function(unwrappedTileID){var canonical=unwrappedTileID.canonical,scale=1/this.zoomScale(canonical.z),unwrappedX=canonical.x+Math.pow(2,canonical.z)*unwrappedTileID.wrap;return[new mapboxgl.MercatorCoordinate(unwrappedX*scale,canonical.y*scale,0),scale]}},{key:"tileWebSDKPosition",value:function(unwrappedTileID){var _this$tileMercatorPos=this.tileMercatorPosition(unwrappedTileID),_this$tileMercatorPos2=_slicedToArray(_this$tileMercatorPos,2),tileTranslation=_this$tileMercatorPos2[0],tileScale=_this$tileMercatorPos2[1];return[this.mercatorCoordinatesToWebSDK(tileTranslation),tileScale/this._sdkToMercator,new Vector2(this._sinRotation,this._cosRotation)]}},{key:"zoomScale",value:function(zoom){return Math.pow(2,zoom)}},{key:"scaleZoom",value:function(scale){return Math.log(scale)/Math.LN2}},{key:"coveringTiles",value:function(_ref6){var tileSize=_ref6.tileSize,roundZoom=(_ref6.minzoom,_ref6.maxzoom,_ref6.roundZoom),reparseOverscaled=_ref6.reparseOverscaled,renderWorldCopies=_ref6.renderWorldCopies,z=(roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/tileSize)),actualZ=z,numTiles=Math.pow(2,z),centerPoint=new Vector2(numTiles*this.center.x-.5,numTiles*this.center.y-.5),cornerCoords=[this._pointCoordinate(-1,-1),this._pointCoordinate(1,-1),this._pointCoordinate(1,1),this._pointCoordinate(-1,1)];return mapboxgl.tileCover(z,cornerCoords,reparseOverscaled?actualZ:z,renderWorldCopies).sort((function(a,b){return centerPoint.distanceTo(a.canonical)-centerPoint.distanceTo(b.canonical)}))}},{key:"webSDKToMercator",get:function(){return this._webSDKToMercator}},{key:"mercatorToWebSDK",get:function(){return this._mercatorToWebSDK}},{key:"mercatorToWebSDKVector",get:function(){return this._mercatorToWebSDKVector}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"width",get:function(){return this._viewportSize.x}},{key:"height",get:function(){return this._viewportSize.y}},{key:"zoom",get:function(){return 14.999}},{key:"scale",get:function(){return this.zoomScale(this.zoom)}}]),MockTransform}(),TileRenderer=function(){function TileRenderer(_ref7){var context=_ref7.context,map=_ref7.map;_classCallCheck(this,TileRenderer),this._needsReRender=!1,this.map=map,this.context=context;var gl=this.context.gl;this.tileVertexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.tileVertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),gl.STATIC_DRAW),this.debugVertexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.debugVertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([.25,.75,.75,.75,.25,.25,.75,.25]),gl.STATIC_DRAW),this.debugShaderProgram=this._loadProgram({programName:"debugShaderProgram",vertexSource:DEBUG_VERTEX_SHADER,fragmentSource:DEBUG_FRAGMENT_SHADER,attributes:["position"],uniforms:[]}),this.backgroundShaderProgram=this._loadProgram({programName:"backgroundShaderProgram",vertexSource:"attribute vec2 position;varying vec2 texcoord;void main(){gl_Position=vec4(position*vec2(2.)-vec2(1.),0.9999999999999,1.);texcoord=position;}",fragmentSource:"uniform highp vec4 color;uniform highp vec4 color2;varying highp vec2 texcoord;void main(){highp vec3 finalColor=mix(color.rgb*color.a,color2.rgb*color2.a,texcoord.y);highp float finalAlpha=mix(color.a,color2.a,texcoord.y);gl_FragColor=vec4(finalColor,finalAlpha);}",attributes:["position"],uniforms:["color","color2"]}),this.textureShaderProgram=this._loadProgram({programName:"textureShaderProgram",vertexSource:TEXTURE_VERTEX_SHADER,fragmentSource:TEXTURE_FRAGMENT_SHADER,attributes:["position"],uniforms:["worldToClip","tileTranslation","tileScale","tileRotation","tileTexture","tileFadeAmount"].concat(Object.keys(ANIMATION_SUITE))}),this.fillShaderProgram=this._loadProgram({programName:"fillShaderProgram",vertexSource:"attribute vec2 a_pos;uniform mat4 worldToClip;uniform mat4 mapboxModelToWorld;void main(){vec4 worldPosition=mapboxModelToWorld*vec4(a_pos,0.,1.);gl_Position=worldToClip*worldPosition;}",fragmentSource:"uniform highp vec4 color;uniform highp float opacity;void main(){highp float alpha=color.a*opacity;gl_FragColor=vec4(color.rgb,1.0)*alpha;}",attributes:["a_pos"],uniforms:["worldToClip","mapboxModelToWorld","color","opacity"]}),this.lineShaderProgram=this._loadProgram({programName:"lineShaderProgram",vertexSource:"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform mediump float u_gapwidth;uniform lowp float u_offset;uniform mediump float u_width;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;float random(vec2 st){return fract(sin(dot(st,vec2(12.9898,78.233)))*43758.5453123);}void main(){mediump float gapwidth=u_gapwidth;lowp float offset=u_offset;mediump float width=u_width;float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}",fragmentSource:"uniform lowp float u_device_pixel_ratio;uniform highp vec4 u_color;uniform lowp float u_blur;uniform lowp float u_opacity;varying highp vec2 v_width2;varying highp vec2 v_normal;varying highp float v_gamma_scale;void main(){highp vec4 color=u_color;lowp float blur=u_blur;lowp float opacity=u_opacity;highp float dist=length(v_normal)*v_width2.s;highp float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;highp float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);}",attributes:["a_pos_normal","a_data"],uniforms:["u_gapwidth","u_offset","u_width","u_color","u_blur","u_opacity","u_matrix","u_ratio","u_units_to_pixels","u_device_pixel_ratio"]}),this.symbolSDFShaderProgram=this._loadProgram({programName:"symbolSDFShaderProgram",vertexSource:"precision highp float;vec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main(){vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/256.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/256.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}",fragmentSource:"precision mediump float;\n#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;uniform highp vec4 u_fill_color;uniform highp vec4 u_halo_color;uniform lowp float u_opacity;uniform lowp float u_halo_width;uniform lowp float u_halo_blur;void main(){highp vec4 fill_color=u_fill_color;highp vec4 halo_color=u_halo_color;lowp float opacity=u_opacity;lowp float halo_width=u_halo_width;lowp float halo_blur=u_halo_blur;float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;gamma_scale/=5000.;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}tex.y=1.0-tex.y;lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);gl_FragColor=color*(alpha*opacity);}",attributes:["a_pos_offset","a_data","a_projected_pos","a_fade_opacity"],uniforms:["u_is_size_zoom_constant","u_is_size_feature_constant","u_size_t","u_size","u_matrix","u_label_plane_matrix","u_coord_matrix","u_is_text","u_pitch_with_map","u_rotate_symbol","u_aspect_ratio","u_camera_to_center_distance","u_fade_change","u_texsize","u_is_halo","u_texture","u_gamma_scale","u_device_pixel_ratio","u_is_text","u_fill_color","u_halo_color","u_opacity","u_halo_width","u_halo_blur"]}),this._worldToClip=new Matrix4,this._mercatorToWebSDK=new Matrix4,this._solipsisticStreetNameLayoutCamera=new PerspectiveCamera,this._worldToClipClamped=new Matrix4,this._overlayColor=new Color(0,0,0),this._overlayOpacity=0,this._overlayColor2=new Color(0,0,0),this._overlayOpacity2=0,this._overlayGradient=!1,this._shouldDrawDebug=!1,this._shouldDrawTiles=!0,this._styleOverride={}}return _createClass(TileRenderer,[{key:"_loadShader",value:function(_ref8){var typeId,programName=_ref8.programName,type=_ref8.type,source=_ref8.source,gl=this.context.gl,shader=gl.createShader(type);if(gl.shaderSource(shader,source),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS))return shader;switch(type){case gl.VERTEX_SHADER:typeId="vertex shader";break;case gl.FRAGMENT_SHADER:typeId="fragment shader";break;default:typeId="unknown shader type"}var error=new Error("error compiling ".concat(typeId," for ").concat(programName,": ").concat(gl.getShaderInfoLog(shader)));throw gl.deleteShader(shader),error}},{key:"_loadProgram",value:function(_ref9){var programName=_ref9.programName,vertexSource=_ref9.vertexSource,fragmentSource=_ref9.fragmentSource,attributes=_ref9.attributes,uniforms=_ref9.uniforms,gl=this.context.gl,vertexShader=this._loadShader({programName:programName,type:gl.VERTEX_SHADER,source:vertexSource}),fragmentShader=this._loadShader({programName:programName,type:gl.FRAGMENT_SHADER,source:fragmentSource}),shaderProgram=gl.createProgram();if(gl.attachShader(shaderProgram,vertexShader),gl.attachShader(shaderProgram,fragmentShader),gl.linkProgram(shaderProgram),!gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)){var error=new Error("error linking ".concat(programName,": ").concat(gl.getProgramInfoLog(shaderProgram)));throw gl.deleteProgram(shaderProgram),error}var attribLocations={},_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=attributes[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var attribute=_step3.value;attribLocations[attribute]=gl.getAttribLocation(shaderProgram,attribute)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}var uniformLocations={},_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=uniforms[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var uniform=_step4.value;uniformLocations[uniform]=gl.getUniformLocation(shaderProgram,uniform),null==uniformLocations[uniform]&&console.error("Uniform location",uniform,"not found")}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return{shaderProgram:shaderProgram,attribLocations:attribLocations,uniformLocations:uniformLocations}}},{key:"setOverlayColor",value:function(color,opacity){this._overlayColor=color,this._overlayOpacity=opacity,this._needsReRender=!0}},{key:"setOverlayColorGradient",value:function(gradient,color,opacity){this._overlayGradient=gradient,this._overlayGradient&&(this._overlayColor2=color,this._overlayOpacity2=opacity),this._needsReRender=!0}},{key:"setShouldDrawTiles",value:function(shouldDrawTiles){this._shouldDrawTiles=shouldDrawTiles,this._needsReRender=!0}},{key:"render",value:function(_ref10){var resolution=_ref10.resolution,camera=_ref10.camera,transform=_ref10.transform,style=_ref10.style,renderState={resolution:resolution,camera:camera,transform:transform};this._saveThreeJSVertexAttribs(renderState),this.context.setDefault(),this._needsReRender=!1,this._computeCameraMatrices(renderState);var tileIDs={};for(var sourceId in style.sourceCaches){var sourceCache=style.sourceCaches[sourceId];tileIDs[sourceId]=transform.coveringTiles({tileSize:sourceCache.getSource().tileSize,minzoom:sourceCache.getSource().minzoom,maxzoom:sourceCache.getSource().maxzoom,roundZoom:sourceCache.getSource().roundZoom,reparseOverscaled:sourceCache.getSource().reparseOverscaled})}var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=style._order[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var _layerId=_step5.value,_layer=style._layers[_layerId];"background"===_layer.type&&this._drawBackground({renderState:renderState,styleLayer:_layer})}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}if(this._shouldDrawTiles)for(var i=0;i<style._order.length;++i){var layerId=style._order[i],layer=style._layers[layerId];if(null!=layer.source){var _sourceCache=style.sourceCaches[layer.source],bindProgramFunction=null,unbindProgramFunction=null,drawFunction=null;switch(layer.type){case"line":bindProgramFunction=this._bindLineTileProgram,unbindProgramFunction=this._unbindLineTileProgram,drawFunction=this._drawLineTile;break;case"fill":bindProgramFunction=this._bindFillTileProgram,unbindProgramFunction=this._unbindFillTileProgram,drawFunction=this._drawFillTile;break;case"symbol":0!==layer.paint.get("text-opacity").constantOr(1)&&(bindProgramFunction=this._bindSymbolSDFTileProgram,unbindProgramFunction=this._unbindSymbolSDFTileProgram,drawFunction=this._drawSymbolSDFTile)}if(null!=bindProgramFunction){console.assert(null!=drawFunction&&null!=unbindProgramFunction),bindProgramFunction.call(this,{renderState:renderState,styleLayer:layer});var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=tileIDs[layer.source][Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var coord=_step6.value,tile=_sourceCache.getTile(coord);null==tile||null==tile.buckets&&null==tile.texture||drawFunction.call(this,{renderState:renderState,styleLayer:layer,tile:tile})}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}unbindProgramFunction.call(this)}else console.assert(null==drawFunction&&null==unbindProgramFunction)}}(0!==this._overlayOpacity||this._overlayGradient&&0!==this._overlayOpacity2)&&this._drawOverlay({renderState:renderState}),this._shouldDrawDebug&&this._drawDebug(renderState),this._restoreThreeJSVertexAttribs(renderState)}},{key:"dumpDebug",value:function(){var gl=this.context.gl;for(var property in gl){var param=gl.getParameter(gl[property]);null!=param&&console.warn(property,param)}if(null==this._dumpDebugDiff){for(var _property in this._dumpDebugDiff={},gl){var _param=gl.getParameter(gl[_property]);this._dumpDebugDiff[_property]=_param}console.warn("GL state captured. Call `dumpDebug` again to log the diff.")}else for(var _property2 in gl){var _param2=gl.getParameter(gl[_property2]);_param2!==this._dumpDebugDiff[_property2]&&(console.warn("Diff:",_property2,"was",this._dumpDebugDiff[_property2],"is",_param2),this._dumpDebugDiff[_property2]=_param2)}}},{key:"getStyleOverride",value:function(layerName,property,value){if(null!=this._styleOverride[layerName]&&null!=this._styleOverride[layerName][property]){var retrievedValue=this._styleOverride[layerName][property];return"object"===_typeof(retrievedValue)&&"object"===_typeof(value)?_objectSpread2(_objectSpread2({},value),retrievedValue):retrievedValue}return value}},{key:"getStyleOverrideOrDefault",value:function(style,layerName,property){if(null!=this._styleOverride[layerName]){var override=this._styleOverride[layerName][property];if(null!=override)return override}if("color"===property){var layer=style._layers[layerName],defaultColor={r:1,g:1,b:1,a:1},color=null;switch(layer.type){case"background":color=this._paintProperty(layer,"background-color",defaultColor);break;case"fill":color=this._paintProperty(layer,"fill-color",defaultColor);break;case"line":color=this._paintProperty(layer,"line-color",defaultColor);break;case"symbol":color=this._paintProperty(layer,"text-color",defaultColor)}if(null!=color)return new Color(color.r,color.g,color.b,color.a)}else if("opacity"===property){var _layer2=style._layers[layerName];switch(_layer2.type){case"background":return this._paintProperty(_layer2,"background-opacity",1);case"fill":return this._paintProperty(_layer2,"fill-opacity",1);case"line":return this._paintProperty(_layer2,"line-opacity",1);case"symbol":return this._paintProperty(_layer2,"text-opacity",1)}}}},{key:"setStyleOverride",value:function(layerName,property,value){null==this._styleOverride[layerName]&&(this._styleOverride[layerName]={}),this._styleOverride[layerName][property]=value}},{key:"getOverridableStyles",value:function(style){var layers={};for(var layerId in style._layers){var layer=style._layers[layerId];-1!==["line","fill","symbol","background"].indexOf(layer.type)&&(layers[layerId]=["color"])}return layers}},{key:"_computeCameraMatrices",value:function(renderState){renderState.camera.updateMatrix(),renderState.camera.updateMatrixWorld(),renderState.camera.updateProjectionMatrix(),this._worldToClip.multiplyMatrices(renderState.camera.projectionMatrix,renderState.camera.matrixWorldInverse);for(var _i=0,_arr=["aspect","far","fov","near","zoom"];_i<_arr.length;_i++){var property=_arr[_i];this._solipsisticStreetNameLayoutCamera[property]=renderState.camera[property]}this._solipsisticStreetNameLayoutCamera.position.copy(renderState.camera.position),this._solipsisticStreetNameLayoutCamera.quaternion.copy(renderState.camera.quaternion),this._solipsisticStreetNameLayoutCamera.rotation.copy(renderState.camera.rotation),this._solipsisticStreetNameLayoutCamera.position.z=Math.min(renderState.camera.position.z,2400),this._mercatorToWebSDK.copy(renderState.transform.mercatorToWebSDK)}},{key:"_bindProgram",value:function(_ref11){var renderState=_ref11.renderState,shaderProgram=_ref11.shaderProgram,gl=this.context.gl;for(var key in gl.useProgram(shaderProgram.shaderProgram),null!=shaderProgram.uniformLocations.worldToClip&&gl.uniformMatrix4fv(shaderProgram.uniformLocations.worldToClip,!1,this._worldToClip.elements),null!=shaderProgram.uniformLocations.resolution&&gl.uniformMatrix2f(shaderProgram.uniformLocations.resolution,renderState.resolution.width,renderState.resolution.height),ANIMATION_SUITE)null!=shaderProgram.uniformLocations[key]&&ANIMATION_SUITE[key](gl,shaderProgram.uniformLocations[key])}},{key:"_saveThreeJSVertexAttribs",value:function(renderState){var gl=this.context.gl,extInstances=gl.getExtension("ANGLE_instanced_arrays");renderState.savedThreeJSVertexAttribs={};for(var i=0;i<gl.getParameter(gl.MAX_VERTEX_ATTRIBS);++i)renderState.savedThreeJSVertexAttribs[i]={enabled:gl.getVertexAttrib(i,gl.VERTEX_ATTRIB_ARRAY_ENABLED),size:gl.getVertexAttrib(i,gl.VERTEX_ATTRIB_ARRAY_SIZE),stride:gl.getVertexAttrib(i,gl.VERTEX_ATTRIB_ARRAY_STRIDE),type:gl.getVertexAttrib(i,gl.VERTEX_ATTRIB_ARRAY_TYPE),normalized:gl.getVertexAttrib(i,gl.VERTEX_ATTRIB_ARRAY_NORMALIZED),offset:gl.getVertexAttribOffset(i,gl.VERTEX_ATTRIB_ARRAY_POINTER),divisor:null!=extInstances?gl.getVertexAttrib(i,extInstances.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE):null}}},{key:"_restoreThreeJSVertexAttribs",value:function(renderState){var gl=this.context.gl,extInstances=gl.getExtension("ANGLE_instanced_arrays");for(var index in renderState.savedThreeJSVertexAttribs){var attrib=renderState.savedThreeJSVertexAttribs[index];attrib.enabled?(gl.enableVertexAttribArray(index),gl.vertexAttribPointer(index,attrib.size,attrib.type,attrib.normalized,attrib.stride,attrib.offset)):gl.disableVertexAttribArray(index),null!=extInstances&&(null!=extInstances.vertexAttribDivisor?extInstances.vertexAttribDivisor(index,attrib.divisor):extInstances.vertexAttribDivisorANGLE(index,attrib.divisor))}}},{key:"_enableVertexAttribArray",value:function(index){var gl=this.context.gl,extInstances=gl.getExtension("ANGLE_instanced_arrays");null!=extInstances&&(null!=extInstances.vertexAttribDivisor?extInstances.vertexAttribDivisor(index,0):extInstances.vertexAttribDivisorANGLE(index,0)),gl.enableVertexAttribArray(index)}},{key:"_drawDebug",value:function(renderState){var gl=this.context.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.debugVertexBuffer),gl.vertexAttribPointer(this.debugShaderProgram.attribLocations.position,2,gl.FLOAT,!1,0,0);var extInstances=gl.getExtension("ANGLE_instanced_arrays");null!=extInstances&&extInstances.vertexAttribDivisorANGLE(this.debugShaderProgram.attribLocations.position,0),this._enableVertexAttribArray(this.debugShaderProgram.attribLocations.position),this._bindProgram({shaderProgram:this.debugShaderProgram,renderState:renderState}),gl.disable(gl.CULL_FACE),gl.disable(gl.DEPTH_TEST),0!==this.textureShaderProgram.attribLocations.position&&gl.disableVertexAttribArray(this.textureShaderProgram.attribLocations.position),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),gl.enable(gl.CULL_FACE),gl.enable(gl.DEPTH_TEST)}},{key:"_bindRasterTileProgram",value:function(renderState){var gl=this.context.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.tileVertexBuffer),gl.vertexAttribPointer(this.textureShaderProgram.attribLocations.position,2,gl.FLOAT,!1,0,0),this._enableVertexAttribArray(this.textureShaderProgram.attribLocations.position),this._bindProgram({renderState:renderState,shaderProgram:this.textureShaderProgram}),gl.disable(gl.CULL_FACE),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}},{key:"_unbindRasterTileProgram",value:function(){var gl=this.context.gl;0!==this.textureShaderProgram.attribLocations.position&&gl.disableVertexAttribArray(this.textureShaderProgram.attribLocations.position),gl.enable(gl.CULL_FACE),gl.disable(gl.BLEND)}},{key:"_bindFillTileProgram",value:function(_ref12){var renderState=_ref12.renderState,styleLayer=_ref12.styleLayer,gl=this.context.gl;this._bindProgram({renderState:renderState,shaderProgram:this.fillShaderProgram}),gl.disable(gl.CULL_FACE),gl.depthMask(!1),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);var fillColor=this.getStyleOverride(styleLayer.id,"color",this._paintProperty(styleLayer,"fill-color",{r:0,g:0,b:0,a:0}));gl.uniform4f(this.fillShaderProgram.uniformLocations.color,fillColor.r,fillColor.g,fillColor.b,fillColor.a);var fillOpacity=this.getStyleOverride(styleLayer.id,"opacity",this._paintProperty(styleLayer,"fill-opacity",1));gl.uniform1f(this.fillShaderProgram.uniformLocations.opacity,fillOpacity)}},{key:"_unbindFillTileProgram",value:function(){var gl=this.context.gl;gl.enable(gl.CULL_FACE),gl.depthMask(!0),gl.disable(gl.BLEND)}},{key:"_bindLineTileProgram",value:function(_ref13){var renderState=_ref13.renderState,styleLayer=_ref13.styleLayer,gl=this.context.gl;this._bindProgram({renderState:renderState,shaderProgram:this.lineShaderProgram}),gl.disable(gl.CULL_FACE),gl.depthMask(!1),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);var u_gapwidth=styleLayer.paint.get("line-gap-width").evaluate();gl.uniform1f(this.lineShaderProgram.uniformLocations.u_gapwidth,u_gapwidth||0);var u_offset=styleLayer.paint.get("line-gap-width").evaluate();gl.uniform1f(this.lineShaderProgram.uniformLocations.u_offset,u_offset||0);var u_width=styleLayer.paint.get("line-width").evaluate();gl.uniform1f(this.lineShaderProgram.uniformLocations.u_width,u_width||1);var u_color=this.getStyleOverride(styleLayer.id,"color",styleLayer.paint.get("line-color").evaluate());gl.uniform4f(this.lineShaderProgram.uniformLocations.u_color,u_color.r,u_color.g,u_color.b,u_color.a||1);var u_blur=styleLayer.paint.get("line-blur").evaluate();gl.uniform1f(this.lineShaderProgram.uniformLocations.u_blur,u_blur||0);var u_opacity=this.getStyleOverride(styleLayer.id,"opacity",styleLayer.paint.get("line-opacity").evaluate());gl.uniform1f(this.lineShaderProgram.uniformLocations.u_opacity,u_opacity||1);var u_units_to_pixels=new Vector2(1/(2/renderState.resolution.width),1/(-2/renderState.resolution.height));gl.uniform2f(this.lineShaderProgram.uniformLocations.u_units_to_pixels,u_units_to_pixels.x,u_units_to_pixels.y);var u_device_pixel_ratio=window.devicePixelRatio;gl.uniform1f(this.lineShaderProgram.uniformLocations.u_device_pixel_ratio,u_device_pixel_ratio)}},{key:"_unbindLineTileProgram",value:function(){var gl=this.context.gl;gl.depthMask(!0),gl.enable(gl.CULL_FACE),gl.disable(gl.BLEND)}},{key:"_bindSymbolSDFTileProgram",value:function(_ref14){var renderState=_ref14.renderState,styleLayer=_ref14.styleLayer,gl=this.context.gl;this._bindProgram({renderState:renderState,shaderProgram:this.symbolSDFShaderProgram}),gl.disable(gl.CULL_FACE),gl.depthMask(!1),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);var rotateWithMap="map"===styleLayer.layout.get("text-rotation-alignment"),pitchWithMap="map"===styleLayer.layout.get("text-pitch-alignment"),alongLine=rotateWithMap&&"point"!==styleLayer.layout.get("symbol-placement"),rotateInShader=rotateWithMap&&!pitchWithMap&&!alongLine,pitchVector=new Vector4(0,0,1,0);pitchVector.applyMatrix4(renderState.camera.matrixWorldInverse),pitchVector.normalize();var u_pitch=Math.acos(pitchVector.z);gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_pitch,u_pitch);var u_aspect_ratio=renderState.resolution.width/renderState.resolution.height;gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_aspect_ratio,u_aspect_ratio);var u_camera_to_center_distance=renderState.transform.cameraToCenterDistance;gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_camera_to_center_distance,u_camera_to_center_distance);gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_gamma_scale,1),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_pitch_with_map,pitchWithMap),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_rotate_symbol,rotateInShader),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_is_size_zoom_constant,1),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_is_size_feature_constant,1),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_fade_Change,1),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_is_text,1),gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_device_pixel_ratio,window.devicePixelRatio);var u_fill_color=this.getStyleOverride(styleLayer.id,"color",this._paintProperty(styleLayer,"text-color",{r:0,g:0,b:0,a:0}));gl.uniform4f(this.symbolSDFShaderProgram.uniformLocations.u_fill_color,u_fill_color.r,u_fill_color.g,u_fill_color.b,u_fill_color.a||1);var u_halo_color=this._paintProperty(styleLayer,"halo-color",{r:0,g:0,b:0,a:0});gl.uniform4f(this.symbolSDFShaderProgram.uniformLocations.u_halo_color,u_halo_color.r,u_halo_color.g,u_halo_color.b,u_halo_color.a||1);var u_opacity=this.getStyleOverride(styleLayer.id,"opacity",this._paintProperty(styleLayer,"text-opacity",1));gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_opacity,u_opacity||1);var u_halo_width=this._paintProperty(styleLayer,"text-halo-width",0);gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_halo_width,u_halo_width||0);var u_halo_blur=this._paintProperty(styleLayer,"text-halo-blur",0);gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_halo_blur,u_halo_blur||0)}},{key:"_unbindSymbolSDFTileProgram",value:function(){var gl=this.context.gl;gl.depthMask(!0),gl.enable(gl.CULL_FACE),gl.disable(gl.BLEND)}},{key:"_paintProperty",value:function(styleLayer,propertyName){var defaultValue=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(null!=styleLayer.paint){var value,property=styleLayer.paint.get(propertyName);return null!=(value=null!=property&&null!=property.evaluate?property.evaluate():property)?value:defaultValue}}},{key:"_drawBackground",value:function(_ref15){var renderState=_ref15.renderState,styleLayer=_ref15.styleLayer,gl=this.context.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.tileVertexBuffer),gl.vertexAttribPointer(this.backgroundShaderProgram.attribLocations.position,2,gl.FLOAT,!1,0,0),this._enableVertexAttribArray(this.backgroundShaderProgram.attribLocations.position),this._bindProgram({renderState:renderState,shaderProgram:this.backgroundShaderProgram});var color=this.getStyleOverride(styleLayer.id,"color",this._paintProperty(styleLayer,"background-color",{r:0,g:0,b:0,a:0})),opacity=this.getStyleOverride(styleLayer.id,"opacity",this._paintProperty(styleLayer,"background-opacity",1)),finalOpacity=(color.a||1)*(opacity||1);gl.uniform4f(this.backgroundShaderProgram.uniformLocations.color,color.r,color.g,color.b,finalOpacity),gl.uniform4f(this.backgroundShaderProgram.uniformLocations.color2,color.r,color.g,color.b,finalOpacity),gl.disable(gl.CULL_FACE),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),gl.enable(gl.CULL_FACE),gl.disable(gl.BLEND)}},{key:"_drawOverlay",value:function(_ref16){var renderState=_ref16.renderState,gl=this.context.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.tileVertexBuffer),gl.vertexAttribPointer(this.backgroundShaderProgram.attribLocations.position,2,gl.FLOAT,!1,0,0),this._enableVertexAttribArray(this.backgroundShaderProgram.attribLocations.position),this._bindProgram({renderState:renderState,shaderProgram:this.backgroundShaderProgram}),gl.uniform4f(this.backgroundShaderProgram.uniformLocations.color,this._overlayColor.r,this._overlayColor.g,this._overlayColor.b,this._overlayOpacity);var secondaryColor=this._overlayGradient?this._overlayColor2:this._overlayColor,secondaryOpacity=this._overlayGradient?this._overlayOpacity2:this._overlayOpacity;gl.uniform4f(this.backgroundShaderProgram.uniformLocations.color2,secondaryColor.r,secondaryColor.g,secondaryColor.b,secondaryOpacity),gl.disable(gl.CULL_FACE),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),gl.drawArrays(gl.TRIANGLE_STRIP,0,4),gl.enable(gl.CULL_FACE),gl.disable(gl.BLEND)}},{key:"_bindVertexAttributes",value:function(program,segment,buffer){var gl=this.context.gl,AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},extVAO=gl.getExtension("OES_vertex_array_object");if(null!=extVAO&&extVAO.bindVertexArrayOES(null),buffer){var _iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=buffer.attributes[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var attribute=_step7.value,attributeIndex=program.attribLocations[attribute.name];null!=attributeIndex&&(this._enableVertexAttribArray(attributeIndex),gl.vertexAttribPointer(attributeIndex,attribute.components,gl[AttributeType[attribute.type]],!1,buffer.itemSize,attribute.offset+buffer.itemSize*(segment.vertexOffset||0)))}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorNormalCompletion7||null==_iterator7.return||_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}}}},{key:"_unbindVertexAttributes",value:function(program,buffer){var gl=this.context.gl;if(buffer){var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=buffer.attributes[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var attribute=_step8.value,attributeIndex=program.attribLocations[attribute.name];null!=attributeIndex&&0!==attributeIndex&&gl.disableVertexAttribArray(attributeIndex)}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorNormalCompletion8||null==_iterator8.return||_iterator8.return()}finally{if(_didIteratorError8)throw _iteratorError8}}}}},{key:"_getPosMatrix",value:function(renderState,tile){var unwrappedTileID=tile.tileID.toUnwrapped(),canonical=unwrappedTileID.canonical,scale=1/renderState.transform.zoomScale(canonical.z),unwrappedX=canonical.x+Math.pow(2,canonical.z)*unwrappedTileID.wrap,mapboxModelToWorld=new Matrix4;mapboxModelToWorld.premultiply((new Matrix4).makeScale(scale/8192,scale/8192,1)),mapboxModelToWorld.multiply(this._mercatorToWebSDK);var translationMercator=new mapboxgl.MercatorCoordinate(unwrappedX*scale,canonical.y*scale,0),translationSDK=renderState.transform.mercatorCoordinatesToWebSDK(translationMercator);return mapboxModelToWorld.premultiply((new Matrix4).makeTranslation(translationSDK.x,translationSDK.y,translationSDK.z)),mapboxModelToWorld}},{key:"_drawFillTile",value:function(_ref17){var _gl$LINES$gl$TRIANGLE,renderState=_ref17.renderState,styleLayer=_ref17.styleLayer,tile=_ref17.tile,gl=this.context.gl,bucket=tile.getBucket(styleLayer);if(bucket){bucket.upload(this.context);var indexBuffer=bucket.indexBuffer,segments=bucket.segments,drawMode=gl.TRIANGLES,primitiveSize=(_gl$LINES$gl$TRIANGLE={},_defineProperty(_gl$LINES$gl$TRIANGLE,gl.LINES,2),_defineProperty(_gl$LINES$gl$TRIANGLE,gl.TRIANGLES,3),_defineProperty(_gl$LINES$gl$TRIANGLE,gl.LINE_STRIP,1),_gl$LINES$gl$TRIANGLE)[drawMode],mapboxModelToWorld=this._getPosMatrix(renderState,tile);mapboxModelToWorld.premultiply((new Matrix4).makeTranslation(0,0,-50)),gl.uniformMatrix4fv(this.fillShaderProgram.uniformLocations.mapboxModelToWorld,!1,mapboxModelToWorld.elements);var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=segments.get()[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var segment=_step9.value;indexBuffer.bind(),bucket.layoutVertexBuffer.bind(),this._bindVertexAttributes(this.fillShaderProgram,segment,bucket.layoutVertexBuffer),gl.drawElements(drawMode,segment.primitiveLength*primitiveSize,gl.UNSIGNED_SHORT,segment.primitiveOffset*primitiveSize*2),this._unbindVertexAttributes(this.fillShaderProgram,bucket.layoutVertexBuffer)}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{_iteratorNormalCompletion9||null==_iterator9.return||_iterator9.return()}finally{if(_didIteratorError9)throw _iteratorError9}}}}},{key:"_drawLineTile",value:function(_ref18){var renderState=_ref18.renderState,styleLayer=_ref18.styleLayer,tile=_ref18.tile,gl=this.context.gl,bucket=tile.getBucket(styleLayer);if(bucket){bucket.upload(this.context);var indexBuffer=bucket.indexBuffer,segments=bucket.segments,mapboxModelToClip=this._getPosMatrix(renderState,tile);mapboxModelToClip.premultiply((new Matrix4).makeTranslation(0,0,-50)),mapboxModelToClip.premultiply(this._worldToClip),gl.uniformMatrix4fv(this.lineShaderProgram.uniformLocations.u_matrix,!1,mapboxModelToClip.elements);var u_ratio=1/function(tile,pixelValue,z){return pixelValue*(8192/(tile.tileSize*Math.pow(2,z-tile.tileID.overscaledZ)))*.7}(tile,1,renderState.transform.zoom);gl.uniform1f(this.lineShaderProgram.uniformLocations.u_ratio,u_ratio);var _iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator10=segments.get()[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=!0){var segment=_step10.value;indexBuffer.bind(),bucket.layoutVertexBuffer.bind(),this._bindVertexAttributes(this.lineShaderProgram,segment,bucket.layoutVertexBuffer),gl.drawElements(gl.TRIANGLES,3*segment.primitiveLength,gl.UNSIGNED_SHORT,3*segment.primitiveOffset*2),this._unbindVertexAttributes(this.lineShaderProgram,bucket.layoutVertexBuffer)}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{_iteratorNormalCompletion10||null==_iterator10.return||_iterator10.return()}finally{if(_didIteratorError10)throw _iteratorError10}}}}},{key:"_drawSymbolSDFTile",value:function(_ref19){var renderState=_ref19.renderState,styleLayer=_ref19.styleLayer,tile=_ref19.tile,gl=this.context.gl;tile.upload(this.context);var bucket=tile.getBucket(styleLayer);if(bucket){bucket.upload(this.context);var buffers=bucket.text;if(buffers&&buffers.segments.get().length){buffers.upload();var indexBuffer=buffers.indexBuffer,segments=buffers.segments,mapboxModelToClip=this._getPosMatrix(renderState,tile);mapboxModelToClip.premultiply((new Matrix4).makeTranslation(0,0,-50)),mapboxModelToClip.premultiply(this._worldToClip),gl.uniformMatrix4fv(this.symbolSDFShaderProgram.uniformLocations.u_matrix,!1,mapboxModelToClip.elements);var sizeData=bucket.textSizeData,size=mapboxgl.symbolSize.evaluateSizeForZoom(sizeData,renderState.transform.zoom),atlasTexture=tile.glyphAtlasTexture,atlasInterpolation=gl.LINEAR,texSize=atlasTexture.size;gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_size,size?size.uSize:0),gl.uniform1f(this.symbolSDFShaderProgram.uniformLocations.u_size_t,size?size.uSizeT:0),gl.uniform2f(this.symbolSDFShaderProgram.uniformLocations.u_texsize,texSize[0],texSize[1]),gl.activeTexture(gl.TEXTURE0),atlasTexture.bind(atlasInterpolation,gl.CLAMP_TO_EDGE),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_texture,0);var rotationAlignment=styleLayer.layout.get("text-rotation-alignment"),pitchAlignment=styleLayer.layout.get("text-pitch-alignment"),keepUpright=styleLayer.layout.get("text-keep-upright"),pitchWithMap="map"===pitchAlignment,alongLine="map"===rotationAlignment&&"point"!==styleLayer.layout.get("symbol-placement"),identity=new Matrix4;if(gl.uniformMatrix4fv(this.symbolSDFShaderProgram.uniformLocations.u_label_plane_matrix,!1,identity.elements),gl.uniformMatrix4fv(this.symbolSDFShaderProgram.uniformLocations.u_coord_matrix,!1,mapboxModelToClip.elements),alongLine){var mapboxModelToWorld=this._getPosMatrix(renderState,tile),tilePosition=new Vector3(0,0,0);tilePosition.applyMatrix4(mapboxModelToWorld),this._solipsisticStreetNameLayoutCamera.x=tilePosition.x,this._solipsisticStreetNameLayoutCamera.y=tilePosition.y,this._solipsisticStreetNameLayoutCamera.updateMatrix(),this._solipsisticStreetNameLayoutCamera.updateMatrixWorld(),this._solipsisticStreetNameLayoutCamera.updateProjectionMatrix(),this._worldToClipClamped.multiplyMatrices(this._solipsisticStreetNameLayoutCamera.projectionMatrix,this._solipsisticStreetNameLayoutCamera.matrixWorldInverse);var mapboxModelToClipClamped=mapboxModelToWorld;mapboxModelToClipClamped.premultiply((new Matrix4).makeTranslation(0,0,-48)),mapboxModelToClipClamped.premultiply(this._worldToClipClamped);var fakePainter={width:this.map.painter.width/1024,height:this.map.painter.height/1024};Object.setPrototypeOf(fakePainter,this.map.painter),mapboxgl.symbolProjection.updateLineLabels(bucket,mapboxModelToClipClamped.elements,fakePainter,!0,identity.elements,mapboxModelToClipClamped.elements,pitchWithMap,keepUpright)}var _iteratorNormalCompletion11=!0,_didIteratorError11=!1,_iteratorError11=void 0;try{for(var _step11,_iterator11=segments.get()[Symbol.iterator]();!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=!0){var segment=_step11.value;indexBuffer.bind(),buffers.dynamicLayoutVertexBuffer.bind(),this._bindVertexAttributes(this.symbolSDFShaderProgram,segment,buffers.dynamicLayoutVertexBuffer),buffers.layoutVertexBuffer.bind(),this._bindVertexAttributes(this.symbolSDFShaderProgram,segment,buffers.layoutVertexBuffer),gl.uniform1i(this.symbolSDFShaderProgram.uniformLocations.u_is_halo,0),gl.drawElements(gl.TRIANGLES,3*segment.primitiveLength,gl.UNSIGNED_SHORT,3*segment.primitiveOffset*2),this._unbindVertexAttributes(this.symbolSDFShaderProgram,buffers.layoutVertexBuffer),this._unbindVertexAttributes(this.symbolSDFShaderProgram,buffers.dynamicLayoutVertexBuffer)}}catch(err){_didIteratorError11=!0,_iteratorError11=err}finally{try{_iteratorNormalCompletion11||null==_iterator11.return||_iterator11.return()}finally{if(_didIteratorError11)throw _iteratorError11}}}}}},{key:"needsReRender",get:function(){return this._needsReRender}}]),TileRenderer}(),ANIMATION_SUITE=_objectSpread2(_objectSpread2({},{animationFallHeight:function(gl,loc){return gl.uniform4f(loc,0,0,1,1)},animationTileScale:function(gl,loc){return gl.uniform4f(loc,1,1,1,1)},animationFadeIn:function(gl,loc){return gl.uniform4f(loc,0,0,1,1)},animationSpreadOut:function(gl,loc){return gl.uniform4f(loc,1,1,1,1)}}),(amount=.2,{animationTileScale:function(gl,loc){return gl.uniform4f(loc,0,1,4,5)},animationFallHeight:function(gl,loc){return gl.uniform4f(loc,100,0,4,8)},animationFadeIn:function(gl,loc){return gl.uniform4f(loc,1,0,4,2)},animationSpreadOut:function(gl,loc){return gl.uniform4f(loc,amount,1,4,6)}})),TEXTURE_VERTEX_SHADER="\nattribute vec2 position;\nuniform mat4 worldToClip;\nuniform vec2 tileTranslation;\nuniform float tileScale;\nuniform vec2 tileRotation;\nuniform float tileFadeAmount;\nvarying highp vec2 vUv;\n\nuniform vec4 animationSpreadOut;\nuniform vec4 animationFallHeight;\nuniform vec4 animationTileScale;\n\nfloat tileHeight() {\n\tfloat suppressionRadius = animationFallHeight.y;\n\tfloat suppressionCoefficient = suppressionRadius != 0.0 ?\n\t\tclamp(length(tileTranslation) / (suppressionRadius * 2.) - suppressionRadius, 0.0, 1.0)\n\t\t: 1.0;\n\tfloat initialHeight = animationFallHeight.x * suppressionCoefficient;\n\tfloat speed = animationFallHeight.z;\n\tfloat tension = animationFallHeight.w;\n\treturn mix(initialHeight, 0.0, 1.0 - pow(1.0 - clamp(tileFadeAmount * speed, 0.0, 1.0), tension));\n}\n\nfloat tileSize() {\n\tfloat initialScale = animationTileScale.x;\n\tfloat finalScale = animationTileScale.y;\n\tfloat speed = animationTileScale.z;\n\tfloat tension = animationTileScale.w;\n\treturn mix(initialScale, finalScale, 1.0 - pow(1.0 - clamp(tileFadeAmount * speed, 0.0, 1.0), tension));\n}\n\nfloat tileSpread() {\n\tfloat initialSpread = animationSpreadOut.x;\n\tfloat finalSpread = animationSpreadOut.y;\n\tfloat speed = animationSpreadOut.z;\n\tfloat tension = animationSpreadOut.w;\n\treturn mix(initialSpread, finalSpread, 1.0 - pow(1.0 - clamp(tileFadeAmount * speed, 0.0, 1.0), tension));\n}\n\nvoid main() {\n\tfloat nx = position.x;\n\tfloat ny = -position.y;\n\tfloat s = tileRotation.x;\n\tfloat c = tileRotation.y;\n\tmat2 rotationMatrix = mat2(c, s, -s, c);\n\tvec2 rotatedPosition = rotationMatrix * vec2(nx, ny);\n\tvec2 scaleOrigin = rotationMatrix * vec2(0.5, -0.5);\n\tvec2 scaledPosition = ((rotatedPosition - scaleOrigin) * tileSize() + scaleOrigin) * tileScale;\n\tvec2 translatedPosition = scaledPosition + tileTranslation * tileSpread();\n\tvec4 homogeneousPosition = vec4(translatedPosition, tileHeight(), 1.0);\n\tgl_Position = worldToClip * homogeneousPosition;\n\tvUv = position;\n}\n",TEXTURE_FRAGMENT_SHADER="\nvarying highp vec2 vUv;\nuniform sampler2D tileTexture;\nuniform highp float tileFadeAmount;\n\nuniform highp vec4 animationFadeIn;\n\nhighp float fadeInAmount() {\n\thighp float speed = animationFadeIn.z;\n\thighp float tension = animationFadeIn.w;\n\treturn 1.0 - pow(1.0 - clamp(tileFadeAmount * speed, 0.0, 1.0), tension);\n}\n\nhighp vec4 fadeInColor(highp vec4 color) {\n\thighp float colorFadeAmount = animationFadeIn.x;\n\thighp float alphaFadeAmount = animationFadeIn.y;\n\treturn vec4(\n\t\tmix(vec3(1.0), color.rgb, mix(1.0, fadeInAmount(), colorFadeAmount)),\n\t\tmix(0.0, color.a, mix(1.0, fadeInAmount(), alphaFadeAmount))\n\t);\n}\n\nvoid main() {\n\thighp vec4 textureColor = texture2D(tileTexture, vUv * vec2(1., -1.) + vec2(0., 1.));\n\thighp vec4 color = fadeInColor(textureColor);\n\tgl_FragColor = color;\n}\n",DEBUG_VERTEX_SHADER="\nattribute vec2 position;\n\nvoid main() {\n\tgl_Position = vec4(position, 0., 1.);\n}\n",DEBUG_FRAGMENT_SHADER="\nvoid main() {\n\tgl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n}\n";export default MapboxOutdoorContext;
