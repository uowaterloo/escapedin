import{Vector3,Box3,Object3D,Raycaster,Color,EventDispatcher,MOUSE,PlaneGeometry,MeshBasicMaterial,Mesh,Vector2,Clock,Matrix4,Euler,WebGLRenderer,WebGLRenderTarget,RGBAFormat,NearestFilter,DepthTexture,UnsignedIntType,OrthographicCamera,ShaderMaterial,PlaneBufferGeometry,Scene,Font,Geometry,ExtrudeGeometry,CanvasTexture,InstancedBufferAttribute,InstancedBufferGeometry,BufferAttribute,RawShaderMaterial,DefaultLoadingManager,FileLoader,Group,BufferGeometry,MeshPhongMaterial,Loader,TextureLoader,FrontSide,RepeatWrapping,ClampToEdgeWrapping,DoubleSide,MeshLambertMaterial,Shape as Shape$1,Path,ExtrudeBufferGeometry,UVMapping,TextGeometry,Box3Helper,AxesHelper,CylinderGeometry,PerspectiveCamera,BoxGeometry,DirectionalLight,HemisphereLight,CatmullRomCurve3,TubeBufferGeometry}from"three";import TWEEN$1 from"@tweenjs/tween.js";import crypto from"crypto";import{LatLonSpherical}from"geodesy";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){return!call||"object"!=typeof call&&"function"!=typeof call?_assertThisInitialized(self):call}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=function(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}var Utils_1=Utils;function Utils(){}Utils.appendArray=function(a,b){if(b.length<15e4)a.push.apply(a,b);else for(var i=0,len=b.length;i!==len;++i)a.push(b[i])},Utils.splice=function(array,index,howmany){howmany=howmany||1;for(var i=index,len=array.length-howmany;i<len;i++)array[i]=array[i+howmany];array.length=len},"undefined"!=typeof P2_ARRAY_TYPE?Utils.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Utils.ARRAY_TYPE=Float32Array:Utils.ARRAY_TYPE=Array,Utils.extend=function(a,b){for(var key in b)a[key]=b[key]},Utils.defaults=function(options,defaults){for(var key in options=options||{},defaults)key in options||(options[key]=defaults[key]);return options};var vec2_1=createCommonjsModule((function(module){var vec2=module.exports={};vec2.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},vec2.crossVZ=function(out,vec,zcomp){return vec2.rotate(out,vec,-Math.PI/2),vec2.scale(out,out,zcomp),out},vec2.crossZV=function(out,zcomp,vec){return vec2.rotate(out,vec,Math.PI/2),vec2.scale(out,out,zcomp),out},vec2.rotate=function(out,a,angle){if(0!==angle){var c=Math.cos(angle),s=Math.sin(angle),x=a[0],y=a[1];out[0]=c*x-s*y,out[1]=s*x+c*y}else out[0]=a[0],out[1]=a[1]},vec2.rotate90cw=function(out,a){var x=a[0],y=a[1];out[0]=y,out[1]=-x},vec2.toLocalFrame=function(out,worldPoint,framePosition,frameAngle){vec2.copy(out,worldPoint),vec2.sub(out,out,framePosition),vec2.rotate(out,out,-frameAngle)},vec2.toGlobalFrame=function(out,localPoint,framePosition,frameAngle){vec2.copy(out,localPoint),vec2.rotate(out,out,frameAngle),vec2.add(out,out,framePosition)},vec2.vectorToLocalFrame=function(out,worldVector,frameAngle){vec2.rotate(out,worldVector,-frameAngle)},vec2.vectorToGlobalFrame=function(out,localVector,frameAngle){vec2.rotate(out,localVector,frameAngle)},vec2.centroid=function(out,a,b,c){return vec2.add(out,a,b),vec2.add(out,out,c),vec2.scale(out,out,1/3),out},vec2.create=function(){var out=new Utils_1.ARRAY_TYPE(2);return out[0]=0,out[1]=0,out},vec2.clone=function(a){var out=new Utils_1.ARRAY_TYPE(2);return out[0]=a[0],out[1]=a[1],out},vec2.fromValues=function(x,y){var out=new Utils_1.ARRAY_TYPE(2);return out[0]=x,out[1]=y,out},vec2.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out},vec2.set=function(out,x,y){return out[0]=x,out[1]=y,out},vec2.add=function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out},vec2.subtract=function(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out},vec2.sub=vec2.subtract,vec2.multiply=function(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out},vec2.mul=vec2.multiply,vec2.divide=function(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out},vec2.div=vec2.divide,vec2.scale=function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out},vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)},vec2.dist=vec2.distance,vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)},vec2.len=vec2.length,vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(out,a){return out[0]=-a[0],out[1]=-a[1],out},vec2.normalize=function(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len),out},vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out},vec2.reflect=function(out,vector,normal){var dot=vector[0]*normal[0]+vector[1]*normal[1];out[0]=vector[0]-2*normal[0]*dot,out[1]=vector[1]-2*normal[1]*dot},vec2.getLineSegmentsIntersection=function(out,p0,p1,p2,p3){var t=vec2.getLineSegmentsIntersectionFraction(p0,p1,p2,p3);return!(t<0)&&(out[0]=p0[0]+t*(p1[0]-p0[0]),out[1]=p0[1]+t*(p1[1]-p0[1]),!0)},vec2.getLineSegmentsIntersectionFraction=function(p0,p1,p2,p3){var s,t,s1_x=p1[0]-p0[0],s1_y=p1[1]-p0[1],s2_x=p3[0]-p2[0],s2_y=p3[1]-p2[1];return s=(-s1_y*(p0[0]-p2[0])+s1_x*(p0[1]-p2[1]))/(-s2_x*s1_y+s1_x*s2_y),t=(s2_x*(p0[1]-p2[1])-s2_y*(p0[0]-p2[0]))/(-s2_x*s1_y+s1_x*s2_y),s>=0&&s<=1&&t>=0&&t<=1?t:-1}})),AABB_1=AABB;function AABB(options){this.lowerBound=vec2_1.create(),options&&options.lowerBound&&vec2_1.copy(this.lowerBound,options.lowerBound),this.upperBound=vec2_1.create(),options&&options.upperBound&&vec2_1.copy(this.upperBound,options.upperBound)}var tmp=vec2_1.create();AABB.prototype.setFromPoints=function(points,position,angle,skinSize){var l=this.lowerBound,u=this.upperBound;"number"!=typeof angle&&(angle=0),0!==angle?vec2_1.rotate(l,points[0],angle):vec2_1.copy(l,points[0]),vec2_1.copy(u,l);for(var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),i=1;i<points.length;i++){var p=points[i];if(0!==angle){var x=p[0],y=p[1];tmp[0]=cosAngle*x-sinAngle*y,tmp[1]=sinAngle*x+cosAngle*y,p=tmp}for(var j=0;j<2;j++)p[j]>u[j]&&(u[j]=p[j]),p[j]<l[j]&&(l[j]=p[j])}position&&(vec2_1.add(this.lowerBound,this.lowerBound,position),vec2_1.add(this.upperBound,this.upperBound,position)),skinSize&&(this.lowerBound[0]-=skinSize,this.lowerBound[1]-=skinSize,this.upperBound[0]+=skinSize,this.upperBound[1]+=skinSize)},AABB.prototype.copy=function(aabb){vec2_1.copy(this.lowerBound,aabb.lowerBound),vec2_1.copy(this.upperBound,aabb.upperBound)},AABB.prototype.extend=function(aabb){for(var i=2;i--;){var l=aabb.lowerBound[i];this.lowerBound[i]>l&&(this.lowerBound[i]=l);var u=aabb.upperBound[i];this.upperBound[i]<u&&(this.upperBound[i]=u)}},AABB.prototype.overlaps=function(aabb){var l1=this.lowerBound,u1=this.upperBound,l2=aabb.lowerBound,u2=aabb.upperBound;return(l2[0]<=u1[0]&&u1[0]<=u2[0]||l1[0]<=u2[0]&&u2[0]<=u1[0])&&(l2[1]<=u1[1]&&u1[1]<=u2[1]||l1[1]<=u2[1]&&u2[1]<=u1[1])},AABB.prototype.containsPoint=function(point){var l=this.lowerBound,u=this.upperBound;return l[0]<=point[0]&&point[0]<=u[0]&&l[1]<=point[1]&&point[1]<=u[1]},AABB.prototype.overlapsRay=function(ray){var dirFracX=1/ray.direction[0],dirFracY=1/ray.direction[1],t1=(this.lowerBound[0]-ray.from[0])*dirFracX,t2=(this.upperBound[0]-ray.from[0])*dirFracX,t3=(this.lowerBound[1]-ray.from[1])*dirFracY,t4=(this.upperBound[1]-ray.from[1])*dirFracY,tmin=Math.max(Math.max(Math.min(t1,t2),Math.min(t3,t4))),tmax=Math.min(Math.min(Math.max(t1,t2),Math.max(t3,t4)));return tmax<0||tmin>tmax?-1:tmin};var Scalar_1=Scalar;function Scalar(){}Scalar.eq=function(a,b,precision){return precision=precision||0,Math.abs(a-b)<precision};var Line_1=Line;function Line(){}Line.lineInt=function(l1,l2,precision){precision=precision||0;var a1,b1,c1,a2,b2,c2,det,i=[0,0];return a1=l1[1][1]-l1[0][1],b1=l1[0][0]-l1[1][0],c1=a1*l1[0][0]+b1*l1[0][1],a2=l2[1][1]-l2[0][1],b2=l2[0][0]-l2[1][0],c2=a2*l2[0][0]+b2*l2[0][1],det=a1*b2-a2*b1,Scalar_1.eq(det,0,precision)||(i[0]=(b2*c1-b1*c2)/det,i[1]=(a1*c2-a2*c1)/det),i},Line.segmentsIntersect=function(p1,p2,q1,q2){var dx=p2[0]-p1[0],dy=p2[1]-p1[1],da=q2[0]-q1[0],db=q2[1]-q1[1];if(da*dy-db*dx==0)return!1;var s=(dx*(q1[1]-p1[1])+dy*(p1[0]-q1[0]))/(da*dy-db*dx),t=(da*(p1[1]-q1[1])+db*(q1[0]-p1[0]))/(db*dx-da*dy);return s>=0&&s<=1&&t>=0&&t<=1};var Point_1=Point;function Point(){}Point.area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])},Point.left=function(a,b,c){return Point.area(a,b,c)>0},Point.leftOn=function(a,b,c){return Point.area(a,b,c)>=0},Point.right=function(a,b,c){return Point.area(a,b,c)<0},Point.rightOn=function(a,b,c){return Point.area(a,b,c)<=0};var tmpPoint1=[],tmpPoint2=[];Point.collinear=function(a,b,c,thresholdAngle){if(thresholdAngle){var ab=tmpPoint1,bc=tmpPoint2;ab[0]=b[0]-a[0],ab[1]=b[1]-a[1],bc[0]=c[0]-b[0],bc[1]=c[1]-b[1];var dot=ab[0]*bc[0]+ab[1]*bc[1],magA=Math.sqrt(ab[0]*ab[0]+ab[1]*ab[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]);return Math.acos(dot/(magA*magB))<thresholdAngle}return 0==Point.area(a,b,c)},Point.sqdist=function(a,b){var dx=b[0]-a[0],dy=b[1]-a[1];return dx*dx+dy*dy};var Polygon_1=Polygon;function Polygon(){this.vertices=[]}Polygon.prototype.at=function(i){var v=this.vertices,s=v.length;return v[i<0?i%s+s:i%s]},Polygon.prototype.first=function(){return this.vertices[0]},Polygon.prototype.last=function(){return this.vertices[this.vertices.length-1]},Polygon.prototype.clear=function(){this.vertices.length=0},Polygon.prototype.append=function(poly,from,to){if(void 0===from)throw new Error("From is not given!");if(void 0===to)throw new Error("To is not given!");if(to-1<from)throw new Error("lol1");if(to>poly.vertices.length)throw new Error("lol2");if(from<0)throw new Error("lol3");for(var i=from;i<to;i++)this.vertices.push(poly.vertices[i])},Polygon.prototype.makeCCW=function(){for(var br=0,v=this.vertices,i=1;i<this.vertices.length;++i)(v[i][1]<v[br][1]||v[i][1]==v[br][1]&&v[i][0]>v[br][0])&&(br=i);Point_1.left(this.at(br-1),this.at(br),this.at(br+1))||this.reverse()},Polygon.prototype.reverse=function(){for(var tmp=[],i=0,N=this.vertices.length;i!==N;i++)tmp.push(this.vertices.pop());this.vertices=tmp},Polygon.prototype.isReflex=function(i){return Point_1.right(this.at(i-1),this.at(i),this.at(i+1))};var tmpLine1=[],tmpLine2=[];function getIntersectionPoint(p1,p2,q1,q2,delta){delta=delta||0;var a1=p2[1]-p1[1],b1=p1[0]-p2[0],c1=a1*p1[0]+b1*p1[1],a2=q2[1]-q1[1],b2=q1[0]-q2[0],c2=a2*q1[0]+b2*q1[1],det=a1*b2-a2*b1;return Scalar_1.eq(det,0,delta)?[0,0]:[(b2*c1-b1*c2)/det,(a1*c2-a2*c1)/det]}Polygon.prototype.canSee=function(a,b){var p,dist,l1=tmpLine1,l2=tmpLine2;if(Point_1.leftOn(this.at(a+1),this.at(a),this.at(b))&&Point_1.rightOn(this.at(a-1),this.at(a),this.at(b)))return!1;dist=Point_1.sqdist(this.at(a),this.at(b));for(var i=0;i!==this.vertices.length;++i)if((i+1)%this.vertices.length!==a&&i!==a&&Point_1.leftOn(this.at(a),this.at(b),this.at(i+1))&&Point_1.rightOn(this.at(a),this.at(b),this.at(i))&&(l1[0]=this.at(a),l1[1]=this.at(b),l2[0]=this.at(i),l2[1]=this.at(i+1),p=Line_1.lineInt(l1,l2),Point_1.sqdist(this.at(a),p)<dist))return!1;return!0},Polygon.prototype.copy=function(i,j,targetPoly){var p=targetPoly||new Polygon;if(p.clear(),i<j)for(var k=i;k<=j;k++)p.vertices.push(this.vertices[k]);else{for(k=0;k<=j;k++)p.vertices.push(this.vertices[k]);for(k=i;k<this.vertices.length;k++)p.vertices.push(this.vertices[k])}return p},Polygon.prototype.getCutEdges=function(){for(var min=[],tmp1=[],tmp2=[],tmpPoly=new Polygon,nDiags=Number.MAX_VALUE,i=0;i<this.vertices.length;++i)if(this.isReflex(i))for(var j=0;j<this.vertices.length;++j)if(this.canSee(i,j)){tmp1=this.copy(i,j,tmpPoly).getCutEdges(),tmp2=this.copy(j,i,tmpPoly).getCutEdges();for(var k=0;k<tmp2.length;k++)tmp1.push(tmp2[k]);tmp1.length<nDiags&&(min=tmp1,nDiags=tmp1.length,min.push([this.at(i),this.at(j)]))}return min},Polygon.prototype.decomp=function(){var edges=this.getCutEdges();return edges.length>0?this.slice(edges):[this]},Polygon.prototype.slice=function(cutEdges){if(0==cutEdges.length)return[this];if(cutEdges instanceof Array&&cutEdges.length&&cutEdges[0]instanceof Array&&2==cutEdges[0].length&&cutEdges[0][0]instanceof Array){for(var polys=[this],i=0;i<cutEdges.length;i++)for(var cutEdge=cutEdges[i],j=0;j<polys.length;j++){var result=polys[j].slice(cutEdge);if(result){polys.splice(j,1),polys.push(result[0],result[1]);break}}return polys}cutEdge=cutEdges,i=this.vertices.indexOf(cutEdge[0]),j=this.vertices.indexOf(cutEdge[1]);return-1!=i&&-1!=j&&[this.copy(i,j),this.copy(j,i)]},Polygon.prototype.isSimple=function(){for(var path=this.vertices,i=0;i<path.length-1;i++)for(var j=0;j<i-1;j++)if(Line_1.segmentsIntersect(path[i],path[i+1],path[j],path[j+1]))return!1;for(i=1;i<path.length-2;i++)if(Line_1.segmentsIntersect(path[0],path[path.length-1],path[i],path[i+1]))return!1;return!0},Polygon.prototype.quickDecomp=function(result,reflexVertices,steinerPoints,delta,maxlevel,level){maxlevel=maxlevel||100,level=level||0,delta=delta||25,result=void 0!==result?result:[],reflexVertices=reflexVertices||[],steinerPoints=steinerPoints||[];var upperInt=[0,0],lowerInt=[0,0],p=[0,0],upperDist=0,lowerDist=0,d=0,closestDist=0,upperIndex=0,lowerIndex=0,closestIndex=0,lowerPoly=new Polygon,upperPoly=new Polygon,v=this.vertices;if(v.length<3)return result;if(++level>maxlevel)return console.warn("quickDecomp: max level ("+maxlevel+") reached."),result;for(var i=0;i<this.vertices.length;++i)if(this.isReflex(i)){reflexVertices.push(this.vertices[i]),upperDist=lowerDist=Number.MAX_VALUE;for(var j=0;j<this.vertices.length;++j)Point_1.left(this.at(i-1),this.at(i),this.at(j))&&Point_1.rightOn(this.at(i-1),this.at(i),this.at(j-1))&&(p=getIntersectionPoint(this.at(i-1),this.at(i),this.at(j),this.at(j-1)),Point_1.right(this.at(i+1),this.at(i),p)&&(d=Point_1.sqdist(this.vertices[i],p))<lowerDist&&(lowerDist=d,lowerInt=p,lowerIndex=j)),Point_1.left(this.at(i+1),this.at(i),this.at(j+1))&&Point_1.rightOn(this.at(i+1),this.at(i),this.at(j))&&(p=getIntersectionPoint(this.at(i+1),this.at(i),this.at(j),this.at(j+1)),Point_1.left(this.at(i-1),this.at(i),p)&&(d=Point_1.sqdist(this.vertices[i],p))<upperDist&&(upperDist=d,upperInt=p,upperIndex=j));if(lowerIndex==(upperIndex+1)%this.vertices.length)p[0]=(lowerInt[0]+upperInt[0])/2,p[1]=(lowerInt[1]+upperInt[1])/2,steinerPoints.push(p),i<upperIndex?(lowerPoly.append(this,i,upperIndex+1),lowerPoly.vertices.push(p),upperPoly.vertices.push(p),0!=lowerIndex&&upperPoly.append(this,lowerIndex,this.vertices.length),upperPoly.append(this,0,i+1)):(0!=i&&lowerPoly.append(this,i,this.vertices.length),lowerPoly.append(this,0,upperIndex+1),lowerPoly.vertices.push(p),upperPoly.vertices.push(p),upperPoly.append(this,lowerIndex,i+1));else{if(lowerIndex>upperIndex&&(upperIndex+=this.vertices.length),closestDist=Number.MAX_VALUE,upperIndex<lowerIndex)return result;for(j=lowerIndex;j<=upperIndex;++j)Point_1.leftOn(this.at(i-1),this.at(i),this.at(j))&&Point_1.rightOn(this.at(i+1),this.at(i),this.at(j))&&(d=Point_1.sqdist(this.at(i),this.at(j)))<closestDist&&(closestDist=d,closestIndex=j%this.vertices.length);i<closestIndex?(lowerPoly.append(this,i,closestIndex+1),0!=closestIndex&&upperPoly.append(this,closestIndex,v.length),upperPoly.append(this,0,i+1)):(0!=i&&lowerPoly.append(this,i,v.length),lowerPoly.append(this,0,closestIndex+1),upperPoly.append(this,closestIndex,i+1))}return lowerPoly.vertices.length<upperPoly.vertices.length?(lowerPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level),upperPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level)):(upperPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level),lowerPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level)),result}return result.push(this),result},Polygon.prototype.removeCollinearPoints=function(precision){for(var num=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)Point_1.collinear(this.at(i-1),this.at(i),this.at(i+1),precision)&&(this.vertices.splice(i%this.vertices.length,1),i--,num++);return num};var src={Polygon:Polygon_1,Point:Point_1},Shape_1=Shape;function Shape(options){options=options||{},this.body=null,this.position=vec2_1.fromValues(0,0),options.position&&vec2_1.copy(this.position,options.position),this.angle=options.angle||0,this.type=options.type||0,this.id=Shape.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==options.collisionGroup?options.collisionGroup:1,this.collisionResponse=void 0===options.collisionResponse||options.collisionResponse,this.collisionMask=void 0!==options.collisionMask?options.collisionMask:1,this.material=options.material||null,this.area=0,this.sensor=void 0!==options.sensor&&options.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}Shape.idCounter=0,Shape.CIRCLE=1,Shape.PARTICLE=2,Shape.PLANE=4,Shape.CONVEX=8,Shape.LINE=16,Shape.BOX=32,Object.defineProperty(Shape,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),Shape.BOX}}),Shape.CAPSULE=64,Shape.HEIGHTFIELD=128,Shape.prototype.computeMomentOfInertia=function(mass){},Shape.prototype.updateBoundingRadius=function(){},Shape.prototype.updateArea=function(){},Shape.prototype.computeAABB=function(out,position,angle){},Shape.prototype.raycast=function(result,ray,position,angle){};var PolyK={GetArea:function(p){if(p.length<6)return 0;for(var l=p.length-2,sum=0,i=0;i<l;i+=2)sum+=(p[i+2]-p[i])*(p[i+1]+p[i+3]);return.5*-(sum+=(p[0]-p[l])*(p[l+1]+p[1]))},Triangulate:function(p){var n=p.length>>1;if(n<3)return[];for(var tgs=[],avl=[],i=0;i<n;i++)avl.push(i);i=0;for(var al=n;al>3;){var i0=avl[(i+0)%al],i1=avl[(i+1)%al],i2=avl[(i+2)%al],ax=p[2*i0],ay=p[2*i0+1],bx=p[2*i1],by=p[2*i1+1],cx=p[2*i2],cy=p[2*i2+1],earFound=!1;if(PolyK._convex(ax,ay,bx,by,cx,cy)){earFound=!0;for(var j=0;j<al;j++){var vi=avl[j];if(vi!=i0&&vi!=i1&&vi!=i2&&PolyK._PointInTriangle(p[2*vi],p[2*vi+1],ax,ay,bx,by,cx,cy)){earFound=!1;break}}}if(earFound)tgs.push(i0,i1,i2),avl.splice((i+1)%al,1),al--,i=0;else if(i++>3*al)break}return tgs.push(avl[0],avl[1],avl[2]),tgs},_PointInTriangle:function(px,py,ax,ay,bx,by,cx,cy){var v0x=cx-ax,v0y=cy-ay,v1x=bx-ax,v1y=by-ay,v2x=px-ax,v2y=py-ay,dot00=v0x*v0x+v0y*v0y,dot01=v0x*v1x+v0y*v1y,dot02=v0x*v2x+v0y*v2y,dot11=v1x*v1x+v1y*v1y,dot12=v1x*v2x+v1y*v2y,invDenom=1/(dot00*dot11-dot01*dot01),u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&u+v<1},_convex:function(ax,ay,bx,by,cx,cy){return(ay-by)*(cx-bx)+(bx-ax)*(cy-by)>=0}},polyk=PolyK,Convex_1=Convex;function Convex(options){Array.isArray(arguments[0])&&(options={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),options=options||{},this.vertices=[];for(var vertices=void 0!==options.vertices?options.vertices:[],i=0;i<vertices.length;i++){var v=vec2_1.create();vec2_1.copy(v,vertices[i]),this.vertices.push(v)}if(this.axes=[],options.axes)for(i=0;i<options.axes.length;i++){var axis=vec2_1.create();vec2_1.copy(axis,options.axes[i]),this.axes.push(axis)}else for(i=0;i<this.vertices.length;i++){var worldPoint0=this.vertices[i],worldPoint1=this.vertices[(i+1)%this.vertices.length],normal=vec2_1.create();vec2_1.sub(normal,worldPoint1,worldPoint0),vec2_1.rotate90cw(normal,normal),vec2_1.normalize(normal,normal),this.axes.push(normal)}if(this.centerOfMass=vec2_1.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,options.type=Shape_1.CONVEX,Shape_1.call(this,options),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}Convex.prototype=new Shape_1,Convex.prototype.constructor=Convex;var tmpVec1=vec2_1.create(),tmpVec2=vec2_1.create();Convex.prototype.projectOntoLocalAxis=function(localAxis,result){for(var v,value,max=null,min=null,i=(localAxis=tmpVec1,0);i<this.vertices.length;i++)v=this.vertices[i],value=vec2_1.dot(v,localAxis),(null===max||value>max)&&(max=value),(null===min||value<min)&&(min=value);if(min>max){var t=min;min=max,max=t}vec2_1.set(result,min,max)},Convex.prototype.projectOntoWorldAxis=function(localAxis,shapeOffset,shapeAngle,result){var worldAxis=tmpVec2;this.projectOntoLocalAxis(localAxis,result),0!==shapeAngle?vec2_1.rotate(worldAxis,localAxis,shapeAngle):worldAxis=localAxis;var offset=vec2_1.dot(shapeOffset,worldAxis);vec2_1.set(result,result[0]+offset,result[1]+offset)},Convex.prototype.updateTriangles=function(){this.triangles.length=0;for(var polykVerts=[],i=0;i<this.vertices.length;i++){var v=this.vertices[i];polykVerts.push(v[0],v[1])}var triangles=polyk.Triangulate(polykVerts);for(i=0;i<triangles.length;i+=3){var id1=triangles[i],id2=triangles[i+1],id3=triangles[i+2];this.triangles.push([id1,id2,id3])}};var updateCenterOfMass_centroid=vec2_1.create(),updateCenterOfMass_centroid_times_mass=vec2_1.create(),updateCenterOfMass_a=vec2_1.create(),updateCenterOfMass_b=vec2_1.create(),updateCenterOfMass_c=vec2_1.create();vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create();Convex.prototype.updateCenterOfMass=function(){var triangles=this.triangles,verts=this.vertices,cm=this.centerOfMass,centroid=updateCenterOfMass_centroid,a=updateCenterOfMass_a,b=updateCenterOfMass_b,c=updateCenterOfMass_c,centroid_times_mass=updateCenterOfMass_centroid_times_mass;vec2_1.set(cm,0,0);for(var totalArea=0,i=0;i!==triangles.length;i++){var t=triangles[i];a=verts[t[0]],b=verts[t[1]],c=verts[t[2]];vec2_1.centroid(centroid,a,b,c);var m=Convex.triangleArea(a,b,c);totalArea+=m,vec2_1.scale(centroid_times_mass,centroid,m),vec2_1.add(cm,cm,centroid_times_mass)}vec2_1.scale(cm,cm,1/totalArea)},Convex.prototype.computeMomentOfInertia=function(mass){for(var denom=0,numer=0,N=this.vertices.length,j=N-1,i=0;i<N;j=i,i++){var p0=this.vertices[j],p1=this.vertices[i],a=Math.abs(vec2_1.crossLength(p0,p1));denom+=a*(vec2_1.dot(p1,p1)+vec2_1.dot(p1,p0)+vec2_1.dot(p0,p0)),numer+=a}return mass/6*(denom/numer)},Convex.prototype.updateBoundingRadius=function(){for(var verts=this.vertices,r2=0,i=0;i!==verts.length;i++){var l2=vec2_1.squaredLength(verts[i]);l2>r2&&(r2=l2)}this.boundingRadius=Math.sqrt(r2)},Convex.triangleArea=function(a,b,c){return.5*((b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]))},Convex.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var triangles=this.triangles,verts=this.vertices,i=0;i!==triangles.length;i++){var t=triangles[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]],m=Convex.triangleArea(a,b,c);this.area+=m}},Convex.prototype.computeAABB=function(out,position,angle){out.setFromPoints(this.vertices,position,angle,0)};var intersectConvex_rayStart=vec2_1.create(),intersectConvex_rayEnd=vec2_1.create(),intersectConvex_normal=vec2_1.create();Convex.prototype.raycast=function(result,ray,position,angle){var rayStart=intersectConvex_rayStart,rayEnd=intersectConvex_rayEnd,normal=intersectConvex_normal,vertices=this.vertices;vec2_1.toLocalFrame(rayStart,ray.from,position,angle),vec2_1.toLocalFrame(rayEnd,ray.to,position,angle);for(var n=vertices.length,i=0;i<n&&!result.shouldStop(ray);i++){var q1=vertices[i],q2=vertices[(i+1)%n],delta=vec2_1.getLineSegmentsIntersectionFraction(rayStart,rayEnd,q1,q2);delta>=0&&(vec2_1.sub(normal,q2,q1),vec2_1.rotate(normal,normal,-Math.PI/2+angle),vec2_1.normalize(normal,normal),ray.reportIntersection(result,delta,normal,i))}};var Ray_1=Ray;function Ray(options){options=options||{},this.from=options.from?vec2_1.fromValues(options.from[0],options.from[1]):vec2_1.create(),this.to=options.to?vec2_1.fromValues(options.to[0],options.to[1]):vec2_1.create(),this.checkCollisionResponse=void 0===options.checkCollisionResponse||options.checkCollisionResponse,this.skipBackfaces=!!options.skipBackfaces,this.collisionMask=void 0!==options.collisionMask?options.collisionMask:-1,this.collisionGroup=void 0!==options.collisionGroup?options.collisionGroup:-1,this.mode=void 0!==options.mode?options.mode:Ray.ANY,this.callback=options.callback||function(result){},this.direction=vec2_1.create(),this.length=1,this.update()}Ray.prototype.constructor=Ray,Ray.CLOSEST=1,Ray.ANY=2,Ray.ALL=4,Ray.prototype.update=function(){var d=this.direction;vec2_1.sub(d,this.to,this.from),this.length=vec2_1.length(d),vec2_1.normalize(d,d)},Ray.prototype.intersectBodies=function(result,bodies){for(var i=0,l=bodies.length;!result.shouldStop(this)&&i<l;i++){var body=bodies[i],aabb=body.getAABB();(aabb.overlapsRay(this)>=0||aabb.containsPoint(this.from))&&this.intersectBody(result,body)}};var intersectBody_worldPosition=vec2_1.create();Ray.prototype.intersectBody=function(result,body){var checkCollisionResponse=this.checkCollisionResponse;if(!checkCollisionResponse||body.collisionResponse)for(var worldPosition=intersectBody_worldPosition,i=0,N=body.shapes.length;i<N;i++){var shape=body.shapes[i];if((!checkCollisionResponse||shape.collisionResponse)&&(0!=(this.collisionGroup&shape.collisionMask)&&0!=(shape.collisionGroup&this.collisionMask))){vec2_1.rotate(worldPosition,shape.position,body.angle),vec2_1.add(worldPosition,worldPosition,body.position);var worldAngle=shape.angle+body.angle;if(this.intersectShape(result,shape,worldAngle,worldPosition,body),result.shouldStop(this))break}}},Ray.prototype.intersectShape=function(result,shape,angle,position,body){(function(from,direction,position){vec2_1.sub(v0,position,from);var dot=vec2_1.dot(v0,direction);return vec2_1.scale(intersect,direction,dot),vec2_1.add(intersect,intersect,from),vec2_1.squaredDistance(position,intersect)})(this.from,this.direction,position)>shape.boundingRadius*shape.boundingRadius||(this._currentBody=body,this._currentShape=shape,shape.raycast(result,this,position,angle),this._currentBody=this._currentShape=null)},Ray.prototype.getAABB=function(result){var to=this.to,from=this.from;vec2_1.set(result.lowerBound,Math.min(to[0],from[0]),Math.min(to[1],from[1])),vec2_1.set(result.upperBound,Math.max(to[0],from[0]),Math.max(to[1],from[1]))};vec2_1.create();Ray.prototype.reportIntersection=function(result,fraction,normal,faceIndex){this.from,this.to;var shape=this._currentShape,body=this._currentBody;if(!(this.skipBackfaces&&vec2_1.dot(normal,this.direction)>0))switch(this.mode){case Ray.ALL:result.set(normal,shape,body,fraction,faceIndex),this.callback(result);break;case Ray.CLOSEST:(fraction<result.fraction||!result.hasHit())&&result.set(normal,shape,body,fraction,faceIndex);break;case Ray.ANY:result.set(normal,shape,body,fraction,faceIndex)}};var v0=vec2_1.create(),intersect=vec2_1.create();var RaycastResult_1=RaycastResult;function RaycastResult(){this.normal=vec2_1.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}RaycastResult.prototype.reset=function(){vec2_1.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},RaycastResult.prototype.getHitDistance=function(ray){return vec2_1.distance(ray.from,ray.to)*this.fraction},RaycastResult.prototype.hasHit=function(){return-1!==this.fraction},RaycastResult.prototype.getHitPoint=function(out,ray){vec2_1.lerp(out,ray.from,ray.to,this.fraction)},RaycastResult.prototype.stop=function(){this.isStopped=!0},RaycastResult.prototype.shouldStop=function(ray){return this.isStopped||-1!==this.fraction&&ray.mode===Ray_1.ANY},RaycastResult.prototype.set=function(normal,shape,body,fraction,faceIndex){vec2_1.copy(this.normal,normal),this.shape=shape,this.body=body,this.fraction=fraction,this.faceIndex=faceIndex};var EventEmitter=function(){},EventEmitter_1=EventEmitter;EventEmitter.prototype={constructor:EventEmitter,on:function(type,listener,context){listener.context=context||this,void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;return void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener),this},has:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;if(listener){if(void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener))return!0}else if(void 0!==listeners[type])return!0;return!1},off:function(type,listener){if(void 0===this._listeners)return this;var listeners=this._listeners,index=listeners[type].indexOf(listener);return-1!==index&&listeners[type].splice(index,1),this},emit:function(event){if(void 0===this._listeners)return this;var listenerArray=this._listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;i<l;i++){var listener=listenerArray[i];listener.call(listener.context,event)}}return this}};var Body_1=Body;function Body(options){options=options||{},EventEmitter_1.call(this),this.id=options.id||++Body._idCounter,this.world=null,this.shapes=[],this.mass=options.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!options.fixedRotation,this.fixedX=!!options.fixedX,this.fixedY=!!options.fixedY,this.massMultiplier=vec2_1.create(),this.position=vec2_1.fromValues(0,0),options.position&&vec2_1.copy(this.position,options.position),this.interpolatedPosition=vec2_1.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=vec2_1.fromValues(0,0),this.previousAngle=0,this.velocity=vec2_1.fromValues(0,0),options.velocity&&vec2_1.copy(this.velocity,options.velocity),this.vlambda=vec2_1.fromValues(0,0),this.wlambda=0,this.angle=options.angle||0,this.angularVelocity=options.angularVelocity||0,this.force=vec2_1.create(),options.force&&vec2_1.copy(this.force,options.force),this.angularForce=options.angularForce||0,this.damping="number"==typeof options.damping?options.damping:.1,this.angularDamping="number"==typeof options.angularDamping?options.angularDamping:.1,this.type=Body.STATIC,void 0!==options.type?this.type=options.type:options.mass?this.type=Body.DYNAMIC:this.type=Body.STATIC,this.boundingRadius=0,this.aabb=new AABB_1,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===options.allowSleep||options.allowSleep,this.wantsToSleep=!1,this.sleepState=Body.AWAKE,this.sleepSpeedLimit=void 0!==options.sleepSpeedLimit?options.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==options.sleepTimeLimit?options.sleepTimeLimit:1,this.gravityScale=void 0!==options.gravityScale?options.gravityScale:1,this.collisionResponse=void 0===options.collisionResponse||options.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==options.ccdSpeedThreshold?options.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==options.ccdIterations?options.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}Body.prototype=new EventEmitter_1,Body.prototype.constructor=Body,Body._idCounter=0,Body.prototype.updateSolveMassProperties=function(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},Body.prototype.setDensity=function(density){var totalArea=this.getArea();this.mass=totalArea*density,this.updateMassProperties()},Body.prototype.getArea=function(){for(var totalArea=0,i=0;i<this.shapes.length;i++)totalArea+=this.shapes[i].area;return totalArea},Body.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var shapeAABB=new AABB_1,tmp$1=vec2_1.create();Body.prototype.updateAABB=function(){for(var shapes=this.shapes,N=shapes.length,offset=tmp$1,bodyAngle=this.angle,i=0;i!==N;i++){var shape=shapes[i],angle=shape.angle+bodyAngle;vec2_1.rotate(offset,shape.position,bodyAngle),vec2_1.add(offset,offset,this.position),shape.computeAABB(shapeAABB,offset,angle),0===i?this.aabb.copy(shapeAABB):this.aabb.extend(shapeAABB)}this.aabbNeedsUpdate=!1},Body.prototype.updateBoundingRadius=function(){for(var shapes=this.shapes,N=shapes.length,radius=0,i=0;i!==N;i++){var shape=shapes[i],offset=vec2_1.length(shape.position),r=shape.boundingRadius;offset+r>radius&&(radius=offset+r)}this.boundingRadius=radius},Body.prototype.addShape=function(shape,offset,angle){if(shape.body)throw new Error("A shape can only be added to one body.");shape.body=this,offset?vec2_1.copy(shape.position,offset):vec2_1.set(shape.position,0,0),shape.angle=angle||0,this.shapes.push(shape),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},Body.prototype.removeShape=function(shape){var idx=this.shapes.indexOf(shape);return-1!==idx&&(this.shapes.splice(idx,1),this.aabbNeedsUpdate=!0,shape.body=null,!0)},Body.prototype.updateMassProperties=function(){if(this.type===Body.STATIC||this.type===Body.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var shapes=this.shapes,N=shapes.length,m=this.mass/N,I=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var i=0;i<N;i++){var shape=shapes[i],r2=vec2_1.squaredLength(shape.position);I+=shape.computeMomentOfInertia(m)+m*r2}this.inertia=I,this.invInertia=I>0?1/I:0}this.invMass=1/this.mass,vec2_1.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};vec2_1.create();Body.prototype.applyForce=function(force,relativePoint){if(vec2_1.add(this.force,this.force,force),relativePoint){var rotForce=vec2_1.crossLength(relativePoint,force);this.angularForce+=rotForce}};var Body_applyForce_forceWorld=vec2_1.create(),Body_applyForce_pointWorld=vec2_1.create(),Body_applyForce_pointLocal=vec2_1.create();Body.prototype.applyForceLocal=function(localForce,localPoint){localPoint=localPoint||Body_applyForce_pointLocal;var worldForce=Body_applyForce_forceWorld,worldPoint=Body_applyForce_pointWorld;this.vectorToWorldFrame(worldForce,localForce),this.vectorToWorldFrame(worldPoint,localPoint),this.applyForce(worldForce,worldPoint)};var Body_applyImpulse_velo=vec2_1.create();Body.prototype.applyImpulse=function(impulseVector,relativePoint){if(this.type===Body.DYNAMIC){var velo=Body_applyImpulse_velo;if(vec2_1.scale(velo,impulseVector,this.invMass),vec2_1.multiply(velo,this.massMultiplier,velo),vec2_1.add(this.velocity,velo,this.velocity),relativePoint){var rotVelo=vec2_1.crossLength(relativePoint,impulseVector);rotVelo*=this.invInertia,this.angularVelocity+=rotVelo}}};var Body_applyImpulse_impulseWorld=vec2_1.create(),Body_applyImpulse_pointWorld=vec2_1.create(),Body_applyImpulse_pointLocal=vec2_1.create();Body.prototype.applyImpulseLocal=function(localImpulse,localPoint){localPoint=localPoint||Body_applyImpulse_pointLocal;var worldImpulse=Body_applyImpulse_impulseWorld,worldPoint=Body_applyImpulse_pointWorld;this.vectorToWorldFrame(worldImpulse,localImpulse),this.vectorToWorldFrame(worldPoint,localPoint),this.applyImpulse(worldImpulse,worldPoint)},Body.prototype.toLocalFrame=function(out,worldPoint){vec2_1.toLocalFrame(out,worldPoint,this.position,this.angle)},Body.prototype.toWorldFrame=function(out,localPoint){vec2_1.toGlobalFrame(out,localPoint,this.position,this.angle)},Body.prototype.vectorToLocalFrame=function(out,worldVector){vec2_1.vectorToLocalFrame(out,worldVector,this.angle)},Body.prototype.vectorToWorldFrame=function(out,localVector){vec2_1.vectorToGlobalFrame(out,localVector,this.angle)},Body.prototype.fromPolygon=function(path,options){options=options||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var convexes,p=new src.Polygon;if(p.vertices=path,p.makeCCW(),"number"==typeof options.removeCollinearPoints&&p.removeCollinearPoints(options.removeCollinearPoints),void 0===options.skipSimpleCheck&&!p.isSimple())return!1;this.concavePath=p.vertices.slice(0);for(i=0;i<this.concavePath.length;i++){var v=[0,0];vec2_1.copy(v,this.concavePath[i]),this.concavePath[i]=v}convexes=options.optimalDecomp?p.decomp():p.quickDecomp();var cm=vec2_1.create();for(i=0;i!==convexes.length;i++){for(var c=new Convex_1({vertices:convexes[i].vertices}),j=0;j!==c.vertices.length;j++){v=c.vertices[j];vec2_1.sub(v,v,c.centerOfMass)}vec2_1.scale(cm,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,cm)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};vec2_1.fromValues(0,0);var adjustCenterOfMass_tmp2=vec2_1.fromValues(0,0),adjustCenterOfMass_tmp3=vec2_1.fromValues(0,0),adjustCenterOfMass_tmp4=vec2_1.fromValues(0,0);Body.prototype.adjustCenterOfMass=function(){var offset_times_area=adjustCenterOfMass_tmp2,sum=adjustCenterOfMass_tmp3,cm=adjustCenterOfMass_tmp4,totalArea=0;vec2_1.set(sum,0,0);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i];vec2_1.scale(offset_times_area,s.position,s.area),vec2_1.add(sum,sum,offset_times_area),totalArea+=s.area}vec2_1.scale(cm,sum,1/totalArea);for(i=0;i!==this.shapes.length;i++){s=this.shapes[i];vec2_1.sub(s.position,s.position,cm)}vec2_1.add(this.position,this.position,cm);for(i=0;this.concavePath&&i<this.concavePath.length;i++)vec2_1.sub(this.concavePath[i],this.concavePath[i],cm);this.updateMassProperties(),this.updateBoundingRadius()},Body.prototype.setZeroForce=function(){vec2_1.set(this.force,0,0),this.angularForce=0},Body.prototype.resetConstraintVelocity=function(){var vlambda=this.vlambda;vec2_1.set(vlambda,0,0),this.wlambda=0},Body.prototype.addConstraintVelocity=function(){var b=this,v=b.velocity;vec2_1.add(v,v,b.vlambda),b.angularVelocity+=b.wlambda},Body.prototype.applyDamping=function(dt){if(this.type===Body.DYNAMIC){var v=this.velocity;vec2_1.scale(v,v,Math.pow(1-this.damping,dt)),this.angularVelocity*=Math.pow(1-this.angularDamping,dt)}},Body.prototype.wakeUp=function(){var s=this.sleepState;this.sleepState=Body.AWAKE,this.idleTime=0,s!==Body.AWAKE&&this.emit(Body.wakeUpEvent)},Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING,this.angularVelocity=0,this.angularForce=0,vec2_1.set(this.velocity,0,0),vec2_1.set(this.force,0,0),this.emit(Body.sleepEvent)},Body.prototype.sleepTick=function(time,dontSleep,dt){if(this.allowSleep&&this.type!==Body.SLEEPING){this.wantsToSleep=!1;this.sleepState;vec2_1.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=Body.AWAKE):(this.idleTime+=dt,this.sleepState=Body.SLEEPY),this.idleTime>this.sleepTimeLimit&&(dontSleep?this.wantsToSleep=!0:this.sleep())}},Body.prototype.overlaps=function(body){return this.world.overlapKeeper.bodiesAreOverlapping(this,body)};var integrate_fhMinv=vec2_1.create(),integrate_velodt=vec2_1.create();Body.prototype.integrate=function(dt){var minv=this.invMass,f=this.force,pos=this.position,velo=this.velocity;vec2_1.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*dt),vec2_1.scale(integrate_fhMinv,f,dt*minv),vec2_1.multiply(integrate_fhMinv,this.massMultiplier,integrate_fhMinv),vec2_1.add(velo,integrate_fhMinv,velo),this.integrateToTimeOfImpact(dt)||(vec2_1.scale(integrate_velodt,velo,dt),vec2_1.add(pos,pos,integrate_velodt),this.fixedRotation||(this.angle+=this.angularVelocity*dt)),this.aabbNeedsUpdate=!0};var result=new RaycastResult_1,ray=new Ray_1({mode:Ray_1.ALL}),direction=vec2_1.create(),end=vec2_1.create(),startToEnd=vec2_1.create(),rememberPosition=vec2_1.create();Body.prototype.integrateToTimeOfImpact=function(dt){if(this.ccdSpeedThreshold<0||vec2_1.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;vec2_1.normalize(direction,this.velocity),vec2_1.scale(end,this.velocity,dt),vec2_1.add(end,end,this.position),vec2_1.sub(startToEnd,end,this.position);var hit,startToEndAngle=this.angularVelocity*dt,len=vec2_1.length(startToEnd),timeOfImpact=1,that=this;if(result.reset(),ray.callback=function(result){result.body!==that&&(hit=result.body,result.getHitPoint(end,ray),vec2_1.sub(startToEnd,end,that.position),timeOfImpact=vec2_1.length(startToEnd)/len,result.stop())},vec2_1.copy(ray.from,this.position),vec2_1.copy(ray.to,end),ray.update(),this.world.raycast(result,ray),!hit)return!1;var rememberAngle=this.angle;vec2_1.copy(rememberPosition,this.position);for(var iter=0,tmin=0,tmid=0,tmax=timeOfImpact;tmax>=tmin&&iter<this.ccdIterations;){iter++,tmid=(tmax-tmin)/2,vec2_1.scale(integrate_velodt,startToEnd,timeOfImpact),vec2_1.add(this.position,rememberPosition,integrate_velodt),this.angle=rememberAngle+startToEndAngle*timeOfImpact,this.updateAABB(),this.aabb.overlaps(hit.aabb)&&this.world.narrowphase.bodiesOverlap(this,hit)?tmin=tmid:tmax=tmid}return timeOfImpact=tmid,vec2_1.copy(this.position,rememberPosition),this.angle=rememberAngle,vec2_1.scale(integrate_velodt,startToEnd,timeOfImpact),vec2_1.add(this.position,this.position,integrate_velodt),this.fixedRotation||(this.angle+=startToEndAngle*timeOfImpact),!0},Body.prototype.getVelocityAtPoint=function(result,relativePoint){return vec2_1.crossVZ(result,relativePoint,this.angularVelocity),vec2_1.subtract(result,this.velocity,result),result},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"},Body.wakeUpEvent={type:"wakeup"},Body.DYNAMIC=1,Body.STATIC=2,Body.KINEMATIC=4,Body.AWAKE=0,Body.SLEEPY=1,Body.SLEEPING=2;var Equation_1=Equation;function Equation(bodyA,bodyB,minForce,maxForce){this.minForce=void 0===minForce?-Number.MAX_VALUE:minForce,this.maxForce=void 0===maxForce?Number.MAX_VALUE:maxForce,this.bodyA=bodyA,this.bodyB=bodyB,this.stiffness=Equation.DEFAULT_STIFFNESS,this.relaxation=Equation.DEFAULT_RELAXATION,this.G=new Utils_1.ARRAY_TYPE(6);for(var i=0;i<6;i++)this.G[i]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}Equation.prototype.constructor=Equation,Equation.DEFAULT_STIFFNESS=1e6,Equation.DEFAULT_RELAXATION=4,Equation.prototype.update=function(){var k=this.stiffness,d=this.relaxation,h=this.timeStep;this.a=4/(h*(1+4*d)),this.b=4*d/(1+4*d),this.epsilon=4/(h*h*k*(1+4*d)),this.needsUpdate=!1},Equation.prototype.gmult=function(G,vi,wi,vj,wj){return G[0]*vi[0]+G[1]*vi[1]+G[2]*wi+G[3]*vj[0]+G[4]*vj[1]+G[5]*wj},Equation.prototype.computeB=function(a,b,h){var GW=this.computeGW();return-this.computeGq()*a-GW*b-this.computeGiMf()*h};var qi=vec2_1.create(),qj=vec2_1.create();Equation.prototype.computeGq=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,ai=(bi.position,bj.position,bi.angle),aj=bj.angle;return this.gmult(G,qi,ai,qj,aj)+this.offset},Equation.prototype.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+this.relativeVelocity},Equation.prototype.computeGWlambda=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.vlambda,vj=bj.vlambda,wi=bi.wlambda,wj=bj.wlambda;return this.gmult(G,vi,wi,vj,wj)};var iMfi=vec2_1.create(),iMfj=vec2_1.create();Equation.prototype.computeGiMf=function(){var bi=this.bodyA,bj=this.bodyB,fi=bi.force,ti=bi.angularForce,fj=bj.force,tj=bj.angularForce,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;return vec2_1.scale(iMfi,fi,invMassi),vec2_1.multiply(iMfi,bi.massMultiplier,iMfi),vec2_1.scale(iMfj,fj,invMassj),vec2_1.multiply(iMfj,bj.massMultiplier,iMfj),this.gmult(G,iMfi,ti*invIi,iMfj,tj*invIj)},Equation.prototype.computeGiMGt=function(){var bi=this.bodyA,bj=this.bodyB,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;return G[0]*G[0]*invMassi*bi.massMultiplier[0]+G[1]*G[1]*invMassi*bi.massMultiplier[1]+G[2]*G[2]*invIi+G[3]*G[3]*invMassj*bj.massMultiplier[0]+G[4]*G[4]*invMassj*bj.massMultiplier[1]+G[5]*G[5]*invIj};var addToWlambda_temp=vec2_1.create(),addToWlambda_Gi=vec2_1.create(),addToWlambda_Gj=vec2_1.create();vec2_1.create(),vec2_1.create(),vec2_1.create();Equation.prototype.addToWlambda=function(deltalambda){var bi=this.bodyA,bj=this.bodyB,temp=addToWlambda_temp,Gi=addToWlambda_Gi,Gj=addToWlambda_Gj,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;Gi[0]=G[0],Gi[1]=G[1],Gj[0]=G[3],Gj[1]=G[4],vec2_1.scale(temp,Gi,invMassi*deltalambda),vec2_1.multiply(temp,temp,bi.massMultiplier),vec2_1.add(bi.vlambda,bi.vlambda,temp),bi.wlambda+=invIi*G[2]*deltalambda,vec2_1.scale(temp,Gj,invMassj*deltalambda),vec2_1.multiply(temp,temp,bj.massMultiplier),vec2_1.add(bj.vlambda,bj.vlambda,temp),bj.wlambda+=invIj*G[5]*deltalambda},Equation.prototype.computeInvC=function(eps){return 1/(this.computeGiMGt()+eps)};var AngleLockEquation_1=AngleLockEquation;function AngleLockEquation(bodyA,bodyB,options){options=options||{},Equation_1.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=options.angle||0,this.ratio="number"==typeof options.ratio?options.ratio:1,this.setRatio(this.ratio)}AngleLockEquation.prototype=new Equation_1,AngleLockEquation.prototype.constructor=AngleLockEquation,AngleLockEquation.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},AngleLockEquation.prototype.setRatio=function(ratio){var G=this.G;G[2]=ratio,G[5]=-1,this.ratio=ratio},AngleLockEquation.prototype.setMaxTorque=function(torque){this.maxForce=torque,this.minForce=-torque};var Broadphase_1=Broadphase;function Broadphase(type){this.type=type,this.result=[],this.world=null,this.boundingVolumeType=Broadphase.AABB}Broadphase.AABB=1,Broadphase.BOUNDING_CIRCLE=2,Broadphase.prototype.setWorld=function(world){this.world=world},Broadphase.prototype.getCollisionPairs=function(world){};var dist=vec2_1.create();Broadphase.boundingRadiusCheck=function(bodyA,bodyB){vec2_1.sub(dist,bodyA.position,bodyB.position);var d2=vec2_1.squaredLength(dist),r=bodyA.boundingRadius+bodyB.boundingRadius;return d2<=r*r},Broadphase.aabbCheck=function(bodyA,bodyB){return bodyA.getAABB().overlaps(bodyB.getAABB())},Broadphase.prototype.boundingVolumeCheck=function(bodyA,bodyB){var result;switch(this.boundingVolumeType){case Broadphase.BOUNDING_CIRCLE:result=Broadphase.boundingRadiusCheck(bodyA,bodyB);break;case Broadphase.AABB:result=Broadphase.aabbCheck(bodyA,bodyB);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return result},Broadphase.canCollide=function(bodyA,bodyB){var KINEMATIC=Body_1.KINEMATIC,STATIC=Body_1.STATIC;return(bodyA.type!==STATIC||bodyB.type!==STATIC)&&(!(bodyA.type===KINEMATIC&&bodyB.type===STATIC||bodyA.type===STATIC&&bodyB.type===KINEMATIC)&&((bodyA.type!==KINEMATIC||bodyB.type!==KINEMATIC)&&((bodyA.sleepState!==Body_1.SLEEPING||bodyB.sleepState!==Body_1.SLEEPING)&&!(bodyA.sleepState===Body_1.SLEEPING&&bodyB.type===STATIC||bodyB.sleepState===Body_1.SLEEPING&&bodyA.type===STATIC))))},Broadphase.NAIVE=1,Broadphase.SAP=2;var Capsule_1=Capsule;function Capsule(options){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(options={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),options=options||{},this.length=options.length||1,this.radius=options.radius||1,options.type=Shape_1.CAPSULE,Shape_1.call(this,options)}Capsule.prototype=new Shape_1,Capsule.prototype.constructor=Capsule,Capsule.prototype.computeMomentOfInertia=function(mass){var r=this.radius,w=this.length+r,h=2*r;return mass*(h*h+w*w)/12},Capsule.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},Capsule.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=vec2_1.create();Capsule.prototype.computeAABB=function(out,position,angle){var radius=this.radius;vec2_1.set(r,this.length/2,0),0!==angle&&vec2_1.rotate(r,r,angle),vec2_1.set(out.upperBound,Math.max(r[0]+radius,-r[0]+radius),Math.max(r[1]+radius,-r[1]+radius)),vec2_1.set(out.lowerBound,Math.min(r[0]-radius,-r[0]-radius),Math.min(r[1]-radius,-r[1]-radius)),vec2_1.add(out.lowerBound,out.lowerBound,position),vec2_1.add(out.upperBound,out.upperBound,position)};var intersectCapsule_hitPointWorld=vec2_1.create(),intersectCapsule_normal=vec2_1.create(),intersectCapsule_l0=vec2_1.create(),intersectCapsule_l1=vec2_1.create(),intersectCapsule_unit_y=vec2_1.fromValues(0,1);Capsule.prototype.raycast=function(result,ray,position,angle){for(var from=ray.from,to=ray.to,hitPointWorld=(ray.direction,intersectCapsule_hitPointWorld),normal=intersectCapsule_normal,l0=intersectCapsule_l0,l1=intersectCapsule_l1,halfLen=this.length/2,i=0;i<2;i++){var y=this.radius*(2*i-1);if(vec2_1.set(l0,-halfLen,y),vec2_1.set(l1,halfLen,y),vec2_1.toGlobalFrame(l0,l0,position,angle),vec2_1.toGlobalFrame(l1,l1,position,angle),(delta=vec2_1.getLineSegmentsIntersectionFraction(from,to,l0,l1))>=0&&(vec2_1.rotate(normal,intersectCapsule_unit_y,angle),vec2_1.scale(normal,normal,2*i-1),ray.reportIntersection(result,delta,normal,-1),result.shouldStop(ray)))return}var diagonalLengthSquared=Math.pow(this.radius,2)+Math.pow(halfLen,2);for(i=0;i<2;i++){vec2_1.set(l0,halfLen*(2*i-1),0),vec2_1.toGlobalFrame(l0,l0,position,angle);var delta,a=Math.pow(to[0]-from[0],2)+Math.pow(to[1]-from[1],2),b=2*((to[0]-from[0])*(from[0]-l0[0])+(to[1]-from[1])*(from[1]-l0[1])),c=Math.pow(from[0]-l0[0],2)+Math.pow(from[1]-l0[1],2)-Math.pow(this.radius,2);if(!((delta=Math.pow(b,2)-4*a*c)<0))if(0===delta){if(vec2_1.lerp(hitPointWorld,from,to,delta),vec2_1.squaredDistance(hitPointWorld,position)>diagonalLengthSquared&&(vec2_1.sub(normal,hitPointWorld,l0),vec2_1.normalize(normal,normal),ray.reportIntersection(result,delta,normal,-1),result.shouldStop(ray)))return}else{var sqrtDelta=Math.sqrt(delta),inv2a=1/(2*a),d1=(-b-sqrtDelta)*inv2a,d2=(-b+sqrtDelta)*inv2a;if(d1>=0&&d1<=1&&(vec2_1.lerp(hitPointWorld,from,to,d1),vec2_1.squaredDistance(hitPointWorld,position)>diagonalLengthSquared&&(vec2_1.sub(normal,hitPointWorld,l0),vec2_1.normalize(normal,normal),ray.reportIntersection(result,d1,normal,-1),result.shouldStop(ray))))return;if(d2>=0&&d2<=1&&(vec2_1.lerp(hitPointWorld,from,to,d2),vec2_1.squaredDistance(hitPointWorld,position)>diagonalLengthSquared&&(vec2_1.sub(normal,hitPointWorld,l0),vec2_1.normalize(normal,normal),ray.reportIntersection(result,d2,normal,-1),result.shouldStop(ray))))return}}};var Circle_1=Circle;function Circle(options){"number"==typeof arguments[0]&&(options={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),options=options||{},this.radius=options.radius||1,options.type=Shape_1.CIRCLE,Shape_1.call(this,options)}Circle.prototype=new Shape_1,Circle.prototype.constructor=Circle,Circle.prototype.computeMomentOfInertia=function(mass){var r=this.radius;return mass*r*r/2},Circle.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},Circle.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},Circle.prototype.computeAABB=function(out,position,angle){var r=this.radius;vec2_1.set(out.upperBound,r,r),vec2_1.set(out.lowerBound,-r,-r),position&&(vec2_1.add(out.lowerBound,out.lowerBound,position),vec2_1.add(out.upperBound,out.upperBound,position))};var Ray_intersectSphere_intersectionPoint=vec2_1.create(),Ray_intersectSphere_normal=vec2_1.create();Circle.prototype.raycast=function(result,ray,position,angle){var from=ray.from,to=ray.to,r=this.radius,a=Math.pow(to[0]-from[0],2)+Math.pow(to[1]-from[1],2),b=2*((to[0]-from[0])*(from[0]-position[0])+(to[1]-from[1])*(from[1]-position[1])),c=Math.pow(from[0]-position[0],2)+Math.pow(from[1]-position[1],2)-Math.pow(r,2),delta=Math.pow(b,2)-4*a*c,intersectionPoint=Ray_intersectSphere_intersectionPoint,normal=Ray_intersectSphere_normal;if(!(delta<0))if(0===delta)vec2_1.lerp(intersectionPoint,from,to,delta),vec2_1.sub(normal,intersectionPoint,position),vec2_1.normalize(normal,normal),ray.reportIntersection(result,delta,normal,-1);else{var sqrtDelta=Math.sqrt(delta),inv2a=1/(2*a),d1=(-b-sqrtDelta)*inv2a,d2=(-b+sqrtDelta)*inv2a;if(d1>=0&&d1<=1&&(vec2_1.lerp(intersectionPoint,from,to,d1),vec2_1.sub(normal,intersectionPoint,position),vec2_1.normalize(normal,normal),ray.reportIntersection(result,d1,normal,-1),result.shouldStop(ray)))return;d2>=0&&d2<=1&&(vec2_1.lerp(intersectionPoint,from,to,d2),vec2_1.sub(normal,intersectionPoint,position),vec2_1.normalize(normal,normal),ray.reportIntersection(result,d2,normal,-1))}};var Constraint_1=Constraint;function Constraint(bodyA,bodyB,type,options){this.type=type,options=Utils_1.defaults(options,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=bodyA,this.bodyB=bodyB,this.collideConnected=options.collideConnected,options.wakeUpBodies&&(bodyA&&bodyA.wakeUp(),bodyB&&bodyB.wakeUp())}Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},Constraint.DISTANCE=1,Constraint.GEAR=2,Constraint.LOCK=3,Constraint.PRISMATIC=4,Constraint.REVOLUTE=5,Constraint.prototype.setStiffness=function(stiffness){for(var eqs=this.equations,i=0;i!==eqs.length;i++){var eq=eqs[i];eq.stiffness=stiffness,eq.needsUpdate=!0}},Constraint.prototype.setRelaxation=function(relaxation){for(var eqs=this.equations,i=0;i!==eqs.length;i++){var eq=eqs[i];eq.relaxation=relaxation,eq.needsUpdate=!0}};var ContactEquation_1=ContactEquation;function ContactEquation(bodyA,bodyB){Equation_1.call(this,bodyA,bodyB,0,Number.MAX_VALUE),this.contactPointA=vec2_1.create(),this.penetrationVec=vec2_1.create(),this.contactPointB=vec2_1.create(),this.normalA=vec2_1.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}ContactEquation.prototype=new Equation_1,ContactEquation.prototype.constructor=ContactEquation,ContactEquation.prototype.computeB=function(a,b,h){var GW,Gq,bi=this.bodyA,bj=this.bodyB,ri=this.contactPointA,rj=this.contactPointB,xi=bi.position,xj=bj.position,penetrationVec=this.penetrationVec,n=this.normalA,G=this.G,rixn=vec2_1.crossLength(ri,n),rjxn=vec2_1.crossLength(rj,n);return G[0]=-n[0],G[1]=-n[1],G[2]=-rixn,G[3]=n[0],G[4]=n[1],G[5]=rjxn,vec2_1.add(penetrationVec,xj,rj),vec2_1.sub(penetrationVec,penetrationVec,xi),vec2_1.sub(penetrationVec,penetrationVec,ri),this.firstImpact&&0!==this.restitution?(Gq=0,GW=1/b*(1+this.restitution)*this.computeGW()):(Gq=vec2_1.dot(n,penetrationVec)+this.offset,GW=this.computeGW()),-Gq*a-GW*b-h*this.computeGiMf()};var vi=vec2_1.create(),vj=vec2_1.create(),relVel=vec2_1.create();ContactEquation.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(vi,this.contactPointA),this.bodyB.getVelocityAtPoint(vj,this.contactPointB),vec2_1.subtract(relVel,vi,vj),vec2_1.dot(this.normalA,relVel)};var Pool_1=Pool;function Pool(options){options=options||{},this.objects=[],void 0!==options.size&&this.resize(options.size)}Pool.prototype.resize=function(size){for(var objects=this.objects;objects.length>size;)objects.pop();for(;objects.length<size;)objects.push(this.create());return this},Pool.prototype.get=function(){var objects=this.objects;return objects.length?objects.pop():this.create()},Pool.prototype.release=function(object){return this.destroy(object),this.objects.push(object),this};var ContactEquationPool_1=ContactEquationPool;function ContactEquationPool(){Pool_1.apply(this,arguments)}ContactEquationPool.prototype=new Pool_1,ContactEquationPool.prototype.constructor=ContactEquationPool,ContactEquationPool.prototype.create=function(){return new ContactEquation_1},ContactEquationPool.prototype.destroy=function(equation){return equation.bodyA=equation.bodyB=null,this};var Material_1=Material;function Material(id){this.id=id||Material.idCounter++}Material.idCounter=0;var ContactMaterial_1=ContactMaterial;function ContactMaterial(materialA,materialB,options){if(options=options||{},!(materialA instanceof Material_1&&materialB instanceof Material_1))throw new Error("First two arguments must be Material instances.");this.id=ContactMaterial.idCounter++,this.materialA=materialA,this.materialB=materialB,this.friction=void 0!==options.friction?Number(options.friction):.3,this.restitution=void 0!==options.restitution?Number(options.restitution):0,this.stiffness=void 0!==options.stiffness?Number(options.stiffness):Equation_1.DEFAULT_STIFFNESS,this.relaxation=void 0!==options.relaxation?Number(options.relaxation):Equation_1.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==options.frictionStiffness?Number(options.frictionStiffness):Equation_1.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==options.frictionRelaxation?Number(options.frictionRelaxation):Equation_1.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==options.surfaceVelocity?Number(options.surfaceVelocity):0,this.contactSkinSize=.005}ContactMaterial.idCounter=0;var DistanceConstraint_1=DistanceConstraint;function DistanceConstraint(bodyA,bodyB,options){options=Utils_1.defaults(options,{localAnchorA:[0,0],localAnchorB:[0,0]}),Constraint_1.call(this,bodyA,bodyB,Constraint_1.DISTANCE,options),this.localAnchorA=vec2_1.fromValues(options.localAnchorA[0],options.localAnchorA[1]),this.localAnchorB=vec2_1.fromValues(options.localAnchorB[0],options.localAnchorB[1]);var maxForce,localAnchorA=this.localAnchorA,localAnchorB=this.localAnchorB;if(this.distance=0,"number"==typeof options.distance)this.distance=options.distance;else{var worldAnchorA=vec2_1.create(),worldAnchorB=vec2_1.create(),r=vec2_1.create();vec2_1.rotate(worldAnchorA,localAnchorA,bodyA.angle),vec2_1.rotate(worldAnchorB,localAnchorB,bodyB.angle),vec2_1.add(r,bodyB.position,worldAnchorB),vec2_1.sub(r,r,worldAnchorA),vec2_1.sub(r,r,bodyA.position),this.distance=vec2_1.length(r)}maxForce=void 0===options.maxForce?Number.MAX_VALUE:options.maxForce;var normal=new Equation_1(bodyA,bodyB,-maxForce,maxForce);this.equations=[normal],this.maxForce=maxForce;r=vec2_1.create();var ri=vec2_1.create(),rj=vec2_1.create(),that=this;normal.computeGq=function(){var bodyA=this.bodyA,bodyB=this.bodyB,xi=bodyA.position,xj=bodyB.position;return vec2_1.rotate(ri,localAnchorA,bodyA.angle),vec2_1.rotate(rj,localAnchorB,bodyB.angle),vec2_1.add(r,xj,rj),vec2_1.sub(r,r,ri),vec2_1.sub(r,r,xi),vec2_1.length(r)-that.distance},this.setMaxForce(maxForce),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}DistanceConstraint.prototype=new Constraint_1,DistanceConstraint.prototype.constructor=DistanceConstraint;var n=vec2_1.create(),ri=vec2_1.create(),rj=vec2_1.create();DistanceConstraint.prototype.update=function(){var normal=this.equations[0],bodyA=this.bodyA,bodyB=this.bodyB,xi=(this.distance,bodyA.position),xj=bodyB.position,normalEquation=this.equations[0],G=normal.G;vec2_1.rotate(ri,this.localAnchorA,bodyA.angle),vec2_1.rotate(rj,this.localAnchorB,bodyB.angle),vec2_1.add(n,xj,rj),vec2_1.sub(n,n,ri),vec2_1.sub(n,n,xi),this.position=vec2_1.length(n);var violating=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(normalEquation.maxForce=0,normalEquation.minForce=-this.maxForce,this.distance=this.upperLimit,violating=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(normalEquation.maxForce=this.maxForce,normalEquation.minForce=0,this.distance=this.lowerLimit,violating=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||violating){normalEquation.enabled=!0,vec2_1.normalize(n,n);var rixn=vec2_1.crossLength(ri,n),rjxn=vec2_1.crossLength(rj,n);G[0]=-n[0],G[1]=-n[1],G[2]=-rixn,G[3]=n[0],G[4]=n[1],G[5]=rjxn}else normalEquation.enabled=!1},DistanceConstraint.prototype.setMaxForce=function(maxForce){var normal=this.equations[0];normal.minForce=-maxForce,normal.maxForce=maxForce},DistanceConstraint.prototype.getMaxForce=function(){return this.equations[0].maxForce};var FrictionEquation_1=FrictionEquation;function FrictionEquation(bodyA,bodyB,slipForce){Equation_1.call(this,bodyA,bodyB,-slipForce,slipForce),this.contactPointA=vec2_1.create(),this.contactPointB=vec2_1.create(),this.t=vec2_1.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}FrictionEquation.prototype=new Equation_1,FrictionEquation.prototype.constructor=FrictionEquation,FrictionEquation.prototype.setSlipForce=function(slipForce){this.maxForce=slipForce,this.minForce=-slipForce},FrictionEquation.prototype.getSlipForce=function(){return this.maxForce},FrictionEquation.prototype.computeB=function(a,b,h){this.bodyA,this.bodyB;var ri=this.contactPointA,rj=this.contactPointB,t=this.t,G=this.G;return G[0]=-t[0],G[1]=-t[1],G[2]=-vec2_1.crossLength(ri,t),G[3]=t[0],G[4]=t[1],G[5]=vec2_1.crossLength(rj,t),-this.computeGW()*b-h*this.computeGiMf()};var FrictionEquationPool_1=FrictionEquationPool;function FrictionEquationPool(){Pool_1.apply(this,arguments)}FrictionEquationPool.prototype=new Pool_1,FrictionEquationPool.prototype.constructor=FrictionEquationPool,FrictionEquationPool.prototype.create=function(){return new FrictionEquation_1},FrictionEquationPool.prototype.destroy=function(equation){return equation.bodyA=equation.bodyB=null,this};var GearConstraint_1=GearConstraint;function GearConstraint(bodyA,bodyB,options){options=options||{},Constraint_1.call(this,bodyA,bodyB,Constraint_1.GEAR,options),this.ratio=void 0!==options.ratio?options.ratio:1,this.angle=void 0!==options.angle?options.angle:bodyB.angle-this.ratio*bodyA.angle,options.angle=this.angle,options.ratio=this.ratio,this.equations=[new AngleLockEquation_1(bodyA,bodyB,options)],void 0!==options.maxTorque&&this.setMaxTorque(options.maxTorque)}GearConstraint.prototype=new Constraint_1,GearConstraint.prototype.constructor=GearConstraint,GearConstraint.prototype.update=function(){var eq=this.equations[0];eq.ratio!==this.ratio&&eq.setRatio(this.ratio),eq.angle=this.angle},GearConstraint.prototype.setMaxTorque=function(torque){this.equations[0].setMaxTorque(torque)},GearConstraint.prototype.getMaxTorque=function(torque){return this.equations[0].maxForce};var Solver_1=Solver;function Solver(options,type){options=options||{},EventEmitter_1.call(this),this.type=type,this.equations=[],this.equationSortFunction=options.equationSortFunction||!1}Solver.prototype=new EventEmitter_1,Solver.prototype.constructor=Solver,Solver.prototype.solve=function(dt,world){throw new Error("Solver.solve should be implemented by subclasses!")};var mockWorld={bodies:[]};Solver.prototype.solveIsland=function(dt,island){this.removeAllEquations(),island.equations.length&&(this.addEquations(island.equations),mockWorld.bodies.length=0,island.getBodies(mockWorld.bodies),mockWorld.bodies.length&&this.solve(dt,mockWorld))},Solver.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},Solver.prototype.addEquation=function(eq){eq.enabled&&this.equations.push(eq)},Solver.prototype.addEquations=function(eqs){for(var i=0,N=eqs.length;i!==N;i++){var eq=eqs[i];eq.enabled&&this.equations.push(eq)}},Solver.prototype.removeEquation=function(eq){var i=this.equations.indexOf(eq);-1!==i&&this.equations.splice(i,1)},Solver.prototype.removeAllEquations=function(){this.equations.length=0},Solver.GS=1,Solver.ISLAND=2;var GSSolver_1=GSSolver;function GSSolver(options){Solver_1.call(this,options,Solver_1.GS),options=options||{},this.iterations=options.iterations||10,this.tolerance=options.tolerance||1e-7,this.arrayStep=30,this.lambda=new Utils_1.ARRAY_TYPE(this.arrayStep),this.Bs=new Utils_1.ARRAY_TYPE(this.arrayStep),this.invCs=new Utils_1.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==options.frictionIterations?0:options.frictionIterations,this.usedIterations=0}GSSolver.prototype=new Solver_1,GSSolver.prototype.constructor=GSSolver,GSSolver.prototype.solve=function(h,world){this.sortEquations();var iter=0,maxIter=this.iterations,maxFrictionIter=this.frictionIterations,equations=this.equations,Neq=equations.length,tolSquared=Math.pow(this.tolerance*Neq,2),bodies=world.bodies,Nbodies=world.bodies.length,useZeroRHS=(vec2_1.add,vec2_1.set,this.useZeroRHS),lambda=this.lambda;if(this.usedIterations=0,Neq)for(var i=0;i!==Nbodies;i++){bodies[i].updateSolveMassProperties()}lambda.length<Neq&&(lambda=this.lambda=new Utils_1.ARRAY_TYPE(Neq+this.arrayStep),this.Bs=new Utils_1.ARRAY_TYPE(Neq+this.arrayStep),this.invCs=new Utils_1.ARRAY_TYPE(Neq+this.arrayStep)),function(array){for(var l=array.length;l--;)array[l]=0}(lambda);var deltalambdaTot,j,invCs=this.invCs,Bs=this.Bs;for(lambda=this.lambda,i=0;i!==equations.length;i++){var c;((c=equations[i]).timeStep!==h||c.needsUpdate)&&(c.timeStep=h,c.update()),Bs[i]=c.computeB(c.a,c.b,h),invCs[i]=c.computeInvC(c.epsilon)}if(0!==Neq){for(i=0;i!==Nbodies;i++){bodies[i].resetConstraintVelocity()}if(maxFrictionIter){for(iter=0;iter!==maxFrictionIter;iter++){for(deltalambdaTot=0,j=0;j!==Neq;j++){c=equations[j];var deltalambda=GSSolver.iterateEquation(j,c,c.epsilon,Bs,invCs,lambda,useZeroRHS,h,iter);deltalambdaTot+=Math.abs(deltalambda)}if(this.usedIterations++,deltalambdaTot*deltalambdaTot<=tolSquared)break}for(GSSolver.updateMultipliers(equations,lambda,1/h),j=0;j!==Neq;j++){var eq=equations[j];if(eq instanceof FrictionEquation_1){for(var f=0,k=0;k!==eq.contactEquations.length;k++)f+=eq.contactEquations[k].multiplier;f*=eq.frictionCoefficient/eq.contactEquations.length,eq.maxForce=f,eq.minForce=-f}}}for(iter=0;iter!==maxIter;iter++){for(deltalambdaTot=0,j=0;j!==Neq;j++){c=equations[j];deltalambda=GSSolver.iterateEquation(j,c,c.epsilon,Bs,invCs,lambda,useZeroRHS,h,iter);deltalambdaTot+=Math.abs(deltalambda)}if(this.usedIterations++,deltalambdaTot*deltalambdaTot<=tolSquared)break}for(i=0;i!==Nbodies;i++)bodies[i].addConstraintVelocity();GSSolver.updateMultipliers(equations,lambda,1/h)}},GSSolver.updateMultipliers=function(equations,lambda,invDt){for(var l=equations.length;l--;)equations[l].multiplier=lambda[l]*invDt},GSSolver.iterateEquation=function(j,eq,eps,Bs,invCs,lambda,useZeroRHS,dt,iter){var B=Bs[j],invC=invCs[j],lambdaj=lambda[j],GWlambda=eq.computeGWlambda(),maxForce=eq.maxForce,minForce=eq.minForce;useZeroRHS&&(B=0);var deltalambda=invC*(B-GWlambda-eps*lambdaj),lambdaj_plus_deltalambda=lambdaj+deltalambda;return lambdaj_plus_deltalambda<minForce*dt?deltalambda=minForce*dt-lambdaj:lambdaj_plus_deltalambda>maxForce*dt&&(deltalambda=maxForce*dt-lambdaj),lambda[j]+=deltalambda,eq.addToWlambda(deltalambda),deltalambda};var Heightfield_1=Heightfield;function Heightfield(options){if(Array.isArray(arguments[0])){if(options={heights:arguments[0]},"object"==typeof arguments[1])for(var key in arguments[1])options[key]=arguments[1][key];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}options=options||{},this.heights=options.heights?options.heights.slice(0):[],this.maxValue=options.maxValue||null,this.minValue=options.minValue||null,this.elementWidth=options.elementWidth||.1,void 0!==options.maxValue&&void 0!==options.minValue||this.updateMaxMinValues(),options.type=Shape_1.HEIGHTFIELD,Shape_1.call(this,options)}Heightfield.prototype=new Shape_1,Heightfield.prototype.constructor=Heightfield,Heightfield.prototype.updateMaxMinValues=function(){for(var data=this.heights,maxValue=data[0],minValue=data[0],i=0;i!==data.length;i++){var v=data[i];v>maxValue&&(maxValue=v),v<minValue&&(minValue=v)}this.maxValue=maxValue,this.minValue=minValue},Heightfield.prototype.computeMomentOfInertia=function(mass){return Number.MAX_VALUE},Heightfield.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},Heightfield.prototype.updateArea=function(){for(var data=this.heights,area=0,i=0;i<data.length-1;i++)area+=(data[i]+data[i+1])/2*this.elementWidth;this.area=area};var points=[vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create()];Heightfield.prototype.computeAABB=function(out,position,angle){vec2_1.set(points[0],0,this.maxValue),vec2_1.set(points[1],this.elementWidth*this.heights.length,this.maxValue),vec2_1.set(points[2],this.elementWidth*this.heights.length,this.minValue),vec2_1.set(points[3],0,this.minValue),out.setFromPoints(points,position,angle)},Heightfield.prototype.getLineSegment=function(start,end,i){var data=this.heights,width=this.elementWidth;vec2_1.set(start,i*width,data[i]),vec2_1.set(end,(i+1)*width,data[i+1])},Heightfield.prototype.getSegmentIndex=function(position){return Math.floor(position[0]/this.elementWidth)},Heightfield.prototype.getClampedSegmentIndex=function(position){var i=this.getSegmentIndex(position);return i=Math.min(this.heights.length,Math.max(i,0))};vec2_1.create();var intersectHeightfield_worldNormal=vec2_1.create(),intersectHeightfield_l0=vec2_1.create(),intersectHeightfield_l1=vec2_1.create(),intersectHeightfield_localFrom=vec2_1.create(),intersectHeightfield_localTo=vec2_1.create();vec2_1.fromValues(0,1);Heightfield.prototype.raycast=function(result,ray,position,angle){var from=ray.from,to=ray.to,worldNormal=(ray.direction,intersectHeightfield_worldNormal),l0=intersectHeightfield_l0,l1=intersectHeightfield_l1,localFrom=intersectHeightfield_localFrom,localTo=intersectHeightfield_localTo;vec2_1.toLocalFrame(localFrom,from,position,angle),vec2_1.toLocalFrame(localTo,to,position,angle);var i0=this.getClampedSegmentIndex(localFrom),i1=this.getClampedSegmentIndex(localTo);if(i0>i1){var tmp=i0;i0=i1,i1=tmp}for(var i=0;i<this.heights.length-1;i++){this.getLineSegment(l0,l1,i);var t=vec2_1.getLineSegmentsIntersectionFraction(localFrom,localTo,l0,l1);if(t>=0&&(vec2_1.sub(worldNormal,l1,l0),vec2_1.rotate(worldNormal,worldNormal,angle+Math.PI/2),vec2_1.normalize(worldNormal,worldNormal),ray.reportIntersection(result,t,worldNormal,-1),result.shouldStop(ray)))return}};var Line_1$1=Line$1;function Line$1(options){"number"==typeof arguments[0]&&(options={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),options=options||{},this.length=options.length||1,options.type=Shape_1.LINE,Shape_1.call(this,options)}Line$1.prototype=new Shape_1,Line$1.prototype.constructor=Line$1,Line$1.prototype.computeMomentOfInertia=function(mass){return mass*Math.pow(this.length,2)/12},Line$1.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var points$1=[vec2_1.create(),vec2_1.create()];Line$1.prototype.computeAABB=function(out,position,angle){var l2=this.length/2;vec2_1.set(points$1[0],-l2,0),vec2_1.set(points$1[1],l2,0),out.setFromPoints(points$1,position,angle,0)};vec2_1.create();var raycast_normal=vec2_1.create(),raycast_l0=vec2_1.create(),raycast_l1=vec2_1.create(),raycast_unit_y=vec2_1.fromValues(0,1);Line$1.prototype.raycast=function(result,ray,position,angle){var from=ray.from,to=ray.to,l0=raycast_l0,l1=raycast_l1,halfLen=this.length/2;vec2_1.set(l0,-halfLen,0),vec2_1.set(l1,halfLen,0),vec2_1.toGlobalFrame(l0,l0,position,angle),vec2_1.toGlobalFrame(l1,l1,position,angle);var fraction=vec2_1.getLineSegmentsIntersectionFraction(l0,l1,from,to);if(fraction>=0){var normal=raycast_normal;vec2_1.rotate(normal,raycast_unit_y,angle),ray.reportIntersection(result,fraction,normal,-1)}};var LockConstraint_1=LockConstraint;function LockConstraint(bodyA,bodyB,options){options=options||{},Constraint_1.call(this,bodyA,bodyB,Constraint_1.LOCK,options);var maxForce=void 0===options.maxForce?Number.MAX_VALUE:options.maxForce,x=(options.localAngleB,new Equation_1(bodyA,bodyB,-maxForce,maxForce)),y=new Equation_1(bodyA,bodyB,-maxForce,maxForce),rot=new Equation_1(bodyA,bodyB,-maxForce,maxForce),l=vec2_1.create(),g=vec2_1.create(),that=this;x.computeGq=function(){return vec2_1.rotate(l,that.localOffsetB,bodyA.angle),vec2_1.sub(g,bodyB.position,bodyA.position),vec2_1.sub(g,g,l),g[0]},y.computeGq=function(){return vec2_1.rotate(l,that.localOffsetB,bodyA.angle),vec2_1.sub(g,bodyB.position,bodyA.position),vec2_1.sub(g,g,l),g[1]};var r=vec2_1.create(),t=vec2_1.create();rot.computeGq=function(){return vec2_1.rotate(r,that.localOffsetB,bodyB.angle-that.localAngleB),vec2_1.scale(r,r,-1),vec2_1.sub(g,bodyA.position,bodyB.position),vec2_1.add(g,g,r),vec2_1.rotate(t,r,-Math.PI/2),vec2_1.normalize(t,t),vec2_1.dot(g,t)},this.localOffsetB=vec2_1.create(),options.localOffsetB?vec2_1.copy(this.localOffsetB,options.localOffsetB):(vec2_1.sub(this.localOffsetB,bodyB.position,bodyA.position),vec2_1.rotate(this.localOffsetB,this.localOffsetB,-bodyA.angle)),this.localAngleB=0,"number"==typeof options.localAngleB?this.localAngleB=options.localAngleB:this.localAngleB=bodyB.angle-bodyA.angle,this.equations.push(x,y,rot),this.setMaxForce(maxForce)}LockConstraint.prototype=new Constraint_1,LockConstraint.prototype.constructor=LockConstraint,LockConstraint.prototype.setMaxForce=function(force){for(var eqs=this.equations,i=0;i<this.equations.length;i++)eqs[i].maxForce=force,eqs[i].minForce=-force},LockConstraint.prototype.getMaxForce=function(){return this.equations[0].maxForce};var l=vec2_1.create(),r$1=vec2_1.create(),t=vec2_1.create(),xAxis=vec2_1.fromValues(1,0),yAxis=vec2_1.fromValues(0,1);LockConstraint.prototype.update=function(){var x=this.equations[0],y=this.equations[1],rot=this.equations[2],bodyA=this.bodyA,bodyB=this.bodyB;vec2_1.rotate(l,this.localOffsetB,bodyA.angle),vec2_1.rotate(r$1,this.localOffsetB,bodyB.angle-this.localAngleB),vec2_1.scale(r$1,r$1,-1),vec2_1.rotate(t,r$1,Math.PI/2),vec2_1.normalize(t,t),x.G[0]=-1,x.G[1]=0,x.G[2]=-vec2_1.crossLength(l,xAxis),x.G[3]=1,y.G[0]=0,y.G[1]=-1,y.G[2]=-vec2_1.crossLength(l,yAxis),y.G[4]=1,rot.G[0]=-t[0],rot.G[1]=-t[1],rot.G[3]=t[0],rot.G[4]=t[1],rot.G[5]=vec2_1.crossLength(r$1,t)};var TupleDictionary_1=TupleDictionary;function TupleDictionary(){this.data={},this.keys=[]}TupleDictionary.prototype.getKey=function(id1,id2){return(0|(id1|=0))==(0|(id2|=0))?-1:0|((0|id1)>(0|id2)?id1<<16|65535&id2:id2<<16|65535&id1)},TupleDictionary.prototype.getByKey=function(key){return key|=0,this.data[key]},TupleDictionary.prototype.get=function(i,j){return this.data[this.getKey(i,j)]},TupleDictionary.prototype.set=function(i,j,value){if(!value)throw new Error("No data!");var key=this.getKey(i,j);return this.data[key]||this.keys.push(key),this.data[key]=value,key},TupleDictionary.prototype.reset=function(){for(var data=this.data,keys=this.keys,l=keys.length;l--;)delete data[keys[l]];keys.length=0},TupleDictionary.prototype.copy=function(dict){this.reset(),Utils_1.appendArray(this.keys,dict.keys);for(var l=dict.keys.length;l--;){var key=dict.keys[l];this.data[key]=dict.data[key]}};var Box_1=Box;function Box(options){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(options={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),options=options||{};var width=this.width=options.width||1,height=this.height=options.height||1,verts=[vec2_1.fromValues(-width/2,-height/2),vec2_1.fromValues(width/2,-height/2),vec2_1.fromValues(width/2,height/2),vec2_1.fromValues(-width/2,height/2)],axes=[vec2_1.fromValues(1,0),vec2_1.fromValues(0,1)];options.vertices=verts,options.axes=axes,options.type=Shape_1.BOX,Convex_1.call(this,options)}Box.prototype=new Convex_1,Box.prototype.constructor=Box,Box.prototype.computeMomentOfInertia=function(mass){var w=this.width,h=this.height;return mass*(h*h+w*w)/12},Box.prototype.updateBoundingRadius=function(){var w=this.width,h=this.height;this.boundingRadius=Math.sqrt(w*w+h*h)/2};vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create();Box.prototype.computeAABB=function(out,position,angle){out.setFromPoints(this.vertices,position,angle,0)},Box.prototype.updateArea=function(){this.area=this.width*this.height};var sub=vec2_1.sub,add=vec2_1.add,dot=vec2_1.dot,Narrowphase_1=Narrowphase,yAxis$1=vec2_1.fromValues(0,1),tmp1=vec2_1.fromValues(0,0),tmp2=vec2_1.fromValues(0,0),tmp3=vec2_1.fromValues(0,0),tmp4=vec2_1.fromValues(0,0),tmp5=vec2_1.fromValues(0,0),tmp6=vec2_1.fromValues(0,0),tmp7=vec2_1.fromValues(0,0),tmp8=vec2_1.fromValues(0,0),tmp9=vec2_1.fromValues(0,0),tmp10=vec2_1.fromValues(0,0),tmp11=vec2_1.fromValues(0,0),tmp12=vec2_1.fromValues(0,0),tmp13=vec2_1.fromValues(0,0),tmp14=vec2_1.fromValues(0,0),tmp15=vec2_1.fromValues(0,0),tmp16=vec2_1.fromValues(0,0),tmp17=vec2_1.fromValues(0,0),tmp18=vec2_1.fromValues(0,0),tmpArray=[];function Narrowphase(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new ContactEquationPool_1({size:32}),this.frictionEquationPool=new FrictionEquationPool_1({size:64}),this.restitution=0,this.stiffness=Equation_1.DEFAULT_STIFFNESS,this.relaxation=Equation_1.DEFAULT_RELAXATION,this.frictionStiffness=Equation_1.DEFAULT_STIFFNESS,this.frictionRelaxation=Equation_1.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new TupleDictionary_1,this.contactSkinSize=.01}var bodiesOverlap_shapePositionA=vec2_1.create(),bodiesOverlap_shapePositionB=vec2_1.create();function setConvexToCapsuleShapeMiddle(convexShape,capsuleShape){vec2_1.set(convexShape.vertices[0],.5*-capsuleShape.length,-capsuleShape.radius),vec2_1.set(convexShape.vertices[1],.5*capsuleShape.length,-capsuleShape.radius),vec2_1.set(convexShape.vertices[2],.5*capsuleShape.length,capsuleShape.radius),vec2_1.set(convexShape.vertices[3],.5*-capsuleShape.length,capsuleShape.radius)}Narrowphase.prototype.bodiesOverlap=function(bodyA,bodyB){for(var shapePositionA=bodiesOverlap_shapePositionA,shapePositionB=bodiesOverlap_shapePositionB,k=0,Nshapesi=bodyA.shapes.length;k!==Nshapesi;k++){var shapeA=bodyA.shapes[k];bodyA.toWorldFrame(shapePositionA,shapeA.position);for(var l=0,Nshapesj=bodyB.shapes.length;l!==Nshapesj;l++){var shapeB=bodyB.shapes[l];if(bodyB.toWorldFrame(shapePositionB,shapeB.position),this[shapeA.type|shapeB.type](bodyA,shapeA,shapePositionA,shapeA.angle+bodyA.angle,bodyB,shapeB,shapePositionB,shapeB.angle+bodyB.angle,!0))return!0}}return!1},Narrowphase.prototype.collidedLastStep=function(bodyA,bodyB){var id1=0|bodyA.id,id2=0|bodyB.id;return!!this.collidingBodiesLastStep.get(id1,id2)},Narrowphase.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var eqs=this.contactEquations,l=eqs.length;l--;){var eq=eqs[l],id1=eq.bodyA.id,id2=eq.bodyB.id;this.collidingBodiesLastStep.set(id1,id2,!0)}for(var ce=this.contactEquations,fe=this.frictionEquations,i=0;i<ce.length;i++)this.contactEquationPool.release(ce[i]);for(i=0;i<fe.length;i++)this.frictionEquationPool.release(fe[i]);this.contactEquations.length=this.frictionEquations.length=0},Narrowphase.prototype.createContactEquation=function(bodyA,bodyB,shapeA,shapeB){var c=this.contactEquationPool.get();return c.bodyA=bodyA,c.bodyB=bodyB,c.shapeA=shapeA,c.shapeB=shapeB,c.restitution=this.restitution,c.firstImpact=!this.collidedLastStep(bodyA,bodyB),c.stiffness=this.stiffness,c.relaxation=this.relaxation,c.needsUpdate=!0,c.enabled=this.enabledEquations,c.offset=this.contactSkinSize,c},Narrowphase.prototype.createFrictionEquation=function(bodyA,bodyB,shapeA,shapeB){var c=this.frictionEquationPool.get();return c.bodyA=bodyA,c.bodyB=bodyB,c.shapeA=shapeA,c.shapeB=shapeB,c.setSlipForce(this.slipForce),c.frictionCoefficient=this.frictionCoefficient,c.relativeVelocity=this.surfaceVelocity,c.enabled=this.enabledEquations,c.needsUpdate=!0,c.stiffness=this.frictionStiffness,c.relaxation=this.frictionRelaxation,c.contactEquations.length=0,c},Narrowphase.prototype.createFrictionFromContact=function(c){var eq=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);return vec2_1.copy(eq.contactPointA,c.contactPointA),vec2_1.copy(eq.contactPointB,c.contactPointB),vec2_1.rotate90cw(eq.t,c.normalA),eq.contactEquations.push(c),eq},Narrowphase.prototype.createFrictionFromAverage=function(numContacts){var c=this.contactEquations[this.contactEquations.length-1],eq=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB),bodyA=c.bodyA;c.bodyB;vec2_1.set(eq.contactPointA,0,0),vec2_1.set(eq.contactPointB,0,0),vec2_1.set(eq.t,0,0);for(var i=0;i!==numContacts;i++)(c=this.contactEquations[this.contactEquations.length-1-i]).bodyA===bodyA?(vec2_1.add(eq.t,eq.t,c.normalA),vec2_1.add(eq.contactPointA,eq.contactPointA,c.contactPointA),vec2_1.add(eq.contactPointB,eq.contactPointB,c.contactPointB)):(vec2_1.sub(eq.t,eq.t,c.normalA),vec2_1.add(eq.contactPointA,eq.contactPointA,c.contactPointB),vec2_1.add(eq.contactPointB,eq.contactPointB,c.contactPointA)),eq.contactEquations.push(c);var invNumContacts=1/numContacts;return vec2_1.scale(eq.contactPointA,eq.contactPointA,invNumContacts),vec2_1.scale(eq.contactPointB,eq.contactPointB,invNumContacts),vec2_1.normalize(eq.t,eq.t),vec2_1.rotate90cw(eq.t,eq.t),eq},Narrowphase.prototype[Shape_1.LINE|Shape_1.CONVEX]=Narrowphase.prototype.convexLine=function(convexBody,convexShape,convexOffset,convexAngle,lineBody,lineShape,lineOffset,lineAngle,justTest){return!justTest&&0},Narrowphase.prototype[Shape_1.LINE|Shape_1.BOX]=Narrowphase.prototype.lineBox=function(lineBody,lineShape,lineOffset,lineAngle,boxBody,boxShape,boxOffset,boxAngle,justTest){return!justTest&&0};var convexCapsule_tempRect=new Box_1({width:1,height:1}),convexCapsule_tempVec=vec2_1.create();Narrowphase.prototype[Shape_1.CAPSULE|Shape_1.CONVEX]=Narrowphase.prototype[Shape_1.CAPSULE|Shape_1.BOX]=Narrowphase.prototype.convexCapsule=function(convexBody,convexShape,convexPosition,convexAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){var circlePos=convexCapsule_tempVec;vec2_1.set(circlePos,capsuleShape.length/2,0),vec2_1.rotate(circlePos,circlePos,capsuleAngle),vec2_1.add(circlePos,circlePos,capsulePosition);var result1=this.circleConvex(capsuleBody,capsuleShape,circlePos,capsuleAngle,convexBody,convexShape,convexPosition,convexAngle,justTest,capsuleShape.radius);vec2_1.set(circlePos,-capsuleShape.length/2,0),vec2_1.rotate(circlePos,circlePos,capsuleAngle),vec2_1.add(circlePos,circlePos,capsulePosition);var result2=this.circleConvex(capsuleBody,capsuleShape,circlePos,capsuleAngle,convexBody,convexShape,convexPosition,convexAngle,justTest,capsuleShape.radius);if(justTest&&(result1||result2))return!0;var r=convexCapsule_tempRect;return setConvexToCapsuleShapeMiddle(r,capsuleShape),this.convexConvex(convexBody,convexShape,convexPosition,convexAngle,capsuleBody,r,capsulePosition,capsuleAngle,justTest)+result1+result2},Narrowphase.prototype[Shape_1.CAPSULE|Shape_1.LINE]=Narrowphase.prototype.lineCapsule=function(lineBody,lineShape,linePosition,lineAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){return!justTest&&0};var capsuleCapsule_tempVec1=vec2_1.create(),capsuleCapsule_tempVec2=vec2_1.create(),capsuleCapsule_tempRect1=new Box_1({width:1,height:1});Narrowphase.prototype[Shape_1.CAPSULE|Shape_1.CAPSULE]=Narrowphase.prototype.capsuleCapsule=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){for(var circlePosi=capsuleCapsule_tempVec1,circlePosj=capsuleCapsule_tempVec2,numContacts=0,i=0;i<2;i++){vec2_1.set(circlePosi,(0===i?-1:1)*si.length/2,0),vec2_1.rotate(circlePosi,circlePosi,ai),vec2_1.add(circlePosi,circlePosi,xi);for(var j=0;j<2;j++){vec2_1.set(circlePosj,(0===j?-1:1)*sj.length/2,0),vec2_1.rotate(circlePosj,circlePosj,aj),vec2_1.add(circlePosj,circlePosj,xj),this.enableFrictionReduction&&(enableFrictionBefore=this.enableFriction,this.enableFriction=!1);var result=this.circleCircle(bi,si,circlePosi,ai,bj,sj,circlePosj,aj,justTest,si.radius,sj.radius);if(this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest&&result)return!0;numContacts+=result}}this.enableFrictionReduction&&(enableFrictionBefore=this.enableFriction,this.enableFriction=!1);var rect=capsuleCapsule_tempRect1;setConvexToCapsuleShapeMiddle(rect,si);var result1=this.convexCapsule(bi,rect,xi,ai,bj,sj,xj,aj,justTest);if(this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest&&result1)return!0;if(numContacts+=result1,this.enableFrictionReduction){var enableFrictionBefore=this.enableFriction;this.enableFriction=!1}setConvexToCapsuleShapeMiddle(rect,sj);var result2=this.convexCapsule(bj,rect,xj,aj,bi,si,xi,ai,justTest);return this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),!(!justTest||!result2)||(numContacts+=result2,this.enableFrictionReduction&&numContacts&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(numContacts)),numContacts)},Narrowphase.prototype[Shape_1.LINE|Shape_1.LINE]=Narrowphase.prototype.lineLine=function(bodyA,shapeA,positionA,angleA,bodyB,shapeB,positionB,angleB,justTest){return!justTest&&0},Narrowphase.prototype[Shape_1.PLANE|Shape_1.LINE]=Narrowphase.prototype.planeLine=function(planeBody,planeShape,planeOffset,planeAngle,lineBody,lineShape,lineOffset,lineAngle,justTest){var worldVertex0=tmp1,worldVertex1=tmp2,worldVertex01=tmp3,worldVertex11=tmp4,worldEdge=tmp5,worldEdgeUnit=tmp6,dist=tmp7,worldNormal=tmp8,worldTangent=tmp9,verts=tmpArray,numContacts=0;vec2_1.set(worldVertex0,-lineShape.length/2,0),vec2_1.set(worldVertex1,lineShape.length/2,0),vec2_1.rotate(worldVertex01,worldVertex0,lineAngle),vec2_1.rotate(worldVertex11,worldVertex1,lineAngle),add(worldVertex01,worldVertex01,lineOffset),add(worldVertex11,worldVertex11,lineOffset),vec2_1.copy(worldVertex0,worldVertex01),vec2_1.copy(worldVertex1,worldVertex11),sub(worldEdge,worldVertex1,worldVertex0),vec2_1.normalize(worldEdgeUnit,worldEdge),vec2_1.rotate90cw(worldTangent,worldEdgeUnit),vec2_1.rotate(worldNormal,yAxis$1,planeAngle),verts[0]=worldVertex0,verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];sub(dist,v,planeOffset);var d=dot(dist,worldNormal);if(d<0){if(justTest)return!0;var c=this.createContactEquation(planeBody,lineBody,planeShape,lineShape);numContacts++,vec2_1.copy(c.normalA,worldNormal),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(dist,worldNormal,d),sub(c.contactPointA,v,dist),sub(c.contactPointA,c.contactPointA,planeBody.position),sub(c.contactPointB,v,lineOffset),add(c.contactPointB,c.contactPointB,lineOffset),sub(c.contactPointB,c.contactPointB,lineBody.position),this.contactEquations.push(c),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}return!justTest&&(this.enableFrictionReduction||numContacts&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(numContacts)),numContacts)},Narrowphase.prototype[Shape_1.PARTICLE|Shape_1.CAPSULE]=Narrowphase.prototype.particleCapsule=function(particleBody,particleShape,particlePosition,particleAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){return this.circleLine(particleBody,particleShape,particlePosition,particleAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest,capsuleShape.radius,0)},Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.LINE]=Narrowphase.prototype.circleLine=function(circleBody,circleShape,circleOffset,circleAngle,lineBody,lineShape,lineOffset,lineAngle,justTest,lineRadius,circleRadius){lineRadius=lineRadius||0,circleRadius=void 0!==circleRadius?circleRadius:circleShape.radius;var orthoDist=tmp1,lineToCircleOrthoUnit=tmp2,projectedPoint=tmp3,centerDist=tmp4,worldTangent=tmp5,worldEdge=tmp6,worldEdgeUnit=tmp7,worldVertex0=tmp8,worldVertex1=tmp9,worldVertex01=tmp10,worldVertex11=tmp11,dist=tmp12,lineToCircle=tmp13,lineEndToLineRadius=tmp14,verts=tmpArray;vec2_1.set(worldVertex0,-lineShape.length/2,0),vec2_1.set(worldVertex1,lineShape.length/2,0),vec2_1.rotate(worldVertex01,worldVertex0,lineAngle),vec2_1.rotate(worldVertex11,worldVertex1,lineAngle),add(worldVertex01,worldVertex01,lineOffset),add(worldVertex11,worldVertex11,lineOffset),vec2_1.copy(worldVertex0,worldVertex01),vec2_1.copy(worldVertex1,worldVertex11),sub(worldEdge,worldVertex1,worldVertex0),vec2_1.normalize(worldEdgeUnit,worldEdge),vec2_1.rotate90cw(worldTangent,worldEdgeUnit),sub(dist,circleOffset,worldVertex0);var d=dot(dist,worldTangent);sub(centerDist,worldVertex0,lineOffset),sub(lineToCircle,circleOffset,lineOffset);var radiusSum=circleRadius+lineRadius;if(Math.abs(d)<radiusSum){vec2_1.scale(orthoDist,worldTangent,d),sub(projectedPoint,circleOffset,orthoDist),vec2_1.scale(lineToCircleOrthoUnit,worldTangent,dot(worldTangent,lineToCircle)),vec2_1.normalize(lineToCircleOrthoUnit,lineToCircleOrthoUnit),vec2_1.scale(lineToCircleOrthoUnit,lineToCircleOrthoUnit,lineRadius),add(projectedPoint,projectedPoint,lineToCircleOrthoUnit);var pos=dot(worldEdgeUnit,projectedPoint),pos0=dot(worldEdgeUnit,worldVertex0),pos1=dot(worldEdgeUnit,worldVertex1);if(pos>pos0&&pos<pos1){if(justTest)return!0;var c=this.createContactEquation(circleBody,lineBody,circleShape,lineShape);return vec2_1.scale(c.normalA,orthoDist,-1),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,projectedPoint,lineOffset),add(c.contactPointB,c.contactPointB,lineOffset),sub(c.contactPointB,c.contactPointB,lineBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}}verts[0]=worldVertex0,verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];if(sub(dist,v,circleOffset),vec2_1.squaredLength(dist)<Math.pow(radiusSum,2)){if(justTest)return!0;c=this.createContactEquation(circleBody,lineBody,circleShape,lineShape);return vec2_1.copy(c.normalA,dist),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,v,lineOffset),vec2_1.scale(lineEndToLineRadius,c.normalA,-lineRadius),add(c.contactPointB,c.contactPointB,lineEndToLineRadius),add(c.contactPointB,c.contactPointB,lineOffset),sub(c.contactPointB,c.contactPointB,lineBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}}return 0},Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.CAPSULE]=Narrowphase.prototype.circleCapsule=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){return this.circleLine(bi,si,xi,ai,bj,sj,xj,aj,justTest,sj.radius)},Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.CONVEX]=Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.BOX]=Narrowphase.prototype.circleConvex=function(circleBody,circleShape,circleOffset,circleAngle,convexBody,convexShape,convexOffset,convexAngle,justTest,circleRadius){circleRadius="number"==typeof circleRadius?circleRadius:circleShape.radius;for(var worldVertex0=tmp1,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldNormal=tmp5,dist=tmp10,worldVertex=tmp11,closestEdgeProjectedPoint=tmp13,candidate=tmp14,candidateDist=tmp15,minCandidate=tmp16,found=!1,minCandidateDistance=Number.MAX_VALUE,verts=convexShape.vertices,i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];if(vec2_1.rotate(worldVertex0,v0,convexAngle),vec2_1.rotate(worldVertex1,v1,convexAngle),add(worldVertex0,worldVertex0,convexOffset),add(worldVertex1,worldVertex1,convexOffset),sub(worldEdge,worldVertex1,worldVertex0),vec2_1.normalize(worldEdgeUnit,worldEdge),vec2_1.rotate90cw(worldNormal,worldEdgeUnit),vec2_1.scale(candidate,worldNormal,-circleShape.radius),add(candidate,candidate,circleOffset),pointInConvex(candidate,convexShape,convexOffset,convexAngle)){vec2_1.sub(candidateDist,worldVertex0,candidate);var candidateDistance=Math.abs(vec2_1.dot(candidateDist,worldNormal));candidateDistance<minCandidateDistance&&(vec2_1.copy(minCandidate,candidate),minCandidateDistance=candidateDistance,vec2_1.scale(closestEdgeProjectedPoint,worldNormal,candidateDistance),vec2_1.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,candidate),found=!0)}}if(found){if(justTest)return!0;var c=this.createContactEquation(circleBody,convexBody,circleShape,convexShape);return vec2_1.sub(c.normalA,minCandidate,circleOffset),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,closestEdgeProjectedPoint,convexOffset),add(c.contactPointB,c.contactPointB,convexOffset),sub(c.contactPointB,c.contactPointB,convexBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}if(circleRadius>0)for(i=0;i<verts.length;i++){var localVertex=verts[i];if(vec2_1.rotate(worldVertex,localVertex,convexAngle),add(worldVertex,worldVertex,convexOffset),sub(dist,worldVertex,circleOffset),vec2_1.squaredLength(dist)<Math.pow(circleRadius,2)){if(justTest)return!0;c=this.createContactEquation(circleBody,convexBody,circleShape,convexShape);return vec2_1.copy(c.normalA,dist),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,worldVertex,convexOffset),add(c.contactPointB,c.contactPointB,convexOffset),sub(c.contactPointB,c.contactPointB,convexBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}}return 0};var pic_worldVertex0=vec2_1.create(),pic_worldVertex1=vec2_1.create(),pic_r0=vec2_1.create(),pic_r1=vec2_1.create();function pointInConvex(worldPoint,convexShape,convexOffset,convexAngle){for(var worldVertex0=pic_worldVertex0,worldVertex1=pic_worldVertex1,r0=pic_r0,r1=pic_r1,point=worldPoint,verts=convexShape.vertices,lastCross=null,i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2_1.rotate(worldVertex0,v0,convexAngle),vec2_1.rotate(worldVertex1,v1,convexAngle),add(worldVertex0,worldVertex0,convexOffset),add(worldVertex1,worldVertex1,convexOffset),sub(r0,worldVertex0,point),sub(r1,worldVertex1,point);var cross=vec2_1.crossLength(r0,r1);if(null===lastCross&&(lastCross=cross),cross*lastCross<=0)return!1;lastCross=cross}return!0}Narrowphase.prototype[Shape_1.PARTICLE|Shape_1.CONVEX]=Narrowphase.prototype[Shape_1.PARTICLE|Shape_1.BOX]=Narrowphase.prototype.particleConvex=function(particleBody,particleShape,particleOffset,particleAngle,convexBody,convexShape,convexOffset,convexAngle,justTest){var worldVertex0=tmp1,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldTangent=tmp5,centerDist=tmp6,convexToparticle=tmp7,dist=tmp10,closestEdgeProjectedPoint=tmp13,candidateDist=tmp17,minEdgeNormal=tmp18,minCandidateDistance=Number.MAX_VALUE,found=!1,verts=convexShape.vertices;if(!pointInConvex(particleOffset,convexShape,convexOffset,convexAngle))return 0;if(justTest)return!0;for(var i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2_1.rotate(worldVertex0,v0,convexAngle),vec2_1.rotate(worldVertex1,v1,convexAngle),add(worldVertex0,worldVertex0,convexOffset),add(worldVertex1,worldVertex1,convexOffset),sub(worldEdge,worldVertex1,worldVertex0),vec2_1.normalize(worldEdgeUnit,worldEdge),vec2_1.rotate90cw(worldTangent,worldEdgeUnit),sub(dist,particleOffset,worldVertex0);dot(dist,worldTangent);sub(centerDist,worldVertex0,convexOffset),sub(convexToparticle,particleOffset,convexOffset),vec2_1.sub(candidateDist,worldVertex0,particleOffset);var candidateDistance=Math.abs(vec2_1.dot(candidateDist,worldTangent));candidateDistance<minCandidateDistance&&(minCandidateDistance=candidateDistance,vec2_1.scale(closestEdgeProjectedPoint,worldTangent,candidateDistance),vec2_1.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,particleOffset),vec2_1.copy(minEdgeNormal,worldTangent),found=!0)}if(found){var c=this.createContactEquation(particleBody,convexBody,particleShape,convexShape);return vec2_1.scale(c.normalA,minEdgeNormal,-1),vec2_1.normalize(c.normalA,c.normalA),vec2_1.set(c.contactPointA,0,0),add(c.contactPointA,c.contactPointA,particleOffset),sub(c.contactPointA,c.contactPointA,particleBody.position),sub(c.contactPointB,closestEdgeProjectedPoint,convexOffset),add(c.contactPointB,c.contactPointB,convexOffset),sub(c.contactPointB,c.contactPointB,convexBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}return 0},Narrowphase.prototype[Shape_1.CIRCLE]=Narrowphase.prototype.circleCircle=function(bodyA,shapeA,offsetA,angleA,bodyB,shapeB,offsetB,angleB,justTest,radiusA,radiusB){var dist=tmp1;radiusA=radiusA||shapeA.radius,radiusB=radiusB||shapeB.radius;sub(dist,offsetA,offsetB);var r=radiusA+radiusB;if(vec2_1.squaredLength(dist)>Math.pow(r,2))return 0;if(justTest)return!0;var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);return sub(c.normalA,offsetB,offsetA),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointA,c.normalA,radiusA),vec2_1.scale(c.contactPointB,c.normalA,-radiusB),add(c.contactPointA,c.contactPointA,offsetA),sub(c.contactPointA,c.contactPointA,bodyA.position),add(c.contactPointB,c.contactPointB,offsetB),sub(c.contactPointB,c.contactPointB,bodyB.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1},Narrowphase.prototype[Shape_1.PLANE|Shape_1.CONVEX]=Narrowphase.prototype[Shape_1.PLANE|Shape_1.BOX]=Narrowphase.prototype.planeConvex=function(planeBody,planeShape,planeOffset,planeAngle,convexBody,convexShape,convexOffset,convexAngle,justTest){var worldVertex=tmp1,worldNormal=tmp2,dist=tmp3,numReported=0;vec2_1.rotate(worldNormal,yAxis$1,planeAngle);for(var i=0;i!==convexShape.vertices.length;i++){var v=convexShape.vertices[i];if(vec2_1.rotate(worldVertex,v,convexAngle),add(worldVertex,worldVertex,convexOffset),sub(dist,worldVertex,planeOffset),dot(dist,worldNormal)<=0){if(justTest)return!0;numReported++;var c=this.createContactEquation(planeBody,convexBody,planeShape,convexShape);sub(dist,worldVertex,planeOffset),vec2_1.copy(c.normalA,worldNormal);var d=dot(dist,c.normalA);vec2_1.scale(dist,c.normalA,d),sub(c.contactPointB,worldVertex,convexBody.position),sub(c.contactPointA,worldVertex,dist),sub(c.contactPointA,c.contactPointA,planeBody.position),this.contactEquations.push(c),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}return this.enableFrictionReduction&&this.enableFriction&&numReported&&this.frictionEquations.push(this.createFrictionFromAverage(numReported)),numReported},Narrowphase.prototype[Shape_1.PARTICLE|Shape_1.PLANE]=Narrowphase.prototype.particlePlane=function(particleBody,particleShape,particleOffset,particleAngle,planeBody,planeShape,planeOffset,planeAngle,justTest){var dist=tmp1,worldNormal=tmp2;planeAngle=planeAngle||0,sub(dist,particleOffset,planeOffset),vec2_1.rotate(worldNormal,yAxis$1,planeAngle);var d=dot(dist,worldNormal);if(d>0)return 0;if(justTest)return!0;var c=this.createContactEquation(planeBody,particleBody,planeShape,particleShape);return vec2_1.copy(c.normalA,worldNormal),vec2_1.scale(dist,c.normalA,d),sub(c.contactPointA,particleOffset,dist),sub(c.contactPointA,c.contactPointA,planeBody.position),sub(c.contactPointB,particleOffset,particleBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1},Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.PARTICLE]=Narrowphase.prototype.circleParticle=function(circleBody,circleShape,circleOffset,circleAngle,particleBody,particleShape,particleOffset,particleAngle,justTest){var dist=tmp1;if(sub(dist,particleOffset,circleOffset),vec2_1.squaredLength(dist)>Math.pow(circleShape.radius,2))return 0;if(justTest)return!0;var c=this.createContactEquation(circleBody,particleBody,circleShape,particleShape);return vec2_1.copy(c.normalA,dist),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointA,c.normalA,circleShape.radius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,particleOffset,particleBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};var planeCapsule_tmpCircle=new Circle_1({radius:1}),planeCapsule_tmp1=vec2_1.create(),planeCapsule_tmp2=vec2_1.create();vec2_1.create();Narrowphase.prototype[Shape_1.PLANE|Shape_1.CAPSULE]=Narrowphase.prototype.planeCapsule=function(planeBody,planeShape,planeOffset,planeAngle,capsuleBody,capsuleShape,capsuleOffset,capsuleAngle,justTest){var enableFrictionBefore,end1=planeCapsule_tmp1,end2=planeCapsule_tmp2,circle=planeCapsule_tmpCircle;vec2_1.set(end1,-capsuleShape.length/2,0),vec2_1.rotate(end1,end1,capsuleAngle),add(end1,end1,capsuleOffset),vec2_1.set(end2,capsuleShape.length/2,0),vec2_1.rotate(end2,end2,capsuleAngle),add(end2,end2,capsuleOffset),circle.radius=capsuleShape.radius,this.enableFrictionReduction&&(enableFrictionBefore=this.enableFriction,this.enableFriction=!1);var numContacts1=this.circlePlane(capsuleBody,circle,end1,0,planeBody,planeShape,planeOffset,planeAngle,justTest),numContacts2=this.circlePlane(capsuleBody,circle,end2,0,planeBody,planeShape,planeOffset,planeAngle,justTest);if(this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest)return numContacts1||numContacts2;var numTotal=numContacts1+numContacts2;return this.enableFrictionReduction&&numTotal&&this.frictionEquations.push(this.createFrictionFromAverage(numTotal)),numTotal},Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.PLANE]=Narrowphase.prototype.circlePlane=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){var circleBody=bi,circleShape=si,circleOffset=xi,planeBody=bj,planeOffset=xj,planeAngle=aj;planeAngle=planeAngle||0;var planeToCircle=tmp1,worldNormal=tmp2,temp=tmp3;sub(planeToCircle,circleOffset,planeOffset),vec2_1.rotate(worldNormal,yAxis$1,planeAngle);var d=dot(worldNormal,planeToCircle);if(d>circleShape.radius)return 0;if(justTest)return!0;var contact=this.createContactEquation(planeBody,circleBody,sj,si);return vec2_1.copy(contact.normalA,worldNormal),vec2_1.scale(contact.contactPointB,contact.normalA,-circleShape.radius),add(contact.contactPointB,contact.contactPointB,circleOffset),sub(contact.contactPointB,contact.contactPointB,circleBody.position),vec2_1.scale(temp,contact.normalA,d),sub(contact.contactPointA,planeToCircle,temp),add(contact.contactPointA,contact.contactPointA,planeOffset),sub(contact.contactPointA,contact.contactPointA,planeBody.position),this.contactEquations.push(contact),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(contact)),1},Narrowphase.prototype[Shape_1.CONVEX]=Narrowphase.prototype[Shape_1.CONVEX|Shape_1.BOX]=Narrowphase.prototype[Shape_1.BOX]=Narrowphase.prototype.convexConvex=function(bi,si,xi,ai,bj,sj,xj,aj,justTest,precision){var sepAxis=tmp1,worldPoint=tmp2,worldPoint0=tmp3,worldPoint1=tmp4,worldEdge=tmp5,penetrationVec=tmp7,dist=tmp8,worldNormal=tmp9,numContacts=0;precision="number"==typeof precision?precision:0;if(!Narrowphase.findSeparatingAxis(si,xi,ai,sj,xj,aj,sepAxis))return 0;sub(dist,xj,xi),dot(sepAxis,dist)>0&&vec2_1.scale(sepAxis,sepAxis,-1);var closestEdge1=Narrowphase.getClosestEdge(si,ai,sepAxis,!0),closestEdge2=Narrowphase.getClosestEdge(sj,aj,sepAxis);if(-1===closestEdge1||-1===closestEdge2)return 0;for(var k=0;k<2;k++){var tmp,closestEdgeA=closestEdge1,closestEdgeB=closestEdge2,shapeA=si,shapeB=sj,offsetA=xi,offsetB=xj,angleA=ai,angleB=aj,bodyA=bi,bodyB=bj;if(0===k)tmp=closestEdgeA,closestEdgeA=closestEdgeB,closestEdgeB=tmp,tmp=shapeA,shapeA=shapeB,shapeB=tmp,tmp=offsetA,offsetA=offsetB,offsetB=tmp,tmp=angleA,angleA=angleB,angleB=tmp,tmp=bodyA,bodyA=bodyB,bodyB=tmp;for(var j=closestEdgeB;j<closestEdgeB+2;j++){var v=shapeB.vertices[(j+shapeB.vertices.length)%shapeB.vertices.length];vec2_1.rotate(worldPoint,v,angleB),add(worldPoint,worldPoint,offsetB);for(var insideNumEdges=0,i=closestEdgeA-1;i<closestEdgeA+2;i++){var v0=shapeA.vertices[(i+shapeA.vertices.length)%shapeA.vertices.length],v1=shapeA.vertices[(i+1+shapeA.vertices.length)%shapeA.vertices.length];vec2_1.rotate(worldPoint0,v0,angleA),vec2_1.rotate(worldPoint1,v1,angleA),add(worldPoint0,worldPoint0,offsetA),add(worldPoint1,worldPoint1,offsetA),sub(worldEdge,worldPoint1,worldPoint0),vec2_1.rotate90cw(worldNormal,worldEdge),vec2_1.normalize(worldNormal,worldNormal),sub(dist,worldPoint,worldPoint0);var d=dot(worldNormal,dist);(i===closestEdgeA&&d<=precision||i!==closestEdgeA&&d<=0)&&insideNumEdges++}if(insideNumEdges>=3){if(justTest)return!0;var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);numContacts++;v0=shapeA.vertices[closestEdgeA%shapeA.vertices.length],v1=shapeA.vertices[(closestEdgeA+1)%shapeA.vertices.length];vec2_1.rotate(worldPoint0,v0,angleA),vec2_1.rotate(worldPoint1,v1,angleA),add(worldPoint0,worldPoint0,offsetA),add(worldPoint1,worldPoint1,offsetA),sub(worldEdge,worldPoint1,worldPoint0),vec2_1.rotate90cw(c.normalA,worldEdge),vec2_1.normalize(c.normalA,c.normalA),sub(dist,worldPoint,worldPoint0);d=dot(c.normalA,dist);vec2_1.scale(penetrationVec,c.normalA,d),sub(c.contactPointA,worldPoint,offsetA),sub(c.contactPointA,c.contactPointA,penetrationVec),add(c.contactPointA,c.contactPointA,offsetA),sub(c.contactPointA,c.contactPointA,bodyA.position),sub(c.contactPointB,worldPoint,offsetB),add(c.contactPointB,c.contactPointB,offsetB),sub(c.contactPointB,c.contactPointB,bodyB.position),this.contactEquations.push(c),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}}return this.enableFrictionReduction&&this.enableFriction&&numContacts&&this.frictionEquations.push(this.createFrictionFromAverage(numContacts)),numContacts};var pcoa_tmp1=vec2_1.fromValues(0,0);Narrowphase.projectConvexOntoAxis=function(convexShape,convexOffset,convexAngle,worldAxis,result){var v,value,max=null,min=null,localAxis=pcoa_tmp1;vec2_1.rotate(localAxis,worldAxis,-convexAngle);for(var i=0;i<convexShape.vertices.length;i++)v=convexShape.vertices[i],value=dot(v,localAxis),(null===max||value>max)&&(max=value),(null===min||value<min)&&(min=value);if(min>max){var t=min;min=max,max=t}var offset=dot(convexOffset,worldAxis);vec2_1.set(result,min+offset,max+offset)};var fsa_tmp1=vec2_1.fromValues(0,0),fsa_tmp2=vec2_1.fromValues(0,0),fsa_tmp3=vec2_1.fromValues(0,0),fsa_tmp4=vec2_1.fromValues(0,0),fsa_tmp5=vec2_1.fromValues(0,0),fsa_tmp6=vec2_1.fromValues(0,0);Narrowphase.findSeparatingAxis=function(c1,offset1,angle1,c2,offset2,angle2,sepAxis){var maxDist=null,overlap=!1,found=!1,edge=fsa_tmp1,worldPoint0=fsa_tmp2,worldPoint1=fsa_tmp3,normal=fsa_tmp4,span1=fsa_tmp5,span2=fsa_tmp6;if(c1 instanceof Box_1&&c2 instanceof Box_1)for(var j=0;2!==j;j++){var c=c1,angle=angle1;1===j&&(c=c2,angle=angle2);for(var i=0;2!==i;i++){0===i?vec2_1.set(normal,0,1):1===i&&vec2_1.set(normal,1,0),0!==angle&&vec2_1.rotate(normal,normal,angle),Narrowphase.projectConvexOntoAxis(c1,offset1,angle1,normal,span1),Narrowphase.projectConvexOntoAxis(c2,offset2,angle2,normal,span2);var a=span1,b=span2;span1[0]>span2[0]&&(b=span1,a=span2),overlap=(dist=b[0]-a[1])<=0,(null===maxDist||dist>maxDist)&&(vec2_1.copy(sepAxis,normal),maxDist=dist,found=overlap)}}else for(j=0;2!==j;j++){c=c1,angle=angle1;1===j&&(c=c2,angle=angle2);for(i=0;i!==c.vertices.length;i++){vec2_1.rotate(worldPoint0,c.vertices[i],angle),vec2_1.rotate(worldPoint1,c.vertices[(i+1)%c.vertices.length],angle),sub(edge,worldPoint1,worldPoint0),vec2_1.rotate90cw(normal,edge),vec2_1.normalize(normal,normal),Narrowphase.projectConvexOntoAxis(c1,offset1,angle1,normal,span1),Narrowphase.projectConvexOntoAxis(c2,offset2,angle2,normal,span2);var dist;a=span1,b=span2;span1[0]>span2[0]&&(b=span1,a=span2),overlap=(dist=b[0]-a[1])<=0,(null===maxDist||dist>maxDist)&&(vec2_1.copy(sepAxis,normal),maxDist=dist,found=overlap)}}return found};var gce_tmp1=vec2_1.fromValues(0,0),gce_tmp2=vec2_1.fromValues(0,0),gce_tmp3=vec2_1.fromValues(0,0);Narrowphase.getClosestEdge=function(c,angle,axis,flip){var localAxis=gce_tmp1,edge=gce_tmp2,normal=gce_tmp3;vec2_1.rotate(localAxis,axis,-angle),flip&&vec2_1.scale(localAxis,localAxis,-1);for(var closestEdge=-1,N=c.vertices.length,maxDot=-1,i=0;i!==N;i++){sub(edge,c.vertices[(i+1)%N],c.vertices[i%N]),vec2_1.rotate90cw(normal,edge),vec2_1.normalize(normal,normal);var d=dot(normal,localAxis);(-1===closestEdge||d>maxDot)&&(closestEdge=i%N,maxDot=d)}return closestEdge};var circleHeightfield_candidate=vec2_1.create(),circleHeightfield_dist=vec2_1.create(),circleHeightfield_v0=vec2_1.create(),circleHeightfield_v1=vec2_1.create(),circleHeightfield_minCandidate=vec2_1.create(),circleHeightfield_worldNormal=vec2_1.create(),circleHeightfield_minCandidateNormal=vec2_1.create();Narrowphase.prototype[Shape_1.CIRCLE|Shape_1.HEIGHTFIELD]=Narrowphase.prototype.circleHeightfield=function(circleBody,circleShape,circlePos,circleAngle,hfBody,hfShape,hfPos,hfAngle,justTest,radius){var data=hfShape.heights,w=(radius=radius||circleShape.radius,hfShape.elementWidth),dist=circleHeightfield_dist,candidate=circleHeightfield_candidate,minCandidate=circleHeightfield_minCandidate,minCandidateNormal=circleHeightfield_minCandidateNormal,worldNormal=circleHeightfield_worldNormal,v0=circleHeightfield_v0,v1=circleHeightfield_v1,idxA=Math.floor((circlePos[0]-radius-hfPos[0])/w),idxB=Math.ceil((circlePos[0]+radius-hfPos[0])/w);idxA<0&&(idxA=0),idxB>=data.length&&(idxB=data.length-1);for(var max=data[idxA],min=data[idxB],i=idxA;i<idxB;i++)data[i]<min&&(min=data[i]),data[i]>max&&(max=data[i]);if(circlePos[1]-radius>max)return!justTest&&0;var found=!1;for(i=idxA;i<idxB;i++){vec2_1.set(v0,i*w,data[i]),vec2_1.set(v1,(i+1)*w,data[i+1]),vec2_1.add(v0,v0,hfPos),vec2_1.add(v1,v1,hfPos),vec2_1.sub(worldNormal,v1,v0),vec2_1.rotate(worldNormal,worldNormal,Math.PI/2),vec2_1.normalize(worldNormal,worldNormal),vec2_1.scale(candidate,worldNormal,-radius),vec2_1.add(candidate,candidate,circlePos),vec2_1.sub(dist,candidate,v0);var d=vec2_1.dot(dist,worldNormal);if(candidate[0]>=v0[0]&&candidate[0]<v1[0]&&d<=0){if(justTest)return!0;found=!0,vec2_1.scale(dist,worldNormal,-d),vec2_1.add(minCandidate,candidate,dist),vec2_1.copy(minCandidateNormal,worldNormal);var c=this.createContactEquation(hfBody,circleBody,hfShape,circleShape);vec2_1.copy(c.normalA,minCandidateNormal),vec2_1.scale(c.contactPointB,c.normalA,-radius),add(c.contactPointB,c.contactPointB,circlePos),sub(c.contactPointB,c.contactPointB,circleBody.position),vec2_1.copy(c.contactPointA,minCandidate),vec2_1.sub(c.contactPointA,c.contactPointA,hfBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}if(found=!1,radius>0)for(i=idxA;i<=idxB;i++)if(vec2_1.set(v0,i*w,data[i]),vec2_1.add(v0,v0,hfPos),vec2_1.sub(dist,circlePos,v0),vec2_1.squaredLength(dist)<Math.pow(radius,2)){if(justTest)return!0;found=!0;c=this.createContactEquation(hfBody,circleBody,hfShape,circleShape);vec2_1.copy(c.normalA,dist),vec2_1.normalize(c.normalA,c.normalA),vec2_1.scale(c.contactPointB,c.normalA,-radius),add(c.contactPointB,c.contactPointB,circlePos),sub(c.contactPointB,c.contactPointB,circleBody.position),sub(c.contactPointA,v0,hfPos),add(c.contactPointA,c.contactPointA,hfPos),sub(c.contactPointA,c.contactPointA,hfBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}return found?1:0};var convexHeightfield_v0=vec2_1.create(),convexHeightfield_v1=vec2_1.create(),convexHeightfield_tilePos=vec2_1.create(),convexHeightfield_tempConvexShape=new Convex_1({vertices:[vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create()]});Narrowphase.prototype[Shape_1.BOX|Shape_1.HEIGHTFIELD]=Narrowphase.prototype[Shape_1.CONVEX|Shape_1.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(convexBody,convexShape,convexPos,convexAngle,hfBody,hfShape,hfPos,hfAngle,justTest){var data=hfShape.heights,w=hfShape.elementWidth,v0=convexHeightfield_v0,v1=convexHeightfield_v1,tilePos=convexHeightfield_tilePos,tileConvex=convexHeightfield_tempConvexShape,idxA=Math.floor((convexBody.aabb.lowerBound[0]-hfPos[0])/w),idxB=Math.ceil((convexBody.aabb.upperBound[0]-hfPos[0])/w);idxA<0&&(idxA=0),idxB>=data.length&&(idxB=data.length-1);for(var max=data[idxA],min=data[idxB],i=idxA;i<idxB;i++)data[i]<min&&(min=data[i]),data[i]>max&&(max=data[i]);if(convexBody.aabb.lowerBound[1]>max)return!justTest&&0;var numContacts=0;for(i=idxA;i<idxB;i++){vec2_1.set(v0,i*w,data[i]),vec2_1.set(v1,(i+1)*w,data[i+1]),vec2_1.add(v0,v0,hfPos),vec2_1.add(v1,v1,hfPos);vec2_1.set(tilePos,.5*(v1[0]+v0[0]),.5*(v1[1]+v0[1]-100)),vec2_1.sub(tileConvex.vertices[0],v1,tilePos),vec2_1.sub(tileConvex.vertices[1],v0,tilePos),vec2_1.copy(tileConvex.vertices[2],tileConvex.vertices[1]),vec2_1.copy(tileConvex.vertices[3],tileConvex.vertices[0]),tileConvex.vertices[2][1]-=100,tileConvex.vertices[3][1]-=100,numContacts+=this.convexConvex(convexBody,convexShape,convexPos,convexAngle,hfBody,tileConvex,tilePos,0,justTest)}return numContacts};var Plane_1=Plane;function Plane(options){(options=options||{}).type=Shape_1.PLANE,Shape_1.call(this,options)}Plane.prototype=new Shape_1,Plane.prototype.constructor=Plane,Plane.prototype.computeMomentOfInertia=function(mass){return 0},Plane.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},Plane.prototype.computeAABB=function(out,position,angle){var a=angle%(2*Math.PI),set=vec2_1.set,max=1e7,lowerBound=out.lowerBound,upperBound=out.upperBound;set(lowerBound,-max,-max),set(upperBound,max,max),0===a?upperBound[1]=0:a===Math.PI/2?lowerBound[0]=0:a===Math.PI?lowerBound[1]=0:a===3*Math.PI/2&&(upperBound[0]=0)},Plane.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var intersectPlane_planePointToFrom=vec2_1.create(),intersectPlane_normal=(vec2_1.create(),vec2_1.create(),vec2_1.create()),intersectPlane_len=vec2_1.create();Plane.prototype.raycast=function(result,ray,position,angle){var from=ray.from,to=ray.to,direction=ray.direction,planePointToFrom=intersectPlane_planePointToFrom,normal=intersectPlane_normal,len=intersectPlane_len;vec2_1.set(normal,0,1),vec2_1.rotate(normal,normal,angle),vec2_1.sub(len,from,position);var planeToFrom=vec2_1.dot(len,normal);if(vec2_1.sub(len,to,position),!(planeToFrom*vec2_1.dot(len,normal)>0||vec2_1.squaredDistance(from,to)<planeToFrom*planeToFrom)){var n_dot_dir=vec2_1.dot(normal,direction);vec2_1.sub(planePointToFrom,from,position);var t=-vec2_1.dot(normal,planePointToFrom)/n_dot_dir/ray.length;ray.reportIntersection(result,t,normal,-1)}};var Particle_1=Particle;function Particle(options){(options=options||{}).type=Shape_1.PARTICLE,Shape_1.call(this,options)}Particle.prototype=new Shape_1,Particle.prototype.constructor=Particle,Particle.prototype.computeMomentOfInertia=function(mass){return 0},Particle.prototype.updateBoundingRadius=function(){this.boundingRadius=0},Particle.prototype.computeAABB=function(out,position,angle){vec2_1.copy(out.lowerBound,position),vec2_1.copy(out.upperBound,position)};var NaiveBroadphase_1=NaiveBroadphase;function NaiveBroadphase(){Broadphase_1.call(this,Broadphase_1.NAIVE)}NaiveBroadphase.prototype=new Broadphase_1,NaiveBroadphase.prototype.constructor=NaiveBroadphase,NaiveBroadphase.prototype.getCollisionPairs=function(world){var bodies=world.bodies,result=this.result;result.length=0;for(var i=0,Ncolliding=bodies.length;i!==Ncolliding;i++)for(var bi=bodies[i],j=0;j<i;j++){var bj=bodies[j];Broadphase_1.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)&&result.push(bi,bj)}return result},NaiveBroadphase.prototype.aabbQuery=function(world,aabb,result){result=result||[];for(var bodies=world.bodies,i=0;i<bodies.length;i++){var b=bodies[i];b.aabbNeedsUpdate&&b.updateAABB(),b.aabb.overlaps(aabb)&&result.push(b)}return result};var RotationalVelocityEquation_1=RotationalVelocityEquation;function RotationalVelocityEquation(bodyA,bodyB){Equation_1.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}RotationalVelocityEquation.prototype=new Equation_1,RotationalVelocityEquation.prototype.constructor=RotationalVelocityEquation,RotationalVelocityEquation.prototype.computeB=function(a,b,h){var G=this.G;G[2]=-1,G[5]=this.ratio;var GiMf=this.computeGiMf();return-this.computeGW()*b-h*GiMf};var RotationalLockEquation_1=RotationalLockEquation;function RotationalLockEquation(bodyA,bodyB,options){options=options||{},Equation_1.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=options.angle||0;var G=this.G;G[2]=1,G[5]=-1}RotationalLockEquation.prototype=new Equation_1,RotationalLockEquation.prototype.constructor=RotationalLockEquation;var worldVectorA=vec2_1.create(),worldVectorB=vec2_1.create(),xAxis$1=vec2_1.fromValues(1,0),yAxis$2=vec2_1.fromValues(0,1);RotationalLockEquation.prototype.computeGq=function(){return vec2_1.rotate(worldVectorA,xAxis$1,this.bodyA.angle+this.angle),vec2_1.rotate(worldVectorB,yAxis$2,this.bodyB.angle),vec2_1.dot(worldVectorA,worldVectorB)};var RevoluteConstraint_1=RevoluteConstraint,worldPivotA=vec2_1.create(),worldPivotB=vec2_1.create(),xAxis$2=vec2_1.fromValues(1,0),yAxis$3=vec2_1.fromValues(0,1),g=vec2_1.create();function RevoluteConstraint(bodyA,bodyB,options){options=options||{},Constraint_1.call(this,bodyA,bodyB,Constraint_1.REVOLUTE,options);var maxForce=this.maxForce=void 0!==options.maxForce?options.maxForce:Number.MAX_VALUE;this.pivotA=vec2_1.create(),this.pivotB=vec2_1.create(),options.worldPivot?(vec2_1.sub(this.pivotA,options.worldPivot,bodyA.position),vec2_1.sub(this.pivotB,options.worldPivot,bodyB.position),vec2_1.rotate(this.pivotA,this.pivotA,-bodyA.angle),vec2_1.rotate(this.pivotB,this.pivotB,-bodyB.angle)):(vec2_1.copy(this.pivotA,options.localPivotA),vec2_1.copy(this.pivotB,options.localPivotB));var eqs=this.equations=[new Equation_1(bodyA,bodyB,-maxForce,maxForce),new Equation_1(bodyA,bodyB,-maxForce,maxForce)],x=eqs[0],y=eqs[1],that=this;x.computeGq=function(){return vec2_1.rotate(worldPivotA,that.pivotA,bodyA.angle),vec2_1.rotate(worldPivotB,that.pivotB,bodyB.angle),vec2_1.add(g,bodyB.position,worldPivotB),vec2_1.sub(g,g,bodyA.position),vec2_1.sub(g,g,worldPivotA),vec2_1.dot(g,xAxis$2)},y.computeGq=function(){return vec2_1.rotate(worldPivotA,that.pivotA,bodyA.angle),vec2_1.rotate(worldPivotB,that.pivotB,bodyB.angle),vec2_1.add(g,bodyB.position,worldPivotB),vec2_1.sub(g,g,bodyA.position),vec2_1.sub(g,g,worldPivotA),vec2_1.dot(g,yAxis$3)},y.minForce=x.minForce=-maxForce,y.maxForce=x.maxForce=maxForce,this.motorEquation=new RotationalVelocityEquation_1(bodyA,bodyB),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new RotationalLockEquation_1(bodyA,bodyB),this.lowerLimitEquation=new RotationalLockEquation_1(bodyA,bodyB),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}RevoluteConstraint.prototype=new Constraint_1,RevoluteConstraint.prototype.constructor=RevoluteConstraint,RevoluteConstraint.prototype.setLimits=function(lower,upper){"number"==typeof lower?(this.lowerLimit=lower,this.lowerLimitEnabled=!0):(this.lowerLimit=lower,this.lowerLimitEnabled=!1),"number"==typeof upper?(this.upperLimit=upper,this.upperLimitEnabled=!0):(this.upperLimit=upper,this.upperLimitEnabled=!1)},RevoluteConstraint.prototype.update=function(){var idx,bodyA=this.bodyA,bodyB=this.bodyB,pivotA=this.pivotA,pivotB=this.pivotB,eqs=this.equations,x=(eqs[0],eqs[1],eqs[0]),y=eqs[1],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation,relAngle=this.angle=bodyB.angle-bodyA.angle;this.upperLimitEnabled&&relAngle>upperLimit?(upperLimitEquation.angle=upperLimit,-1===eqs.indexOf(upperLimitEquation)&&eqs.push(upperLimitEquation)):-1!==(idx=eqs.indexOf(upperLimitEquation))&&eqs.splice(idx,1);this.lowerLimitEnabled&&relAngle<lowerLimit?(lowerLimitEquation.angle=lowerLimit,-1===eqs.indexOf(lowerLimitEquation)&&eqs.push(lowerLimitEquation)):-1!==(idx=eqs.indexOf(lowerLimitEquation))&&eqs.splice(idx,1);vec2_1.rotate(worldPivotA,pivotA,bodyA.angle),vec2_1.rotate(worldPivotB,pivotB,bodyB.angle),x.G[0]=-1,x.G[1]=0,x.G[2]=-vec2_1.crossLength(worldPivotA,xAxis$2),x.G[3]=1,x.G[4]=0,x.G[5]=vec2_1.crossLength(worldPivotB,xAxis$2),y.G[0]=0,y.G[1]=-1,y.G[2]=-vec2_1.crossLength(worldPivotA,yAxis$3),y.G[3]=0,y.G[4]=1,y.G[5]=vec2_1.crossLength(worldPivotB,yAxis$3)},RevoluteConstraint.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},RevoluteConstraint.prototype.disableMotor=function(){if(this.motorEnabled){var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1),this.motorEnabled=!1}},RevoluteConstraint.prototype.motorIsEnabled=function(){return!!this.motorEnabled},RevoluteConstraint.prototype.setMotorSpeed=function(speed){if(this.motorEnabled){var i=this.equations.indexOf(this.motorEquation);this.equations[i].relativeVelocity=speed}},RevoluteConstraint.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity};var PrismaticConstraint_1=PrismaticConstraint;function PrismaticConstraint(bodyA,bodyB,options){options=options||{},Constraint_1.call(this,bodyA,bodyB,Constraint_1.PRISMATIC,options);var localAnchorA=vec2_1.fromValues(0,0),localAxisA=vec2_1.fromValues(1,0),localAnchorB=vec2_1.fromValues(0,0);options.localAnchorA&&vec2_1.copy(localAnchorA,options.localAnchorA),options.localAxisA&&vec2_1.copy(localAxisA,options.localAxisA),options.localAnchorB&&vec2_1.copy(localAnchorB,options.localAnchorB),this.localAnchorA=localAnchorA,this.localAnchorB=localAnchorB,this.localAxisA=localAxisA;var maxForce=this.maxForce=void 0!==options.maxForce?options.maxForce:Number.MAX_VALUE,trans=new Equation_1(bodyA,bodyB,-maxForce,maxForce),ri=new vec2_1.create,rj=new vec2_1.create,gg=new vec2_1.create,t=new vec2_1.create;if(trans.computeGq=function(){return vec2_1.dot(gg,t)},trans.updateJacobian=function(){var G=this.G,xi=bodyA.position,xj=bodyB.position;vec2_1.rotate(ri,localAnchorA,bodyA.angle),vec2_1.rotate(rj,localAnchorB,bodyB.angle),vec2_1.add(gg,xj,rj),vec2_1.sub(gg,gg,xi),vec2_1.sub(gg,gg,ri),vec2_1.rotate(t,localAxisA,bodyA.angle+Math.PI/2),G[0]=-t[0],G[1]=-t[1],G[2]=-vec2_1.crossLength(ri,t)+vec2_1.crossLength(t,gg),G[3]=t[0],G[4]=t[1],G[5]=vec2_1.crossLength(rj,t)},this.equations.push(trans),!options.disableRotationalLock){var rot=new RotationalLockEquation_1(bodyA,bodyB,-maxForce,maxForce);this.equations.push(rot)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==options.lowerLimit,this.upperLimitEnabled=void 0!==options.upperLimit,this.lowerLimit=void 0!==options.lowerLimit?options.lowerLimit:0,this.upperLimit=void 0!==options.upperLimit?options.upperLimit:1,this.upperLimitEquation=new ContactEquation_1(bodyA,bodyB),this.lowerLimitEquation=new ContactEquation_1(bodyA,bodyB),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=maxForce,this.motorEquation=new Equation_1(bodyA,bodyB),this.motorEnabled=!1,this.motorSpeed=0;var that=this,motorEquation=this.motorEquation;motorEquation.computeGW;motorEquation.computeGq=function(){return 0},motorEquation.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+that.motorSpeed}}PrismaticConstraint.prototype=new Constraint_1,PrismaticConstraint.prototype.constructor=PrismaticConstraint;var worldAxisA=vec2_1.create(),worldAnchorA=vec2_1.create(),worldAnchorB=vec2_1.create(),orientedAnchorA=vec2_1.create(),orientedAnchorB=vec2_1.create(),tmp$2=vec2_1.create();PrismaticConstraint.prototype.update=function(){var eqs=this.equations,trans=eqs[0],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation,bodyA=this.bodyA,bodyB=this.bodyB,localAxisA=this.localAxisA,localAnchorA=this.localAnchorA,localAnchorB=this.localAnchorB;trans.updateJacobian(),vec2_1.rotate(worldAxisA,localAxisA,bodyA.angle),vec2_1.rotate(orientedAnchorA,localAnchorA,bodyA.angle),vec2_1.add(worldAnchorA,orientedAnchorA,bodyA.position),vec2_1.rotate(orientedAnchorB,localAnchorB,bodyB.angle),vec2_1.add(worldAnchorB,orientedAnchorB,bodyB.position);var idx,relPosition=this.position=vec2_1.dot(worldAnchorB,worldAxisA)-vec2_1.dot(worldAnchorA,worldAxisA);if(this.motorEnabled){var G=this.motorEquation.G;G[0]=worldAxisA[0],G[1]=worldAxisA[1],G[2]=vec2_1.crossLength(worldAxisA,orientedAnchorB),G[3]=-worldAxisA[0],G[4]=-worldAxisA[1],G[5]=-vec2_1.crossLength(worldAxisA,orientedAnchorA)}this.upperLimitEnabled&&relPosition>upperLimit?(vec2_1.scale(upperLimitEquation.normalA,worldAxisA,-1),vec2_1.sub(upperLimitEquation.contactPointA,worldAnchorA,bodyA.position),vec2_1.sub(upperLimitEquation.contactPointB,worldAnchorB,bodyB.position),vec2_1.scale(tmp$2,worldAxisA,upperLimit),vec2_1.add(upperLimitEquation.contactPointA,upperLimitEquation.contactPointA,tmp$2),-1===eqs.indexOf(upperLimitEquation)&&eqs.push(upperLimitEquation)):-1!==(idx=eqs.indexOf(upperLimitEquation))&&eqs.splice(idx,1);this.lowerLimitEnabled&&relPosition<lowerLimit?(vec2_1.scale(lowerLimitEquation.normalA,worldAxisA,1),vec2_1.sub(lowerLimitEquation.contactPointA,worldAnchorA,bodyA.position),vec2_1.sub(lowerLimitEquation.contactPointB,worldAnchorB,bodyB.position),vec2_1.scale(tmp$2,worldAxisA,lowerLimit),vec2_1.sub(lowerLimitEquation.contactPointB,lowerLimitEquation.contactPointB,tmp$2),-1===eqs.indexOf(lowerLimitEquation)&&eqs.push(lowerLimitEquation)):-1!==(idx=eqs.indexOf(lowerLimitEquation))&&eqs.splice(idx,1)},PrismaticConstraint.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},PrismaticConstraint.prototype.disableMotor=function(){if(this.motorEnabled){var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1),this.motorEnabled=!1}},PrismaticConstraint.prototype.setLimits=function(lower,upper){"number"==typeof lower?(this.lowerLimit=lower,this.lowerLimitEnabled=!0):(this.lowerLimit=lower,this.lowerLimitEnabled=!1),"number"==typeof upper?(this.upperLimit=upper,this.upperLimitEnabled=!0):(this.upperLimit=upper,this.upperLimitEnabled=!1)};var SAPBroadphase_1=SAPBroadphase;function SAPBroadphase(){Broadphase_1.call(this,Broadphase_1.SAP),this.axisList=[],this.axisIndex=0;var that=this;this._addBodyHandler=function(e){that.axisList.push(e.body)},this._removeBodyHandler=function(e){var idx=that.axisList.indexOf(e.body);-1!==idx&&that.axisList.splice(idx,1)}}SAPBroadphase.prototype=new Broadphase_1,SAPBroadphase.prototype.constructor=SAPBroadphase,SAPBroadphase.prototype.setWorld=function(world){this.axisList.length=0,Utils_1.appendArray(this.axisList,world.bodies),world.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),world.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=world},SAPBroadphase.sortAxisList=function(a,axisIndex){axisIndex|=0;for(var i=1,l=a.length;i<l;i++){for(var v=a[i],j=i-1;j>=0&&!(a[j].aabb.lowerBound[axisIndex]<=v.aabb.lowerBound[axisIndex]);j--)a[j+1]=a[j];a[j+1]=v}return a},SAPBroadphase.prototype.sortList=function(){var bodies=this.axisList,axisIndex=this.axisIndex;SAPBroadphase.sortAxisList(bodies,axisIndex)},SAPBroadphase.prototype.getCollisionPairs=function(world){var bodies=this.axisList,result=this.result,axisIndex=this.axisIndex;result.length=0;for(var l=bodies.length;l--;){var b=bodies[l];b.aabbNeedsUpdate&&b.updateAABB()}this.sortList();for(var i=0,N=0|bodies.length;i!==N;i++)for(var bi=bodies[i],j=i+1;j<N;j++){var bj=bodies[j];if(!(bj.aabb.lowerBound[axisIndex]<=bi.aabb.upperBound[axisIndex]))break;Broadphase_1.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)&&result.push(bi,bj)}return result},SAPBroadphase.prototype.aabbQuery=function(world,aabb,result){result=result||[],this.sortList();var axisIndex=this.axisIndex,axis="x";1===axisIndex&&(axis="y"),2===axisIndex&&(axis="z");for(var axisList=this.axisList,i=(aabb.lowerBound[axis],aabb.upperBound[axis],0);i<axisList.length;i++){var b=axisList[i];b.aabbNeedsUpdate&&b.updateAABB(),b.aabb.overlaps(aabb)&&result.push(b)}return result};var Spring_1=Spring;function Spring(bodyA,bodyB,options){options=Utils_1.defaults(options,{stiffness:100,damping:1}),this.stiffness=options.stiffness,this.damping=options.damping,this.bodyA=bodyA,this.bodyB=bodyB}Spring.prototype.applyForce=function(){};var TopDownVehicle_1=TopDownVehicle;function TopDownVehicle(chassisBody,options){this.chassisBody=chassisBody,this.wheels=[],this.groundBody=new Body_1({mass:0}),this.world=null;var that=this;this.preStepCallback=function(){that.update()}}function WheelConstraint(vehicle,options){options=options||{},this.vehicle=vehicle,this.forwardEquation=new FrictionEquation_1(vehicle.chassisBody,vehicle.groundBody),this.sideEquation=new FrictionEquation_1(vehicle.chassisBody,vehicle.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==options.sideFriction?options.sideFriction:5),this.localForwardVector=vec2_1.fromValues(0,1),options.localForwardVector&&vec2_1.copy(this.localForwardVector,options.localForwardVector),this.localPosition=vec2_1.fromValues(0,0),options.localPosition&&vec2_1.copy(this.localPosition,options.localPosition),Constraint_1.apply(this,vehicle.chassisBody,vehicle.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}TopDownVehicle.prototype.addToWorld=function(world){this.world=world,world.addBody(this.groundBody),world.on("preStep",this.preStepCallback);for(var i=0;i<this.wheels.length;i++){var wheel=this.wheels[i];world.addConstraint(wheel)}},TopDownVehicle.prototype.removeFromWorld=function(){var world=this.world;world.removeBody(this.groundBody),world.off("preStep",this.preStepCallback);for(var i=0;i<this.wheels.length;i++){var wheel=this.wheels[i];world.removeConstraint(wheel)}this.world=null},TopDownVehicle.prototype.addWheel=function(wheelOptions){var wheel=new WheelConstraint(this,wheelOptions);return this.wheels.push(wheel),wheel},TopDownVehicle.prototype.update=function(){for(var i=0;i<this.wheels.length;i++)this.wheels[i].update()},WheelConstraint.prototype=new Constraint_1,WheelConstraint.prototype.setBrakeForce=function(force){this.forwardEquation.setSlipForce(force)},WheelConstraint.prototype.setSideFriction=function(force){this.sideEquation.setSlipForce(force)};var worldVelocity=vec2_1.create(),relativePoint=vec2_1.create();WheelConstraint.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(relativePoint,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(worldVelocity,relativePoint),vec2_1.dot(worldVelocity,relativePoint)};var tmpVec=vec2_1.create();WheelConstraint.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),vec2_1.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),vec2_1.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),vec2_1.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),vec2_1.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),vec2_1.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),vec2_1.normalize(tmpVec,this.forwardEquation.t),vec2_1.scale(tmpVec,tmpVec,this.engineForce),this.vehicle.chassisBody.applyForce(tmpVec,this.forwardEquation.contactPointA)};var LinearSpring_1=LinearSpring;function LinearSpring(bodyA,bodyB,options){options=options||{},Spring_1.call(this,bodyA,bodyB,options),this.localAnchorA=vec2_1.fromValues(0,0),this.localAnchorB=vec2_1.fromValues(0,0),options.localAnchorA&&vec2_1.copy(this.localAnchorA,options.localAnchorA),options.localAnchorB&&vec2_1.copy(this.localAnchorB,options.localAnchorB),options.worldAnchorA&&this.setWorldAnchorA(options.worldAnchorA),options.worldAnchorB&&this.setWorldAnchorB(options.worldAnchorB);var worldAnchorA=vec2_1.create(),worldAnchorB=vec2_1.create();this.getWorldAnchorA(worldAnchorA),this.getWorldAnchorB(worldAnchorB);var worldDistance=vec2_1.distance(worldAnchorA,worldAnchorB);this.restLength="number"==typeof options.restLength?options.restLength:worldDistance}LinearSpring.prototype=new Spring_1,LinearSpring.prototype.constructor=LinearSpring,LinearSpring.prototype.setWorldAnchorA=function(worldAnchorA){this.bodyA.toLocalFrame(this.localAnchorA,worldAnchorA)},LinearSpring.prototype.setWorldAnchorB=function(worldAnchorB){this.bodyB.toLocalFrame(this.localAnchorB,worldAnchorB)},LinearSpring.prototype.getWorldAnchorA=function(result){this.bodyA.toWorldFrame(result,this.localAnchorA)},LinearSpring.prototype.getWorldAnchorB=function(result){this.bodyB.toWorldFrame(result,this.localAnchorB)};var applyForce_r=vec2_1.create(),applyForce_r_unit=vec2_1.create(),applyForce_u=vec2_1.create(),applyForce_f=vec2_1.create(),applyForce_worldAnchorA=vec2_1.create(),applyForce_worldAnchorB=vec2_1.create(),applyForce_ri=vec2_1.create(),applyForce_rj=vec2_1.create(),applyForce_tmp=vec2_1.create();LinearSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restLength,bodyA=this.bodyA,bodyB=this.bodyB,r=applyForce_r,r_unit=applyForce_r_unit,u=applyForce_u,f=applyForce_f,tmp=applyForce_tmp,worldAnchorA=applyForce_worldAnchorA,worldAnchorB=applyForce_worldAnchorB,ri=applyForce_ri,rj=applyForce_rj;this.getWorldAnchorA(worldAnchorA),this.getWorldAnchorB(worldAnchorB),vec2_1.sub(ri,worldAnchorA,bodyA.position),vec2_1.sub(rj,worldAnchorB,bodyB.position),vec2_1.sub(r,worldAnchorB,worldAnchorA);var rlen=vec2_1.len(r);vec2_1.normalize(r_unit,r),vec2_1.sub(u,bodyB.velocity,bodyA.velocity),vec2_1.crossZV(tmp,bodyB.angularVelocity,rj),vec2_1.add(u,u,tmp),vec2_1.crossZV(tmp,bodyA.angularVelocity,ri),vec2_1.sub(u,u,tmp),vec2_1.scale(f,r_unit,-k*(rlen-l)-d*vec2_1.dot(u,r_unit)),vec2_1.sub(bodyA.force,bodyA.force,f),vec2_1.add(bodyB.force,bodyB.force,f);var ri_x_f=vec2_1.crossLength(ri,f),rj_x_f=vec2_1.crossLength(rj,f);bodyA.angularForce-=ri_x_f,bodyB.angularForce+=rj_x_f};var RotationalSpring_1=RotationalSpring;function RotationalSpring(bodyA,bodyB,options){options=options||{},Spring_1.call(this,bodyA,bodyB,options),this.restAngle="number"==typeof options.restAngle?options.restAngle:bodyB.angle-bodyA.angle}RotationalSpring.prototype=new Spring_1,RotationalSpring.prototype.constructor=RotationalSpring,RotationalSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restAngle,bodyA=this.bodyA,bodyB=this.bodyB,torque=-k*(bodyB.angle-bodyA.angle-l)-d*(bodyB.angularVelocity-bodyA.angularVelocity)*0;bodyA.angularForce-=torque,bodyB.angularForce+=torque};var _args=[[{raw:"p2@0.7.1",scope:null,escapedName:"p2",name:"p2",rawSpec:"0.7.1",spec:"0.7.1",type:"version"},"/var/lib/jenkins/workspace/websdk-production"]],_npmUser={name:"schteppe",email:"schteppe@gmail.com"},_phantomChildren={},_requested={raw:"p2@0.7.1",scope:null,escapedName:"p2",name:"p2",rawSpec:"0.7.1",spec:"0.7.1",type:"version"},_requiredBy=["#USER","/"],_resolved="https://registry.npmjs.org/p2/-/p2-0.7.1.tgz",_shasum="25f2474d9bc3a6d3140a1da26a67c9e118ac9543",_where="/var/lib/jenkins/workspace/websdk-production",author={name:"Stefan Hedman",email:"schteppe@gmail.com",url:"http://steffe.se"},bugs={url:"https://github.com/schteppe/p2.js/issues"},dependencies={"poly-decomp":"0.1.1"},devDependencies={grunt:"^0.4.5","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0"},directories={},dist$1={shasum:"25f2474d9bc3a6d3140a1da26a67c9e118ac9543",tarball:"https://registry.npmjs.org/p2/-/p2-0.7.1.tgz"},engines={node:"*"},gitHead="d83c483f912362fd6e57c74b0634ea3f1f3e0c82",homepage="https://github.com/schteppe/p2.js#readme",keywords=["p2.js","p2","physics","engine","2d"],licenses=[{type:"MIT"}],maintainers=[{name:"schteppe",email:"schteppe@gmail.com"}],optionalDependencies={},readme="ERROR: No README data found!",repository={type:"git",url:"git+https://github.com/schteppe/p2.js.git"},scripts={},_package={_args:_args,_from:"p2@0.7.1",_id:"p2@0.7.1",_inCache:!0,_location:"/p2",_nodeVersion:"4.2.2",_npmUser:_npmUser,_npmVersion:"2.14.7",_phantomChildren:_phantomChildren,_requested:_requested,_requiredBy:_requiredBy,_resolved:_resolved,_shasum:_shasum,_shrinkwrap:null,_spec:"p2@0.7.1",_where:_where,author:author,bugs:bugs,dependencies:dependencies,description:"A JavaScript 2D physics engine.",devDependencies:devDependencies,directories:directories,dist:dist$1,engines:engines,gitHead:gitHead,homepage:homepage,keywords:keywords,licenses:licenses,main:"./src/p2.js",maintainers:maintainers,name:"p2",optionalDependencies:optionalDependencies,readme:readme,repository:repository,scripts:scripts,version:"0.7.1"},_package$1=Object.freeze({__proto__:null,_args:_args,_from:"p2@0.7.1",_id:"p2@0.7.1",_inCache:!0,_location:"/p2",_nodeVersion:"4.2.2",_npmUser:_npmUser,_npmVersion:"2.14.7",_phantomChildren:_phantomChildren,_requested:_requested,_requiredBy:_requiredBy,_resolved:_resolved,_shasum:_shasum,_shrinkwrap:null,_spec:"p2@0.7.1",_where:_where,author:author,bugs:bugs,dependencies:dependencies,description:"A JavaScript 2D physics engine.",devDependencies:devDependencies,directories:directories,dist:dist$1,engines:engines,gitHead:gitHead,homepage:homepage,keywords:keywords,licenses:licenses,main:"./src/p2.js",maintainers:maintainers,name:"p2",optionalDependencies:optionalDependencies,readme:readme,repository:repository,scripts:scripts,version:"0.7.1",default:_package}),OverlapKeeperRecord_1=OverlapKeeperRecord;function OverlapKeeperRecord(bodyA,shapeA,bodyB,shapeB){this.shapeA=shapeA,this.shapeB=shapeB,this.bodyA=bodyA,this.bodyB=bodyB}OverlapKeeperRecord.prototype.set=function(bodyA,shapeA,bodyB,shapeB){OverlapKeeperRecord.call(this,bodyA,shapeA,bodyB,shapeB)};var OverlapKeeperRecordPool_1=OverlapKeeperRecordPool;function OverlapKeeperRecordPool(){Pool_1.apply(this,arguments)}OverlapKeeperRecordPool.prototype=new Pool_1,OverlapKeeperRecordPool.prototype.constructor=OverlapKeeperRecordPool,OverlapKeeperRecordPool.prototype.create=function(){return new OverlapKeeperRecord_1},OverlapKeeperRecordPool.prototype.destroy=function(record){return record.bodyA=record.bodyB=record.shapeA=record.shapeB=null,this};var OverlapKeeper_1=OverlapKeeper;function OverlapKeeper(){this.overlappingShapesLastState=new TupleDictionary_1,this.overlappingShapesCurrentState=new TupleDictionary_1,this.recordPool=new OverlapKeeperRecordPool_1({size:16}),this.tmpDict=new TupleDictionary_1,this.tmpArray1=[]}OverlapKeeper.prototype.tick=function(){for(var last=this.overlappingShapesLastState,current=this.overlappingShapesCurrentState,l=last.keys.length;l--;){var key=last.keys[l],lastObject=last.getByKey(key);current.getByKey(key);lastObject&&this.recordPool.release(lastObject)}last.reset(),last.copy(current),current.reset()},OverlapKeeper.prototype.setOverlapping=function(bodyA,shapeA,bodyB,shapeB){this.overlappingShapesLastState;var current=this.overlappingShapesCurrentState;if(!current.get(shapeA.id,shapeB.id)){var data=this.recordPool.get();data.set(bodyA,shapeA,bodyB,shapeB),current.set(shapeA.id,shapeB.id,data)}},OverlapKeeper.prototype.getNewOverlaps=function(result){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,result)},OverlapKeeper.prototype.getEndOverlaps=function(result){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,result)},OverlapKeeper.prototype.bodiesAreOverlapping=function(bodyA,bodyB){for(var current=this.overlappingShapesCurrentState,l=current.keys.length;l--;){var key=current.keys[l],data=current.data[key];if(data.bodyA===bodyA&&data.bodyB===bodyB||data.bodyA===bodyB&&data.bodyB===bodyA)return!0}return!1},OverlapKeeper.prototype.getDiff=function(dictA,dictB,result){var last=dictA,current=dictB;(result=result||[]).length=0;for(var l=current.keys.length;l--;){var key=current.keys[l],data=current.data[key];if(!data)throw new Error("Key "+key+" had no data!");last.data[key]||result.push(data)}return result},OverlapKeeper.prototype.isNewOverlap=function(shapeA,shapeB){var idA=0|shapeA.id,idB=0|shapeB.id,last=this.overlappingShapesLastState,current=this.overlappingShapesCurrentState;return!last.get(idA,idB)&&!!current.get(idA,idB)},OverlapKeeper.prototype.getNewBodyOverlaps=function(result){this.tmpArray1.length=0;var overlaps=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(overlaps,result)},OverlapKeeper.prototype.getEndBodyOverlaps=function(result){this.tmpArray1.length=0;var overlaps=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(overlaps,result)},OverlapKeeper.prototype.getBodyDiff=function(overlaps,result){result=result||[];for(var accumulator=this.tmpDict,l=overlaps.length;l--;){var data=overlaps[l];accumulator.set(0|data.bodyA.id,0|data.bodyB.id,data)}for(l=accumulator.keys.length;l--;){(data=accumulator.getByKey(accumulator.keys[l]))&&result.push(data.bodyA,data.bodyB)}return accumulator.reset(),result};var Island_1=Island;function Island(){this.equations=[],this.bodies=[]}Island.prototype.reset=function(){this.equations.length=this.bodies.length=0};var bodyIds=[];Island.prototype.getBodies=function(result){var bodies=result||[],eqs=this.equations;bodyIds.length=0;for(var i=0;i!==eqs.length;i++){var eq=eqs[i];-1===bodyIds.indexOf(eq.bodyA.id)&&(bodies.push(eq.bodyA),bodyIds.push(eq.bodyA.id)),-1===bodyIds.indexOf(eq.bodyB.id)&&(bodies.push(eq.bodyB),bodyIds.push(eq.bodyB.id))}return bodies},Island.prototype.wantsToSleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];if(b.type===Body_1.DYNAMIC&&!b.wantsToSleep)return!1}return!0},Island.prototype.sleep=function(){for(var i=0;i<this.bodies.length;i++){this.bodies[i].sleep()}return!0};var IslandNode_1=IslandNode;function IslandNode(body){this.body=body,this.neighbors=[],this.equations=[],this.visited=!1}IslandNode.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null};var IslandNodePool_1=IslandNodePool;function IslandNodePool(){Pool_1.apply(this,arguments)}IslandNodePool.prototype=new Pool_1,IslandNodePool.prototype.constructor=IslandNodePool,IslandNodePool.prototype.create=function(){return new IslandNode_1},IslandNodePool.prototype.destroy=function(node){return node.reset(),this};var IslandPool_1=IslandPool;function IslandPool(){Pool_1.apply(this,arguments)}IslandPool.prototype=new Pool_1,IslandPool.prototype.constructor=IslandPool,IslandPool.prototype.create=function(){return new Island_1},IslandPool.prototype.destroy=function(island){return island.reset(),this};var IslandManager_1=IslandManager;function IslandManager(options){this.nodePool=new IslandNodePool_1({size:16}),this.islandPool=new IslandPool_1({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}IslandManager.getUnvisitedNode=function(nodes){for(var Nnodes=nodes.length,i=0;i!==Nnodes;i++){var node=nodes[i];if(!node.visited&&node.body.type===Body_1.DYNAMIC)return node}return!1},IslandManager.prototype.visit=function(node,bds,eqs){bds.push(node.body);for(var Neqs=node.equations.length,i=0;i!==Neqs;i++){var eq=node.equations[i];-1===eqs.indexOf(eq)&&eqs.push(eq)}},IslandManager.prototype.bfs=function(root,bds,eqs){var queue=this.queue;for(queue.length=0,queue.push(root),root.visited=!0,this.visit(root,bds,eqs);queue.length;)for(var child,node=queue.pop();child=IslandManager.getUnvisitedNode(node.neighbors);)child.visited=!0,this.visit(child,bds,eqs),child.body.type===Body_1.DYNAMIC&&queue.push(child)},IslandManager.prototype.split=function(world){for(var bodies=world.bodies,nodes=this.nodes,equations=this.equations;nodes.length;)this.nodePool.release(nodes.pop());for(var i=0;i!==bodies.length;i++){var node=this.nodePool.get();node.body=bodies[i],nodes.push(node)}for(var k=0;k!==equations.length;k++){var eq=equations[k],j=(i=bodies.indexOf(eq.bodyA),bodies.indexOf(eq.bodyB)),ni=nodes[i],nj=nodes[j];ni.neighbors.push(nj),nj.neighbors.push(ni),ni.equations.push(eq),nj.equations.push(eq)}var child,islands=this.islands;for(i=0;i<islands.length;i++)this.islandPool.release(islands[i]);for(islands.length=0;child=IslandManager.getUnvisitedNode(nodes);){var island=this.islandPool.get();this.bfs(child,island.bodies,island.equations),islands.push(island)}return islands};var require$$43=function(n){return n&&n.default||n}(_package$1),World_1=World;function World(options){EventEmitter_1.apply(this),options=options||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=options.solver||new GSSolver_1,this.narrowphase=new Narrowphase_1(this),this.islandManager=new IslandManager_1,this.gravity=vec2_1.fromValues(0,-9.78),options.gravity&&vec2_1.copy(this.gravity,options.gravity),this.frictionGravity=vec2_1.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=options.broadphase||new SAPBroadphase_1,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new Material_1,this.defaultContactMaterial=new ContactMaterial_1(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===options.islandSplit||!!options.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=World.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new OverlapKeeper_1}World.prototype=new Object(EventEmitter_1.prototype),World.prototype.constructor=World,World.NO_SLEEPING=1,World.BODY_SLEEPING=2,World.ISLAND_SLEEPING=4,World.prototype.addConstraint=function(constraint){this.constraints.push(constraint)},World.prototype.addContactMaterial=function(contactMaterial){this.contactMaterials.push(contactMaterial)},World.prototype.removeContactMaterial=function(cm){var idx=this.contactMaterials.indexOf(cm);-1!==idx&&Utils_1.splice(this.contactMaterials,idx,1)},World.prototype.getContactMaterial=function(materialA,materialB){for(var cmats=this.contactMaterials,i=0,N=cmats.length;i!==N;i++){var cm=cmats[i];if(cm.materialA.id===materialA.id&&cm.materialB.id===materialB.id||cm.materialA.id===materialB.id&&cm.materialB.id===materialA.id)return cm}return!1},World.prototype.removeConstraint=function(constraint){var idx=this.constraints.indexOf(constraint);-1!==idx&&Utils_1.splice(this.constraints,idx,1)};vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create(),vec2_1.create();var step_mg=vec2_1.create(),xiw=vec2_1.fromValues(0,0),xjw=vec2_1.fromValues(0,0);vec2_1.fromValues(0,0),vec2_1.fromValues(0,0);World.prototype.step=function(dt,timeSinceLastCalled,maxSubSteps){if(maxSubSteps=maxSubSteps||10,0===(timeSinceLastCalled=timeSinceLastCalled||0))this.internalStep(dt),this.time+=dt;else{this.accumulator+=timeSinceLastCalled;for(var substeps=0;this.accumulator>=dt&&substeps<maxSubSteps;)this.internalStep(dt),this.time+=dt,this.accumulator-=dt,substeps++;for(var t=this.accumulator%dt/dt,j=0;j!==this.bodies.length;j++){var b=this.bodies[j];vec2_1.lerp(b.interpolatedPosition,b.previousPosition,b.position,t),b.interpolatedAngle=b.previousAngle+t*(b.angle-b.previousAngle)}}};var endOverlaps=[];World.prototype.internalStep=function(dt){this.stepping=!0;var Nsprings=this.springs.length,springs=this.springs,bodies=this.bodies,g=this.gravity,solver=this.solver,Nbodies=this.bodies.length,broadphase=this.broadphase,np=this.narrowphase,constraints=this.constraints,mg=step_mg,add=(vec2_1.scale,vec2_1.add),islandManager=(vec2_1.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=dt,this.useWorldGravityAsFrictionGravity){var gravityLen=vec2_1.length(this.gravity);0===gravityLen&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=gravityLen)}if(this.applyGravity)for(var i=0;i!==Nbodies;i++){var fi=(b=bodies[i]).force;b.type===Body_1.DYNAMIC&&b.sleepState!==Body_1.SLEEPING&&(vec2_1.scale(mg,g,b.mass*b.gravityScale),add(fi,fi,mg))}if(this.applySpringForces)for(i=0;i!==Nsprings;i++){springs[i].applyForce()}if(this.applyDamping)for(i=0;i!==Nbodies;i++){var b;(b=bodies[i]).type===Body_1.DYNAMIC&&b.applyDamping(dt)}var result=broadphase.getCollisionPairs(this),ignoredPairs=this.disabledBodyCollisionPairs;for(i=ignoredPairs.length-2;i>=0;i-=2)for(var j=result.length-2;j>=0;j-=2)(ignoredPairs[i]===result[j]&&ignoredPairs[i+1]===result[j+1]||ignoredPairs[i+1]===result[j]&&ignoredPairs[i]===result[j+1])&&result.splice(j,2);var Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++){var c=constraints[i];if(!c.collideConnected)for(j=result.length-2;j>=0;j-=2)(c.bodyA===result[j]&&c.bodyB===result[j+1]||c.bodyB===result[j]&&c.bodyA===result[j+1])&&result.splice(j,2)}this.postBroadphaseEvent.pairs=result,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,np.reset(this);i=0;for(var Nresults=result.length;i!==Nresults;i+=2)for(var bi=result[i],bj=result[i+1],k=0,Nshapesi=bi.shapes.length;k!==Nshapesi;k++)for(var si=bi.shapes[k],xi=si.position,ai=si.angle,l=0,Nshapesj=bj.shapes.length;l!==Nshapesj;l++){var sj=bj.shapes[l],xj=sj.position,aj=sj.angle,cm=this.defaultContactMaterial;if(si.material&&sj.material){var tmp=this.getContactMaterial(si.material,sj.material);tmp&&(cm=tmp)}this.runNarrowphase(np,bi,si,xi,ai,bj,sj,xj,aj,cm,this.frictionGravity)}for(i=0;i!==Nbodies;i++){(body=bodies[i])._wakeUpAfterNarrowphase&&(body.wakeUp(),body._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(endOverlaps);var e=this.endContactEvent;for(l=endOverlaps.length;l--;){var data=endOverlaps[l];e.shapeA=data.shapeA,e.shapeB=data.shapeB,e.bodyA=data.bodyA,e.bodyB=data.bodyB,this.emit(e)}endOverlaps.length=0}var preSolveEvent=this.preSolveEvent;preSolveEvent.contactEquations=np.contactEquations,preSolveEvent.frictionEquations=np.frictionEquations,this.emit(preSolveEvent),preSolveEvent.contactEquations=preSolveEvent.frictionEquations=null;Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++)constraints[i].update();if(np.contactEquations.length||np.frictionEquations.length||Nconstraints)if(this.islandSplit){for(islandManager.equations.length=0,Utils_1.appendArray(islandManager.equations,np.contactEquations),Utils_1.appendArray(islandManager.equations,np.frictionEquations),i=0;i!==Nconstraints;i++)Utils_1.appendArray(islandManager.equations,constraints[i].equations);islandManager.split(this);for(i=0;i!==islandManager.islands.length;i++){(island=islandManager.islands[i]).equations.length&&solver.solveIsland(dt,island)}}else{for(solver.addEquations(np.contactEquations),solver.addEquations(np.frictionEquations),i=0;i!==Nconstraints;i++)solver.addEquations(constraints[i].equations);this.solveConstraints&&solver.solve(dt,this),solver.removeAllEquations()}for(i=0;i!==Nbodies;i++){var body;(body=bodies[i]).integrate(dt)}for(i=0;i!==Nbodies;i++)bodies[i].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var ev=this.impactEvent;for(i=0;i!==np.contactEquations.length;i++){var eq=np.contactEquations[i];eq.firstImpact&&(ev.bodyA=eq.bodyA,ev.bodyB=eq.bodyB,ev.shapeA=eq.shapeA,ev.shapeB=eq.shapeB,ev.contactEquation=eq,this.emit(ev))}}if(this.sleepMode===World.BODY_SLEEPING)for(i=0;i!==Nbodies;i++)bodies[i].sleepTick(this.time,!1,dt);else if(this.sleepMode===World.ISLAND_SLEEPING&&this.islandSplit){for(i=0;i!==Nbodies;i++)bodies[i].sleepTick(this.time,!0,dt);for(i=0;i<this.islandManager.islands.length;i++){var island;(island=this.islandManager.islands[i]).wantsToSleep()&&island.sleep()}}this.stepping=!1;var bodiesToBeRemoved=this.bodiesToBeRemoved;for(i=0;i!==bodiesToBeRemoved.length;i++)this.removeBody(bodiesToBeRemoved[i]);bodiesToBeRemoved.length=0,this.emit(this.postStepEvent)},World.prototype.runNarrowphase=function(np,bi,si,xi,ai,bj,sj,xj,aj,cm,glen){if(0!=(si.collisionGroup&sj.collisionMask)&&0!=(sj.collisionGroup&si.collisionMask)){vec2_1.rotate(xiw,xi,bi.angle),vec2_1.rotate(xjw,xj,bj.angle),vec2_1.add(xiw,xiw,bi.position),vec2_1.add(xjw,xjw,bj.position);var reducedMass,aiw=ai+bi.angle,ajw=aj+bj.angle;np.enableFriction=cm.friction>0,np.frictionCoefficient=cm.friction,reducedMass=bi.type===Body_1.STATIC||bi.type===Body_1.KINEMATIC?bj.mass:bj.type===Body_1.STATIC||bj.type===Body_1.KINEMATIC?bi.mass:bi.mass*bj.mass/(bi.mass+bj.mass),np.slipForce=cm.friction*glen*reducedMass,np.restitution=cm.restitution,np.surfaceVelocity=cm.surfaceVelocity,np.frictionStiffness=cm.frictionStiffness,np.frictionRelaxation=cm.frictionRelaxation,np.stiffness=cm.stiffness,np.relaxation=cm.relaxation,np.contactSkinSize=cm.contactSkinSize,np.enabledEquations=bi.collisionResponse&&bj.collisionResponse&&si.collisionResponse&&sj.collisionResponse;var resolver=np[si.type|sj.type],numContacts=0;if(resolver){var sensor=si.sensor||sj.sensor,numFrictionBefore=np.frictionEquations.length;numContacts=si.type<sj.type?resolver.call(np,bi,si,xiw,aiw,bj,sj,xjw,ajw,sensor):resolver.call(np,bj,sj,xjw,ajw,bi,si,xiw,aiw,sensor);var numFrictionEquations=np.frictionEquations.length-numFrictionBefore;if(numContacts){if(bi.allowSleep&&bi.type===Body_1.DYNAMIC&&bi.sleepState===Body_1.SLEEPING&&bj.sleepState===Body_1.AWAKE&&bj.type!==Body_1.STATIC)vec2_1.squaredLength(bj.velocity)+Math.pow(bj.angularVelocity,2)>=2*Math.pow(bj.sleepSpeedLimit,2)&&(bi._wakeUpAfterNarrowphase=!0);if(bj.allowSleep&&bj.type===Body_1.DYNAMIC&&bj.sleepState===Body_1.SLEEPING&&bi.sleepState===Body_1.AWAKE&&bi.type!==Body_1.STATIC)vec2_1.squaredLength(bi.velocity)+Math.pow(bi.angularVelocity,2)>=2*Math.pow(bi.sleepSpeedLimit,2)&&(bj._wakeUpAfterNarrowphase=!0);if(this.overlapKeeper.setOverlapping(bi,si,bj,sj),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(si,sj)){var e=this.beginContactEvent;if(e.shapeA=si,e.shapeB=sj,e.bodyA=bi,e.bodyB=bj,e.contactEquations.length=0,"number"==typeof numContacts)for(var i=np.contactEquations.length-numContacts;i<np.contactEquations.length;i++)e.contactEquations.push(np.contactEquations[i]);this.emit(e)}if("number"==typeof numContacts&&numFrictionEquations>1)for(i=np.frictionEquations.length-numFrictionEquations;i<np.frictionEquations.length;i++){var f=np.frictionEquations[i];f.setSlipForce(f.getSlipForce()/numFrictionEquations)}}}}},World.prototype.addSpring=function(spring){this.springs.push(spring);var evt=this.addSpringEvent;evt.spring=spring,this.emit(evt),evt.spring=null},World.prototype.removeSpring=function(spring){var idx=this.springs.indexOf(spring);-1!==idx&&Utils_1.splice(this.springs,idx,1)},World.prototype.addBody=function(body){if(-1===this.bodies.indexOf(body)){this.bodies.push(body),body.world=this;var evt=this.addBodyEvent;evt.body=body,this.emit(evt),evt.body=null}},World.prototype.removeBody=function(body){if(this.stepping)this.bodiesToBeRemoved.push(body);else{body.world=null;var idx=this.bodies.indexOf(body);-1!==idx&&(Utils_1.splice(this.bodies,idx,1),this.removeBodyEvent.body=body,body.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},World.prototype.getBodyById=function(id){for(var bodies=this.bodies,i=0;i<bodies.length;i++){var b=bodies[i];if(b.id===id)return b}return!1},World.prototype.disableBodyCollision=function(bodyA,bodyB){this.disabledBodyCollisionPairs.push(bodyA,bodyB)},World.prototype.enableBodyCollision=function(bodyA,bodyB){for(var pairs=this.disabledBodyCollisionPairs,i=0;i<pairs.length;i+=2)if(pairs[i]===bodyA&&pairs[i+1]===bodyB||pairs[i+1]===bodyA&&pairs[i]===bodyB)return void pairs.splice(i,2)},World.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var cs=this.constraints,i=cs.length-1;i>=0;i--)this.removeConstraint(cs[i]);var bodies=this.bodies;for(i=bodies.length-1;i>=0;i--)this.removeBody(bodies[i]);var springs=this.springs;for(i=springs.length-1;i>=0;i--)this.removeSpring(springs[i]);var cms=this.contactMaterials;for(i=cms.length-1;i>=0;i--)this.removeContactMaterial(cms[i]);World.apply(this)};var hitTest_tmp1=vec2_1.create(),hitTest_tmp2=(vec2_1.fromValues(0,0),vec2_1.fromValues(0,0));World.prototype.hitTest=function(worldPoint,bodies,precision){precision=precision||0;var pb=new Body_1({position:worldPoint}),ps=new Particle_1,px=worldPoint,x=hitTest_tmp1,tmp=hitTest_tmp2;pb.addShape(ps);for(var n=this.narrowphase,result=[],i=0,N=bodies.length;i!==N;i++)for(var b=bodies[i],j=0,NS=b.shapes.length;j!==NS;j++){var s=b.shapes[j];vec2_1.rotate(x,s.position,b.angle),vec2_1.add(x,x,b.position);var a=s.angle+b.angle;(s instanceof Circle_1&&n.circleParticle(b,s,x,a,pb,ps,px,0,!0)||s instanceof Convex_1&&n.particleConvex(pb,ps,px,0,b,s,x,a,!0)||s instanceof Plane_1&&n.particlePlane(pb,ps,px,0,b,s,x,a,!0)||s instanceof Capsule_1&&n.particleCapsule(pb,ps,px,0,b,s,x,a,!0)||s instanceof Particle_1&&vec2_1.squaredLength(vec2_1.sub(tmp,x,worldPoint))<precision*precision)&&result.push(b)}return result},World.prototype.setGlobalStiffness=function(stiffness){for(var constraints=this.constraints,i=0;i!==constraints.length;i++)for(var c=constraints[i],j=0;j!==c.equations.length;j++){var eq=c.equations[j];eq.stiffness=stiffness,eq.needsUpdate=!0}var contactMaterials=this.contactMaterials;for(i=0;i!==contactMaterials.length;i++){(c=contactMaterials[i]).stiffness=c.frictionStiffness=stiffness}(c=this.defaultContactMaterial).stiffness=c.frictionStiffness=stiffness},World.prototype.setGlobalRelaxation=function(relaxation){for(var i=0;i!==this.constraints.length;i++)for(var c=this.constraints[i],j=0;j!==c.equations.length;j++){var eq=c.equations[j];eq.relaxation=relaxation,eq.needsUpdate=!0}for(i=0;i!==this.contactMaterials.length;i++){(c=this.contactMaterials[i]).relaxation=c.frictionRelaxation=relaxation}(c=this.defaultContactMaterial).relaxation=c.frictionRelaxation=relaxation};var tmpAABB=new AABB_1,tmpArray$1=[];World.prototype.raycast=function(result,ray){return ray.getAABB(tmpAABB),this.broadphase.aabbQuery(this,tmpAABB,tmpArray$1),ray.intersectBodies(result,tmpArray$1),tmpArray$1.length=0,result.hasHit()};for(var p2_1=createCommonjsModule((function(module){var p2=module.exports={AABB:AABB_1,AngleLockEquation:AngleLockEquation_1,Body:Body_1,Broadphase:Broadphase_1,Capsule:Capsule_1,Circle:Circle_1,Constraint:Constraint_1,ContactEquation:ContactEquation_1,ContactEquationPool:ContactEquationPool_1,ContactMaterial:ContactMaterial_1,Convex:Convex_1,DistanceConstraint:DistanceConstraint_1,Equation:Equation_1,EventEmitter:EventEmitter_1,FrictionEquation:FrictionEquation_1,FrictionEquationPool:FrictionEquationPool_1,GearConstraint:GearConstraint_1,GSSolver:GSSolver_1,Heightfield:Heightfield_1,Line:Line_1$1,LockConstraint:LockConstraint_1,Material:Material_1,Narrowphase:Narrowphase_1,NaiveBroadphase:NaiveBroadphase_1,Particle:Particle_1,Plane:Plane_1,Pool:Pool_1,RevoluteConstraint:RevoluteConstraint_1,PrismaticConstraint:PrismaticConstraint_1,Ray:Ray_1,RaycastResult:RaycastResult_1,Box:Box_1,RotationalVelocityEquation:RotationalVelocityEquation_1,SAPBroadphase:SAPBroadphase_1,Shape:Shape_1,Solver:Solver_1,Spring:Spring_1,TopDownVehicle:TopDownVehicle_1,LinearSpring:LinearSpring_1,RotationalSpring:RotationalSpring_1,Utils:Utils_1,World:World_1,vec2:vec2_1,version:require$$43.version};Object.defineProperty(p2,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})})),arrayUnique=(p2_1.AABB,p2_1.AngleLockEquation,p2_1.Body,p2_1.Broadphase,p2_1.Capsule,p2_1.Circle,p2_1.Constraint,p2_1.ContactEquation,p2_1.ContactEquationPool,p2_1.ContactMaterial,p2_1.Convex,p2_1.DistanceConstraint,p2_1.Equation,p2_1.EventEmitter,p2_1.FrictionEquation,p2_1.FrictionEquationPool,p2_1.GearConstraint,p2_1.GSSolver,p2_1.Heightfield,p2_1.Line,p2_1.LockConstraint,p2_1.Material,p2_1.Narrowphase,p2_1.NaiveBroadphase,p2_1.Particle,p2_1.Plane,p2_1.Pool,p2_1.RevoluteConstraint,p2_1.PrismaticConstraint,p2_1.Ray,p2_1.RaycastResult,p2_1.Box,p2_1.RotationalVelocityEquation,p2_1.SAPBroadphase,p2_1.Shape,p2_1.Solver,p2_1.Spring,p2_1.TopDownVehicle,p2_1.LinearSpring,p2_1.RotationalSpring,p2_1.Utils,p2_1.World,p2_1.vec2,p2_1.version,createCommonjsModule((function(module){module.exports=function(arr){if(!Array.isArray(arr))throw new TypeError("array-unique expects an array.");for(var len=arr.length,i=-1;i++<len;)for(var j=i+1;j<arr.length;++j)arr[i]===arr[j]&&arr.splice(j--,1);return arr},module.exports.immutable=function(arr){if(!Array.isArray(arr))throw new TypeError("array-unique expects an array.");for(var arrLen=arr.length,newArr=new Array(arrLen),i=0;i<arrLen;i++)newArr[i]=arr[i];return module.exports(newArr)}}))),byteToHex=(arrayUnique.immutable,crypto.randomBytes,[]),i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function getMapsBoundingBox(maps,mapPadding){var objects,combinedBB,cbb=(objects=maps.map((function(m){return m.object})),combinedBB=new Box3,objects.forEach((function(object){var bb=new Box3;bb.setFromObject(object),combinedBB.union(bb)})),combinedBB);return mapPadding&&(cbb.max.add(new Vector3(0,0,mapPadding)),cbb.min.sub(new Vector3(0,0,mapPadding))),cbb}function scrubMaterial(material){material&&material.map&&(material.map.dispose(),material.map=void 0),material.dispose()}function getObjectId(object){return"string"==typeof object?object:object.id}function getObject(obj,array){return null==array?obj:"string"==typeof obj?array.find((function(o){return o.id==obj})):obj}function getBoundingBox(object){return(new Box3).setFromObject(object)}function unpackBoundingBox(boundingBox){var min=boundingBox.min,max=boundingBox.max;return[new Vector3(min.x,min.y,min.z),new Vector3(max.x,min.y,min.z),new Vector3(min.x,max.y,min.z),new Vector3(max.x,max.y,min.z),new Vector3(min.x,min.y,max.z),new Vector3(max.x,min.y,max.z),new Vector3(min.x,max.y,max.z),new Vector3(max.x,max.y,max.z)]}function throttle(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=!1===options.leading?0:Date.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=Date.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}}function toStyleString(styles){var result=[];for(var prop in styles)result.push(prop+": "+styles[prop]);return result.join("; ")}function getProjectionScaleFactor(FOV,canvasHeight,zoom){var halfFOV=FOV*(Math.PI/180)/2,PQ=canvasHeight/2;return zoom*Math.tan(halfFOV)/PQ}function getZoom(focusBox,focusBoxHeight,FOV){var TS=focusBox.max.y,RT=focusBoxHeight/2,F=FOV/2*Math.PI/180;return RT/Math.tan(F)+TS}function splitLine(startNode,endNode,segments){for(var points=[startNode],xDelta=(endNode.x-startNode.x)/segments,yDelta=(endNode.y-startNode.y)/segments,zDelta=(endNode.z-startNode.z)/segments,i=1;i<segments;i++){var newPoint=startNode.clone(),delta=new Vector3(i*xDelta,i*yDelta,i*zDelta);newPoint.add(delta),points.push(newPoint)}return points.push(endNode),points}Object3D.prototype.destroy=function(){for(var i=this.children.length-1;i>=0;i--)this.children[i].destroy();this.geometry&&(this.geometry.dispose(),this.geometry=void 0),this.parent&&this.parent.remove(this),this.texture&&(this.texture.dispose(),this.texture=void 0),Array.isArray(this.material)?this.material.forEach((function(material){scrubMaterial(material)})):void 0!==this.material&&scrubMaterial(this.material),this.material=void 0};var icons=new Map([["question-mark",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M25.86,2.59A10.12,10.12,0,0,0,22.4.65a14,14,0,0,0-8.85.14A10.33,10.33,0,0,0,10,3.1,9.78,9.78,0,0,0,7.72,6.68,10,10,0,0,0,7,11h6a6.3,6.3,0,0,1,.18-2.33,5.57,5.57,0,0,1,1-1.77,4.05,4.05,0,0,1,1.5-1.13,6.87,6.87,0,0,1,4.5-.08,4.4,4.4,0,0,1,1.6.88,3.37,3.37,0,0,1,.93,1.22A3.84,3.84,0,0,1,23,9.29a3.15,3.15,0,0,1-.38,1.5,10.54,10.54,0,0,1-1.26,1.72,18.9,18.9,0,0,1-1.78,1.8c-.71.66-1.4,1.34-2,2C16.31,17.55,14,19,14,21v6h6V23c0-.63,0-1,1-2s1.24-1.3,2-2,1.69-1.66,2.5-2.52a14,14,0,0,0,2.28-2.81,7.51,7.51,0,0,0,1.08-4.05,9.68,9.68,0,0,0-.78-3.91A8.34,8.34,0,0,0,25.86,2.59Z"/><circle cx="17" cy="33" r="3"/></svg>'],["arrow","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAAAAAB5Gfe6AAAQkHpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHjarZpZciQ7rkT/uYpeAicQ5HI4mr0dvOX3ATOl0li3q3SVJkUqFMEBcHc4IuX2///fcf/hK7cSXRatpZXi+cott9h5U/3j63EMPt+fL1/h+fPdeff6NnJMHNPjD2U/7+qcl183aH6eH+/PO52PN7E+B3qZ+Tlgspkjb57X1edAKT7Oh+fvrj3v6/nNdp7ftd057abHnz78npVgLGG8FF3cKSTPz2oXJFaQWuocCz9D0mhnEu8Tx54k6dexc98F77vY+f48n96HwvnyvKB8iNHzfJCvY3cj9HZF4dfM7/6QZ4j+7deb2J2z6jn7sbueC5Eq7rmpl63cd1w4GCrd2wov5Vt4r/fVeFW2OMnYIpuD13ShhUi0T8hhhR5O2Pc4w2SJOe5IuGOMM6Z7rhL+FudNSrZXOFFJz3KpkqtJ1hKn4+tawp233flmqMy8AlfGwGCBOz693Fcn/+b1OtA5Bt0QfH2NFeuKFnCWYZmzn1xFQsJ5xlRufO/LvcGNf5PYRAblhrmywe7HY4gh4Re20s1z4jrx2fkHNYKu5wCEiLmFxYREBnwJSUIJXmPUEIhjJT+dlceU4yADQSSu4A65SamQnBptbu7RcK+NEh+nkRYSIZBGSQ0EIlk5C/jRXMFQlyTZiUgRlSpNekklFymlaDGN6po0q2hR1apNe001V6mlaq211d5iS0iYtNLUtdpa651JO0N37u5c0fuII408ZJSho442+gQ+M0+ZZeqss82+4koL+q+y1K262uo7bKC085Zdtu662+4HrJ108pFTjp562umvWXtm9X3WwofM/T5r4Zk1y1i+1+mvrHFa9WWIYHIiljMyFnMg42oZANDRcuZryDla5ixnvkVIIZGsBbHkrGAZI4N5hygnvObuV+Z+mzcn+Y/yFr/LnLPU/RuZc5a6Z+Y+5+2LrK1+K0q6CTIWWkx9OggbF+zaY+1Wk/766H46wF8ONFY+O8hBMEc7oc4Vdh+8JsE+PUSrVjr70Zz1+H56PH3o9sRR1ql5Ha8bUMQxpe89Tki8Sb0tE23cw3DcfEo+ugnj2G3WEmononVfoag71pVjR+EmAE53eT5tqYfEHl/7ThMusaI+St0jktFa9gKnreiQqCNpZ2mJdSkbaiK6DrovYR4/JhJfRsx5d5EVZnEIPetHnU5KynJPTSuCPuC0lOuXH7n1DNq7DpUtHbhM5lDA0c2bnDCJoOObMnyj+aPjPwx0yiDUxKKsg35VnRnBEVhonKwK5hOk5NttUrhr2+tMOXkPJb1RZ+iAelYjL2MuO3pGRQ78GdxwOOaTAcJZcewq7ilB1RJCSozUdSEdwVJVb6asiBsHH1Bqgbiv3Cmkkis6ktVnZGRRwMNJjUA3Ao2127YWdhAIblxF51hzMcZsVZc0r0dJo5Liqfn41Q+q193SGhhkMkgaLJRNnEpqBtyVvbcVffIk+LE9QPFBTMTQe0aWkMXMnx3dy5sfHreDE60Ql50E+SqRcmfK16L2p0Ol8JFATu3qASXy7SvmiGW2cdMBxsty44CvtLogfGlv7WkCSV0WId2270EaD5Ym40cs+SAwZuNjPSTywAvEfLmzQhtLDntfCnhl/fNmUNnzyA2g76Zn0SP+c+I6bCC0FONUQ4L50e95dif+DH/m9htQjBEhPPpOjYjmm2ChbfEMIUaYtAIxmWJHlilLU8ZRs9pCsHbDpFaRgZljz2QandjDIBPZDGTuoZW1KdlYh52ALzisKJRNWSQmLAWx8iv9mGttT15bBc2oxd57bZtVF98CYtK3UH22Yd/A7WaKa+ZjNTOXEzNhMJ5kmQOvfzsbxbZALJ2xwGBjX2HFQybhi7kpbA7DVpS3RxMJwFyHwGk5gs6a4lrRHVqhYT0QTJC9UZcC9Yrelkn6yXch68NKNtG7CiU3vf/zMZAYXPWdrR9XZ/ctMV1sJQ2wJEGxzaHs7LmmHIwnUwbwnNAapBY9xhE19DNJW3ua0dDk/AjwITacR0PqZxkbyJ+E5jYbxI84x1TBE+y90hwDCYZIM0tqAKPZfCzFrbH8kYCm3eqQkZ2+2GovcL8Suokyg8yyCJes6dcouSLiNSLb0ETJU+/N/WFsBBSOXBbm9Cwp4CzlOag7ro7R2vC19nSsCPmAjIEMiobFwaoVXhjTU2XMpgEsDH/L3Sx54OCTMUSXI/IIA2V4QcLQpwVz12pInI0bY56pIQ2BSGRLL+yLfZ7JkiimbK+aepsbwRStpokx5gCqe1hjdMAwcINbkk5jmedrNRAG5pUXPe0sZIoXy1h7lSDxApzheg24JeDNtDS1oBDBUC4iWZFilBPhZx0Kqx2lihpbG9q4sYidksCN4yRYhNM4nxfBbTi4E3AT6B3igbvs9Gv8ZkHsIfdlep+2HelEDbkJdNjqZQ90B7k6OIoFfkkPNoY+z0gzACa1f2qcBYxVJpT2QQgS19dKQlbC24S92xiEAFRKB5Uy1qrBgOtwIge55G0kRPfIytGx0tMOrGfrijB2FHOk/TKcMjDTMPeBo4FnXD5cQ8vtdgoAN0yuzZQHQI09wm/5vAB6RHyI9rYKiZ6YWC6rbaiLmDtoaToC1bViXQFNtgWsOfEEKCleC3GWPSfgQWRQWMgw/9FDgvOZrFAT3SmsA3DLbqlsSppQG5QeOjPXavUUkxF/qgLM05vW5o7UakuBqo2ZW8Nj0LB7imVJC9QSA+wd7RPztIUZ80xQZq0ROrc8CSVncWzkTA/RwmunldCPAQKjqVC7bhRuTIv0plbk7gOX4m5OAi2YesYZ0KBQRToG8iv9x8dgGtgECYRBeEU87OxoSc8epu+s7Mq/MN0VbBT19dii7ekO66UZwdAMtoAVQd13J5nwZe98OgGslmVqAGBkeLZNVNVlWpV18qihntXKnBZvrDIVgFpx4q5poLqREOVplMPSpTF2KvjBAzDpprkruXIaaUmUD4Xo2yrGWcYlixKIwRFjl0jPQhKznUXZAoSjlg9c/NwAI4p3Q/w5bCNfhUZS7bGfqesHqKAlyZZxZgNrhGevZXccaqBys4NEqB3Vqfptji9uUrhCL6yXFqxtm0hhLyYU3Tjd8I/HZaWD1oyVjnG5hhpCN5yHSf8BQUZlVNd00OP4M0TK+JSM7iqWi01SinFkCQXWxiZJLqqAHiEt3G3I2WYd46KU9pIJIOkoRQYCcEAAPguHo0Y4k8Hl6SW50MoW0uZU8jJOUghKo38Nl5ZSwsJNAUC2/lFZWkfMjrU8dFrTjHpJnUrLCILQIxINiYdQlDXaE/razQ4jjQluN5jW1Eh/S7yYvI5gigSjdLYU9TiFXAcHjISiLhQd9obb3OQmwY+YqVwiBMCkOGLXaK/ljBShh56c1g0uyIb2lBRKO7ZTAFncw5c5UGjGSy3CsI1Jt2mtruZkfhBZmbR+842Yu1eDiWEl0V6LZcGem6Ct+LW4Wy3oAjyNObazKBHomhJ3HMKEKHgiGksH+Ig1nTidfNMyA+oYHqVFaRGLiQreVLc9GvQgftKjW9cfUSKNYL80rqU7Um2rwqQJR1ai31Wq7vzKJEsFHDj0bAEMUKXgvfD5bWbaLPBTKz1Nk/Fg+GUZvUzFw80CLaKtPAACVAWrismh863FU4IJ0716SXBUNVb/SDMVvZgDt34CXoOq1JKvg0n08gPHTwXBNgD5W8pZZ8E9EVWcv1DZMB2NFysIwkqBSaH5QRmsAHdkHB+UANvLJvFpQKAahSmYTLEd2AFO+5rsqRRU6sVv5IP0wsSPLcWsbC1Y95mte71CUm6RJJWwkg6Q4k+xWMM0ByElJPQ6j2ED5hY42ALpZRytx9RlgQlJLijzhKi5eX5JBSIRGfo9o2xhd/0aWku8OS+4D9ZnovHDQMPaYo4qm2mlZbUnd7pR6oQj29Z2BqJ9n3LRT+MTLu3IR+ZP2TCPh3EDw8H1NHpoT7FibNYU8WHd9ESHcY12aDOQCUBddi4Ucp+4yuzz8ybcCCu1h8zvzXhDN4HYLq1R+U0xzUqg5QSA3iSBgdDouy55Ifx0DaeEhgezxBRGmoEJ6AJitVuzwtKPlUskHgU2F0LS7AFIwW5jPu0RUL7sp+fkNk0ee8P6uXYgl40WM+cdCOW21r13e0ivt0ff/mYcUfrQZWs2BiN6G+MDTGz1BKORmUTNQp9YGSHFxAeTkQrKd6FoVUogyytW25OLy3OpaO5oZCQp46aPzb5LnJiFEIwAKkmbYVYIjzVv3vj7rA6HignEeQAXTAHKDhoD7Uujh0QjtsB6fTP1NzO7T1Nzq4F1GnfHdXCG1Yxjwdtjf+PGRGTzEtEAUCz7KLfTdItLwCXuSOAzVjaZB6LvbUZhYGWmifSZlcMDnGHPd6gPeiK9erhpiw7ZP9ahTrMhFDa1J53m9ri2DloziqGETTcVSppCbTDDjExg6RrZ6cPEzB8XArEjQSB29odrUoLyoS/65RfM9fprGGjlHpbhGgbYD8MtmW1eFcAWX5dbcMHcl8sUI2k+H7GPW9VrArw3G+BefcCrCaAT/N53YLvP26Uy0kMFnDEZz0DJkmQqEOlL7SlKweYhH8gxpYeAYi0f9magqPbMYZuUI6007lSZQoyoGfYQHsNRzHXR3MMINTSMZpq1KD2A5MDJgtMLdRU6R4CEOJcKGiIJ7K6P/vAM6xpECHI8rRHsaEj6smkngAUjXTzrRoSI48ZpHOqgOY5OejKVdpnmiYUChQnVdIPa6ekGqRSRgEO119oDHOiIUQ5ciYVgaF1oG8Udo8WYtD+DEi8D/w8rAJE2k2PoyV0oMtpauxreaFjpujAvxFlwBhjuNqM9P0IfI5iD8Nh8y1kG4igjJkDNkOijnlLhItAd9lhRd670yNRTu95cR/Xuu0c5WO4DEFk5YQAPtLvU4TYPGRh4APPEDNiuuwR6SC21JoFbQBBMr+zJmT32QplNI6p16PbculN/pCX1wAyTWGTeJ774aln0gvQikw7TmkfsNbdQNs0adutYUDqNtGc0RqngUYdhUYuHSL1/eLrgvqDTC5neu++vufRkEgP9D2T64Kg/c4n+s7k3dDr3me8nOr0c72MRNmgF7D4WySPP0YAI/bI4eixwc7K13QiRiL85A8fnSsUj+mvTrsZtVUEQZ6sTpVafW8nYJZyaZS0U+0xIb6et9PhhtoObozQbjKAoDf6eiFgx1UUvpUYj1GweH0MNMrofhynfWn7+KYu7n5r83hN9aqm+6qjcH7dUlgvZVLV3xqq4fbP16qv+eofuTz43eomAqfS7GBAB9zEE31WJ37eVIPtdGN5A8nMYPvvLt8t2/V/6gM19G4g/hIL7UXf9JgbuLRZ+AoW//AzyMxTcWyz8BAruLRZ+AgX3r3y2+mT/PwfiN1DoVI+QT3CZDmvb8022JeYb6HiQPQpPPvboFB+i1MZdcqWZqthHmix6vttw0UAI1z8oEnGwVe++c7JamxslC+8xKJE41XJmug1npz+6CUAKyURd9gSxo+kWxvtZth848GBlws/0SKjYhmbZ9IiV+mcGBSdWHk8sqSr2zz5J7QME/0yD+z4Pe+JuGn1MV/vUyZwOHojWPlmPXgf9CuoeN9UAT+FGwaLg44v3dWe6QpvuL3Ln/p3k/2AgqNDcfwHgqUmIIqn+hwAAAAJiS0dEAACqjSMyAAAACXBIWXMAAAsSAAALEgHS3X78AAAAB3RJTUUH4wYRESAMujenGAAAB9FJREFUeNrtnWlsFVUUx899fS1gUoKioEY+WBRUEohGkUhAKxgEjSgGoRGB4AJCNKAIJBJZJSiyGYMKKkIoLlEUKhUraxFkKUE2kU1aCrRgW2jpg9f29R2/sBTo67v3zL2zvfP73MzM+XU6mf+5504BGIZhGIZhGIZhGIZhGMZGGq3JvSmR62++BXHH7Ylbf9ouRMT99yVq/e0PICIiHumUmPV3PooXOf5EItafXoCXOdUn8ep/pgjrUDY40ervX4JXUTEiocoXL5/FawiNEwlU/6hzeB3hqQljQIwJYT3UzEkQA2JiGOslsiAhDIgZ1RiD6NIEMBD8NIKxyQr6vv7FtdgQa31uILg0ig2zsZmv4//yePUj7rjNv/U3yUEJ/r7Xr/XfvBmlOPKwT+vfhpIUdvdj/Wm7UZpTz/mv/g4HUYGyQb5r/+SjEhXD/VV/j5OoSGisj16LRe9iVCY8xTcGxIulSKBmtk8MiKHlSMIn8ViMqkQivojHgfcuIJ0VAc/XPzmMVljrcQOBmdVojY1NvVx/8mcRtEqeh+NxypJatM6+ezxb/7Io6uBwR4/e/1moicJunvz956A2ip/1Xv3Nt6JGSgd6rf47/0KtlHssHrfZi5rxVDwWDx5C7XgoHotHC9AANbO8YqBXERohMt8bv/8X/kNDRDM9cA+IgWVojhWuNxAYXo4mWePyeBwYHUKz5Lo6HidNvICmybvVxfXPqEbz7Gvr2vrn1KAdHH7IpX//8yNoD8dcGY+TM6NoF26MxzLTL26Mx0majtM4q5ed7yhNulVsd5WAxqset/mGS6/d5CIBLXI62/7I6ZKyzjUC0rIfsP+hE3zkxt9c8vy7tPnJbiKfuyP+Xdn8ZDeuiMei+zF0juWOGyBNv+iMxw4bEBkl6CzOxmPx6ll0mryWDtb/ViU6z17H4rEYG0I3cMiheByYFEZ34Ew8Dn5UjW7BiXisY/rFDfGYmgWCCwcngXto0q08z1YBSUsy3NWgb5Qe2WSjgJRlfdy2RJPcNXm9bQIarexpsP5VdxHjcbMcm2Q3/5P64i71U8k/ELuLNsVjcct2cnST+rGg+Jo4XmhLPBZ376GOfoOkAIB5NWTHxuu/nzj9ElkA8gLgA+pLlvF43IU4/VI9G1QEAHnIPjfVaP1PnqRdVngKqAkActDMa2Hw/u9zijjjNg5UBcBr1FbD3jbG6h9QSruk8ovfyFESABnUWSNT8VgMI06/lF7aBqomAJ4n3m+G4nHgbeJfZfHljcCKAqDHcWo87m2g/gnE53LhlS+lqQqATv9S4/FL2u//qcT2T34XoAuAdvuJBspf11z/LOKbyYG6q4bqAqDVTqKByjFa21/U6ZfdaWBNADTdTDQQnqSv/pRMYjrZevVLCUUAiF+JBqpnaqv/J2I+zb3mxZwkAMTPDq8ep1A3P/1y3ZOEJABgiaPxuOnvxLN/B7oEwELq/sPl1utvSdz8VPsl6BMAn1AbBKut1t96F+3ENXOFTgFiehXRwAZL8Vi0JW5+qppW7+HIAgDGnyca2G4hHouOh2knvTARdAuAkedsj8cinTj9Ujka9AuAV87YHI/F08TNT2eHgQkB0I/aIDhGmuIU/YnnKxkAZgTAU8SGHC0eDyJufiqKfTKrAqBrPtFAiXo8HlFBO1VBA7ebZQHQifhUVo7H4p2QgQeOdQHQbp8t8Tg4idj+2dPgwJIGAdBqhw3xmDz9EuelQ4cASP3DeDwOziW+ecdbldEiACDbcDxOWkBs/8QNHpoEAPXjLNFMmfpv+IZ4+PjRU5cAWGwwHqcQNz/J2NUmAMgjavHjMfEPTGpvvz4BQH1MrzMkoHoW2CsAppEaBFskemQUA+HJYLcAeJfQINgpNVuvbiA0FuwXAG8qNwh2S07WqxqQ/saPXgEwRDGu7W8te2Q1A6XSH0HWLAD6nVa5zoPS9asZKJb/DLZuAdDzhPx1Hu2gkobkDRQq/J8w7QJAfstevuI3+WQN1F39dkAAtP9H7jpPdFVtiMgZOKC0Z9aAAEiT+mrbScLQjIyBXWngtABokRf/kKefonRF4xvYqrjmYEQApG6Md8SyvrS+eDwDG5QbzUYExL3QMxnUlZGGD5wFbhEADQ7YVwyhr401YCD6LbhHACyK3SA4N9TK6mhMA5EvwE0CYF6sBkFopLXl8exYq9/gLgHwYf3x+PxoqwMC9RoIvw9uE1D/gH3VeOsjItnSq9/OCqhvwL5qAoABA5XU28qsAHjj2tW8mukABgzEXP12WgAMvrpBEPkYwICB2KvfjguAvnUH7GvnARgwUGRhEt24gLoD9tGvAAwYKLDyySzzAqDzpQH76CIAAwYOWtqNYoMAaH9xwP57AAMG9ljbj2SHALhjJyLijwAGDGyzuCPNFgGQuhlxpfw1yR94dfAxi5cmojI/lRyx+rtaX9XDhADr2CVABc//JycWwAJYAAtgASyABbAAFsACWAALYAEsgAWwABbAAlgAC2ABLIAFsAAWwAJYAAtgASyABbAAFsACWAALYAEsgAWwABbAAlgAC2ABLIAFsAAWwAJYAAtgASyABbAAFsACWAALYAEsgAWwABbAAlgAC2ABLIAFsAAWwAJYAAtgASyABbAAFsACWIDToH8FyJUWtVWAALedDoFhGIZhGIZhGIZhGIYxyf+YwEMsIhMo/AAAAABJRU5ErkJggg=="],["door",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><polygon points="36 14.99 28 7.99 28 12.99 17 12.99 17 16.99 28 16.99 28 21.99 36 14.99"/><path d="M24,29H15V7L6,2H24v9h2V0H0V29l14.94,7L15,31H26V19H24Z"/></svg>'],["elevator",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M12.85,18.24H9.25a1.27,1.27,0,0,0-1.2,1.2v4.8c0,.43.65,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42c.43-.11,1.08-.75,1.08-1.18v-4.8A1.26,1.26,0,0,0,12.85,18.24Z"/><circle cx="11.05" cy="15.85" r="1.5"/><path d="M26.82,18.24h-3.6a1.26,1.26,0,0,0-1.2,1.2v4.8c0,.43.65,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42c.43-.11,1.08-.75,1.08-1.18v-4.8A1.27,1.27,0,0,0,26.82,18.24Z"/><circle cx="25.02" cy="15.85" r="1.5"/><path d="M19.79,18.24h-3.6a1.27,1.27,0,0,0-1.2,1.2v4.8c0,.43.66,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42A1.68,1.68,0,0,0,21,24.24v-4.8A1.26,1.26,0,0,0,19.79,18.24Z"/><path d="M18,17.35a1.5,1.5,0,1,0-1.5-1.5A1.51,1.51,0,0,0,18,17.35Z"/><path d="M28.79,10H7.27c-2.82,0-5.11,2-5.11,4.51V31.6c0,2.49,2.29,4.51,5.11,4.51H28.79c2.82,0,5.12-2,5.12-4.51V14.51C33.91,12,31.61,10,28.79,10Zm2.85,21.6a2.7,2.7,0,0,1-2.85,2.51H7.27A2.7,2.7,0,0,1,4.42,31.6V14.51A2.7,2.7,0,0,1,7.27,12H28.79a2.7,2.7,0,0,1,2.85,2.51Z"/><polygon points="27 4 26 3 24 5 24 0 22 0 22 5 20 3 19 4 23 8 27 4"/><polygon points="17 4 16 5 14 3 14 8 12 8 12 3 10 5 9 4 13 0 17 4"/></svg>'],["elevator-up",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M12.85,18.24H9.25a1.27,1.27,0,0,0-1.2,1.2v4.8c0,.43.65,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42c.43-.11,1.08-.75,1.08-1.18v-4.8A1.26,1.26,0,0,0,12.85,18.24Z"/><circle cx="11.05" cy="15.85" r="1.5"/><path d="M26.82,18.24h-3.6a1.26,1.26,0,0,0-1.2,1.2v4.8c0,.43.65,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42c.43-.11,1.08-.75,1.08-1.18v-4.8A1.27,1.27,0,0,0,26.82,18.24Z"/><circle cx="25.02" cy="15.85" r="1.5"/><path d="M19.79,18.24h-3.6a1.27,1.27,0,0,0-1.2,1.2v4.8c0,.43.66,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42A1.68,1.68,0,0,0,21,24.24v-4.8A1.26,1.26,0,0,0,19.79,18.24Z"/><path d="M18,17.35a1.5,1.5,0,1,0-1.5-1.5A1.51,1.51,0,0,0,18,17.35Z"/><path d="M28.79,10H7.27c-2.82,0-5.11,2-5.11,4.51V31.6c0,2.49,2.29,4.51,5.11,4.51H28.79c2.82,0,5.12-2,5.12-4.51V14.51C33.91,12,31.61,10,28.79,10Zm2.85,21.6a2.7,2.7,0,0,1-2.85,2.51H7.27A2.7,2.7,0,0,1,4.42,31.6V14.51A2.7,2.7,0,0,1,7.27,12H28.79a2.7,2.7,0,0,1,2.85,2.51Z"/><polygon points="22 4 21 5 19 3 19 8 17 8 17 3 15 5 14 4 18 0 22 4"/></svg>'],["elevator-down",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M12.85,18.24H9.25a1.27,1.27,0,0,0-1.2,1.2v4.8c0,.43.65,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42c.43-.11,1.08-.75,1.08-1.18v-4.8A1.26,1.26,0,0,0,12.85,18.24Z"/><circle cx="11.05" cy="15.85" r="1.5"/><path d="M26.82,18.24h-3.6a1.26,1.26,0,0,0-1.2,1.2v4.8c0,.43.65,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42c.43-.11,1.08-.75,1.08-1.18v-4.8A1.27,1.27,0,0,0,26.82,18.24Z"/><circle cx="25.02" cy="15.85" r="1.5"/><path d="M19.79,18.24h-3.6a1.27,1.27,0,0,0-1.2,1.2v4.8c0,.43.66,1.07,1.08,1.18v5.52c0,1.09,1.2,1.09,1.2,0v-5.5h1.44v5.5c0,1.09,1.2,1.09,1.2,0V25.42A1.68,1.68,0,0,0,21,24.24v-4.8A1.26,1.26,0,0,0,19.79,18.24Z"/><path d="M18,17.35a1.5,1.5,0,1,0-1.5-1.5A1.51,1.51,0,0,0,18,17.35Z"/><path d="M28.79,10H7.27c-2.82,0-5.11,2-5.11,4.51V31.6c0,2.49,2.29,4.51,5.11,4.51H28.79c2.82,0,5.12-2,5.12-4.51V14.51C33.91,12,31.61,10,28.79,10Zm2.85,21.6a2.7,2.7,0,0,1-2.85,2.51H7.27A2.7,2.7,0,0,1,4.42,31.6V14.51A2.7,2.7,0,0,1,7.27,12H28.79a2.7,2.7,0,0,1,2.85,2.51Z"/><polygon points="22 4 21 3 19 5 19 0 17 0 17 5 15 3 14 4 18 8 22 4"/></svg>'],["elevator-alt",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><polygon points="4 16 18 0 31.99 16 4 16"/><polygon points="31.99 20 18 36 4 20 31.99 20"/></svg>'],["escalator-down",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M18,8a3,3,0,1,0-3-3A3,3,0,0,0,18,8Z"/><path d="M33,10H27a3.65,3.65,0,0,0-3,1l-2.76,2.75V12.39a2.48,2.48,0,0,0-2.46-2.47H17.22a2.48,2.48,0,0,0-2.47,2.47v7.87L9,26a3.26,3.26,0,0,1-2,1H3c-2.28,0-3,1.79-3,3.93A2.76,2.76,0,0,0,3,34H9a3.77,3.77,0,0,0,3-1L27,18a3.29,3.29,0,0,1,2.49-1h3.26A3.43,3.43,0,0,0,36,13.44C36,12.08,35,10,33,10Zm0,5H29c-1.47,0-1.92-.08-3,1L11,31a3.15,3.15,0,0,1-2,1H3c-.82,0-1-.29-1-1.16S2.12,28.9,3,29H7a3.87,3.87,0,0,0,3-1L25,13a2.72,2.72,0,0,1,2-1h6c.68,0,1,1.05,1,1.44S34,15,33,15Z"/><polygon points="30.18 26.18 26 31 26 28 24 28 24 34 31 34 31 32 28 32 31.69 27.59 30.18 26.18"/></svg>'],["escalator-up",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M18,8a3,3,0,1,0-3-3A3,3,0,0,0,18,8Z"/><path d="M33,10H27a3.65,3.65,0,0,0-3,1l-2.76,2.75V12.39a2.48,2.48,0,0,0-2.46-2.47H17.22a2.48,2.48,0,0,0-2.47,2.47v7.87L9,26a3.26,3.26,0,0,1-2,1H3c-2.28,0-3,1.79-3,3.93A2.76,2.76,0,0,0,3,34H9a3.77,3.77,0,0,0,3-1L27,18a3.29,3.29,0,0,1,2.49-1h3.26A3.43,3.43,0,0,0,36,13.44C36,12.08,35,10,33,10Zm0,5H29c-1.47,0-1.92-.08-3,1L11,31a3.15,3.15,0,0,1-2,1H3c-.82,0-1-.29-1-1.16S2.12,28.9,3,29H7a3.87,3.87,0,0,0,3-1L25,13a2.72,2.72,0,0,1,2-1h6c.68,0,1,1.05,1,1.44S34,15,33,15Z"/><polygon points="25.67 34 29.84 29.18 29.84 32.18 31.84 32.18 31.84 26.18 24.84 26.18 24.84 28.18 27.84 28.18 24.16 32.58 25.67 34"/></svg>'],["ramp",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M36,34H0L36,2ZM12,30H32V12Z"/></svg>'],["ramp-down",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M36,34H0L36,2ZM12,30H32V12Z"/><polygon points="18.18 4.18 14 9 14 6 12 6 12 12 19 12 19 10 16 10 19.69 5.59 18.18 4.18"/></svg>'],["ramp-up",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M36,34H0L36,2ZM12,30H32V12Z"/><polygon points="13.82 13.82 18 9 18 12 20 12 20 6 13 6 13 8 16 8 12.31 12.41 13.82 13.82"/></svg>'],["sligntTurnLeft",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M10,0,26,2s-5.59,5.68-5.56,5.71C23.32,10.88,23.94,15.27,24,18V36H20V18c-.05-2.09-.54-5.32-2.47-7.53L12,16Z"/></svg>'],["sightTurnRight",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M26,0,10,2s5.59,5.68,5.57,5.71C12.68,10.88,12.06,15.27,12,18V36h4V18c.06-2.09.54-5.32,2.47-7.53L24,16Z"/></svg>'],["stairs",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><polygon points="35.99 2 30 2 25.99 2 25.99 6.59 25.99 8.84 24 8.84 19.99 8.84 19.99 13.43 19.99 15.67 13.99 15.67 13.99 15.69 13.99 20.27 13.99 22.52 12 22.52 7.99 22.52 7.99 27.12 7.99 29.36 0 29.36 0 33.95 7.99 33.95 11.99 33.95 12 33.95 12 27.12 13.99 27.12 18 27.12 18 22.52 18 20.27 19.99 20.27 24 20.27 24 15.67 24 13.43 25.99 13.43 30 13.43 30 8.84 30 6.59 35.99 6.59 35.99 2"/></svg>'],["stairs-down",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><polygon points="30 2.03 25.99 2.03 25.99 6.63 25.99 8.87 24 8.87 19.99 8.87 19.99 13.47 19.99 15.71 13.99 15.71 13.99 15.73 13.99 20.31 13.99 22.57 12 22.57 7.99 22.57 7.99 27.16 7.99 29.4 0 29.4 0 34 7.99 34 11.99 34 12 34 12 27.16 13.99 27.16 18 27.16 18 22.57 18 20.31 19.99 20.31 24 20.31 24 15.71 24 13.47 25.99 13.47 30 13.47 30 8.87 30 6.63 35.99 6.63 35.99 2.03 30 2.03"/><polygon points="30.17 26.18 26 31 26 28 24 28 24 34 31 34 31 32 28 32 31.68 27.59 30.17 26.18"/></svg>'],["stairs-up",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><polygon points="30 2.03 25.99 2.03 25.99 6.63 25.99 8.87 24 8.87 19.99 8.87 19.99 13.47 19.99 15.71 13.99 15.71 13.99 15.73 13.99 20.31 13.99 22.57 12 22.57 7.99 22.57 7.99 27.16 7.99 29.4 0 29.4 0 34 7.99 34 11.99 34 12 34 12 27.16 13.99 27.16 18 27.16 18 22.57 18 20.31 19.99 20.31 24 20.31 24 15.71 24 13.47 25.99 13.47 30 13.47 30 8.87 30 6.63 35.99 6.63 35.99 2.03 30 2.03"/><polygon points="24.83 33.82 29 29 29 32 31 32 31 26 24 26 24 28 27 28 23.32 32.41 24.83 33.82"/></svg>'],["turnLeft",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M5,10,17,0V8a11,11,0,0,1,8.44,3.5c2.88,3.2,3.5,7.8,3.56,10.5V36H25V22c-.05-2.11-.54-5.61-2.53-7.82A7.1,7.1,0,0,0,17,12v8Z"/></svg>'],["turnRight",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M29,10,17,0V8a11,11,0,0,0-8.44,3.5C5.68,14.7,5.06,19.3,5,22V36H9V22c.06-2.11.54-5.61,2.53-7.82A7.1,7.1,0,0,1,17,12v8Z"/></svg>'],["uTurn",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M20,0c-5.38,0-9.79,5.34-10,12H2L12,24,22,12H14c.19-4.39,2.86-8,6-8s6,4.58,6,10V36h4V14C30,6.13,25.6,0,20,0Z"/></svg>'],["blue-arrow",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M21,3c-.44-.92-1-3-3-3s-2.63,2.16-3,3C15,3,2,29,2,33a2.65,2.65,0,0,0,3,3c2,0,6.1-2.2,9-4,2-1,3-2,4-2s2,1,4,2c0,0,7,4,9,4a2.65,2.65,0,0,0,3-3C34,29,21,3,21,3Z"/></svg>'],["start",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M18,4A14,14,0,1,1,4,18,14,14,0,0,1,18,4m0-4A18,18,0,1,0,36,18,18,18,0,0,0,18,0Z"/><circle cx="18" cy="18" r="6"/></svg>'],["destination-marker-back",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M18,0A13.83,13.83,0,0,0,4,14c0,4,1,9,7,12,2,1,6.15,8.67,7,10,3.38-5.44,5-9,7-10,6-3,7-8,7-12A13.83,13.83,0,0,0,18,0Zm0,19a5,5,0,1,1,5-5A5,5,0,0,1,18,19Z"/></svg>'],["destination-marker-front",'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><title>mappedin-icon</title><path d="M18,0A13.83,13.83,0,0,0,4,14c0,4,1,9,7,12,2,1,6.15,8.67,7,10,3.38-5.44,5-9,7-10,6-3,7-8,7-12A13.83,13.83,0,0,0,18,0Z"/></svg>'],["smart-label-pin-back",'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="25px" height="30px" viewBox="0 0 25 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 57.1 (83088) - https://sketch.com --\x3e\n    <title>Marker Pin</title>\n    <desc>Created with Sketch.</desc>\n    <defs>\n        <path d="M5.5,15 C6.34615385,14.1176471 7.33333333,12.9411765 8.46153846,11.4705882 C10.1538462,9.26470588 11,7.18962511 11,5.73529412 C11,2.56777864 8.53756612,0 5.5,0 C2.46243388,0 0,2.56777864 0,5.73529412 C0,7.1924534 0.846153846,9.26470588 2.53846154,11.4705882 C3.66666667,12.9411765 4.65384615,14.1176471 5.5,15 Z" id="path-1"></path>\n        <filter x="-104.5%" y="-63.3%" width="309.1%" height="259.8%" filterUnits="objectBoundingBox" id="filter-2">\n            <feMorphology radius="2" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology>\n            <feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset>\n            <feGaussianBlur stdDeviation="2.5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n            <feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"></feComposite>\n            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.2 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>\n        </filter>\n    </defs>\n    <g id="CE-1261" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Final-MVP-Markers" transform="translate(-204.000000, -523.000000)">\n            <g id="Marker-Pin" transform="translate(211.000000, 528.000000)">\n                <g id="Oval-Copy-25">\n                    <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>\n                    <path stroke="#FFFFFF" stroke-width="1.5" d="M4.95868222,15.5191099 C4.09118889,14.6145045 3.08708286,13.4178617 1.94340415,11.9271041 C0.219570966,9.68012899 -0.75,7.4435468 -0.75,5.73529412 C-0.75,2.16043095 2.04102866,-0.75 5.5,-0.75 C8.95897134,-0.75 11.75,2.16043095 11.75,5.73529412 C11.75,7.44173178 10.7794284,9.68143336 9.05659585,11.9271041 C7.91291714,13.4178617 6.90881111,14.6145045 6.04131778,15.5191099 L5.5,16.0835856 L4.95868222,15.5191099 Z" fill="#FFFFFF" fill-rule="evenodd"></path>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>\n'],["smart-label-pin-front",'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="23px" height="27px" viewBox="0 0 23 27" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    \x3c!-- Generator: Sketch 57.1 (83088) - https://sketch.com --\x3e\n    <title>Oval Copy 25</title>\n    <desc>Created with Sketch.</desc>\n    <defs>\n        <path d="M5.5,15 C6.34615385,14.1176471 7.33333333,12.9411765 8.46153846,11.4705882 C10.1538462,9.26470588 11,7.18962511 11,5.73529412 C11,2.56777864 8.53756612,0 5.5,0 C2.46243388,0 0,2.56777864 0,5.73529412 C0,7.1924534 0.846153846,9.26470588 2.53846154,11.4705882 C3.66666667,12.9411765 4.65384615,14.1176471 5.5,15 Z" id="path-1"></path>\n        <filter x="-90.9%" y="-53.3%" width="281.8%" height="236.1%" filterUnits="objectBoundingBox" id="filter-2">\n            <feMorphology radius="0.5" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology>\n            <feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset>\n            <feGaussianBlur stdDeviation="2.5" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n            <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.2 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>\n        </filter>\n    </defs>\n    <g id="CE-1261" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Final-MVP-Markers" transform="translate(-205.000000, -524.000000)">\n            <g id="Marker-Pin" transform="translate(211.000000, 528.000000)">\n                <g id="Oval-Copy-25">\n                    <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>\n                    <use fill="#000000" fill-rule="evenodd" xlink:href="#path-1"></use>\n                </g>\n            </g>\n        </g>\n    </g>\n</svg>\n']]),TouchAnchor=function(touch,camera,cameraPlane){this.touch=touch,this.camera=camera,this.cameraPlane=cameraPlane,this.viewCoordinate={x:touch.x,y:touch.y},this.camera.updateMatrixWorld(),this.camera.updateMatrix(),this.snapHolderMatrix=this.camera.matrixWorld.clone(),this.snapCamera=this.camera.clone(),this.snapshotCameraState=function(){this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraPosition=this.camera.position;var coordinateVector=new Vector3(this.viewCoordinate.x,this.viewCoordinate.y,1);this.raycaster=this.raycaster||new Raycaster,this.raycaster.setFromCamera(coordinateVector,this.snapCamera);var point=this.raycaster.intersectObject(this.cameraPlane,!1);this.worldCoordinate=point&&point[0]&&point[0].point,this.snapshotted=!0},this.updateAnchorState=function(camera,coord){this.camera=camera,this.snapCamera=camera.clone(),this.snapHolderMatrix=camera.matrixWorld.clone(),this.updateViewCoordinate(coord),this.snapshotCameraState()},this.updateViewCoordinate=function(coord){this.viewCoordinate={x:coord.x,y:coord.y}},this.reUnproject=function(){var coordinateVector=new Vector3(this.viewCoordinate.x,this.viewCoordinate.y,1);return this.raycaster.setFromCamera(coordinateVector,this.snapCamera),this.raycaster.intersectObject(this.cameraPlane,!1)[0].point},this.snapshotCameraState()};function angle(first,second){return Math.atan2(second.y-first.y,second.x-first.x)}function distance(first,second){return Math.sqrt(Math.pow(second.y-first.y,2)+Math.pow(second.x-first.x,2))}function average(first,second){return{x:(first.x+second.x)/2,y:(first.y+second.y)/2}}var InputSet=function(input1,input2){this.input1=input1,this.input2=input2,this.lastAngle=angle(input1,input2),this.lastDistance=distance(input1,input2),this.first=input1,this.second=input2,this.update=function(input1,input2){var newDistance=distance(input1,input2);this.input1=input1,this.input2=input2;var newAngle=angle(input1,input2);this.lastAngle=newAngle,this.lastDistance=newDistance,this.first=average(this.first,input1),this.second=average(this.second,input2)}};function rgb2hsv(r,g,b){null==g&&(g=r.g,b=r.b,r=r.r);var maxIndex=0,max=r;g>r&&(maxIndex=1,max=g),b>g&&b>r&&(maxIndex=2,max=b);var min=r;g<r&&(min=g),b<g&&b<r&&(min=b);var h=0,s=0;return max!==min&&(h=0===maxIndex?60/360*(g-b)/(max-min):1===maxIndex?60/360*(2+(b-r)/(max-min)):60/360*(4+(r-g)/(max-min)),s=0===max?0:(max-min)/max),[h,s,max]}function hsv2rgb(h,s,v){var hh=360*h%360/60,sextant=0|hh,ff=hh-sextant,p=v*(1-s),q=v*(1-s*ff),t=v*(1-s*(1-ff)),r=0,g=0,b=0;switch(sextant){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}return new Color(r,g,b)}var DebugUIScalarSlider=function(){function DebugUIScalarSlider(_ref){var _this=this,minimum=_ref.minimum,maximum=_ref.maximum,step=_ref.step,current=_ref.current,onValueChanged=_ref.onValueChanged;_classCallCheck(this,DebugUIScalarSlider),this._minimum=minimum,this._maximum=maximum,this._step=step,this._onValueChanged=onValueChanged,this._element=document.createElement("input"),this._element.type="range",this._element.min=this._minimum,this._element.max=this._maximum,null!=this._step&&(this._element.step=this._step),this._element.value=null!=current?current:this._minimum,null!=onValueChanged&&(this._element.addEventListener("input",(function(e){onValueChanged(_this._element.value)})),onValueChanged(this._element.value)),Object.assign(this._element.style,{height:"16px"})}return _createClass(DebugUIScalarSlider,[{key:"destroy",value:function(){this._element=null,Object.setPrototypeOf(this,null)}},{key:"addValueChangedListener",value:function(listener){var _this2=this;this._element.addEventListener("input",(function(e){return listener(_this2._element.value)}))}},{key:"setValue",value:function(value){this._element.value=value}},{key:"element",get:function(){return this._element}},{key:"value",get:function(){return this._element.value}},{key:"displayedValue",get:function(){return""+this._element.value}},{key:"height",get:function(){return 16}}]),DebugUIScalarSlider}(),DebugUICheckbox=function(){function DebugUICheckbox(_ref2){var _this3=this,current=_ref2.current,onValueChanged=_ref2.onValueChanged;_classCallCheck(this,DebugUICheckbox),this._onValueChanged=onValueChanged,this._element=document.createElement("div"),this._titleElement=document.createElement("input"),this._titleElement.type="checkbox",this._titleElement.checked=current||!1,Object.assign(this._titleElement.style,{width:"16px",height:"16px",margin:"0px"}),null!=onValueChanged&&(this._titleElement.addEventListener("click",(function(e){onValueChanged(_this3._titleElement.checked)})),onValueChanged(this._titleElement.checked))}return _createClass(DebugUICheckbox,[{key:"destroy",value:function(){this._element=null,this._titleElement=null,Object.setPrototypeOf(this,null)}},{key:"addValueChangedListener",value:function(listener){var _this4=this;this._titleElement.addEventListener("click",(function(e){return listener(_this4._titleElement.checked)}))}},{key:"element",get:function(){return this._element}},{key:"titleElement",get:function(){return this._titleElement}},{key:"value",get:function(){return this._titleElement.checked}},{key:"displayedValue",get:function(){return this._titleElement.checked?"true":"false"}},{key:"height",get:function(){return 0}},{key:"titleElementWidth",get:function(){return 16}}]),DebugUICheckbox}(),DebugUIDropdown=function(){function DebugUIDropdown(_ref3){var _this5=this,values=_ref3.values,current=_ref3.current,onValueChanged=_ref3.onValueChanged;_classCallCheck(this,DebugUIDropdown),this._values=values,this._onValueChanged=onValueChanged,this._element=document.createElement("select");var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=values[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var value=_step.value,element=document.createElement("option");element.value=value,element.innerHTML=escapeHTML(value),element.selected=value===current?"selected":"unselected",this._element.appendChild(element)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}null!=onValueChanged&&(this._element.addEventListener("change",(function(e){onValueChanged(_this5._element.value)})),onValueChanged(this._element.value)),Object.assign(this._element.style,{height:"24px"})}return _createClass(DebugUIDropdown,[{key:"destroy",value:function(){this._element=null,Object.setPrototypeOf(this,null)}},{key:"addValueChangedListener",value:function(listener){var _this6=this;this._element.addEventListener("change",(function(e){return listener(_this6._element.value)}))}},{key:"element",get:function(){return this._element}},{key:"value",get:function(){return this._element.value}},{key:"displayedValue",get:function(){return this._element.value}},{key:"height",get:function(){return 24}}]),DebugUIDropdown}(),DebugUIButton=function(){function DebugUIButton(_ref4){var label=_ref4.label,onClick=_ref4.onClick;_classCallCheck(this,DebugUIButton),this._onClick=onClick,this._element=document.createElement("button"),this._element.innerHTML=escapeHTML(label),null!=onClick&&this._element.addEventListener("click",(function(e){onClick()})),Object.assign(this._element.style,{height:"24px"})}return _createClass(DebugUIButton,[{key:"destroy",value:function(){this._element=null,Object.setPrototypeOf(this,null)}},{key:"addValueChangedListener",value:function(){}},{key:"addClickListener",value:function(listener){var _this7=this;this._element.addEventListener("click",(function(e){return listener(_this7._element.value)}))}},{key:"element",get:function(){return this._element}},{key:"value",get:function(){return""}},{key:"displayedValue",get:function(){return""}},{key:"height",get:function(){return 24}}]),DebugUIButton}(),DebugUIColorPicker=function(){function DebugUIColorPicker(_ref5){var _this8=this,current=_ref5.current,onValueChanged=_ref5.onValueChanged;_classCallCheck(this,DebugUIColorPicker),this._onValueChanged=onValueChanged,this._element=document.createElement("div"),this._titleElement=document.createElement("div"),this._color=current||new Color,this._listeners=[],Object.assign(this._element.style,{width:"100%",height:this.height+"px"}),Object.assign(this._titleElement.style,{width:"10px",height:"10px","border-radius":"2px"}),this._colorPickerMain=document.createElement("canvas"),this._colorPickerMain.height=62,Object.assign(this._colorPickerMain.style,{position:"absolute",left:"0px",right:"0px",top:"0px",height:"62px"}),this._element.appendChild(this._colorPickerMain),this._colorPickerBottomSlider=document.createElement("canvas"),this._colorPickerBottomSlider.height=14,Object.assign(this._colorPickerBottomSlider.style,{position:"absolute",left:"0px",right:"0px",top:"66px",height:"14px"}),this._element.appendChild(this._colorPickerBottomSlider),this._requestAnimationFrameHandle=null,this._requestAnimationFrameUpdate=this._requestAnimationFrameUpdate.bind(this),this._pickingMain=!1,this._pickingX=0,this._pickingY=0,this._colorPickerMain.addEventListener("pointerdown",(function(e){_this8._pickingMain=!0,_this8._updateMain(e.offsetX,e.offsetY),_this8._notify(),_this8._moveListener=function(e){var x=e.clientX-_this8._colorPickerMain.getBoundingClientRect().x,y=e.clientY-_this8._colorPickerMain.getBoundingClientRect().y;_this8._pickingX=Math.min(Math.max(x,0),_this8._colorPickerMain.clientWidth),_this8._pickingY=Math.min(Math.max(y,0),_this8._colorPickerMain.clientHeight),_this8._requestAnimationFrame()},document.body.addEventListener("pointermove",_this8._moveListener),_this8._upListener=function(e){_this8._pickingMain=!1,_this8.redraw(),document.body.removeEventListener("pointermove",_this8._moveListener),document.body.removeEventListener("pointerup",_this8._upListener),delete _this8._moveListener,delete _this8._upListener},document.body.addEventListener("pointerup",_this8._upListener)})),this._pickingBottomSlider=!1,this._colorPickerBottomSlider.addEventListener("pointerdown",(function(e){_this8._pickingBottomSlider=!0,_this8._updateBottomSlider(e.offsetX),_this8._notify(),_this8._bottomMoveListener=function(e){var x=e.clientX-_this8._colorPickerBottomSlider.getBoundingClientRect().x;_this8._pickingX=Math.min(Math.max(x,0),_this8._colorPickerMain.clientWidth),_this8._requestAnimationFrame()},document.body.addEventListener("pointermove",_this8._bottomMoveListener),_this8._bottomUpListener=function(e){_this8._pickingBottomSlider=!1,_this8.redraw(),document.body.removeEventListener("pointermove",_this8._bottomMoveListener),document.body.removeEventListener("pointerup",_this8._bottomUpListener),delete _this8._bottomMoveListener,delete _this8._bottomUpListener},document.body.addEventListener("pointerup",_this8._bottomUpListener)}));var offset=0,createModeButton=function(identifier,label){var button=document.createElement("button");return Object.assign(button.style,{position:"absolute",top:_this8.height-24+"px",left:offset+"px",height:"24px",width:"48px",color:"grey"}),button.innerHTML=label,offset+=50,button.addEventListener("click",(function(){_this8._modeButtons[_this8._mode].style.color="grey",_this8._mode=identifier,button.style.color="black",_this8.redraw()})),_this8._element.appendChild(button),button};this._modeButtons={},this._modeButtons.hsv=createModeButton("hsv","HSV"),this._modeButtons.svh=createModeButton("svh","SVH"),this._modeButtons.rgb=createModeButton("rgb","RGB"),this._mode="hsv",this._modeButtons.hsv.style.color="black",this._requestAnimationFrame(),this._notify()}return _createClass(DebugUIColorPicker,[{key:"destroy",value:function(){document.body.removeEventListener("pointermove",this._moveListener),document.body.removeEventListener("pointerup",this._upListener),document.body.removeEventListener("pointermove",this._bottomMoveListener),document.body.removeEventListener("pointerup",this._bottomUpListener),this._element=null,this._titleElement=null,this._destroyed=!0,Object.setPrototypeOf(this,null)}},{key:"addValueChangedListener",value:function(listener){this._listeners.push(listener)}},{key:"setValue",value:function(color){this._color.copy(color),this.redraw(),this._notify()}},{key:"_requestAnimationFrame",value:function(){null!=this._requestAnimationFrameHandle||this._destroyed||(this._requestAnimationFrameHandle=requestAnimationFrame(this._requestAnimationFrameUpdate))}},{key:"_requestAnimationFrameUpdate",value:function(){this._pickingMain&&(this._updateMain(this._pickingX,this._pickingY),this._notify()),this._pickingBottomSlider&&(this._updateBottomSlider(this._pickingX),this._notify()),this._requestAnimationFrameHandle=null}},{key:"_notify",value:function(){null!=this._onValueChanged&&this._onValueChanged(this._color);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this._listeners[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){(0,_step2.value)(this._color)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"_updateMain",value:function(x,y){var width=this._colorPickerMain.clientWidth;this._pickingX=Math.min(Math.max(x,1),width-1)-1,this._pickingY=Math.min(Math.max(y,1),63)-1;var xt=this._pickingX/(width-1),yt=this._pickingY/63;if("hsv"===this._mode){var v=_slicedToArray(rgb2hsv(this._color),3)[2];this._color.set(hsv2rgb(xt,yt,v))}else if("svh"===this._mode){var h=_slicedToArray(rgb2hsv(this._color),2)[0];this._color.set(hsv2rgb(h,xt,1-yt))}else this._color.r=xt,this._color.g=yt;this.redraw()}},{key:"_updateBottomSlider",value:function(x){var width=this._colorPickerBottomSlider.clientWidth;this._pickingX=Math.min(Math.max(x,1),width-1)-1;var xt=this._pickingX/(width-1);if("hsv"===this._mode){var _rgb2hsv6=_slicedToArray(rgb2hsv(this._color),2),h=_rgb2hsv6[0],s=_rgb2hsv6[1];this._color.set(hsv2rgb(h,s,xt))}else if("svh"===this._mode){var _rgb2hsv8=_slicedToArray(rgb2hsv(this._color),3),_s=_rgb2hsv8[1],v=_rgb2hsv8[2];this._color.set(hsv2rgb(xt,_s,v))}else this._color.b=xt;this.redraw()}},{key:"redraw",value:function(){var width=this._element.clientWidth-2;this._colorPickerMain.width!==width&&(this._colorPickerMain.width=width);for(var _rgb2hsv10=_slicedToArray(rgb2hsv(this._color),3),currentH=_rgb2hsv10[0],currentS=_rgb2hsv10[1],currentV=_rgb2hsv10[2],mainContext=this._colorPickerMain.getContext("2d"),yi=0;yi<62;++yi)for(var xi=0;xi<width;++xi){if("hsv"===this._mode){var _hsv2rgb=hsv2rgb(xi/(width-1),yi/61,currentV),_r=_hsv2rgb.r,_g=_hsv2rgb.g,_b=_hsv2rgb.b;mainContext.fillStyle="rgb(".concat(255*_r,",").concat(255*_g,",").concat(255*_b,")")}else if("svh"===this._mode){var _hsv2rgb2=hsv2rgb(currentH,xi/(width-1),1-yi/61),_r2=_hsv2rgb2.r,_g2=_hsv2rgb2.g,_b2=_hsv2rgb2.b;mainContext.fillStyle="rgb(".concat(255*_r2,",").concat(255*_g2,",").concat(255*_b2,")")}else{var _r3=xi/width*255,_g3=yi/62*255,_b3=255*this._color.b;mainContext.fillStyle="rgb(".concat(_r3,",").concat(_g3,",").concat(_b3,")")}mainContext.fillRect(xi,yi,1,1)}this._pickingMain&&(mainContext.fillStyle="rgba(0,0,0,0.5)",mainContext.fillRect(0,this._pickingY,width,1),mainContext.fillRect(this._pickingX,0,1,62)),this._colorPickerBottomSlider.width!==width&&(this._colorPickerBottomSlider.width=width);for(var bottomSliderContext=this._colorPickerBottomSlider.getContext("2d"),_xi=0;_xi<width;++_xi){if("hsv"===this._mode){var _hsv2rgb3=hsv2rgb(currentH,currentS,_xi/(width-1)),_r4=_hsv2rgb3.r,_g4=_hsv2rgb3.g,_b4=_hsv2rgb3.b;bottomSliderContext.fillStyle="rgb(".concat(255*_r4,",").concat(255*_g4,",").concat(255*_b4,")")}else if("svh"===this._mode){var _hsv2rgb4=hsv2rgb(_xi/(width-1),currentS,currentV),_r5=_hsv2rgb4.r,_g5=_hsv2rgb4.g,_b5=_hsv2rgb4.b;bottomSliderContext.fillStyle="rgb(".concat(255*_r5,",").concat(255*_g5,",").concat(255*_b5,")")}else{var _r6=255*this._color.r,_g6=255*this._color.g,_b6=_xi/(width-2)*255;bottomSliderContext.fillStyle="rgb(".concat(_r6,",").concat(_g6,",").concat(_b6,")")}bottomSliderContext.fillRect(_xi,0,1,14)}this._pickingBottomSlider&&(bottomSliderContext.fillStyle="rgba(0,0,0,0.5)",bottomSliderContext.fillRect(this._pickingX,0,1,14));var r=255*this._color.r,g=255*this._color.g,b=255*this._color.b,border="1px solid rgb(".concat(.9*r,",").concat(.9*g,",").concat(.9*b,")");Object.assign(this._colorPickerMain.style,{border:border}),Object.assign(this._colorPickerBottomSlider.style,{border:border}),Object.assign(this._titleElement.style,{"background-color":"rgb(".concat(r,",").concat(g,",").concat(b,")"),border:border})}},{key:"element",get:function(){return this._element}},{key:"titleElement",get:function(){return this._titleElement}},{key:"value",get:function(){return this._color}},{key:"displayedValue",get:function(){return"#"+this._color.getHexString().toUpperCase()}},{key:"height",get:function(){return 108}},{key:"titleElementWidth",get:function(){return 12}}]),DebugUIColorPicker}(),DebugUIPanel=function(){function DebugUIPanel(_ref6){var name=_ref6.name;_classCallCheck(this,DebugUIPanel),this._name=name,this._element=document.createElement("div"),this._entries=[],this._height=12}return _createClass(DebugUIPanel,[{key:"destroy",value:function(){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this._entries[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){_step3.value.destroy()}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}this._entries=null,this._element=null,Object.setPrototypeOf(this,null)}},{key:"addControl",value:function(name,description,control){if(-1===this._entries.findIndex((function(entry){return entry.name===name}))){var child=new DebugUIEntry({name:name,description:description,control:control});this._entries.push(child),this._element.appendChild(child.element),null!=control.redraw&&control.redraw()}}},{key:"removeControl",value:function(name){var index=this._entries.findIndex((function(entry){return entry.name===name}));if(-1!==index){var entry=_slicedToArray(this._entries.splice(index,1),1)[0];this._element.removeChild(entry.element),entry.destroy()}}},{key:"_updateLayout",value:function(){this._height=0;var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this._entries[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var child=_step4.value;child.element.style.top=this._height+"px",this._height+=child.height+12}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}Object.assign(this._element.style,{height:this._height+"px"})}},{key:"element",get:function(){return this._element}},{key:"height",get:function(){return this._height}}]),DebugUIPanel}(),DebugUIEntry=function(){function DebugUIEntry(_ref7){var _this9=this,name=_ref7.name,description=_ref7.description,control=_ref7.control;_classCallCheck(this,DebugUIEntry),this._name=name,this._description=description,this._control=control,this._element=document.createElement("div"),this._element.title=description,Object.assign(this._element.style,{position:"absolute",left:"0px",right:"0px"}),this._element.appendChild(this._control.element),Object.assign(this._control.element.style,{position:"absolute",left:"0px",width:"100%",top:"16px","font-size":"10px"});var titleElementWidth=0;null!=this._control.titleElement&&(this._element.appendChild(this._control.titleElement),Object.assign(this._control.titleElement.style,{position:"absolute",left:"0px",top:"0px","font-size":"10px"}),titleElementWidth=this._control.titleElementWidth+4),this._control.addValueChangedListener((function(value){_this9._displayedValueElement.innerHTML=escapeHTML(_this9._control.displayedValue)})),this._nameElement=document.createElement("span"),this._nameElement.innerHTML=name,Object.assign(this._nameElement.style,{position:"absolute",left:titleElementWidth+"px",right:"0px",height:"16px",color:"#666666","font-size":"12px","text-align":"left","vertical-align":"middle"}),this._element.appendChild(this._nameElement),this._displayedValueElement=document.createElement("span"),this._displayedValueElement.innerHTML=escapeHTML(this._control.displayedValue),Object.assign(this._displayedValueElement.style,{position:"absolute",left:titleElementWidth+"px",right:"0px",height:"16px","font-size":"12px","text-align":"right","vertical-align":"middle"}),this._element.appendChild(this._displayedValueElement)}return _createClass(DebugUIEntry,[{key:"destroy",value:function(){this._element=null,this._nameElement=null,this._displayedValueElement=null,this._control.destroy(),Object.setPrototypeOf(this,null)}},{key:"name",get:function(){return this._name}},{key:"element",get:function(){return this._element}},{key:"value",get:function(){return this._control.value}},{key:"height",get:function(){return this._control.height+16}}]),DebugUIEntry}();function escapeHTML(value){return value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var TWEEN=require("@tweenjs/tween.js"),CAMERA_CONTROL_OPTIONS_chain="chain",CAMERA_CONTROL_OPTIONS_cancel="cancel",CAMERA_LAYER_STATIC=0,CAMERA_LAYER_ANIMATED=1,RENDER_ANIMATED="animated",RENDER_STATIC_AND_ANIMATED="static_and_animated",RENDER_TWEEN="tween",CompositeVertexShader="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",CompositeFragmentShader="varying vec2 vUv;uniform sampler2D staticSceneColorTexture;uniform sampler2D staticSceneDepthTexture;uniform sampler2D animatedSceneColorTexture;uniform sampler2D animatedSceneDepthTexture;vec4 alphaBlend(vec4 background,vec4 foreground){vec3 resultColor=(foreground.rgb*foreground.a+background.rgb*background.a*(1.0-foreground.a));float resultAlpha=foreground.a+background.a*(1.0-foreground.a);return vec4(resultColor/resultAlpha,resultAlpha);}void main(){float staticDepth=texture2D(staticSceneDepthTexture,vUv).r;float animatedDepth=texture2D(animatedSceneDepthTexture,vUv).r;vec4 staticColor=texture2D(staticSceneColorTexture,vUv).rgba;vec4 animatedColor=texture2D(animatedSceneColorTexture,vUv).rgba;if(staticDepth<animatedDepth){animatedColor.a*=0.0;}gl_FragColor=alphaBlend(staticColor,animatedColor);}",Renderer=function(){function Renderer(renderOptions){var _this=this;_classCallCheck(this,Renderer),renderOptions.multiBufferRendering=renderOptions.multiBufferRendering||!1,this.contextLost=!1,this.implementation=renderOptions.multiBufferRendering?new MultiBufferRenderer(renderOptions):new SingleBufferRenderer(renderOptions),this.onWebGLContextCreationError=renderOptions.onWebGLContextCreationError,this.onWebGLContextLost=renderOptions.onWebGLContextLost,this.onWebGLContextRestored=renderOptions.onWebGLContextRestored,this.webGLContextCreationErrorListener=this.domElement().addEventListener("webglcontextcreationerror",(function(e){return _this.reportWebGlContextCreationError(e)})),this.webGLContextLostListener=this.domElement().addEventListener("webglcontextlost",(function(e){return _this.reportWebGlContextLost(e)})),this.webGLContextRestoredListener=this.domElement().addEventListener("webglcontextrestored",(function(e){return _this.reportWebGLContextRestored(e)}));var backgroundColor=renderOptions.backgroundColor;null==backgroundColor&&(backgroundColor=new Color(16777215));var backgroundAlpha=renderOptions.backgroundAlpha;null==backgroundAlpha&&(backgroundAlpha=1),this.shouldConsiderAlpha=renderOptions.alpha||!1,this.antialias=renderOptions.antialias||!1,this.setBackgroundColor(backgroundColor,backgroundAlpha)}return _createClass(Renderer,[{key:"destroy",value:function(){this.domElement().removeEventListener("webglcontextcreationerror",this.webGLContextCreationErrorListener),this.domElement().removeEventListener("webglcontextlost",this.webGLContextLostListener),this.domElement().removeEventListener("webglcontextrestored",this.webGLContextRestoredListener),this.implementation.destroy()}},{key:"render",value:function(renderTask,renderTarget,scene,sceneCamera){this.implementation.render(renderTask,renderTarget,scene,sceneCamera)}},{key:"getMaxAnisotropy",value:function(){return this.implementation.renderer.capabilities.getMaxAnisotropy()}},{key:"getBufferSize",value:function(){return this.implementation.renderer.getSize()}},{key:"getContext",value:function(){return this.implementation.renderer.getContext()}},{key:"preloadTexture",value:function(texture){this.implementation.renderer.setTexture2D(texture,0)}},{key:"setBufferSize",value:function(width,height){this.implementation.setBufferSize(width,height)}},{key:"setBackgroundColor",value:function(color,alpha){this.shouldConsiderAlpha||(alpha=1),alpha=(alpha=void 0!==alpha?+alpha:1)>=0&&alpha<=1?alpha:1,this.implementation.setBackgroundColor(color,alpha)}},{key:"setMapboxOutdoorContext",value:function(mapboxOutdoorContext){this.implementation.setMapboxOutdoorContext(mapboxOutdoorContext)}},{key:"domElement",value:function(){return this.implementation.renderer.domElement}},{key:"isAvailable",value:function(){return null!=this.implementation.renderer&&!this.contextLost}},{key:"disposeOfRenderLists",value:function(){this.implementation.renderer.renderLists.dispose()}},{key:"reportWebGlContextCreationError",value:function(e){this.onWebGLContextCreationError&&this.onWebGLContextCreationError(e)}},{key:"reportWebGlContextLost",value:function(e){e.preventDefault(),this.onWebGLContextLost&&this.onWebGLContextLost(e),this.contextLost=!0}},{key:"reportWebGLContextRestored",value:function(){this.onWebGLContextRestored&&this.onWebGLContextRestored(),this.contextLost=!1}},{key:"backgroundColor",get:function(){return this.implementation.backgroundColor}},{key:"backgroundAlpha",get:function(){return this.implementation.backgroundAlpha}}]),Renderer}(),SingleBufferRenderer=function(){function SingleBufferRenderer(renderOptions){_classCallCheck(this,SingleBufferRenderer);try{this.renderer=new WebGLRenderer({alpha:renderOptions.alpha||!1,antialias:renderOptions.antialias,preserveDrawingBuffer:!0})}catch(e){renderOptions.onWebGLRendererError&&renderOptions.onWebGLRendererError(e)}this.backgroundColor=new Color,this.backgroundAlpha=1,this.mapboxOutdoorContext=null}return _createClass(SingleBufferRenderer,[{key:"destroy",value:function(){this.renderer.dispose()}},{key:"render",value:function(renderTask,renderTarget,scene,sceneCamera){sceneCamera.layers.enable(CAMERA_LAYER_STATIC),sceneCamera.layers.enable(CAMERA_LAYER_ANIMATED),this.renderer.autoClear=!1,this.renderer.setClearColor(this.backgroundColor,this.backgroundAlpha),this.renderer.setRenderTarget(renderTarget),this.renderer.clear(),this.renderer.render(scene,sceneCamera,renderTarget),null!=this.mapboxOutdoorContext&&(this.renderer.state.reset(),this.mapboxOutdoorContext.render({resolution:this.renderer.getSize(),camera:sceneCamera}),this.renderer.state.reset())}},{key:"setBufferSize",value:function(width,height){this.renderer.setSize(width,height,!1)}},{key:"setBackgroundColor",value:function(color,alpha){this.backgroundColor=color,this.backgroundAlpha=alpha}},{key:"setMapboxOutdoorContext",value:function(mapboxOutdoorContext){this.mapboxOutdoorContext=mapboxOutdoorContext}}]),SingleBufferRenderer}(),MultiBufferRenderer=function(){function MultiBufferRenderer(renderOptions){_classCallCheck(this,MultiBufferRenderer);try{this.renderer=new WebGLRenderer({alpha:renderOptions.alpha||!1,antialias:!1,preserveDrawingBuffer:!0})}catch(e){renderOptions.onWebGLRendererError&&renderOptions.onWebGLRendererError(e)}this.backgroundColor=new Color,this.backgroundAlpha=1,this.mapboxOutdoorContext=null,this.staticSceneRenderTarget=new WebGLRenderTarget(this.renderer.width,this.renderer.height),this.staticSceneRenderTarget.texture.format=RGBAFormat,this.staticSceneRenderTarget.texture.minFilter=NearestFilter,this.staticSceneRenderTarget.texture.magFilter=NearestFilter,this.staticSceneRenderTarget.texture.generateMipmaps=!1,this.staticSceneRenderTarget.stencilBuffer=!1,this.staticSceneRenderTarget.depthBuffer=!0,this.staticSceneRenderTarget.depthTexture=new DepthTexture,this.staticSceneRenderTarget.depthTexture.type=UnsignedIntType,this.animatedSceneRenderTarget=new WebGLRenderTarget(this.renderer.width,this.renderer.height),this.animatedSceneRenderTarget.texture.format=RGBAFormat,this.animatedSceneRenderTarget.texture.minFilter=NearestFilter,this.animatedSceneRenderTarget.texture.magFilter=NearestFilter,this.animatedSceneRenderTarget.texture.generateMipmaps=!1,this.animatedSceneRenderTarget.stencilBuffer=!1,this.animatedSceneRenderTarget.depthBuffer=!0,this.animatedSceneRenderTarget.depthTexture=new DepthTexture,this.animatedSceneRenderTarget.depthTexture.type=UnsignedIntType,this.compositeUniforms={staticSceneColorTexture:{type:"t",value:this.staticSceneRenderTarget.texture},staticSceneDepthTexture:{type:"t",value:this.staticSceneRenderTarget.depthTexture},animatedSceneColorTexture:{type:"t",value:this.animatedSceneRenderTarget.texture},animatedSceneDepthTexture:{type:"t",value:this.animatedSceneRenderTarget.depthTexture}},this.compositeCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.compositeMaterial=new ShaderMaterial({uniforms:this.compositeUniforms,vertexShader:CompositeVertexShader,fragmentShader:CompositeFragmentShader}),this.compositeFullscreenQuad=new Mesh(new PlaneBufferGeometry(2,2),this.compositeMaterial),this.compositeScene=new Scene,this.compositeScene.add(this.compositeFullscreenQuad)}return _createClass(MultiBufferRenderer,[{key:"destroy",value:function(){this.staticSceneRenderTarget.dispose(),this.animatedSceneRenderTarget.dispose(),this.renderer.dispose()}},{key:"renderAnimated",value:function(renderTarget,scene,sceneCamera){sceneCamera.layers.enable(CAMERA_LAYER_ANIMATED),sceneCamera.layers.disable(CAMERA_LAYER_STATIC),this.renderer.setClearColor(new Color,0),this.renderer.setRenderTarget(this.animatedSceneRenderTarget),this.renderer.clear(),this.renderer.render(scene,sceneCamera,this.animatedSceneRenderTarget),this.renderer.setRenderTarget(renderTarget),this.renderer.clear(),this.renderer.context.depthMask(!1),this.renderer.render(this.compositeScene,this.compositeCamera,renderTarget),this.renderer.context.depthMask(!0)}},{key:"renderStaticAndAnimated",value:function(renderTarget,scene,sceneCamera){sceneCamera.layers.enable(CAMERA_LAYER_STATIC),sceneCamera.layers.disable(CAMERA_LAYER_ANIMATED),this.renderer.autoClear=!1,this.renderer.setClearColor(this.backgroundColor,this.backgroundAlpha),this.renderer.setRenderTarget(this.staticSceneRenderTarget),this.renderer.clear(),this.renderer.render(scene,sceneCamera,this.staticSceneRenderTarget),null!=this.mapboxOutdoorContext&&(this.renderer.state.reset(),this.mapboxOutdoorContext.render({resolution:this.renderer.getSize(),camera:sceneCamera,renderTarget:this.staticSceneRenderTarget}),this.renderer.state.reset()),this.renderAnimated(renderTarget,scene,sceneCamera)}},{key:"render",value:function(renderTask,renderTarget,scene,sceneCamera){renderTask===RENDER_ANIMATED?this.renderAnimated(renderTarget,scene,sceneCamera):renderTask===RENDER_STATIC_AND_ANIMATED?this.renderStaticAndAnimated(renderTarget,scene,sceneCamera):console.error("Renderer.render called with invalid renderTask")}},{key:"setBufferSize",value:function(width,height){this.renderer.setSize(width,height,!1),this.staticSceneRenderTarget.setSize(width,height),this.animatedSceneRenderTarget.setSize(width,height)}},{key:"setBackgroundColor",value:function(color,alpha){this.backgroundColor=color,this.backgroundAlpha=alpha}},{key:"setMapboxOutdoorContext",value:function(mapboxOutdoorContext){this.mapboxOutdoorContext=mapboxOutdoorContext}}]),MultiBufferRenderer}(),UPDATE_ORDERING_BEFORE_CAMERA=5,UPDATE_ORDERING_CAMERA=4,UPDATE_ORDERING_AFTER_CAMERA=3,UPDATE_ORDERING_RENDER=2,UPDATE_ORDERING_AFTER_RENDER=1,UPDATE_ORDERING_AFTER_ALL_UPDATES=0,TASK_PRIORITY_VISIBLE_MAP_HIGH=5,TASK_PRIORITY_VISIBLE_MAP_LOW=4,TASK_PRIORITY_VISIBLE_MAP_MARKER=3,TASK_PRIORITY_ASYNC_MAP_HIGH=2,TASK_PRIORITY_ASYNC_MAP_LOW=1,TASK_PRIORITY_ASYNC_MAP_MARKER=0,TASK_PRIORITY_MAP_LOADED=-1,FrameUpdate=function(){function FrameUpdate(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,FrameUpdate),this._callback=options.callback,this._frameCount=null!=options.frameCount?options.frameCount:1,this._ordering=null!=options.ordering?options.ordering:0,this._supersededBy=null!=options.supersededBy?new Set(options.supersededBy):new Set,this.name=options.name,this.userdata=options.userdata,this._remainingFrameCount=this._frameCount,this._lastFrameTime=0}return _createClass(FrameUpdate,[{key:"getLastFrameTime",value:function(){return this._lastFrameTime}}]),FrameUpdate}(),FrameTask=function(){function FrameTask(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,FrameTask),null!=options.group&&null!=options.priority)throw new Error("cannot specify task priority individually within group");if(null!=options.group&&null!=options.postponeOnAdd)throw new Error("cannot specify task postpone individually within group");this._callback=options.callback,this._group=null!=options.group?options.group:null,this._priority=null!=options.priority?options.priority:0,this._postponed=null!=options.postponeOnAdd&&options.postponeOnAdd,this.name=options.name,this.userdata=options.userdata,this._complete=!1,this._scheduled=!1,this._cancelled=!1,this._lastFrameTime=0}return _createClass(FrameTask,[{key:"isComplete",value:function(){return this._complete}},{key:"getLastFrameTime",value:function(){return this._lastFrameTime}}]),FrameTask}(),FrameTaskGroup=function(){function FrameTaskGroup(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,FrameTaskGroup),this._onComplete=null!=options.onComplete?options.onComplete:function(){},this._priority=null!=options.priority?options.priority:0,this._postponed=null!=options.postponeOnAdd&&options.postponeOnAdd,this.name=options.name,this.userdata=options.userdata,this._tasks=new Set,this._scheduledTasks=new Set,this._scheduled=!1,this._cancelled=!1}return _createClass(FrameTaskGroup,[{key:"isComplete",value:function(){return 0===this._scheduledTasks.size}},{key:"getTasks",value:function(){return Array.from(this._tasks.values())}},{key:"clear",value:function(){this._tasks.clear(),this._scheduledTasks.clear()}},{key:"_popTask",value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._scheduledTasks[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var task=_step.value;return this._scheduledTasks.delete(task),task}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}]),FrameTaskGroup}(),RealTimeTimer=function(){function RealTimeTimer(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,RealTimeTimer),this._maxMillisecondsPerFrame=null!=options.maxMillisecondsPerFrame?options.maxMillisecondsPerFrame:32,this._time=null}return _createClass(RealTimeTimer,[{key:"beginFrame",value:function(){this._time=performance.now()+this._maxMillisecondsPerFrame}},{key:"hasTimeRemaining",value:function(){return performance.now()<=this._time}}]),RealTimeTimer}(),TaskScheduler=function(){function TaskScheduler(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,TaskScheduler),this._timer=null!=options.timer?options.timer:new RealTimeTimer,this._performance=null!=options.performance&&options.performance,this._scheduledUpdatesByOrdering=new Multimap,this._scheduledTasksByPriority=new Multimap,this._postponedTasks=new Set,this._requestAnimationFrameHandle=null,this._updatesToRunThisFrame=[],this._lastFrameTime=0,this._updatesRunLastFrame=new Set,this.update=this.update.bind(this)}return _createClass(TaskScheduler,[{key:"clear",value:function(){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this._scheduledTasksByPriority.values()[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){_step2.value._cancelled=!0}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this._postponedTasks.values()[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){_step3.value._cancelled=!0}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}this._scheduledUpdatesByOrdering=new Multimap,this._scheduledTasksByPriority=new Multimap,this._postponedTasks=new Set,this._lastFrameTime=0,this._updatesRunLastFrame.clear()}},{key:"destroy",value:function(){this.clear()}},{key:"requestAnimationFrame",value:function(_requestAnimationFrame){function requestAnimationFrame(){return _requestAnimationFrame.apply(this,arguments)}return requestAnimationFrame.toString=function(){return _requestAnimationFrame.toString()},requestAnimationFrame}((function(){null==this._requestAnimationFrameHandle&&(this._requestAnimationFrameHandle=requestAnimationFrame(this.update))}))},{key:"update",value:function(timestamp){var frameBeginTime;this._timer.beginFrame(),this._performance&&(frameBeginTime=performance.now());for(var keys=this._scheduledUpdatesByOrdering.keys(),i=keys.length-1;i>=0;--i){var ordering=keys[i],_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this._scheduledUpdatesByOrdering.get(ordering).values()[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var scheduledUpdate=_step4.value;this._updatesToRunThisFrame.push(scheduledUpdate)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=this._updatesToRunThisFrame[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var updateToRunThisFrame=_step5.value;--updateToRunThisFrame._remainingFrameCount,updateToRunThisFrame._remainingFrameCount<=0&&this._scheduledUpdatesByOrdering.delete(updateToRunThisFrame._ordering,updateToRunThisFrame),updateToRunThisFrame._superseded=!1;var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=this._updatesToRunThisFrame[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var otherUpdateToRunThisFrame=_step8.value;updateToRunThisFrame._supersededBy.has(otherUpdateToRunThisFrame)&&(updateToRunThisFrame._superseded=!0)}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorNormalCompletion8||null==_iterator8.return||_iterator8.return()}finally{if(_didIteratorError8)throw _iteratorError8}}}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}for(var _i=0;_i<this._updatesToRunThisFrame.length;++_i)this._updatesToRunThisFrame[_i]._superseded&&(this._updatesToRunThisFrame.splice(_i,1),--_i);var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=this._updatesToRunThisFrame[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var _updateToRunThisFrame=_step6.value,updateFrameBeginTime=void 0;this._performance&&(updateFrameBeginTime=performance.now()),_updateToRunThisFrame._callback(timestamp),this._performance&&(_updateToRunThisFrame._lastFrameTime=performance.now()-updateFrameBeginTime)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}this._updatesRunLastFrame.clear();var _iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=this._updatesToRunThisFrame[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var update=_step7.value;this._updatesRunLastFrame.add(update)}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorNormalCompletion7||null==_iterator7.return||_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}if(this._updatesToRunThisFrame.splice(0,this._updatesToRunThisFrame.length),this._scheduledTasksByPriority.size>0)do{this._executeOneTask(timestamp)}while(this._timer.hasTimeRemaining()&&this._scheduledTasksByPriority.size>0);this._performance&&(this._lastFrameTime=performance.now()-frameBeginTime),this._requestAnimationFrameHandle=null,(this._scheduledUpdatesByOrdering.size>0||this._scheduledTasksByPriority.size>0)&&this.requestAnimationFrame()}},{key:"flushTasks",value:function(){for(;this._scheduledTasksByPriority.size>0;)this._executeOneTask(performance.now())}},{key:"getLastFrameTime",value:function(){return this._lastFrameTime}},{key:"getUpdatesRunLastFrame",value:function(){return this._updatesRunLastFrame}},{key:"_executeOneTask",value:function(timestamp){var frameBeginTime,task=this._scheduledTasksByPriority.popFromMaxKey(),taskGroup=null;console.assert(void 0!==task),Object.getPrototypeOf(task)===FrameTaskGroup.prototype&&(task=(taskGroup=task)._popTask()),console.assert(void 0!==task),console.assert(Object.getPrototypeOf(task)===FrameTask.prototype),this._performance&&(frameBeginTime=performance.now()),task._callback(timestamp),task._complete=!0,this._performance&&(task._lastFrameTime=performance.now()-frameBeginTime),null!=taskGroup&&(taskGroup.isComplete()?(taskGroup.clear(),taskGroup._onComplete()):this._scheduledTasksByPriority.insert(taskGroup._priority,taskGroup))}},{key:"scheduleUpdate",value:function(update){update._remainingFrameCount=update._frameCount,this._scheduledUpdatesByOrdering.insert(update._ordering,update),this.requestAnimationFrame()}},{key:"scheduleTask",value:function(task){if(Object.getPrototypeOf(task)===FrameTaskGroup)throw new Error("frame task groups are automatically scheduled when a task is added to them and cannot be manually scheduled: ",task.name);if(task._scheduled)throw new Error("cannot schedule already scheduled task: ",task.name);if(task._cancelled)throw new Error("cannot schedule cancelled task: ",task.name);var toAdd=task;null!=task._group&&(task._group._tasks.add(task),task._group._scheduledTasks.add(task),toAdd=task._group),toAdd._postponed?this._postponedTasks.add(toAdd):this._scheduledTasksByPriority.insert(toAdd._priority,toAdd),task._scheduled=!0,toAdd._scheduled=!0,this.requestAnimationFrame()}},{key:"cancelUpdate",value:function(update){this._scheduledUpdatesByOrdering.delete(update._ordering,update)}},{key:"cancelTask",value:function(task){if(!task._scheduled)throw new Error("cannot cancel task that has not been scheduled: "+task.name);if(task._cancelled)throw new Error("cannot cancel task that has already been cancelled: "+task.name);if(null!=task._group){var wasComplete=task._group.isComplete();task._group._tasks.delete(task),task._group._scheduledTasks.delete(task),task._group.isComplete()&&(this._scheduledTasksByPriority.delete(task._group._priority,task._group),wasComplete||task._group._onComplete())}else this._scheduledTasksByPriority.delete(task._priority,task),this._postponedTasks.delete(task);Object.getPrototypeOf(task)===FrameTask.prototype?task._cancelled=!0:task.clear()}},{key:"postponeTask",value:function(task){if(null!=task._group)throw new Error("cannot postpone individual tasks in group: "+task.name);if(task._cancelled)throw new Error("cannot postpone cancelled task: "+task.name);if(!task._postponed){if(Object.getPrototypeOf(task)===FrameTask.prototype){if(task._complete)return;if(!task._scheduled)throw new Error("cannot postpone task that has not been scheduled: "+task.name)}this._scheduledTasksByPriority.delete(task._priority,task),Object.getPrototypeOf(task)!==FrameTask.prototype&&task.isComplete()||this._postponedTasks.add(task),task._postponed=!0}}},{key:"resumeTask",value:function(task){if(null!=task._group)throw new Error("cannot resume individual tasks in groups");if(task._cancelled)throw new Error("cannot resume cancelled task");if(task._postponed){if(Object.getPrototypeOf(task)===FrameTask.prototype){if(task._complete)return;if(!task._scheduled)throw new Error("cannot resume unscheduled task")}this._postponedTasks.delete(task),Object.getPrototypeOf(task)!==FrameTask.prototype&&task.isComplete()||this._scheduledTasksByPriority.insert(task._priority,task),task._postponed=!1,this.requestAnimationFrame()}}},{key:"setTaskPriority",value:function(task,priority){if(Object.getPrototypeOf(task)===FrameTask.prototype&&!task._scheduled)throw new Error("task must be scheduled to be reprioritized");this._scheduledTasksByPriority.has(task._priority,task)&&(this._scheduledTasksByPriority.delete(task._priority,task),this._scheduledTasksByPriority.insert(priority,task)),task._priority=priority}}]),TaskScheduler}(),Multimap=function(){function Multimap(){_classCallCheck(this,Multimap),this._map=new Map,this._size=0,this._sortedKeys=[]}return _createClass(Multimap,[{key:"has",value:function(key,value){return null!=this._map.get(key)&&this._map.get(key).has(value)}},{key:"get",value:function(key){return this._map.get(key)}},{key:"insert",value:function(key,value){if(console.assert("number"==typeof key&&Number.isFinite(key)),null==this._map.get(key)){this._map.set(key,new Set);for(var i=0;i<=this._sortedKeys.length;++i)if(i===this._sortedKeys.length||key<this._sortedKeys[i]){this._sortedKeys.splice(i,0,key);break}}this._map.get(key).has(value)||(this._map.get(key).add(value),++this._size)}},{key:"delete",value:function(key,value){null!=this._map.get(key)&&this._map.get(key).has(value)&&(this._map.get(key).delete(value),--this._size,0===this._map.get(key).size&&(this._map.delete(key),this._sortedKeys.splice(this._sortedKeys.indexOf(key),1)))}},{key:"pop",value:function(key){if(null!=this._map.get(key)){var value,_iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=this._map.get(key).values()[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){value=_step9.value,this._map.get(key).delete(value),--this._size;break}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{_iteratorNormalCompletion9||null==_iterator9.return||_iterator9.return()}finally{if(_didIteratorError9)throw _iteratorError9}}return 0===this._map.get(key).size&&(this._map.delete(key),this._sortedKeys.splice(this._sortedKeys.indexOf(key),1)),value}}},{key:"popFromMaxKey",value:function(){if(this._sortedKeys.length>0)return this.pop(this._sortedKeys[this._sortedKeys.length-1])}},{key:"values",value:function(){var _iterator10,_this=this,keyIterator=this._map.keys(),valueIterator=null,iterator=(_defineProperty(_iterator10={},Symbol.iterator,(function(){return iterator})),_defineProperty(_iterator10,"next",(function(){if(null==valueIterator){var nextKey=keyIterator.next();if(nextKey.done)return nextKey;valueIterator=_this._map.get(nextKey.value).values()}for(var nextValue=valueIterator.next();nextValue.done;){var _nextKey=keyIterator.next();if(_nextKey.done)return _nextKey;nextValue=(valueIterator=_this._map.get(_nextKey.value).values()).next()}return nextValue})),_iterator10);return iterator}},{key:"keys",value:function(){return this._sortedKeys}},{key:"size",get:function(){var sum=0,_iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator11=this._map.values()[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator11.next()).done);_iteratorNormalCompletion10=!0){sum+=_step10.value.size}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{_iteratorNormalCompletion10||null==_iterator11.return||_iterator11.return()}finally{if(_didIteratorError10)throw _iteratorError10}}return console.assert(sum===this._size),sum}}]),Multimap}(),MapView=function(container,venue,options){var scope=this;this.type="MapView",this.controls=null,this.colors={hover:13421772,select:5022204,text:0,path:16745292,pathPulse:16777215,textSelect:16777215},this.venue=venue,this.container=container,this.currentMap=null,this.focusZoomFactor=3,this.setMap=function(mapId){},this.addMap=function(){},this.removeMap=function(){},this.focusOnPolygon=function(polygonId,changeZoom,duration,curve){},this.focusOnPath=function(path,polygonIds,changeZoom,duration,curve){},this.focusOn=function(options){},this.showEntireMap=function(options){},this.setPadding=function(padding){},this.getZoomLevelForPolygon=function(polygonId){},this.getZoomLevelForCurrentMap=function(){},this.resetCamera=function(){},this.getNorth=function(){return 0},this.lockNorth=function(element,offset){},this.unlockNorth=function(element){},this.setPolygonColor=function(polygonId,color,textColor){},this.clearPolygonColor=function(polygonId){},this.clearAllPolygonColors=function(){},this.addInteractivePolygon=function(polygonId){},this.addInteractivePolygonsForAllLocations=function(options){},this.removeInteractivePolygon=function(polygonId){},this.onPolygonClicked=function(polygonId){},this.onNothingClicked=function(){},this.createMarker=function(html,position,className,map,options){},this.addMarker=function(marker){},this.removeMarker=function(marker){},this.removeAllMarkers=function(){},this.convertTo3DMapPosition=function(mappedInCoordinate){},this.getPositionPolygon=function(polygonId){},this.getPositionNode=function(nodeId){},this.labelPolygon=function(options){},this.labelAllLocations=function(options){},this.removeAllLabels=function(){},this.createTooltip=function(options){},this.removeTooltip=function(tooltip){},this.enableImageFlippingForAllLocations=function(options){},this.enableImageFlippingForPolygon=function(options){},this.createFont=function(facetypeJson){},this.getPathLength=function(path){for(var length=0,map=path[0].map,i=0,iLen=path.length-1;i<iLen;++i){var node=path[i],nextNode=path[i+1];nextNode.map==map?length+=Math.sqrt(Math.pow(nextNode.x-node.x,2)+Math.pow(nextNode.y-node.y,2)):map=nextNode.map}return length},this.drawPath=function(path,options){},this.drawPathSegment=function(path,map,options){},this.removePathSegment=function(pathSegment){},this.removeAllPaths=function(){},this.setBackgroundColor=function(color,alpha){},this.tryRendering=function(){},this.resetState=function(){this.removeAllPaths(),this.removeAllMarkers(),this.removeAllLabels(),this.removeAllMaps()},this.getPrimaryLocationForPolygon=function(polygon){if("string"==typeof polygon){if(null==scope.venue||!Array.isArray(scope.venue.polygons))return null;polygon=scope.venue.polygons.find((function(p){return p.id==polygon}))}var location=null;if(null!=polygon&&null!=polygon.locations&&polygon.locations.length>0){location=polygon.locations[0];for(var i=0,iLen=polygon.locations.length;i<iLen;i++){for(var testLoc=polygon.locations[i];null!=testLoc.parent;)(testLoc=testLoc.parent).polygons.includes(polygon)&&(location=testLoc);if(null==testLoc.parent&&testLoc.polygons.includes(polygon))return testLoc}}return location}};MapView.createFont=function(facetypeJson){};var HoverLabel=function(container){var lastX,lastY,scope=this,hoverLabel=document.createElement("div");hoverLabel.style.display="none!important",hoverLabel.style.position="absolute",hoverLabel.style.top="0px",hoverLabel.style.left="0px",hoverLabel.style.pointerEvents="none",this.hovering=!1,container.appendChild(hoverLabel),this.show=function(textLabel){scope.hovering||scope.setPosition(lastX,lastY),scope.hovering=!0,hoverLabel.style.removeProperty("display"),hoverLabel.textContent=textLabel.toString(),hoverLabel.className=textLabel.hoverLabelClass},this.hide=function(){scope.hovering&&(scope.hovering=!1,hoverLabel.style.setProperty("display","none","important"),hoverLabel.textContent="")},this.setZIndex=function(z){hoverLabel.style.zIndex=z},this.setPosition=function(x,y){lastX=x,lastY=y,scope.hovering&&(y-hoverLabel.clientHeight>0?(y-=hoverLabel.clientHeight,x+hoverLabel.clientWidth>container.clientWidth&&(x-=hoverLabel.clientWidth)):x=x-hoverLabel.clientWidth-10,hoverLabel.style.transform="translate("+x+"px, "+y+"px)")},this.destroy=function(){container.removeChild(hoverLabel)}};HoverLabel.MODES={NONE:1,NO_TEXT_LABEL_ONLY:2,ALL:3};function PubSub(){}Object.assign(PubSub.prototype,{publish:function(eventName,data){this.subscribers&&this.subscribers[eventName]&&this.subscribers[eventName].forEach((function(fn){"function"==typeof fn&&fn(data)}))},on:function(eventName,fn){this.subscribers||(this.subscribers={}),this.subscribers[eventName]=this.subscribers[eventName]||[],this.subscribers[eventName].push(fn)},off:function(eventName,fn){if(this.subscribers&&this.subscribers[eventName]){var itemIdx=this.subscribers[eventName].indexOf(fn);-1!==itemIdx&&(this.subscribers[eventName][itemIdx]=void 0,this.subscribers[eventName].splice(itemIdx,1))}},destroy:function(){this.subscribers={}}});var stopPropagation=function(event){event.stopPropagation()},Marker=function(mapView,options){Object.assign(this,PubSub.prototype);var collider,marker=this,div=document.createElement("div");marker.div=div,marker._mMapId=options.map?options.map.id||options.map:mapView.currentMap,marker._mMarkerBuffer=options.markerBuffer||2;var collisionRank=null!=options.collisionRank?options.collisionRank:999;if(marker._mLockToAnchor=1==options.lockToAnchor,marker._mIgnoreCollisions=1==options.ignoreCollisions,marker._mRotateWithCamera=1==options.rotateWithCamera,marker._mIntitialRotation=options.rotation?options.rotation:0,marker.m_translateX=0,marker.m_translateY=0,marker.m_rotateZ=0,marker.userData=options.userData,div.className=options.className||options.class,div.innerHTML=options.html,options.position&&(div.style.position="absolute",div.style.top="0px",div.style.left="0px",div.style.willChange="transform",options.polygon)){var polygonPos=mapView.getPositionPolygon(options.polygon);polygonPos&&(options.position.z=polygonPos.z)}div.addEventListener("mousedown",stopPropagation),marker._oldPointerEvents=div.style.pointerEvents,marker._mPosition=options.position,marker._mOriginalPosition=options.position,marker._mProjectedPosition=[0,0],this.destroy=function(){for(var eventName in this.publish("destroy"),div.removeEventListener("mousedown",stopPropagation),this.subscribers)for(var eventSubscribers=this.subscribers[eventName],iter=eventSubscribers.length-1;iter>=0;--iter)marker.off(eventName,eventSubscribers[iter]);this.__alive=!1},this.isColliding=function(){return!marker._mIgnoreCollisions&&marker._mShadowElement._mNumCollisions>0},this.show=function(){1==marker._mHidden&&(marker._mHidden=!1,marker._mAnchor&&p2_1.vec2.copy(marker._mShadowElement.position,marker._mAnchor.position),div.style.opacity=marker._oldOpacity,div.style.pointerEvents=marker._oldPointerEvents,null!=collider&&collider.enable(),this.publish("show"))},this.hide=function(){1!=marker._mHidden&&(marker._mHidden=!0,marker._oldOpacity=div.style.opacity,div.style.opacity=0,marker._oldPointerEvents=div.style.pointerEvents,div.style.pointerEvents="none",null!=collider&&collider.disable(),this.publish("hide"))},this.setCollisionAreas=function(hitAreas){null==collider?((collider=options.collisionEngine.add({rank:collisionRank,hitAreas:hitAreas,userData:marker.userData})).on("collision",marker.publishCollisions),collider.update(marker.m_translateX,marker.m_translateY)):collider.updateHitAreas(hitAreas)},this.setPosition=function(position){position&&position.x&&position.y&&(marker._mPosition=position,mapView.tryRendering())},this.setTransform=function(transforms){marker.m_translateX=transforms.x,marker.m_translateY=transforms.y,marker.m_rotateZ=transforms.rotateZ;var transform="translate("+transforms.x+"px, "+transforms.y+"px)"+" "+("rotate("+transforms.rotateZ+"rad)");null!=collider&&collider.update(marker.m_translateX,marker.m_translateY),marker.div.style.transform=transform,marker.publish("update-position",{x:transforms.x,y:transforms.y,rotateZ:transforms.rotateZ})},this.publishCollisions=function(collisions){marker.publish("collision",collisions)},this.addEventListener=function(ev,response){marker.div.addEventListener(ev,response)},this.isVisible=function(){return!marker._mHidden},this.getMap=function(type){return"id"===type?marker._mMapId:mapView.venue.maps.find((function(mapObject){return mapObject.id===marker._mMapId}))}},TWO_PI=2*Math.PI,HALF_PI=Math.PI/2,ONE_AND_A_HALF_PI=1.5*Math.PI,TextLabel=function(options,venue,mapObject,DEFAULT_FONT,polygonMeshesById,textLabelsByPolygonId,textMaterials,mapView){var polyId=options.polygonId||getObjectId(options.polygon,venue.polygons),polygon=getObject(options.polygon,venue.polygons),mapScale=mapObject.getMapScale()||1,canvasBounds=options.canvasBounds||polygon.canvasBounds,height=Number(options.height)||null,stateText=options.stateText?" ("+options.stateText+")":"",text=options.shortText||options.text,hoverLabelText=options.text,margin=(options.margin||2)*mapScale,heightMargin=(options.heightMargin||.5)*mapScale,multiline=null==options.multiline||options.multiline,color=options.color||mapView.colors.text||0,fontSize=(options.fontSize||12)/8,size=(options.size||fontSize)*mapScale,font=options.font||DEFAULT_FONT,scaleMin=options.scaleMin||.25,scaleStep=options.scaleStep>0?options.scaleStep:.25,hoverLabelMode=options.hoverLabelMode3D||HoverLabel.MODES.ALL;this.hoverLabelClass=options.hoverLabelClass||"mMapviewHoverLabel",this.showHoverLabel=hoverLabelMode==HoverLabel.MODES.ALL||hoverLabelMode==HoverLabel.MODES.NO_TEXT_LABEL_ONLY;var textAnchor,textObject,textMaterial,textMesh,hoverIfLabelFails=hoverLabelMode==HoverLabel.MODES.ALL||hoverLabelMode==HoverLabel.MODES.NO_TEXT_LABEL_ONLY,labelScope=this,created=!1,hideOnCreate=!1,radiansRotation=0,doNotCreate=!1;null==(textMaterial=textMaterials[color])&&(textMaterial=new MeshBasicMaterial({color:color}),textMaterials[color]=textMaterial),this.invalid=!1,this.message="",mapObject.textObjects.push(labelScope),this.create=function(){if(labelScope.invalid=!0,labelScope.showHoverLabel=hoverLabelMode==HoverLabel.MODES.ALL,!doNotCreate){if(null==canvasBounds)return labelScope.invalid=!0,labelScope.message="No Canvas Bounds. Can't draw text '"+text+"'",void(labelScope.showHoverLabel=hoverIfLabelFails);font instanceof Font==0&&(console.error("Invalid font for '"+text+"'. Make sure you provide a Mappedin.Font or Font object. Using default instead."),font=DEFAULT_FONT);var lines,shrinkStep,currentScale,stringsToTry=[text+stateText,text],spaceWidth=font.data.glyphs[" "].ha/(font.data.resolution/size),lineHeight=(font.data.ascender-font.data.descender)/(font.data.resolution/size);if(stringsToTry.forEach((function(stringAttempt){if(labelScope.invalid){for(var words=(stringAttempt=(stringAttempt=stringAttempt.replace(font._mInvalidCharacters,"")).trim()).split(" "),availableWidth=canvasBounds.maxWidth-2*margin,availableHeight=canvasBounds.maxHeight-2*heightMargin,maxShrinkSteps=(1-scaleMin)/scaleStep,wordSizes=words.map((function(word){var characters=word.split("");return{word:word,width:characters.reduce((function(acc,val){return font.data.glyphs[val].ha+acc}),0)/(font.data.resolution/size)}})),minimumShrinkSteps=0,i=0,iLen=wordSizes.length;i<iLen;i++){var width=wordSizes[i].width,wShrinkSteps=Math.ceil((width-availableWidth)/(width*scaleStep));minimumShrinkSteps=Math.max(wShrinkSteps,minimumShrinkSteps)}shrink:for(shrinkStep=minimumShrinkSteps;shrinkStep<=maxShrinkSteps;shrinkStep++){currentScale=1-shrinkStep*scaleStep;var thisLineWidth=wordSizes[0].width*currentScale;lines=[{text:wordSizes[0].word,scaledWidth:thisLineWidth}];for(var iWordSize=1;iWordSize<wordSizes.length;iWordSize++){var wordSize=wordSizes[iWordSize],spaceForNextWord=(wordSize.width+spaceWidth)*currentScale;if(thisLineWidth+spaceForNextWord<availableWidth)lines[lines.length-1].text+=" "+wordSize.word,lines[lines.length-1].scaledWidth+=spaceForNextWord,thisLineWidth+=spaceForNextWord;else{if(!multiline)continue shrink;lines[lines.length-1].scaledWidth=thisLineWidth,thisLineWidth=wordSize.width*currentScale,lines.push({text:wordSize.word,scaledWidth:thisLineWidth})}}if(lines.length*lineHeight*currentScale<=availableHeight){labelScope.invalid=!1;break}}}})),labelScope.invalid)return labelScope.message="Could not draw '"+text+"' on "+polygon.id+": Too small",void(labelScope.showHoverLabel=hoverIfLabelFails);font._cache||(font._cache={},font._cacheDefaultSize=size);var finalGeo=new Geometry,xx=0,yy=0;lines.forEach((function(line){xx=-line.scaledWidth/2,line.text.split("").forEach((function(char){font._cache[char]||(font._cache[char]=new ExtrudeGeometry(font.generateShapes(char,font._cacheDefaultSize),{curveSegments:1,bevelThickness:0,bevelSize:0,bevelEnabled:!1,amount:1/12*mapScale}));var cachedCharacter=font._cache[char],scaleFactor=currentScale*(size/font._cacheDefaultSize);1!==scaleFactor&&cachedCharacter.scale(scaleFactor,scaleFactor,1),cachedCharacter.translate(xx,yy,0),finalGeo.merge(cachedCharacter),cachedCharacter.translate(-xx,-yy,0),1!==scaleFactor&&cachedCharacter.scale(1/scaleFactor,1/scaleFactor,1),xx+=font.data.glyphs[char].ha/(font.data.resolution/size)*currentScale})),yy-=lineHeight*currentScale})),finalGeo.center(),(textMesh=new Mesh(finalGeo,textMaterial)).geometry.computeBoundingBox();var bounds=textMesh.geometry.boundingBox;if((textObject=new Object3D).add(textMesh),"left"==canvasBounds.align?textObject.translateX((bounds.max.x-bounds.min.x)/2+margin):"right"==canvasBounds.align?textObject.translateX(-(bounds.max.x-bounds.min.x)/2-margin):"center"==canvasBounds.align&&textObject.translateX(canvasBounds.maxWidth/2),(textAnchor=new Object3D).add(textObject),null==height)if(polygonMeshesById[polyId]){var target=polygonMeshesById[polyId];target.geometry.boundingBox||target.geometry.computeBoundingBox(),height=target.geometry.boundingBox.max.z}else height=0;var map=mapObject.mapClass;textAnchor.translateX(canvasBounds.x-map.width/2),textAnchor.translateY(-canvasBounds.y+map.height/2),textAnchor.translateZ(height),radiansRotation=-canvasBounds.rotation*Math.PI/180,textAnchor.rotation.z=radiansRotation,textAnchor.updateMatrix(),hideOnCreate&&(textObject.visible=!1),created=!0,labelScope.flipIfNeeded(mapView.controls.getRotation()),mapObject.add(textAnchor),mapView.tryRendering()}};this.flipIfNeeded=function(cameraAngle){var angle=(radiansRotation-cameraAngle)%TWO_PI;created&&(angle>HALF_PI&&angle<ONE_AND_A_HALF_PI||angle<-HALF_PI&&angle>-ONE_AND_A_HALF_PI)&&(radiansRotation=(radiansRotation+Math.PI)%TWO_PI,textAnchor.rotation.z=radiansRotation,textObject.position.x=-textObject.position.x)},this.removeSelf=function(bulk){textMesh&&textMesh.destroy&&textMesh.destroy(),textObject&&textObject.destroy&&textObject.destroy(),textAnchor&&textAnchor.destroy&&textAnchor.destroy(),created?bulk||(mapObject.textObjects=mapObject.textObjects.filter((function(object){return object!=labelScope})),Object.keys(textLabelsByPolygonId).forEach((function(key){textLabelsByPolygonId[key]==labelScope&&delete textLabelsByPolygonId[key]}))):doNotCreate=!0},this.setColor=function(textColor){null==(textMaterial=textMaterials[textColor])&&(textMaterial=new MeshBasicMaterial({color:textColor}),textMaterials[textColor]=textMaterial),created&&(textMesh.material=textMaterial,mapView.tryRendering())},this.hide=function(){created&&textObject?textObject.visible=!1:hideOnCreate=!0},this.show=function(){created&&textObject?textObject.visible=!0:hideOnCreate=!1},this.clearColor=function(){this.setColor(color)},this.toString=function(){return hoverLabelText}};function drawSVGIcon(_ref){var iconElement,type=_ref.type,direction=_ref.direction,_ref$iconWidth=_ref.iconWidth,iconWidth=void 0===_ref$iconWidth?14:_ref$iconWidth,_ref$iconHeight=_ref.iconHeight,iconHeight=void 0===_ref$iconHeight?14:_ref$iconHeight,_ref$color=_ref.color,color=void 0===_ref$color?"white":_ref$color,_ref$scale=_ref.scale,scale=void 0===_ref$scale?1:_ref$scale;return null!=direction&&(iconElement=icons.get("".concat(type,"-").concat(direction))),null==iconElement&&(iconElement=icons.get(type)),null==iconElement&&(iconElement=icons.get("question-mark")),'<svg\n\t\t\theight="'.concat(iconWidth*scale,'"\n\t\t\tviewBox="0 0 36 36"\n\t\t\twidth="').concat(iconHeight*scale,'"\n\t\t>\n\t\t\t<g fill="').concat(color,'">\n\t\t\t\t').concat(iconElement,"\n\t\t\t</g>\n\t\t</svg>")}function extractMapIdsFromPath(path){var mapIdsInDirections=path.map((function(node){return node.map}));return mapIdsInDirections.reduce((function(x,y){return x.includes(y)?x:[].concat(_toConsumableArray(x),[y])}),[])}function areMultiFloor(directions){return 1!==extractMapIdsFromPath(directions.path).length}function getDistanceBetweenNodes(startNodeId,endNodeId,path,scale){var startIdx=path.indexOf(path.find((function(n){return null!=n.id?n.id===startNodeId:n.node===startNodeId}))),endIdx=path.indexOf(path.find((function(n){return null!=n.id?n.id===endNodeId:n.node===endNodeId}))),consecutivePath=path.slice(startIdx,endIdx+1);return consecutivePath.reduce((function(distance,node,idx){if(idx>0){var lastNode=consecutivePath[idx-1];distance+=(pt1=node,pt2=lastNode,Math.sqrt(Math.pow(pt2.x-pt1.x,2)+Math.pow(pt2.y-pt1.y,2)))}var pt1,pt2;return distance}),0)/scale}function getEntryAndExitConnections(mapId,connections){var connectionsOnMap=connections.filter((function(m){return m.map===mapId}));return{entry:connectionsOnMap[0],exit:connectionsOnMap[connectionsOnMap.length-1]}}function generateConnections(instructions,mapObjects){return null!=instructions.distance?function(journey,mapObjects){var path=journey.path,nodes=journey.instructions.reduce((function(nodes,point,index){var nextPoint=journey.instructions[index+1];if("TakeVortex"===point.action.type&&null!=nextPoint&&nextPoint.node.map!==point.node.map){var direction=mapObjects.get(nextPoint.node.map).mapClass.elevation>mapObjects.get(point.node.map).mapClass.elevation?"up":"down";nodes.push(_objectSpread2(_objectSpread2({},point.node),{},{type:point.atLocation.type,vortex:!0,direction:direction,exitMap:nextPoint.node.map,isEntrance:!1}));var nextNodeInPath=path[path.indexOf(path.find((function(p){return p.id===point.node.id})))+1];nodes.push(_objectSpread2(_objectSpread2({},nextNodeInPath),{},{type:point.atLocation.type,vortex:!0,direction:"up"===direction?"down":"up",exitMap:point.node.map,isEntrance:!0}))}return nodes}),[]);return nodes.unshift(_objectSpread2(_objectSpread2({},journey.path[0]),{},{type:"departure"})),nodes.push(_objectSpread2(_objectSpread2({},journey.path[journey.path.length-1]),{},{type:"destination"})),nodes}(instructions,mapObjects):function(instructions,mapObjects){var lastVortex,lastNode,nodes=instructions.path.reduce((function(nodes,point,index){var nextPoint=instructions.path[index+1];if(null!=nextPoint&&!0===nextPoint.vortex&&nextPoint.map!==point.map){var direction=mapObjects.get(nextPoint.map).mapClass.elevation>mapObjects.get(point.map).mapClass.elevation?"up":"down",step=instructions.directions.find((function(i){return i.node.node===point.node})),node=step.node;nodes.push({map:node.map,node:node.node,x:node.x,y:node.y,type:step.vortex.type,vortex:!0,direction:direction,exitMap:nextPoint.map,isEntrance:!1}),lastVortex=step.vortex,lastNode=node}else point.vortex&&(nodes.push(_objectSpread2(_objectSpread2({},point),{},{type:lastVortex.type,exitMap:lastNode.map,isEntrance:!0,direction:"up"})),lastVortex=null);return nodes}),[]);return nodes.unshift(_objectSpread2(_objectSpread2({},instructions.path[0]),{},{type:"departure"})),nodes.push(_objectSpread2(_objectSpread2({},instructions.path[instructions.path.length-1]),{},{type:"destination"})),nodes}(instructions,mapObjects)}function generateJourney(instructions,mapObjects){var lastConnection,lastMap,threshold=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,combineSimilarConnections=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],path=instructions.path,mapIdsInPath=extractMapIdsFromPath(path),sourceMap=mapIdsInPath[0],destinationMap=mapIdsInPath[mapIdsInPath.length-1],mapsInJourney=mapIdsInPath.map((function(mId){return mapObjects.get(mId)})),connections=generateConnections(instructions,mapObjects),mapsSortedByElevation=mapsInJourney.slice().sort((function(a,b){return a.mapClass.elevation-b.mapClass.elevation})),lowestMap=mapsSortedByElevation[0],highestMap=mapsSortedByElevation[mapsSortedByElevation.length-1];return mapsInJourney.reduce((function(processedMaps,map,index){if(map.id!==sourceMap&&map.id!==destinationMap){var connectionsForMap=getEntryAndExitConnections(map.id,connections),distance=getDistanceBetweenNodes(connectionsForMap.entry.node||connectionsForMap.entry.id,connectionsForMap.exit.node||connectionsForMap.exit.id,instructions.path,map.getMapScale());if(!hasMultipleSegments(path,map.id)&&!0===combineSimilarConnections&&connectionsForMap.entry.type===connectionsForMap.exit.type&&distance<threshold&&map!=lowestMap&&map!=highestMap){if(null==lastConnection){var obj={connection:!0,maps:[map.id],elevation:map.mapClass.elevation};processedMaps.push(obj),lastConnection=obj}else lastConnection.maps.push(map.id);return processedMaps}}if(null!=lastMap&&null!=lastConnection){lastConnection.maps.sort((function(a,b){return mapsInJourney.indexOf(b.id)-mapsInJourney.indexOf(a.id)}));var connectionsForLastMap=getEntryAndExitConnections(lastMap.id,connections),connectionsForCurrentMap=getEntryAndExitConnections(map.id,connections);lastConnection.connectionNodes=[connectionsForLastMap.exit,connectionsForCurrentMap.entry]}return processedMaps.push(map.id),lastMap=map,lastConnection=null,processedMaps}),[])}function hasMultipleSegments(directions,mapId){var maps={},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=directions[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){if(_step.value.map===mapId){if(1===maps[mapId])return!0;maps[mapId]=0}else 0===maps[mapId]&&(maps[mapId]=1)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return!1}var COLLISION_RANKING_TIERS={OPTIONAL_MINIMUM:0,OPTIONAL_MAXIMUM:1,MEDIUM:2,HIGH:3};function intersects(rect1,rect2){return rect1.x<rect2.x+rect2.w&&rect1.x+rect1.w>rect2.x&&rect1.y<rect2.y+rect2.h&&rect1.h+rect1.y>rect2.y}var PRIORITIZE_NEARBY_COLLIDERS_CAMERA_TILT_CUTOFF=Math.PI/180*55;function insideGrid(collider,_ref){return intersects(_ref.boundingBox,collider.boundingBox)}var Grid=function(){function Grid(_ref2){var width=_ref2.width,height=_ref2.height,_ref2$steps=_ref2.steps,steps=void 0===_ref2$steps?20:_ref2$steps,_ref2$screenBuffer=_ref2.screenBuffer,screenBuffer=void 0===_ref2$screenBuffer?150:_ref2$screenBuffer,offscreenCollider=_ref2.offscreenCollider;_classCallCheck(this,Grid),this.rows=[],this.boundingBox={x:0,y:0,w:1/0,h:1/0},this.screenBuffer=screenBuffer,this.width=width,this.height=height,this.steps=steps,this.offscreenCollider=offscreenCollider,this.build(width,height,steps),this.clear=this.clear.bind(this),this.insert=this.insert.bind(this),this._seenColliderCache=new Set}return _createClass(Grid,[{key:"insert",value:function(collider){for(var i in collider.hitAreas){var hitArea=collider.hitAreas[i];hitArea.cells.clear();for(var r=0;r<this.rows.length;r++)for(var row=this.rows[r],c=0;c<row.cols.length;c++){var cell=row.cols[c];intersects(cell,hitArea)&&(cell.collisions.add(hitArea),hitArea.cells.add({row:r,col:c}))}}}},{key:"clear",value:function(){for(var r=0;r<this.rows.length;r++)for(var row=this.rows[r],c=0;c<row.cols.length;c++){row.cols[c].collisions.clear()}}},{key:"build",value:function(){for(var width=this.width,height=this.height,steps=this.steps,stepDistance=Math.abs(Math.max(height,width)/steps),heightSteps=Math.abs(height/stepDistance),widthSteps=Math.abs(width/stepDistance),r=0;r<heightSteps;r++){var row={w:width,h:stepDistance,x:0,y:r*stepDistance,cols:[]};this.rows.push(row);for(var c=0;c<widthSteps;c++)row.cols.push({w:stepDistance,h:stepDistance,x:c*stepDistance,y:row.y,collisions:new Set})}this.boundingBox={x:-this.screenBuffer,y:-this.screenBuffer,w:this.width+2*this.screenBuffer,h:this.height+2*this.screenBuffer},this.screenBoundingBox={x:0,y:0,w:this.width,h:this.height}}},{key:"destroy",value:function(){this.clear(),this.rows=[]}},{key:"getCollisions",value:function(collider){var rect1,rect2,result={};for(var i in collider.hitAreas){var area=collider.hitAreas[i];if(result[i]=[],!1!==area.enabled){rect1=this.screenBoundingBox,rect2=area,rect1.x<rect2.x&&rect1.x+rect1.w>rect2.x+rect2.w&&rect1.y<rect2.y&&rect1.h+rect1.y>rect2.y+rect2.h||result[i].push({collider:this.offscreenCollider,hitArea:this.offscreenCollider.hitAreas.offscreen}),this._seenColliderCache.clear();var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=area.cells[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var cell=_step.value,row=cell.row,col=cell.col,collisionHitAreas=this.rows[row].cols[col].collisions;if(collisionHitAreas.size>0){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=collisionHitAreas[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var collisionArea=_step2.value;collisionArea.collider!=collider&&collisionArea.collider.enabled&&!this._seenColliderCache.has(collisionArea)&&intersects(collisionArea,area)&&(this._seenColliderCache.add(collisionArea),result[i].push({collider:collisionArea.collider,hitArea:collisionArea}))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}}return result}}]),Grid}(),Collider=function(_PubSub){_inherits(Collider,PubSub);var _super=function(Derived){function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var result,Super=_getPrototypeOf(Derived);if(isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}(Collider);function Collider(_ref3){var _this,_ref3$hitAreas=_ref3.hitAreas,hitAreas=void 0===_ref3$hitAreas?{}:_ref3$hitAreas,_ref3$rank=_ref3.rank,rank=void 0===_ref3$rank?999:_ref3$rank,_ref3$tiebreakerRank=_ref3.tiebreakerRank,tiebreakerRank=void 0===_ref3$tiebreakerRank?0:_ref3$tiebreakerRank,id=_ref3.id,_ref3$debug=_ref3.debug,debug=void 0!==_ref3$debug&&_ref3$debug,_ref3$userData=_ref3.userData,userData=void 0===_ref3$userData?{}:_ref3$userData;return _classCallCheck(this,Collider),(_this=_super.call(this)).hitAreas={},_this.collisions={},_this.userData={},_this.enabled=!0,_this.occupied=!0,_this._debug=!1,_this.x=0,_this.y=0,_this.rank=rank,_this.tiebreakerRank=tiebreakerRank,_this.userData=userData,_this.id=id,_this._debug=debug,_this._isCurrentlyBeingStepped=!1,_this.distanceFromCamera=-1/0,_this.update=_this.update.bind(_assertThisInitialized(_this)),_this.enable=_this.enable.bind(_assertThisInitialized(_this)),_this.disable=_this.disable.bind(_assertThisInitialized(_this)),_this.reset=_this.reset.bind(_assertThisInitialized(_this)),_this.updateHitAreas=_this.updateHitAreas.bind(_assertThisInitialized(_this)),_this.updateHitAreas(hitAreas),_this}return _createClass(Collider,[{key:"reset",value:function(){for(var o in this.hitAreas)this.hitAreas[o].cells.clear()}},{key:"calculateBoundingBox",value:function(){var totalArea={x:1/0,y:1/0,x1:-1/0,y1:-1/0,w:0,h:0};for(var o in this.hitAreas)totalArea.x=Math.min(totalArea.x,this.hitAreas[o].x),totalArea.y=Math.min(totalArea.y,this.hitAreas[o].y),totalArea.x1=Math.max(totalArea.x1,this.hitAreas[o].x+this.hitAreas[o].w),totalArea.y1=Math.max(totalArea.y1,this.hitAreas[o].y+this.hitAreas[o].h);return totalArea.w=totalArea.x1-totalArea.x,totalArea.h=totalArea.y1-totalArea.y,this.boundingBox=totalArea,this.boundingBox}},{key:"updateHitAreas",value:function(areas){for(var orientation in this.hitAreas){var area=this.hitAreas[orientation];area.el&&document.body.contains(area.el)&&this._debug&&document.body.removeChild(area.el)}for(var _orientation in this.hitAreas=areas,this.hitAreas){var _area=this.hitAreas[_orientation];_area._x=_area.x,_area._y=_area.y,_area.cells=new Set,null==_area.occupied&&(_area.occupied=!0),this._debug&&(_area.el=_area.el||document.createElement("div"),document.body.appendChild(_area.el))}this.update()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"update",value:function(){var x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.x,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.y,distanceFromCamera=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.distanceFromCamera;for(var h in this.x=x,this.y=y,this.distanceFromCamera=distanceFromCamera,this.hitAreas){var area=this.hitAreas[h];area.collider=this,area.x=area._x+this.x,area.y=area._y+this.y}return this.calculateBoundingBox(),this._debug&&this._updateDebugStyles(),this}},{key:"_updateDebugStyles",value:function(){for(var h in this.hitAreas){var area=this.hitAreas[h],areaActive=this._isCurrentlyBeingStepped&&area.occupied,opacity=areaActive?.25:.05,borderOpacity=areaActive?1:.25;area.el&&Object.assign(area.el.style,{left:"".concat(area.x,"px"),top:"".concat(area.y,"px"),width:"".concat(area.w,"px"),height:"".concat(area.h,"px"),background:"rgba(0, 0, 0, ".concat(opacity,")"),border:"1px solid rgba(255, 255, 255, ".concat(borderOpacity,")"),position:"absolute","pointer-events":"none"})}}},{key:"_setIsCurrentlyBeingStepped",value:function(active){this._isCurrentlyBeingStepped=active,this._debug&&this._updateDebugStyles()}},{key:"insideGrid",get:function(){for(var o in this.hitAreas)if(this.hitAreas[o].cells.size>0)return!0;return!1}}]),Collider}(),CollisionEngine=function(){function CollisionEngine(_ref4){var width=_ref4.width,height=_ref4.height,_ref4$gridSteps=_ref4.gridSteps,gridSteps=void 0===_ref4$gridSteps?20:_ref4$gridSteps,_ref4$screenBuffer=_ref4.screenBuffer,screenBuffer=void 0===_ref4$screenBuffer?150:_ref4$screenBuffer;_classCallCheck(this,CollisionEngine),this.colliders=new Set,this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.destroy=this.destroy.bind(this),this.step=throttle(this.step,16).bind(this),this.gridSteps=gridSteps,this.screenBuffer=screenBuffer;this.offscreenCollider={userData:{type:"offscreen"},rank:1/0,hitAreas:{offscreen:{occupied:!0,enabled:!0}},occupied:!0,enabled:!0},this.grid=new Grid({width:width,height:height,steps:this.gridSteps,screenBuffer:screenBuffer,offscreenCollider:this.offscreenCollider}),this._cameraTilt=0}return _createClass(CollisionEngine,[{key:"resize",value:function(_ref5){var width=_ref5.width,height=_ref5.height;this.grid.destroy(),this.grid=new Grid({width:width,height:height,steps:this.gridSteps,screenBuffer:this.screenBuffer,offscreenCollider:this.offscreenCollider})}},{key:"add",value:function(params){var collider=new Collider(_objectSpread2(_objectSpread2({},params),{},{debug:null!=CollisionEngine.DEBUG}));return this.colliders.add(collider),collider}},{key:"remove",value:function(collider){this.colliders.delete(collider)}},{key:"setCameraTilt",value:function(tilt){this._cameraTilt=tilt}},{key:"getRankedColliders",value:function(){var _this2=this,byRank=function(a,b){return b.rank!==a.rank?b.rank-a.rank:b.tiebreakerRank-a.tiebreakerRank};return this._cameraTilt>=PRIORITIZE_NEARBY_COLLIDERS_CAMERA_TILT_CUTOFF?Array.from(this.colliders).filter((function(c){return c.enabled&&insideGrid(c,_this2.grid)})).sort((function(a,b){return a.distanceFromCamera-b.distanceFromCamera})).slice(0,50).sort(byRank):Array.from(this.colliders).filter((function(c){return c.enabled&&insideGrid(c,_this2.grid)})).sort(byRank).slice(0,50)}},{key:"step",value:function(){this.grid.clear();var rankedColliders=this.getRankedColliders(),_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this.colliders[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var _collider=_step3.value;_collider.reset(),-1===rankedColliders.indexOf(_collider)?(_collider.publish("hide"),_collider._setIsCurrentlyBeingStepped(!1)):(_collider.publish("show"),this.grid.insert(_collider),_collider._setIsCurrentlyBeingStepped(!0))}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}for(var i=0;i<rankedColliders.length;i++){var collider=rankedColliders[i],collisions=this.grid.getCollisions(collider);collider.publish("collision",collisions)}var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this.colliders[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){_step4.value.publish("update")}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}},{key:"destroy",value:function(){this.grid.destroy(),this.clear()}},{key:"clear",value:function(){this.colliders.clear(),this.grid.clear()}}]),CollisionEngine}();function styleInject(css,ref){void 0===ref&&(ref={});var insertAt=ref.insertAt;if(css&&"undefined"!=typeof document){var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css","top"===insertAt&&head.firstChild?head.insertBefore(style,head.firstChild):head.appendChild(style),style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css))}}CollisionEngine.DEBUG=void 0;styleInject(".mappedin-pin-marker {\n  transition: opacity 150ms linear, transform 0ms linear;\n  position: absolute;\n  will-change: transform, opacity;\n  border-radius: 50%; }\n\n.mappedin-pin-marker-text {\n  text-shadow: 1px 1px 0px #ffffff, -1px -1px 0px #ffffff, 1px -1px 0px #ffffff, -1px 1px 0px #ffffff;\n  font-family: 'InterUI-Regular', Helvetica, Arial, sans-serif;\n  font-weight: normal;\n  min-height: 15px;\n  font-weight: 500;\n  position: absolute;\n  pointer-events: none;\n  padding: 1px;\n  will-change: transform; }\n\n.mappedin-smart-label-icon__container {\n  top: 3px;\n  left: 1px;\n  position: absolute; }\n  .mappedin-smart-label-icon__container > svg {\n    position: absolute;\n    top: 0px;\n    left: 0px; }\n");var balancetext=createCommonjsModule((function(module){var root,factory;root=commonjsGlobal,factory=function(){var breakMatches,wsnwMatches,wsnwOffset,style,watching={sel:[],el:[]},handlersInitialized=!1,polyfilled=!1;function noop(){}function forEach(elements,callback){Array.prototype.forEach.call(elements,callback)}function NextWS_params(){this.reset()}function isWhiteSpaceNoWrap(index){return wsnwMatches.some((function(range){return range.start<index&&index<range.end}))}function calcNoWrapOffsetsForLine(el,oldWS,lineCharOffset){if(0===lineCharOffset)el.style.whiteSpace=oldWS,wsnwOffset=0,wsnwMatches=[],function recursiveCalcNoWrapOffsetsForLine(el,includeTag){if(el.nodeType===el.ELEMENT_NODE)if("nowrap"===window.getComputedStyle(el).whiteSpace){var len=el.outerHTML.length;wsnwMatches.push({start:wsnwOffset,end:wsnwOffset+len}),wsnwOffset+=len}else forEach(el.childNodes,(function(child){recursiveCalcNoWrapOffsetsForLine(child,!0)})),includeTag&&(wsnwOffset+=el.outerHTML.length-el.innerHTML.length);else el.nodeType===el.COMMENT_NODE?wsnwOffset+=el.length+7:el.nodeType===el.PROCESSING_INSTRUCTION_NODE?wsnwOffset+=el.length+2:wsnwOffset+=el.length}(el,!1),el.style.whiteSpace="nowrap";else{var newMatches=[];wsnwMatches.forEach((function(match){match.start>lineCharOffset&&newMatches.push({start:match.start-lineCharOffset,end:match.end-lineCharOffset})})),wsnwMatches=newMatches}}function justify(el,txt,conWidth){var div,size,tmp,words,wordSpacing;return words=(txt=txt.trim()).split(" ").length,txt+=" ",words<2?txt:((tmp=document.createElement("span")).innerHTML=txt,el.appendChild(tmp),size=tmp.offsetWidth,tmp.parentNode.removeChild(tmp),wordSpacing=Math.floor((conWidth-size)/(words-1)),tmp.style.wordSpacing=wordSpacing+"px",tmp.setAttribute("data-owner","balance-text-justify"),(div=document.createElement("div")).appendChild(tmp),div.innerHTML)}function isBreakChar(txt,index){var match,re=/([^\S\u00a0]|-|\u2014|\u2013|\u00ad)(?![^<]*>)/g;if(!breakMatches)for(breakMatches=[],match=re.exec(txt);null!==match;)isWhiteSpaceNoWrap(match.index)||breakMatches.push(match.index),match=re.exec(txt);return-1!==breakMatches.indexOf(index)}function isBreakOpportunity(txt,index){return 0===index||index===txt.length||isBreakChar(txt,index-1)&&!isBreakChar(txt,index)}function findBreakOpportunity(el,txt,conWidth,desWidth,dir,c,ret){var w;if(txt&&"string"==typeof txt)for(;;){for(;!isBreakOpportunity(txt,c);)c+=dir;if(el.innerHTML=txt.substr(0,c),w=el.offsetWidth,dir<0){if(w<=desWidth||w<=0||0===c)break}else if(desWidth<=w||conWidth<=w||c===txt.length)break;c+=dir}ret.index=c,ret.width=w}function getElementsList(elements){return elements?"string"==typeof elements?document.querySelectorAll(elements):elements.tagName&&elements.querySelectorAll?[elements]:elements:[]}function balanceText(elements){forEach(getElementsList(elements),(function(el){!function(el){var brs=el.querySelectorAll('br[data-owner="balance-text-hyphen"]');forEach(brs,(function(br){br.outerHTML=""})),forEach(brs=el.querySelectorAll('br[data-owner="balance-text"]'),(function(br){br.outerHTML=" "}));var spans=el.querySelectorAll('span[data-owner="balance-text-softhyphen"]');if(spans.length>0&&forEach(spans,(function(span){var textNode=document.createTextNode("­");span.parentNode.insertBefore(textNode,span),span.parentNode.removeChild(span)})),(spans=el.querySelectorAll('span[data-owner="balance-text-justify"]')).length>0){var txt="";forEach(spans,(function(span){txt+=span.textContent,span.parentNode.removeChild(span)})),el.innerHTML=txt}}(el);var oldWS=el.style.whiteSpace,oldFloat=el.style.float,oldDisplay=el.style.display,oldPosition=el.style.position,oldLH=el.style.lineHeight;el.style.lineHeight="normal";var containerWidth=el.offsetWidth,containerHeight=el.offsetHeight;el.style.whiteSpace="nowrap",el.style.float="none",el.style.display="inline",el.style.position="static";var nowrapWidth=el.offsetWidth,nowrapHeight=el.offsetHeight,spaceWidth="pre-wrap"===oldWS?0:function(el,h){var dims,space,container=document.createElement("div");return container.style.display="block",container.style.position="absolute",container.style.bottom=0,container.style.right=0,container.style.width=0,container.style.height=0,container.style.margin=0,container.style.padding=0,container.style.visibility="hidden",container.style.overflow="hidden",(space=document.createElement("span")).style.fontSize="2000px",space.innerHTML="&nbsp;",container.appendChild(space),el.appendChild(container),dims=space.getBoundingClientRect(),container.parentNode.removeChild(container),h/(dims.height/dims.width)}(el,nowrapHeight);if(containerWidth>0&&nowrapWidth>containerWidth&&nowrapWidth<5e3){for(var desiredWidth,le,ge,splitIndex,isSoftHyphen,remainingText=el.innerHTML,newText="",lineText="",shouldJustify=function(el){return"justify"===(el.currentStyle||window.getComputedStyle(el,null)).textAlign}(el),remLines=Math.round(containerHeight/nowrapHeight),lineCharOffset=0;remLines>1;)breakMatches=null,calcNoWrapOffsetsForLine(el,oldWS,lineCharOffset),findBreakOpportunity(el,remainingText,containerWidth,desiredWidth=Math.round((nowrapWidth+spaceWidth)/remLines-spaceWidth),-1,Math.round((remainingText.length+1)/remLines)-1,le=new NextWS_params),ge=new NextWS_params,findBreakOpportunity(el,remainingText,containerWidth,desiredWidth,1,le.index,ge),le.reset(),findBreakOpportunity(el,remainingText,containerWidth,desiredWidth,-1,ge.index,le),splitIndex=0===le.index?ge.index:containerWidth<ge.width||le.index===ge.index||Math.abs(desiredWidth-le.width)<Math.abs(ge.width-desiredWidth)?le.index:ge.index,lineText=remainingText.substr(0,splitIndex).replace(/\s$/,""),(isSoftHyphen=Boolean(lineText.match(/\u00ad$/)))&&(lineText=lineText.replace(/\u00ad$/,'<span data-owner="balance-text-softhyphen">-</span>')),shouldJustify?newText+=justify(el,lineText,containerWidth):(newText+=lineText,newText+=isSoftHyphen||Boolean(lineText.match(/(-|\u2014|\u2013)$/))?'<br data-owner="balance-text-hyphen" />':'<br data-owner="balance-text" />'),remainingText=remainingText.substr(splitIndex),lineCharOffset=splitIndex,remLines--,el.innerHTML=remainingText,nowrapWidth=el.offsetWidth;el.innerHTML=shouldJustify?newText+justify(el,remainingText,containerWidth):newText+remainingText}el.style.whiteSpace=oldWS,el.style.float=oldFloat,el.style.display=oldDisplay,el.style.position=oldPosition,el.style.lineHeight=oldLH}))}function updateWatched(){var selectedElements=getElementsList(watching.sel.join(","));balanceText(Array.prototype.concat.apply(watching.el,selectedElements))}function initHandlers(){var fn,func,threshold,execAsap,timeout;handlersInitialized||(fn=updateWatched,"loading"!==document.readyState?fn():document.addEventListener?document.addEventListener("DOMContentLoaded",fn):document.attachEvent("onreadystatechange",(function(){"loading"!==document.readyState&&fn()})),window.addEventListener("load",updateWatched),window.addEventListener("resize",(func=updateWatched,function(){var obj=this,args=arguments;function delayed(){execAsap||func.apply(obj,args),timeout=null}timeout?clearTimeout(timeout):execAsap&&func.apply(obj,args),timeout=setTimeout(delayed,threshold||100)})),handlersInitialized=!0)}function publicInterface(elements,options){elements?options&&!0===options.watch?function(elements){"string"==typeof elements?watching.sel.push(elements):forEach(getElementsList(elements),(function(el){watching.el.push(el)})),initHandlers(),updateWatched()}(elements):options&&!1===options.watch?function(elements){"string"==typeof elements?watching.sel=watching.sel.filter((function(el){return el!==elements})):(elements=getElementsList(elements),watching.el=watching.el.filter((function(el){return-1===elements.indexOf(el)})))}(elements):balanceText(elements):polyfilled||(watching.sel.push(".balance-text"),initHandlers(),polyfilled=!0)}return NextWS_params.prototype.reset=function(){this.index=0,this.width=0},publicInterface.updateWatched=updateWatched,(style=document.documentElement.style).textWrap||style.WebkitTextWrap||style.MozTextWrap||style.MsTextWrap?(noop.updateWatched=noop,noop):publicInterface},module.exports?module.exports=factory():root.balanceText=factory()})),lodash=createCommonjsModule((function(module,exports){(function(){var FUNC_ERROR_TEXT="Expected a function",PLACEHOLDER="__lodash_placeholder__",wrapFlags=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source),reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/,reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /,reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsOctal=/^0o[0-7]+$/i,reIsUint=/^(?:0|[1-9]\d*)$/,reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,rsComboRange="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",rsBreakRange="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsAstral="[\\ud800-\\udfff]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="[\\u2700-\\u27bf]",rsLower="[a-z\\xdf-\\xf6\\xf8-\\xff]",rsMisc="[^\\ud800-\\udfff"+rsBreakRange+rsDigits+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsNonAstral="[^\\ud800-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",reOptMod="(?:"+rsCombo+"|"+rsFitz+")"+"?",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+("(?:\\u200d(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*"),rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reApos=RegExp("['’]","g"),reComboMark=RegExp(rsCombo,"g"),reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g"),reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+(?:['’](?:d|ll|m|re|s|t|ve))?",rsUpper+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)","\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",rsDigits,rsEmoji].join("|"),"g"),reHasUnicode=RegExp("[\\u200d\\ud800-\\udfff"+rsComboRange+"\\ufe0e\\ufe0f]"),reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeParseFloat=parseFloat,freeParseInt=parseInt,freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function addMapEntry(map,pair){return map.set(pair[0],pair[1]),map}function addSetEntry(set,value){return set.add(value),set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=null==array?0:array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}function arrayEachRight(array,iteratee){for(var length=null==array?0:array.length;length--&&!1!==iteratee(array[length],length,array););return array}function arrayEvery(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}function arrayIncludes(array,value){return!!(null==array?0:array.length)&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){for(var index=-1,length=null==array?0:array.length;++index<length;)if(comparator(value,array[index]))return!0;return!1}function arrayMap(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}var asciiSize=baseProperty("length");function baseFindKey(collection,predicate,eachFunc){var result;return eachFunc(collection,(function(value,key,collection){if(predicate(value,key,collection))return result=key,!1})),result}function baseFindIndex(array,predicate,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?1:-1);fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){return value==value?function(array,value,fromIndex){var index=fromIndex-1,length=array.length;for(;++index<length;)if(array[index]===value)return index;return-1}(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){for(var index=fromIndex-1,length=array.length;++index<length;)if(comparator(array[index],value))return index;return-1}function baseIsNaN(value){return value!=value}function baseMean(array,iteratee){var length=null==array?0:array.length;return length?baseSum(array,iteratee)/length:NaN}function baseProperty(key){return function(object){return null==object?void 0:object[key]}}function basePropertyOf(object){return function(key){return null==object?void 0:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){return eachFunc(collection,(function(value,index,collection){accumulator=initAccum?(initAccum=!1,value):iteratee(accumulator,value,index,collection)})),accumulator}function baseSum(array,iteratee){for(var result,index=-1,length=array.length;++index<length;){var current=iteratee(array[index]);void 0!==current&&(result=void 0===result?current:result+current)}return result}function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,(function(key){return object[key]}))}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){for(var index=-1,length=strSymbols.length;++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function charsEndIndex(strSymbols,chrSymbols){for(var index=strSymbols.length;index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function countHolders(array,placeholder){for(var length=array.length,result=0;length--;)array[length]===placeholder&&++result;return result}var deburrLetter=basePropertyOf({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),escapeHtmlChar=basePropertyOf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function hasUnicode(string){return reHasUnicode.test(string)}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach((function(value,key){result[++index]=[key,value]})),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=0,result=[];++index<length;){var value=array[index];value!==placeholder&&value!==PLACEHOLDER||(array[index]=PLACEHOLDER,result[resIndex++]=index)}return result}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=value})),result}function setToPairs(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=[value,value]})),result}function stringSize(string){return hasUnicode(string)?function(string){var result=reUnicode.lastIndex=0;for(;reUnicode.test(string);)++result;return result}(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?function(string){return string.match(reUnicode)||[]}(string):function(string){return string.split("")}(string)}var unescapeHtmlChar=basePropertyOf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var _=function runInContext(context){var uid,Array=(context=null==context?root:_.defaults(root.Object(),context,_.pick(root,contextProps))).Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=context["__core-js_shared__"],funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",nativeObjectToString=objectProto.toString,objectCtorString=funcToString.call(Object),oldDash=root._,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?context.Buffer:void 0,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:void 0,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:void 0,symIterator=Symbol?Symbol.iterator:void 0,symToStringTag=Symbol?Symbol.toStringTag:void 0,defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}(),ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout,nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse,DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create"),metaMap=WeakMap&&new WeakMap,realNames={},dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;var result=new object;return object.prototype=void 0,result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value,this.__actions__=[],this.__chain__=!!chainAll,this.__index__=0,this.__values__=void 0}function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:void 0}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){(void 0!==value&&!eq(object[key],value)||void 0===value&&!(key in object))&&baseAssignValue(object,key,value)}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||baseAssignValue(object,key,value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,(function(value,key,collection){setter(accumulator,value,iteratee(value),collection)})),accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}function baseAt(object,paths){for(var index=-1,length=paths.length,result=Array(length),skip=null==object;++index<length;)result[index]=skip?void 0:get(object,paths[index]);return result}function baseClamp(number,lower,upper){return number==number&&(void 0!==upper&&(number=number<=upper?number:upper),void 0!==lower&&(number=number>=lower?number:lower)),number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=1&bitmask,isFlat=2&bitmask,isFull=4&bitmask;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=function(array){var length=array.length,result=array.constructor(length);length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input);return result}(value),!isDeep)return copyArray(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return cloneBuffer(value,isDeep);if(tag==objectTag||tag==argsTag||isFunc&&!object){if(result=isFlat||isFunc?{}:initCloneObject(value),!isDeep)return isFlat?function(source,object){return copyObject(source,getSymbolsIn(source),object)}(value,function(object,source){return object&&copyObject(source,keysIn(source),object)}(result,value)):function(source,object){return copyObject(source,getSymbols(source),object)}(value,baseAssign(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=function(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return function(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case"[object Uint8ClampedArray]":case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return function(map,isDeep,cloneFunc){return arrayReduce(isDeep?cloneFunc(mapToArray(map),1):mapToArray(map),addMapEntry,new map.constructor)}(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return function(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}(object);case setTag:return function(set,isDeep,cloneFunc){return arrayReduce(isDeep?cloneFunc(setToArray(set),1):setToArray(set),addSetEntry,new set.constructor)}(object,isDeep,cloneFunc);case symbolTag:return symbol=object,symbolValueOf?Object(symbolValueOf.call(symbol)):{}}var symbol}(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;stack.set(value,result);var props=isArr?void 0:(isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys)(value);return arrayEach(props||value,(function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))})),result}function baseConformsTo(object,source,props){var length=props.length;if(null==object)return!length;for(object=Object(object);length--;){var key=props[length],predicate=source[key],value=object[key];if(void 0===value&&!(key in object)||!predicate(value))return!1}return!0}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout((function(){func.apply(void 0,args)}),wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):values.length>=200&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:for(;++index<length;){var value=array[index],computed=null==iteratee?value:iteratee(value);if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=function(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0},Hash.prototype.delete=function(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result},Hash.prototype.get=function(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function(){this.__data__=[],this.size=0},ListCache.prototype.delete=function(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)},ListCache.prototype.get=function(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this},MapCache.prototype.clear=function(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result},MapCache.prototype.get=function(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function(value){return this.__data__.has(value)},Stack.prototype.clear=function(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result},Stack.prototype.get=function(key){return this.__data__.get(key)},Stack.prototype.has=function(key){return this.__data__.has(key)},Stack.prototype.set=function(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this};var baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0);function baseEvery(collection,predicate){var result=!0;return baseEach(collection,(function(value,index,collection){return result=!!predicate(value,index,collection)})),result}function baseExtremum(array,iteratee,comparator){for(var index=-1,length=array.length;++index<length;){var value=array[index],current=iteratee(value);if(null!=current&&(void 0===computed?current==current&&!isSymbol(current):comparator(current,computed)))var computed=current,result=value}return result}function baseFilter(collection,predicate){var result=[];return baseEach(collection,(function(value,index,collection){predicate(value,index,collection)&&result.push(value)})),result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var baseFor=createBaseFor(),baseForRight=createBaseFor(!0);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,(function(key){return isFunction(object[key])}))}function baseGet(object,path){for(var index=0,length=(path=castPath(path,object)).length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:void 0}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?function(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]);return result}(value):function(value){return nativeObjectToString.call(value)}(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return null!=object&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return null!=object&&key in Object(object)}function baseIntersection(arrays,iteratee,comparator){for(var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=1/0,result=[];othIndex--;){var array=arrays[othIndex];othIndex&&iteratee&&(array=arrayMap(array,baseUnary(iteratee))),maxLength=nativeMin(array.length,maxLength),caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):void 0}array=arrays[0];var index=-1,seen=caches[0];outer:for(;++index<length&&result.length<maxLength;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){for(othIndex=othLength;--othIndex;){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator)))continue outer}seen&&seen.push(computed),result.push(value)}}return result}function baseInvoke(object,path,args){var func=null==(object=parent(object,path=castPath(path,object)))?object:object[toKey(last(path))];return null==func?void 0:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!=value&&other!=other:function(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other),objIsObj=(objTag=objTag==argsTag?objectTag:objTag)==objectTag,othIsObj=(othTag=othTag==argsTag?objectTag:othTag)==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):function(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=1&bitmask;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=2,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case symbolTag:if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(1&bitmask)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag)return!1;return stack||(stack=new Stack),function(object,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,objProps=getAllKeys(object),objLength=objProps.length,othLength=getAllKeys(other).length;if(objLength!=othLength&&!isPartial)return!1;var index=objLength;for(;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var stacked=stack.get(object);if(stacked&&stack.get(other))return stacked==other;var result=!0;stack.set(object,other),stack.set(other,object);var skipCtor=isPartial;for(;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor==othCtor||!("constructor"in object)||!("constructor"in other)||"function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor||(result=!1)}return stack.delete(object),stack.delete(other),result}(object,other,bitmask,customizer,equalFunc,stack)}(value,other,bitmask,customizer,baseIsEqual,stack))}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=Object(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){var key=(data=matchData[index])[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var stack=new Stack;if(customizer)var result=customizer(objValue,srcValue,key,object,source,stack);if(!(void 0===result?baseIsEqual(srcValue,objValue,3,customizer,stack):result))return!1}}return!0}function baseIsNative(value){return!(!isObject(value)||(func=value,maskSrcKey&&maskSrcKey in func))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value));var func}function baseIteratee(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}function baseKeys(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}function baseKeysIn(object){if(!isObject(object))return function(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}(object);var isProto=isPrototype(object),result=[];for(var key in object)("constructor"!=key||!isProto&&hasOwnProperty.call(object,key))&&result.push(key);return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,(function(value,key,collection){result[++index]=iteratee(value,key,collection)})),result}function baseMatches(source){var matchData=getMatchData(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=get(object,path);return void 0===objValue&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,3)}}function baseMerge(object,source,srcIndex,customizer,stack){object!==source&&baseFor(source,(function(srcValue,key){if(isObject(srcValue))stack||(stack=new Stack),function(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked)return void assignMergeValue(object,key,stacked);var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):void 0,isCommon=void 0===newValue;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue,isArr||isBuff||isTyped?isArray(objValue)?newValue=objValue:isArrayLikeObject(objValue)?newValue=copyArray(objValue):isBuff?(isCommon=!1,newValue=cloneBuffer(srcValue,!0)):isTyped?(isCommon=!1,newValue=cloneTypedArray(srcValue,!0)):newValue=[]:isPlainObject(srcValue)||isArguments(srcValue)?(newValue=objValue,isArguments(objValue)?newValue=toPlainObject(objValue):(!isObject(objValue)||srcIndex&&isFunction(objValue))&&(newValue=initCloneObject(srcValue))):isCommon=!1}isCommon&&(stack.set(srcValue,newValue),mergeFunc(newValue,srcValue,srcIndex,customizer,stack),stack.delete(srcValue));assignMergeValue(object,key,newValue)}(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):void 0;void 0===newValue&&(newValue=srcValue),assignMergeValue(object,key,newValue)}}),keysIn)}function baseNth(array,n){var length=array.length;if(length)return isIndex(n+=n<0?length:0,length)?array[n]:void 0}function baseOrderBy(collection,iteratees,orders){var index=-1;return iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee())),function(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}(baseMap(collection,(function(value,key,collection){return{criteria:arrayMap(iteratees,(function(iteratee){return iteratee(value)})),index:++index,value:value}})),(function(object,other){return function(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;for(;++index<length;){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength)return result;var order=orders[index];return result*("desc"==order?-1:1)}}return object.index-other.index}(object,other,orders)}))}function basePickBy(object,paths,predicate){for(var index=-1,length=paths.length,result={};++index<length;){var path=paths[index],value=baseGet(object,path);predicate(value,path)&&baseSet(result,castPath(path,object),value)}return result}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;for(array===values&&(values=copyArray(values)),iteratee&&(seen=arrayMap(array,baseUnary(iteratee)));++index<length;)for(var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;(fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1;)seen!==array&&splice.call(seen,fromIndex,1),splice.call(array,fromIndex,1);return array}function basePullAt(array,indexes){for(var length=array?indexes.length:0,lastIndex=length-1;length--;){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;isIndex(index)?splice.call(array,index,1):baseUnset(array,index)}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRepeat(string,n){var result="";if(!string||n<1||n>9007199254740991)return result;do{n%2&&(result+=string),(n=nativeFloor(n/2))&&(string+=string)}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object))return object;for(var index=-1,length=(path=castPath(path,object)).length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];void 0===(newValue=customizer?customizer(objValue,key,nested):void 0)&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}var baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity,baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:identity;function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;start<0&&(start=-start>length?0:length+start),(end=end>length?length:end)<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,(function(value,index,collection){return!(result=predicate(value,index,collection))})),!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=null==array?low:array.length;if("number"==typeof value&&value==value&&high<=2147483647){for(;low<high;){var mid=low+high>>>1,computed=array[mid];null!==computed&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)?low=mid+1:high=mid}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=null==array?0:array.length,valIsNaN=value!=value,valIsNull=null===value,valIsSymbol=isSymbol(value),valIsUndefined=void 0===value;low<high;){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=void 0!==computed,othIsNull=null===computed,othIsReflexive=computed==computed,othIsSymbol=isSymbol(computed);if(valIsNaN)var setLow=retHighest||othIsReflexive;else setLow=valIsUndefined?othIsReflexive&&(retHighest||othIsDefined):valIsNull?othIsReflexive&&othIsDefined&&(retHighest||!othIsNull):valIsSymbol?othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol):!othIsNull&&!othIsSymbol&&(retHighest?computed<=value:computed<value);setLow?low=mid+1:high=mid}return nativeMin(high,4294967294)}function baseSortedUniq(array,iteratee){for(var index=-1,length=array.length,resIndex=0,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=0===value?0:value}}return result}function baseToNumber(value){return"number"==typeof value?value:isSymbol(value)?NaN:+value}function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=200){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}function baseUnset(object,path){return null==(object=parent(object,path=castPath(path,object)))||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;return result instanceof LazyWrapper&&(result=result.value()),arrayReduce(actions,(function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))}),result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2)return length?baseUniq(arrays[0]):[];for(var index=-1,result=Array(length);++index<length;)for(var array=arrays[index],othIndex=-1;++othIndex<length;)othIndex!=index&&(result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator));return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){for(var index=-1,length=props.length,valsLength=values.length,result={};++index<length;){var value=index<valsLength?values[index]:void 0;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return"function"==typeof value?value:identity}function castPath(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;return end=void 0===end?length:end,!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep)return buffer.slice();var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);return buffer.copy(result),result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=void 0!==value,valIsNull=null===value,valIsReflexive=value==value,valIsSymbol=isSymbol(value),othIsDefined=void 0!==other,othIsNull=null===other,othIsReflexive=other==other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive)return 1;if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive)return-1}return 0}function composeArgs(args,partials,holders,isCurried){for(var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)(isUncurried||argsIndex<argsLength)&&(result[holders[argsIndex]]=args[argsIndex]);for(;rangeLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders,isCurried){for(var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;++argsIndex<rangeLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)(isUncurried||argsIndex<argsLength)&&(result[offset+holders[holdersIndex]]=args[argsIndex++]);return result}function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;void 0===newValue&&(newValue=source[key]),isNew?baseAssignValue(object,key,newValue):assignValue(object,key,newValue)}return object}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest((function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:void 0,guard=length>2?sources[2]:void 0;for(customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):void 0,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?void 0:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object}))}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}function createCaseFirst(methodName){return function(string){var strSymbols=hasUnicode(string=toString(string))?stringToArray(string):void 0,chr=strSymbols?strSymbols[0]:string.charAt(0),trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection),predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:void 0}}function createFlow(fromRight){return flatRest((function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;for(fromRight&&funcs.reverse();index--;){var func=funcs[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(prereq&&!wrapper&&"wrapper"==getFuncName(func))var wrapper=new LodashWrapper([],!0)}for(index=wrapper?index:length;++index<length;){var funcName=getFuncName(func=funcs[index]),data="wrapper"==funcName?getData(func):void 0;wrapper=data&&isLaziable(data[0])&&424==data[1]&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value))return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}}))}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=128&bitmask,isBind=1&bitmask,isBindKey=2&bitmask,isCurried=24&bitmask,isFlip=512&bitmask,Ctor=isBindKey?void 0:createCtor(func);return function wrapper(){for(var length=arguments.length,args=Array(length),index=length;index--;)args[index]=arguments[index];if(isCurried)var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder);if(partials&&(args=composeArgs(args,partials,holders,isCurried)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight,isCurried)),length-=holdersCount,isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return length=args.length,argPos?args=reorder(args,argPos):isFlip&&length>1&&args.reverse(),isAry&&ary<length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtor(fn)),fn.apply(thisBinding,args)}}function createInverter(setter,toIteratee){return function(object,iteratee){return function(object,setter,iteratee,accumulator){return baseForOwn(object,(function(value,key,object){setter(accumulator,iteratee(value),key,object)})),accumulator}(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(void 0===value&&void 0===other)return defaultValue;if(void 0!==value&&(result=value),void 0!==other){if(void 0===result)return other;"string"==typeof value||"string"==typeof other?(value=baseToString(value),other=baseToString(other)):(value=baseToNumber(value),other=baseToNumber(other)),result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest((function(iteratees){return iteratees=arrayMap(iteratees,baseUnary(getIteratee())),baseRest((function(args){var thisArg=this;return arrayFunc(iteratees,(function(iteratee){return apply(iteratee,thisArg,args)}))}))}))}function createPadding(length,chars){var charsLength=(chars=void 0===chars?" ":baseToString(chars)).length;if(charsLength<2)return charsLength?baseRepeat(chars,length):chars;var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createRange(fromRight){return function(start,end,step){return step&&"number"!=typeof step&&isIterateeCall(start,end,step)&&(end=step=void 0),start=toFinite(start),void 0===end?(end=start,start=0):end=toFinite(end),function(start,end,step,fromRight){for(var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);length--;)result[fromRight?length:++index]=start,start+=step;return result}(start,end,step=void 0===step?start<end?1:-1:toFinite(step),fromRight)}}function createRelationalOperation(operator){return function(value,other){return"string"==typeof value&&"string"==typeof other||(value=toNumber(value),other=toNumber(other)),operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=8&bitmask;bitmask|=isCurry?32:64,4&(bitmask&=~(isCurry?64:32))||(bitmask&=-4);var newData=[func,bitmask,thisArg,isCurry?partials:void 0,isCurry?holders:void 0,isCurry?void 0:partials,isCurry?void 0:holders,argPos,ary,arity],result=wrapFunc.apply(void 0,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){if(number=toNumber(number),precision=null==precision?0:nativeMin(toInteger(precision),292)){var pair=(toString(number)+"e").split("e");return+((pair=(toString(func(pair[0]+"e"+(+pair[1]+precision)))+"e").split("e"))[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=Set&&1/setToArray(new Set([,-0]))[1]==1/0?function(values){return new Set(values)}:noop;function createToPairs(keysFunc){return function(object){var tag=getTag(object);return tag==mapTag?mapToArray(object):tag==setTag?setToPairs(object):function(object,props){return arrayMap(props,(function(key){return[key,object[key]]}))}(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=2&bitmask;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=-97,partials=holders=void 0),ary=void 0===ary?ary:nativeMax(toInteger(ary),0),arity=void 0===arity?arity:toInteger(arity),length-=holders?holders.length:0,64&bitmask){var partialsRight=partials,holdersRight=holders;partials=holders=void 0}var data=isBindKey?void 0:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&function(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<131,isCombo=128==srcBitmask&&8==bitmask||128==srcBitmask&&256==bitmask&&data[7].length<=source[8]||384==srcBitmask&&source[7].length<=source[8]&&8==bitmask;if(!isCommon&&!isCombo)return data;1&srcBitmask&&(data[2]=source[2],newBitmask|=1&bitmask?0:4);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value,data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}(value=source[5])&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):value,data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]);(value=source[7])&&(data[7]=value);128&srcBitmask&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8]));null==data[9]&&(data[9]=source[9]);data[0]=source[0],data[1]=newBitmask}(newData,data),func=newData[0],bitmask=newData[1],thisArg=newData[2],partials=newData[3],holders=newData[4],!(arity=newData[9]=void 0===newData[9]?isBindKey?0:func.length:nativeMax(newData[9]-length,0))&&24&bitmask&&(bitmask&=-25),bitmask&&1!=bitmask)result=8==bitmask||16==bitmask?function(func,bitmask,arity){var Ctor=createCtor(func);return function wrapper(){for(var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);index--;)args[index]=arguments[index];var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);if((length-=holders.length)<arity)return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,void 0,args,holders,void 0,void 0,arity-length);var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}}(func,bitmask,arity):32!=bitmask&&33!=bitmask||holders.length?createHybrid.apply(void 0,newData):function(func,bitmask,thisArg,partials){var isBind=1&bitmask,Ctor=createCtor(func);return function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return apply(fn,isBind?thisArg:this,args)}}(func,bitmask,thisArg,partials);else var result=function(func,bitmask,thisArg){var isBind=1&bitmask,Ctor=createCtor(func);return function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}}(func,bitmask,thisArg);return setWrapToString((data?baseSetData:setData)(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){return void 0===objValue||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)?srcValue:objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){return isObject(objValue)&&isObject(srcValue)&&(stack.set(srcValue,objValue),baseMerge(objValue,srcValue,void 0,customDefaultsMerge,stack),stack.delete(srcValue)),objValue}function customOmitClone(value){return isPlainObject(value)?void 0:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked&&stack.get(other))return stacked==other;var index=-1,result=!0,seen=2&bitmask?new SetCache:void 0;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,(function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)}))){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}function flatRest(func){return setToString(overRest(func,void 0,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=metaMap?function(func){return metaMap.get(func)}:noop;function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getHolder(func){return(hasOwnProperty.call(lodash,"placeholder")?lodash:func).placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;return result=result===iteratee?baseIteratee:result,arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var value,type,data=map.__data__;return("string"==(type=typeof(value=key))||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value)?data["string"==typeof key?"string":"hash"]:data.map}function getMatchData(object){for(var result=keys(object),length=result.length;length--;){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=function(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}var getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),arrayFilter(nativeGetSymbols(object),(function(symbol){return propertyIsEnumerable.call(object,symbol)})))}:stubArray,getSymbolsIn=nativeGetSymbols?function(object){for(var result=[];object;)arrayPush(result,getSymbols(object)),object=getPrototype(object);return result}:stubArray,getTag=baseGetTag;function hasPath(object,path,hasFunc){for(var index=-1,length=(path=castPath(path,object)).length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneObject(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:baseCreate(getPrototype(object))}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}function isKey(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return result});var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function isStrictComparable(value){return value==value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){return null!=object&&(object[key]===srcValue&&(void 0!==srcValue||key in Object(object)))}}function overRest(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:void 0}return array}var setData=shortOut(baseSetData),setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)},setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,function(source,details){var length=details.length;if(!length)return source;var lastIndex=length-1;return details[lastIndex]=(length>1?"& ":"")+details[lastIndex],details=details.join(length>2?", ":" "),source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}(source,function(details,bitmask){return arrayEach(wrapFlags,(function(pair){var value="_."+pair[0];bitmask&pair[1]&&!arrayIncludes(details,value)&&details.push(value)})),details.sort()}(function(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=800)return arguments[0]}else count=0;return func.apply(void 0,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;for(size=void 0===size?length:size;++index<size;){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index],array[index]=value}return array.length=size,array}var stringToPath=function(func){var result=memoize(func,(function(key){return 500===cache.size&&cache.clear(),key})),cache=result.cache;return result}((function(string){var result=[];return reLeadingDot.test(string)&&result.push(""),string.replace(rePropName,(function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)})),result}));function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper)return wrapper.clone();var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);return result.__actions__=copyArray(wrapper.__actions__),result.__index__=wrapper.__index__,result.__values__=wrapper.__values__,result}var difference=baseRest((function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0)):[]})),differenceBy=baseRest((function(array,values){var iteratee=last(values);return isArrayLikeObject(iteratee)&&(iteratee=void 0),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),getIteratee(iteratee,2)):[]})),differenceWith=baseRest((function(array,values){var comparator=last(values);return isArrayLikeObject(comparator)&&(comparator=void 0),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),void 0,comparator):[]}));function findIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length-1;return void 0!==fromIndex&&(index=toInteger(fromIndex),index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)),baseFindIndex(array,getIteratee(predicate,3),index,!0)}function flatten(array){return(null==array?0:array.length)?baseFlatten(array,1):[]}function head(array){return array&&array.length?array[0]:void 0}var intersection=baseRest((function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]})),intersectionBy=baseRest((function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return iteratee===last(mapped)?iteratee=void 0:mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]})),intersectionWith=baseRest((function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return(comparator="function"==typeof comparator?comparator:void 0)&&mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,void 0,comparator):[]}));function last(array){var length=null==array?0:array.length;return length?array[length-1]:void 0}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}var pullAt=flatRest((function(array,indexes){var length=null==array?0:array.length,result=baseAt(array,indexes);return basePullAt(array,arrayMap(indexes,(function(index){return isIndex(index,length)?+index:index})).sort(compareAscending)),result}));function reverse(array){return null==array?array:nativeReverse.call(array)}var union=baseRest((function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0))})),unionBy=baseRest((function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=void 0),baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),getIteratee(iteratee,2))})),unionWith=baseRest((function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:void 0,baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),void 0,comparator)}));function unzip(array){if(!array||!array.length)return[];var length=0;return array=arrayFilter(array,(function(group){if(isArrayLikeObject(group))return length=nativeMax(group.length,length),!0})),baseTimes(length,(function(index){return arrayMap(array,baseProperty(index))}))}function unzipWith(array,iteratee){if(!array||!array.length)return[];var result=unzip(array);return null==iteratee?result:arrayMap(result,(function(group){return apply(iteratee,void 0,group)}))}var without=baseRest((function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]})),xor=baseRest((function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))})),xorBy=baseRest((function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=void 0),baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))})),xorWith=baseRest((function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:void 0,baseXor(arrayFilter(arrays,isArrayLikeObject),void 0,comparator)})),zip=baseRest(unzip);var zipWith=baseRest((function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:void 0;return iteratee="function"==typeof iteratee?(arrays.pop(),iteratee):void 0,unzipWith(arrays,iteratee)}));function chain(value){var result=lodash(value);return result.__chain__=!0,result}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest((function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};return!(length>1||this.__actions__.length)&&value instanceof LazyWrapper&&isIndex(start)?((value=value.slice(start,+start+(length?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:void 0}),new LodashWrapper(value,this.__chain__).thru((function(array){return length&&!array.length&&array.push(void 0),array}))):this.thru(interceptor)}));var countBy=createAggregator((function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:baseAssignValue(result,key,1)}));var find=createFind(findIndex),findLast=createFind(findLastIndex);function forEach(collection,iteratee){return(isArray(collection)?arrayEach:baseEach)(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){return(isArray(collection)?arrayEachRight:baseEachRight)(collection,getIteratee(iteratee,3))}var groupBy=createAggregator((function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):baseAssignValue(result,key,[value])}));var invokeMap=baseRest((function(collection,path,args){var index=-1,isFunc="function"==typeof path,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,(function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)})),result})),keyBy=createAggregator((function(result,value,key){baseAssignValue(result,key,value)}));function map(collection,iteratee){return(isArray(collection)?arrayMap:baseMap)(collection,getIteratee(iteratee,3))}var partition=createAggregator((function(result,value,key){result[key?0:1].push(value)}),(function(){return[[],[]]}));var sortBy=baseRest((function(collection,iteratees){if(null==collection)return[];var length=iteratees.length;return length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])?iteratees=[]:length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])&&(iteratees=[iteratees[0]]),baseOrderBy(collection,baseFlatten(iteratees,1),[])})),now=ctxNow||function(){return root.Date.now()};function ary(func,n,guard){return n=guard?void 0:n,createWrap(func,128,void 0,void 0,void 0,void 0,n=func&&null==n?func.length:n)}function before(n,func){var result;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){return--n>0&&(result=func.apply(this,arguments)),n<=1&&(func=void 0),result}}var bind=baseRest((function(func,thisArg,partials){var bitmask=1;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=32}return createWrap(func,bitmask,thisArg,partials,holders)})),bindKey=baseRest((function(object,key,partials){var bitmask=3;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=32}return createWrap(key,bitmask,object,partials,holders)}));function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function(time){var result=wait-(time-lastCallTime);return maxing?nativeMin(result,maxWait-(time-lastInvokeTime)):result}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return leadingEdge(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function(){return void 0===timerId?result:trailingEdge(now())},debounced}var defer=baseRest((function(func,args){return baseDelay(func,1,args)})),delay=baseRest((function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)}));function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}memoize.Cache=MapCache;var overArgs=castRest((function(func,transforms){var funcsLength=(transforms=1==transforms.length&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()))).length;return baseRest((function(args){for(var index=-1,length=nativeMin(args.length,funcsLength);++index<length;)args[index]=transforms[index].call(this,args[index]);return apply(func,this,args)}))})),partial=baseRest((function(func,partials){return createWrap(func,32,void 0,partials,replaceHolders(partials,getHolder(partial)))})),partialRight=baseRest((function(func,partials){return createWrap(func,64,void 0,partials,replaceHolders(partials,getHolder(partialRight)))})),rearg=flatRest((function(func,indexes){return createWrap(func,256,void 0,void 0,void 0,indexes)}));function eq(value,other){return value===other||value!=value&&other!=other}var gt=createRelationalOperation(baseGt),gte=createRelationalOperation((function(value,other){return value>=other})),isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")},isArray=Array.isArray,isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):function(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag};function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var isBuffer=nativeIsBuffer||stubFalse,isDate=nodeIsDate?baseUnary(nodeIsDate):function(value){return isObjectLike(value)&&baseGetTag(value)==dateTag};function isError(value){if(!isObjectLike(value))return!1;var tag=baseGetTag(value);return tag==errorTag||"[object DOMException]"==tag||"string"==typeof value.message&&"string"==typeof value.name&&!isPlainObject(value)}function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag}function isInteger(value){return"number"==typeof value&&value==toInteger(value)}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function isObjectLike(value){return null!=value&&"object"==typeof value}var isMap=nodeIsMap?baseUnary(nodeIsMap):function(value){return isObjectLike(value)&&getTag(value)==mapTag};function isNumber(value){return"number"==typeof value||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag)return!1;var proto=getPrototype(value);if(null===proto)return!0;var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):function(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag};var isSet=nodeIsSet?baseUnary(nodeIsSet):function(value){return isObjectLike(value)&&getTag(value)==setTag};function isString(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):function(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]};var lt=createRelationalOperation(baseLt),lte=createRelationalOperation((function(value,other){return value<=other}));function toArray(value){if(!value)return[];if(isArrayLike(value))return isString(value)?stringToArray(value):copyArray(value);if(symIterator&&value[symIterator])return function(iterator){for(var data,result=[];!(data=iterator.next()).done;)result.push(data.value);return result}(value[symIterator]());var tag=getTag(value);return(tag==mapTag?mapToArray:tag==setTag?setToArray:values)(value)}function toFinite(value){return value?(value=toNumber(value))===1/0||value===-1/0?17976931348623157e292*(value<0?-1:1):value==value?value:0:0===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result==result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,4294967295):0}function toNumber(value){if("number"==typeof value)return value;if(isSymbol(value))return NaN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toString(value){return null==value?"":baseToString(value)}var assign=createAssigner((function(object,source){if(isPrototype(source)||isArrayLike(source))copyObject(source,keys(source),object);else for(var key in source)hasOwnProperty.call(source,key)&&assignValue(object,key,source[key])})),assignIn=createAssigner((function(object,source){copyObject(source,keysIn(source),object)})),assignInWith=createAssigner((function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)})),assignWith=createAssigner((function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)})),at=flatRest(baseAt);var defaults=baseRest((function(args){return args.push(void 0,customDefaultsAssignIn),apply(assignInWith,void 0,args)})),defaultsDeep=baseRest((function(args){return args.push(void 0,customDefaultsMerge),apply(mergeWith,void 0,args)}));function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,path);return void 0===result?defaultValue:result}function hasIn(object,path){return null!=object&&hasPath(object,path,baseHasIn)}var invert=createInverter((function(result,value,key){result[value]=key}),constant(identity)),invertBy=createInverter((function(result,value,key){hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]}),getIteratee),invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}var merge=createAssigner((function(object,source,srcIndex){baseMerge(object,source,srcIndex)})),mergeWith=createAssigner((function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)})),omit=flatRest((function(object,paths){var result={};if(null==object)return result;var isDeep=!1;paths=arrayMap(paths,(function(path){return path=castPath(path,object),isDeep||(isDeep=path.length>1),path})),copyObject(object,getAllKeysIn(object),result),isDeep&&(result=baseClone(result,7,customOmitClone));for(var length=paths.length;length--;)baseUnset(result,paths[length]);return result}));var pick=flatRest((function(object,paths){return null==object?{}:function(object,paths){return basePickBy(object,paths,(function(value,path){return hasIn(object,path)}))}(object,paths)}));function pickBy(object,predicate){if(null==object)return{};var props=arrayMap(getAllKeysIn(object),(function(prop){return[prop]}));return predicate=getIteratee(predicate),basePickBy(object,props,(function(value,path){return predicate(value,path[0])}))}var toPairs=createToPairs(keys),toPairsIn=createToPairs(keysIn);function values(object){return null==object?[]:baseValues(object,keys(object))}var camelCase=createCompounder((function(result,word,index){return word=word.toLowerCase(),result+(index?capitalize(word):word)}));function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){return(string=toString(string))&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}var kebabCase=createCompounder((function(result,word,index){return result+(index?"-":"")+word.toLowerCase()})),lowerCase=createCompounder((function(result,word,index){return result+(index?" ":"")+word.toLowerCase()})),lowerFirst=createCaseFirst("toLowerCase");var snakeCase=createCompounder((function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}));var startCase=createCompounder((function(result,word,index){return result+(index?" ":"")+upperFirst(word)}));var upperCase=createCompounder((function(result,word,index){return result+(index?" ":"")+word.toUpperCase()})),upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){return string=toString(string),void 0===(pattern=guard?void 0:pattern)?function(string){return reHasUnicodeWord.test(string)}(string)?function(string){return string.match(reUnicodeWord)||[]}(string):function(string){return string.match(reAsciiWord)||[]}(string):string.match(pattern)||[]}var attempt=baseRest((function(func,args){try{return apply(func,void 0,args)}catch(e){return isError(e)?e:new Error(e)}})),bindAll=flatRest((function(object,methodNames){return arrayEach(methodNames,(function(key){key=toKey(key),baseAssignValue(object,key,bind(object[key],object))})),object}));function constant(value){return function(){return value}}var flow=createFlow(),flowRight=createFlow(!0);function identity(value){return value}function iteratee(func){return baseIteratee("function"==typeof func?func:baseClone(func,1))}var method=baseRest((function(path,args){return function(object){return baseInvoke(object,path,args)}})),methodOf=baseRest((function(object,args){return function(path){return baseInvoke(object,path,args)}}));function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);null!=options||isObject(source)&&(methodNames.length||!props.length)||(options=source,source=object,object=this,methodNames=baseFunctions(source,keys(source)));var chain=!(isObject(options)&&"chain"in options&&!options.chain),isFunc=isFunction(object);return arrayEach(methodNames,(function(methodName){var func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);return actions.push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))})})),object}function noop(){}var over=createOver(arrayMap),overEvery=createOver(arrayEvery),overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):function(path){return function(object){return baseGet(object,path)}}(path)}var range=createRange(),rangeRight=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}var add=createMathOperation((function(augend,addend){return augend+addend}),0),ceil=createRound("ceil"),divide=createMathOperation((function(dividend,divisor){return dividend/divisor}),1),floor=createRound("floor");var source,multiply=createMathOperation((function(multiplier,multiplicand){return multiplier*multiplicand}),1),round=createRound("round"),subtract=createMathOperation((function(minuend,subtrahend){return minuend-subtrahend}),0);return lodash.after=function(n,func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){if(--n<1)return func.apply(this,arguments)}},lodash.ary=ary,lodash.assign=assign,lodash.assignIn=assignIn,lodash.assignInWith=assignInWith,lodash.assignWith=assignWith,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.castArray=function(){if(!arguments.length)return[];var value=arguments[0];return isArray(value)?value:[value]},lodash.chain=chain,lodash.chunk=function(array,size,guard){size=(guard?isIterateeCall(array,size,guard):void 0===size)?1:nativeMax(toInteger(size),0);var length=null==array?0:array.length;if(!length||size<1)return[];for(var index=0,resIndex=0,result=Array(nativeCeil(length/size));index<length;)result[resIndex++]=baseSlice(array,index,index+=size);return result},lodash.compact=function(array){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];value&&(result[resIndex++]=value)}return result},lodash.concat=function(){var length=arguments.length;if(!length)return[];for(var args=Array(length-1),array=arguments[0],index=length;index--;)args[index-1]=arguments[index];return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))},lodash.cond=function(pairs){var length=null==pairs?0:pairs.length,toIteratee=getIteratee();return pairs=length?arrayMap(pairs,(function(pair){if("function"!=typeof pair[1])throw new TypeError(FUNC_ERROR_TEXT);return[toIteratee(pair[0]),pair[1]]})):[],baseRest((function(args){for(var index=-1;++index<length;){var pair=pairs[index];if(apply(pair[0],this,args))return apply(pair[1],this,args)}}))},lodash.conforms=function(source){return function(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}(baseClone(source,1))},lodash.constant=constant,lodash.countBy=countBy,lodash.create=function(prototype,properties){var result=baseCreate(prototype);return null==properties?result:baseAssign(result,properties)},lodash.curry=function curry(func,arity,guard){var result=createWrap(func,8,void 0,void 0,void 0,void 0,void 0,arity=guard?void 0:arity);return result.placeholder=curry.placeholder,result},lodash.curryRight=function curryRight(func,arity,guard){var result=createWrap(func,16,void 0,void 0,void 0,void 0,void 0,arity=guard?void 0:arity);return result.placeholder=curryRight.placeholder,result},lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.differenceBy=differenceBy,lodash.differenceWith=differenceWith,lodash.drop=function(array,n,guard){var length=null==array?0:array.length;return length?baseSlice(array,(n=guard||void 0===n?1:toInteger(n))<0?0:n,length):[]},lodash.dropRight=function(array,n,guard){var length=null==array?0:array.length;return length?baseSlice(array,0,(n=length-(n=guard||void 0===n?1:toInteger(n)))<0?0:n):[]},lodash.dropRightWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0,!0):[]},lodash.dropWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0):[]},lodash.fill=function(array,value,start,end){var length=null==array?0:array.length;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),function(array,value,start,end){var length=array.length;for((start=toInteger(start))<0&&(start=-start>length?0:length+start),(end=void 0===end||end>length?length:toInteger(end))<0&&(end+=length),end=start>end?0:toLength(end);start<end;)array[start++]=value;return array}(array,value,start,end)):[]},lodash.filter=function(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,getIteratee(predicate,3))},lodash.flatMap=function(collection,iteratee){return baseFlatten(map(collection,iteratee),1)},lodash.flatMapDeep=function(collection,iteratee){return baseFlatten(map(collection,iteratee),1/0)},lodash.flatMapDepth=function(collection,iteratee,depth){return depth=void 0===depth?1:toInteger(depth),baseFlatten(map(collection,iteratee),depth)},lodash.flatten=flatten,lodash.flattenDeep=function(array){return(null==array?0:array.length)?baseFlatten(array,1/0):[]},lodash.flattenDepth=function(array,depth){return(null==array?0:array.length)?baseFlatten(array,depth=void 0===depth?1:toInteger(depth)):[]},lodash.flip=function(func){return createWrap(func,512)},lodash.flow=flow,lodash.flowRight=flowRight,lodash.fromPairs=function(pairs){for(var index=-1,length=null==pairs?0:pairs.length,result={};++index<length;){var pair=pairs[index];result[pair[0]]=pair[1]}return result},lodash.functions=function(object){return null==object?[]:baseFunctions(object,keys(object))},lodash.functionsIn=function(object){return null==object?[]:baseFunctions(object,keysIn(object))},lodash.groupBy=groupBy,lodash.initial=function(array){return(null==array?0:array.length)?baseSlice(array,0,-1):[]},lodash.intersection=intersection,lodash.intersectionBy=intersectionBy,lodash.intersectionWith=intersectionWith,lodash.invert=invert,lodash.invertBy=invertBy,lodash.invokeMap=invokeMap,lodash.iteratee=iteratee,lodash.keyBy=keyBy,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=function(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,(function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)})),result},lodash.mapValues=function(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,(function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))})),result},lodash.matches=function(source){return baseMatches(baseClone(source,1))},lodash.matchesProperty=function(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,1))},lodash.memoize=memoize,lodash.merge=merge,lodash.mergeWith=mergeWith,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=function(n){return n=toInteger(n),baseRest((function(args){return baseNth(args,n)}))},lodash.omit=omit,lodash.omitBy=function(object,predicate){return pickBy(object,negate(getIteratee(predicate)))},lodash.once=function(func){return before(2,func)},lodash.orderBy=function(collection,iteratees,orders,guard){return null==collection?[]:(isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),isArray(orders=guard?void 0:orders)||(orders=null==orders?[]:[orders]),baseOrderBy(collection,iteratees,orders))},lodash.over=over,lodash.overArgs=overArgs,lodash.overEvery=overEvery,lodash.overSome=overSome,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=function(object){return function(path){return null==object?void 0:baseGet(object,path)}},lodash.pull=pull,lodash.pullAll=pullAll,lodash.pullAllBy=function(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array},lodash.pullAllWith=function(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,void 0,comparator):array},lodash.pullAt=pullAt,lodash.range=range,lodash.rangeRight=rangeRight,lodash.rearg=rearg,lodash.reject=function(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,negate(getIteratee(predicate,3)))},lodash.remove=function(array,predicate){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getIteratee(predicate,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result},lodash.rest=function(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return baseRest(func,start=void 0===start?start:toInteger(start))},lodash.reverse=reverse,lodash.sampleSize=function(collection,n,guard){return n=(guard?isIterateeCall(collection,n,guard):void 0===n)?1:toInteger(n),(isArray(collection)?arraySampleSize:baseSampleSize)(collection,n)},lodash.set=function(object,path,value){return null==object?object:baseSet(object,path,value)},lodash.setWith=function(object,path,value,customizer){return customizer="function"==typeof customizer?customizer:void 0,null==object?object:baseSet(object,path,value,customizer)},lodash.shuffle=function(collection){return(isArray(collection)?arrayShuffle:baseShuffle)(collection)},lodash.slice=function(array,start,end){var length=null==array?0:array.length;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)?(start=0,end=length):(start=null==start?0:toInteger(start),end=void 0===end?length:toInteger(end)),baseSlice(array,start,end)):[]},lodash.sortBy=sortBy,lodash.sortedUniq=function(array){return array&&array.length?baseSortedUniq(array):[]},lodash.sortedUniqBy=function(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]},lodash.split=function(string,separator,limit){return limit&&"number"!=typeof limit&&isIterateeCall(string,separator,limit)&&(separator=limit=void 0),(limit=void 0===limit?4294967295:limit>>>0)?(string=toString(string))&&("string"==typeof separator||null!=separator&&!isRegExp(separator))&&!(separator=baseToString(separator))&&hasUnicode(string)?castSlice(stringToArray(string),0,limit):string.split(separator,limit):[]},lodash.spread=function(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=null==start?0:nativeMax(toInteger(start),0),baseRest((function(args){var array=args[start],otherArgs=castSlice(args,0,start);return array&&arrayPush(otherArgs,array),apply(func,this,otherArgs)}))},lodash.tail=function(array){var length=null==array?0:array.length;return length?baseSlice(array,1,length):[]},lodash.take=function(array,n,guard){return array&&array.length?baseSlice(array,0,(n=guard||void 0===n?1:toInteger(n))<0?0:n):[]},lodash.takeRight=function(array,n,guard){var length=null==array?0:array.length;return length?baseSlice(array,(n=length-(n=guard||void 0===n?1:toInteger(n)))<0?0:n,length):[]},lodash.takeRightWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!1,!0):[]},lodash.takeWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]},lodash.tap=function(value,interceptor){return interceptor(value),value},lodash.throttle=function(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})},lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=toPairs,lodash.toPairsIn=toPairsIn,lodash.toPath=function(value){return isArray(value)?arrayMap(value,toKey):isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))},lodash.toPlainObject=toPlainObject,lodash.transform=function(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);if(iteratee=getIteratee(iteratee,4),null==accumulator){var Ctor=object&&object.constructor;accumulator=isArrLike?isArr?new Ctor:[]:isObject(object)&&isFunction(Ctor)?baseCreate(getPrototype(object)):{}}return(isArrLike?arrayEach:baseForOwn)(object,(function(value,index,object){return iteratee(accumulator,value,index,object)})),accumulator},lodash.unary=function(func){return ary(func,1)},lodash.union=union,lodash.unionBy=unionBy,lodash.unionWith=unionWith,lodash.uniq=function(array){return array&&array.length?baseUniq(array):[]},lodash.uniqBy=function(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]},lodash.uniqWith=function(array,comparator){return comparator="function"==typeof comparator?comparator:void 0,array&&array.length?baseUniq(array,void 0,comparator):[]},lodash.unset=function(object,path){return null==object||baseUnset(object,path)},lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=function(object,path,updater){return null==object?object:baseUpdate(object,path,castFunction(updater))},lodash.updateWith=function(object,path,updater,customizer){return customizer="function"==typeof customizer?customizer:void 0,null==object?object:baseUpdate(object,path,castFunction(updater),customizer)},lodash.values=values,lodash.valuesIn=function(object){return null==object?[]:baseValues(object,keysIn(object))},lodash.without=without,lodash.words=words,lodash.wrap=function(value,wrapper){return partial(castFunction(wrapper),value)},lodash.xor=xor,lodash.xorBy=xorBy,lodash.xorWith=xorWith,lodash.zip=zip,lodash.zipObject=function(props,values){return baseZipObject(props||[],values||[],assignValue)},lodash.zipObjectDeep=function(props,values){return baseZipObject(props||[],values||[],baseSet)},lodash.zipWith=zipWith,lodash.entries=toPairs,lodash.entriesIn=toPairsIn,lodash.extend=assignIn,lodash.extendWith=assignInWith,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.ceil=ceil,lodash.clamp=function(number,lower,upper){return void 0===upper&&(upper=lower,lower=void 0),void 0!==upper&&(upper=(upper=toNumber(upper))==upper?upper:0),void 0!==lower&&(lower=(lower=toNumber(lower))==lower?lower:0),baseClamp(toNumber(number),lower,upper)},lodash.clone=function(value){return baseClone(value,4)},lodash.cloneDeep=function(value){return baseClone(value,5)},lodash.cloneDeepWith=function(value,customizer){return baseClone(value,5,customizer="function"==typeof customizer?customizer:void 0)},lodash.cloneWith=function(value,customizer){return baseClone(value,4,customizer="function"==typeof customizer?customizer:void 0)},lodash.conformsTo=function(object,source){return null==source||baseConformsTo(object,source,keys(source))},lodash.deburr=deburr,lodash.defaultTo=function(value,defaultValue){return null==value||value!=value?defaultValue:value},lodash.divide=divide,lodash.endsWith=function(string,target,position){string=toString(string),target=baseToString(target);var length=string.length,end=position=void 0===position?length:baseClamp(toInteger(position),0,length);return(position-=target.length)>=0&&string.slice(position,end)==target},lodash.eq=eq,lodash.escape=function(string){return(string=toString(string))&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string},lodash.escapeRegExp=function(string){return(string=toString(string))&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string},lodash.every=function(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=void 0),func(collection,getIteratee(predicate,3))},lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=function(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)},lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=function(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)},lodash.floor=floor,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=function(object,iteratee){return null==object?object:baseFor(object,getIteratee(iteratee,3),keysIn)},lodash.forInRight=function(object,iteratee){return null==object?object:baseForRight(object,getIteratee(iteratee,3),keysIn)},lodash.forOwn=function(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))},lodash.forOwnRight=function(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))},lodash.get=get,lodash.gt=gt,lodash.gte=gte,lodash.has=function(object,path){return null!=object&&hasPath(object,path,baseHas)},lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=function(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection),fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;return fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1},lodash.indexOf=function(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseIndexOf(array,value,index)},lodash.inRange=function(number,start,end){return start=toFinite(start),void 0===end?(end=start,start=0):end=toFinite(end),function(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}(number=toNumber(number),start,end)},lodash.invoke=invoke,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isArrayBuffer=isArrayBuffer,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=function(value){return!0===value||!1===value||isObjectLike(value)&&baseGetTag(value)==boolTag},lodash.isBuffer=isBuffer,lodash.isDate=isDate,lodash.isElement=function(value){return isObjectLike(value)&&1===value.nodeType&&!isPlainObject(value)},lodash.isEmpty=function(value){if(null==value)return!0;if(isArrayLike(value)&&(isArray(value)||"string"==typeof value||"function"==typeof value.splice||isBuffer(value)||isTypedArray(value)||isArguments(value)))return!value.length;var tag=getTag(value);if(tag==mapTag||tag==setTag)return!value.size;if(isPrototype(value))return!baseKeys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0},lodash.isEqual=function(value,other){return baseIsEqual(value,other)},lodash.isEqualWith=function(value,other,customizer){var result=(customizer="function"==typeof customizer?customizer:void 0)?customizer(value,other):void 0;return void 0===result?baseIsEqual(value,other,void 0,customizer):!!result},lodash.isError=isError,lodash.isFinite=function(value){return"number"==typeof value&&nativeIsFinite(value)},lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=isMap,lodash.isMatch=function(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))},lodash.isMatchWith=function(object,source,customizer){return customizer="function"==typeof customizer?customizer:void 0,baseIsMatch(object,source,getMatchData(source),customizer)},lodash.isNaN=function(value){return isNumber(value)&&value!=+value},lodash.isNative=function(value){if(isMaskable(value))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return baseIsNative(value)},lodash.isNil=function(value){return null==value},lodash.isNull=function(value){return null===value},lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isSafeInteger=function(value){return isInteger(value)&&value>=-9007199254740991&&value<=9007199254740991},lodash.isSet=isSet,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=isTypedArray,lodash.isUndefined=function(value){return void 0===value},lodash.isWeakMap=function(value){return isObjectLike(value)&&getTag(value)==weakMapTag},lodash.isWeakSet=function(value){return isObjectLike(value)&&"[object WeakSet]"==baseGetTag(value)},lodash.join=function(array,separator){return null==array?"":nativeJoin.call(array,separator)},lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=function(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length;return void 0!==fromIndex&&(index=(index=toInteger(fromIndex))<0?nativeMax(length+index,0):nativeMin(index,length-1)),value==value?function(array,value,fromIndex){for(var index=fromIndex+1;index--;)if(array[index]===value)return index;return index}(array,value,index):baseFindIndex(array,baseIsNaN,index,!0)},lodash.lowerCase=lowerCase,lodash.lowerFirst=lowerFirst,lodash.lt=lt,lodash.lte=lte,lodash.max=function(array){return array&&array.length?baseExtremum(array,identity,baseGt):void 0},lodash.maxBy=function(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):void 0},lodash.mean=function(array){return baseMean(array,identity)},lodash.meanBy=function(array,iteratee){return baseMean(array,getIteratee(iteratee,2))},lodash.min=function(array){return array&&array.length?baseExtremum(array,identity,baseLt):void 0},lodash.minBy=function(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):void 0},lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=function(){return{}},lodash.stubString=function(){return""},lodash.stubTrue=function(){return!0},lodash.multiply=multiply,lodash.nth=function(array,n){return array&&array.length?baseNth(array,toInteger(n)):void 0},lodash.noConflict=function(){return root._===this&&(root._=oldDash),this},lodash.noop=noop,lodash.now=now,lodash.pad=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;if(!length||strLength>=length)return string;var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)},lodash.padEnd=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string},lodash.padStart=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string},lodash.parseInt=function(string,radix,guard){return guard||null==radix?radix=0:radix&&(radix=+radix),nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)},lodash.random=function(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=void 0),void 0===floating&&("boolean"==typeof upper?(floating=upper,upper=void 0):"boolean"==typeof lower&&(floating=lower,lower=void 0)),void 0===lower&&void 0===upper?(lower=0,upper=1):(lower=toFinite(lower),void 0===upper?(upper=lower,lower=0):upper=toFinite(upper)),lower>upper){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)},lodash.reduce=function(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)},lodash.reduceRight=function(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)},lodash.repeat=function(string,n,guard){return n=(guard?isIterateeCall(string,n,guard):void 0===n)?1:toInteger(n),baseRepeat(toString(string),n)},lodash.replace=function(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])},lodash.result=function(object,path,defaultValue){var index=-1,length=(path=castPath(path,object)).length;for(length||(length=1,object=void 0);++index<length;){var value=null==object?void 0:object[toKey(path[index])];void 0===value&&(index=length,value=defaultValue),object=isFunction(value)?value.call(object):value}return object},lodash.round=round,lodash.runInContext=runInContext,lodash.sample=function(collection){return(isArray(collection)?arraySample:baseSample)(collection)},lodash.size=function(collection){if(null==collection)return 0;if(isArrayLike(collection))return isString(collection)?stringSize(collection):collection.length;var tag=getTag(collection);return tag==mapTag||tag==setTag?collection.size:baseKeys(collection).length},lodash.snakeCase=snakeCase,lodash.some=function(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=void 0),func(collection,getIteratee(predicate,3))},lodash.sortedIndex=function(array,value){return baseSortedIndex(array,value)},lodash.sortedIndexBy=function(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))},lodash.sortedIndexOf=function(array,value){var length=null==array?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value))return index}return-1},lodash.sortedLastIndex=function(array,value){return baseSortedIndex(array,value,!0)},lodash.sortedLastIndexBy=function(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),!0)},lodash.sortedLastIndexOf=function(array,value){if(null==array?0:array.length){var index=baseSortedIndex(array,value,!0)-1;if(eq(array[index],value))return index}return-1},lodash.startCase=startCase,lodash.startsWith=function(string,target,position){return string=toString(string),position=null==position?0:baseClamp(toInteger(position),0,string.length),target=baseToString(target),string.slice(position,position+target.length)==target},lodash.subtract=subtract,lodash.sum=function(array){return array&&array.length?baseSum(array,identity):0},lodash.sumBy=function(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0},lodash.template=function(string,options,guard){var settings=lodash.templateSettings;guard&&isIterateeCall(string,options,guard)&&(options=void 0),string=toString(string),options=assignInWith({},options,settings,customDefaultsAssignIn);var isEscaping,isEvaluating,imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,(function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match})),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt((function(){return Function(importsKeys,sourceURL+"return "+source).apply(void 0,importsValues)}));if(result.source=source,isError(result))throw result;return result},lodash.times=function(n,iteratee){if((n=toInteger(n))<1||n>9007199254740991)return[];var index=4294967295,length=nativeMin(n,4294967295);n-=4294967295;for(var result=baseTimes(length,iteratee=getIteratee(iteratee));++index<n;)iteratee(index);return result},lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=function(value){return toString(value).toLowerCase()},lodash.toNumber=toNumber,lodash.toSafeInteger=function(value){return value?baseClamp(toInteger(value),-9007199254740991,9007199254740991):0===value?value:0},lodash.toString=toString,lodash.toUpper=function(value){return toString(value).toUpperCase()},lodash.trim=function(string,chars,guard){if((string=toString(string))&&(guard||void 0===chars))return string.replace(reTrim,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars);return castSlice(strSymbols,charsStartIndex(strSymbols,chrSymbols),charsEndIndex(strSymbols,chrSymbols)+1).join("")},lodash.trimEnd=function(string,chars,guard){if((string=toString(string))&&(guard||void 0===chars))return string.replace(reTrimEnd,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string);return castSlice(strSymbols,0,charsEndIndex(strSymbols,stringToArray(chars))+1).join("")},lodash.trimStart=function(string,chars,guard){if((string=toString(string))&&(guard||void 0===chars))return string.replace(reTrimStart,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string);return castSlice(strSymbols,charsStartIndex(strSymbols,stringToArray(chars))).join("")},lodash.truncate=function(string,options){var length=30,omission="...";if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length,omission="omission"in options?baseToString(options.omission):omission}var strLength=(string=toString(string)).length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength)return string;var end=length-stringSize(omission);if(end<1)return omission;var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(void 0===separator)return result+omission;if(strSymbols&&(end+=result.length-end),isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;for(separator.global||(separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")),separator.lastIndex=0;match=separator.exec(substring);)var newEnd=match.index;result=result.slice(0,void 0===newEnd?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission},lodash.unescape=function(string){return(string=toString(string))&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string},lodash.uniqueId=function(prefix){var id=++idCounter;return toString(prefix)+id},lodash.upperCase=upperCase,lodash.upperFirst=upperFirst,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(source={},baseForOwn(lodash,(function(func,methodName){hasOwnProperty.call(lodash.prototype,methodName)||(source[methodName]=func)})),source),{chain:!1}),lodash.VERSION="4.17.4",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(methodName){lodash[methodName].placeholder=lodash})),arrayEach(["drop","take"],(function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=void 0===n?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();return result.__filtered__?result.__takeCount__=nativeMin(n,result.__takeCount__):result.__views__.push({size:nativeMin(n,4294967295),type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(methodName,index){var type=index+1,isFilter=1==type||3==type;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();return result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type}),result.__filtered__=result.__filtered__||isFilter,result}})),arrayEach(["head","last"],(function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}})),arrayEach(["initial","tail"],(function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()},LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)},LazyWrapper.prototype.invokeMap=baseRest((function(path,args){return"function"==typeof path?new LazyWrapper(this):this.map((function(value){return baseInvoke(value,path,args)}))})),LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))},LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;return result.__filtered__&&(start>0||end<0)?new LazyWrapper(result):(start<0?result=result.takeRight(-start):start&&(result=result.drop(start)),void 0!==end&&(result=(end=toInteger(end))<0?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(4294967295)},baseForOwn(LazyWrapper.prototype,(function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+("last"==methodName?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);lodashFunc&&(lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value),interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push({func:thru,args:[interceptor],thisArg:void 0}),new LodashWrapper(result,chainAll)}return isUnwrapped&&onlyLazy?func.apply(this,args):(result=this.thru(interceptor),isUnwrapped?isTaker?result.value()[0]:result.value():result)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName]((function(value){return func.apply(isArray(value)?value:[],args)}))}})),baseForOwn(LazyWrapper.prototype,(function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"";(realNames[key]||(realNames[key]=[])).push({name:methodName,func:lodashFunc})}})),realNames[createHybrid(void 0,2).name]=[{name:"wrapper",func:void 0}],LazyWrapper.prototype.clone=function(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=copyArray(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=copyArray(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=copyArray(this.__views__),result},LazyWrapper.prototype.reverse=function(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else(result=this.clone()).__dir__*=-1;return result},LazyWrapper.prototype.value=function(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=function(start,end,transforms){var index=-1,length=transforms.length;for(;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length)return baseWrapperValue(array,this.__actions__);var result=[];outer:for(;length--&&resIndex<takeCount;){for(var iterIndex=-1,value=array[index+=dir];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(2==type)value=computed;else if(!computed){if(1==type)continue outer;break outer}}result[resIndex++]=value}return result},lodash.prototype.at=wrapperAt,lodash.prototype.chain=function(){return chain(this)},lodash.prototype.commit=function(){return new LodashWrapper(this.value(),this.__chain__)},lodash.prototype.next=function(){void 0===this.__values__&&(this.__values__=toArray(this.value()));var done=this.__index__>=this.__values__.length;return{done:done,value:done?void 0:this.__values__[this.__index__++]}},lodash.prototype.plant=function(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);clone.__index__=0,clone.__values__=void 0,result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result},lodash.prototype.reverse=function(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),(wrapped=wrapped.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:void 0}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)},lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=function(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash.prototype.first=lodash.prototype.head,symIterator&&(lodash.prototype[symIterator]=function(){return this}),lodash}();freeModule?((freeModule.exports=_)._=_,freeExports._=_):root._=_}).call(commonjsGlobal)})),fastdom=createCommonjsModule((function(module){!function(win){var raf=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||function(cb){return setTimeout(cb,16)};function FastDom(){this.reads=[],this.writes=[],this.raf=raf.bind(win)}function scheduleFlush(fastdom){fastdom.scheduled||(fastdom.scheduled=!0,fastdom.raf(flush.bind(null,fastdom)))}function flush(fastdom){var error,writes=fastdom.writes,reads=fastdom.reads;try{reads.length,runTasks(reads),writes.length,runTasks(writes)}catch(e){error=e}if(fastdom.scheduled=!1,(reads.length||writes.length)&&scheduleFlush(fastdom),error){if(error.message,!fastdom.catch)throw error;fastdom.catch(error)}}function runTasks(tasks){for(var task;task=tasks.shift();)task()}function remove(array,item){var index=array.indexOf(item);return!!~index&&!!array.splice(index,1)}FastDom.prototype={constructor:FastDom,measure:function(fn,ctx){var task=ctx?fn.bind(ctx):fn;return this.reads.push(task),scheduleFlush(this),task},mutate:function(fn,ctx){var task=ctx?fn.bind(ctx):fn;return this.writes.push(task),scheduleFlush(this),task},clear:function(task){return remove(this.reads,task)||remove(this.writes,task)},extend:function(props){if("object"!=typeof props)throw new Error("expected object");var child=Object.create(this);return function(target,source){for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}(child,props),child.fastdom=this,child.initialize&&child.initialize(),child},catch:null};var exports=win.fastdom=win.fastdom||new FastDom;module.exports=exports}("undefined"!=typeof window?window:commonjsGlobal)})),defaultOptions={orientation:null,textSize:12,maxTextDivWidth:150,minTextDivWidth:100,textLines:2,shrinkAmount:0,color:"#000000",markerBuffer:0,textDivHeight:40,textDivWidth:100,textClass:"",activeColor:"white",inactiveColor:"rgb(128,128,128)",markerClass:"",markerSize:16,scale:1},SmartLabelBatchCreator=function(){function SmartLabelBatchCreator(_ref){var _this=this,mapView=_ref.mapView,_ref$debounceDelayMS=_ref.debounceDelayMS,debounceDelayMS=void 0===_ref$debounceDelayMS?100:_ref$debounceDelayMS;_classCallCheck(this,SmartLabelBatchCreator),this.mapView=mapView,this.debounce=lodash.debounce((function(){_this.mapView.container.appendChild(_this.fragment),requestAnimationFrame((function(){_toConsumableArray(_this.polygonToSmartLabel.values()).forEach((function(smartLabel){return smartLabel.postProcessAfterCreation()})),_this.prepareForNewBatch()}))}),debounceDelayMS),this.prepareForNewBatch()}return _createClass(SmartLabelBatchCreator,[{key:"prepareForNewBatch",value:function(){this.fragment=document.createDocumentFragment(),null!=this.polygonToSmartLabel?this.polygonToSmartLabel.clear():this.polygonToSmartLabel=new Map}},{key:"addToBatch",value:function(smartLabel){smartLabel.created&&(this.debounce(),this.fragment.append(smartLabel.markerDiv),this.polygonToSmartLabel.set(smartLabel.polygon.id,smartLabel))}}]),SmartLabelBatchCreator}(),SmartLabel=function(){function SmartLabel(options,mapObject,polygonMeshesById,textLabelsByPolygonId,mapView,collisionPoints,collisionEngine){_classCallCheck(this,SmartLabel),this.styles={east:{textAlign:"left"},north:{textAlign:"center",verticalAlign:"bottom"},west:{textAlign:"right"},marker:{textAlign:"center",verticalAlign:"bottom"}},this._updateAction=null,Object.assign(this,PubSub.prototype),this.collisionEngine=collisionEngine,this.mapObject=mapObject,this.mapView=mapView,this.textLabelsByPolygonId=textLabelsByPolygonId,this.polygonMeshesById=polygonMeshesById,this.collisionPoints=collisionPoints,this.id=options.polygonId,this.polygonId=options.polygonId,this.polygon=options.polygon,this._mPosition=options.position,this._mOriginalPosition=options.position,this.heightAbovePolygon=options.heightAbovePolygon>=0?options.heightAbovePolygon:0,this.label=options.label,this.text=options.shortText||options.text||"",this._mMapId=options.polygon.map||null,this.isActive=options.isActive||!1,this._misHidden=options.hidden||!1,this.currentOrientation=options.orientation,this.color=options.color||"#000000",this.markerBuffer=options.markerBuffer||defaultOptions.markerBuffer,this.originalColor=options.color||"#000000",this.height=options.height,this.collisionsAgainst={},this.screenRenderBuffer=options.screenRenderBuffer||250,this.rank=options.rank||0,this._initialRank=this.rank,this.tiebreakerRank=function(string){for(var hash=3735928559,i=0;i<string.length;++i)hash=4294967295&(hash<<9|hash>>>23),hash^=string.charCodeAt(i);return hash}(this.label||this.text),this.scale=options.scale||defaultOptions.scale,this.createDespiteImage=options.createDespiteImage,this.shrinkAmount=options.shrinkAmount||defaultOptions.shrinkAmount,options.stateText&&(this.text+=" (".concat(options.stateText,")")),this.textSize=options.textSize||defaultOptions.textSize,this.maxTextWidth=options.maxTextDivWidth||defaultOptions.maxTextDivWidth,this.minTextWidth=options.minTextDivWidth||defaultOptions.minTextDivWidth,this.lineHeight=options.lineHeight||1.2*this.textSize,this.textHeight=options.textDivHeight||defaultOptions.textDivHeight,this.textWidth=options.textDivWidth||defaultOptions.textDivWidth,this.textLines=options.textLines||defaultOptions.textLines,this.textClass=options.textClass||defaultOptions.textClass,this.pinColor=options.pinColor||defaultOptions.pinColor,this.activeColor=options.activeColor||defaultOptions.activeColor,this.inactiveColor=options.inactiveColor||defaultOptions.inactiveColor,this.markerClass=options.markerClass||defaultOptions.markerClass,this.markerSize=(options.markerSize||defaultOptions.markerSize)*this.scale,this.options=options,this.m_translateX=0,this.m_translateY=0,this.m_rotateZ=0,this.created=!1,this.isShowing=!1,this._mShowMarker=!1,this._mShowLine=!1,this._mShowLabel=!1,this.type="pin",this.textDiv=null,this.offsets=[],this.previousOrientation=null,this.hasNeverBeenShownYet=!0,this.create=this.create.bind(this),this.destroy=this.destroy.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.setPosition=this.setPosition.bind(this),this.addEventListener=this.addEventListener.bind(this),this.calculateHeightOfPolygon=this.calculateHeightOfPolygon.bind(this),this.setColor=this.setColor.bind(this),this.clearColor=this.clearColor.bind(this),this.setOrientation=throttle(this.setOrientation,options.smartLabelOrientationDelay).bind(this),this.createMarkerDiv=this.createMarkerDiv.bind(this),this.setTransform=this.setTransform.bind(this),this.enable=this.enable.bind(this),this.disable=this.disable.bind(this),this.updateMarkerStyles=this.updateMarkerStyles.bind(this),this.updateTextStyles=this.updateTextStyles.bind(this),this.updateStyles=this.updateStyles.bind(this),this.registerSelf=this.registerSelf.bind(this),this.deregisterSelf=this.deregisterSelf.bind(this),this.updateCollisions=this.updateCollisions.bind(this),this.determineOrientation=this.determineOrientation.bind(this),this.update=this.update.bind(this),this.flipIfNeeded=function(){},this.mapObject.textObjects.push(this)}return _createClass(SmartLabel,[{key:"updateMarkerStyles",value:function(){this.markerDiv&&(this.markerDiv.style.opacity=this._mShowMarker?1:0,this.markerDiv.style.top="0px",this.markerDiv.style.pointerEvents="none",this.markerDiv.style.width="".concat(this.markerSize,"px"),this.markerDiv.style.height="".concat(this.markerSize,"px"))}},{key:"updateTextStyles",value:function(){var _this2=this;if(this.textDiv&&(this.polygon.map!==this.mapView.currentMap&&this._mShowLabel&&(this.textDiv.style.opacity=this._mShowLabel?1:0),this.textDiv.style.opacity=this._mShowLabel?1:0,this.textHeight&&this.orientations)){this.textDiv.style.height="".concat(this.textHeight,"px");var offset=this.orientations[this.currentOrientation||"north"];this.textDiv.style.transform="translate(".concat(offset.x,"px, ").concat(offset.y,"px)");var styles=this.styles[this.currentOrientation||"north"];Object.keys(styles).forEach((function(key){var value=styles[key];_this2.textDiv.style[key]=value}))}}},{key:"enable",value:function(){this.isActive=!0,this.collider&&this.collider.enable(),this._updateAction="show"}},{key:"disable",value:function(){this.isActive=!1,this.collider&&this.collider.disable(),this._updateAction="hide"}},{key:"updateStyles",value:function(){this.updateMarkerStyles(),this.updateTextStyles()}},{key:"setPriority",value:function(newPriority){!function(n){return n>=COLLISION_RANKING_TIERS.OPTIONAL_MINIMUM&&n<=COLLISION_RANKING_TIERS.OPTIONAL_MAXIMUM||n===COLLISION_RANKING_TIERS.MEDIUM||n===COLLISION_RANKING_TIERS.HIGH}(newPriority)?console.warn("Ranking should be one of ",Object.keys(COLLISION_RANKING_TIERS)):(this.hide(),this.deregisterSelf(),this.rank=newPriority,this.registerSelf(),this.show(),this.mapView.tryRendering())}},{key:"resetPriority",value:function(){this.setPriority(this._initialRank)}},{key:"createMarkerDiv",value:function(){var markerDiv=document.createElement("div"),backIcon=drawSVGIcon({type:"smart-label-pin-back",iconWidth:this.markerSize,iconHeight:this.markerSize,color:this.color}),frontIcon=drawSVGIcon({type:"smart-label-pin-front",iconWidth:this.markerSize,iconHeight:this.markerSize,color:this.color}),iconEl='<div class="mappedin-smart-label-icon__container">'.concat(backIcon).concat(frontIcon,"</div>");return markerDiv.innerHTML=iconEl,markerDiv.className="mappedin-pin-marker ".concat(this.polygon.id," ").concat(this.markerClass),markerDiv}},{key:"createTextDiv",value:function(label){var asHTML=arguments.length>1&&void 0!==arguments[1]&&arguments[1],textDiv=document.createElement("div");return asHTML?textDiv.innerHTML=label:textDiv.textContent=label,textDiv.className="mappedin-pin-marker-text ".concat(this.polygon.id," ").concat(this.textClass),textDiv.style.lineHeight="".concat(this.lineHeight,"px"),textDiv.style.fontSize="".concat(this.textSize,"px"),textDiv.style.maxWidth="".concat(this.maxTextWidth,"px"),textDiv.style.minWidth="".concat(this.minTextWidth,"px"),this.markerDiv.appendChild(textDiv),this.registered=this.registerSelf(),textDiv}},{key:"postProcessAfterCreation",value:function(){var _this3=this,textDiv=this.textDiv;fastdom.mutate((function(){!
/**
  shave - Shave is a javascript plugin that truncates multi-line text within a html element based on set max height
  @version v2.5.9
  @link https://github.com/yowainwright/shave#readme
  @author Jeff Wainwright <yowainwright@gmail.com> (jeffry.in)
  @license MIT
**/
function(target,maxHeight){var opts=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(void 0===maxHeight||isNaN(maxHeight))throw Error("maxHeight is required");var els="string"==typeof target?document.querySelectorAll(target):target;if(els){var character=opts.character||"&mldr;",classname=opts.classname||"js-shave",spaces="boolean"!=typeof opts.spaces||opts.spaces,charHtml='<span class="js-shave-char">'.concat(character,"</span>");"length"in els||(els=[els]);for(var i=0;i<els.length;i+=1){var el=els[i],styles=el.style,span=el.querySelector(".".concat(classname)),textProp=void 0===el.textContent?"innerText":"textContent";span&&(el.removeChild(el.querySelector(".js-shave-char")),el[textProp]=el[textProp]);var fullText=el[textProp],words=spaces?fullText.split(" "):fullText;if(!(words.length<2)){var heightStyle=styles.height;styles.height="auto";var maxHeightStyle=styles.maxHeight;if(styles.maxHeight="none",el.offsetHeight<=maxHeight)styles.height=heightStyle,styles.maxHeight=maxHeightStyle;else{for(var max=words.length-1,min=0,pivot=void 0;min<max;)pivot=min+max+1>>1,el[textProp]=spaces?words.slice(0,pivot).join(" "):words.slice(0,pivot),el.insertAdjacentHTML("beforeend",charHtml),el.offsetHeight>maxHeight?max=pivot-1:min=pivot;el[textProp]=spaces?words.slice(0,max).join(" "):words.slice(0,max),el.insertAdjacentHTML("beforeend",charHtml);var diff=spaces?" ".concat(words.slice(max).join(" ")):words.slice(max),shavedText=document.createTextNode(diff),elWithShavedText=document.createElement("span");elWithShavedText.classList.add(classname),elWithShavedText.style.display="none",elWithShavedText.appendChild(shavedText),el.insertAdjacentElement("beforeend",elWithShavedText),styles.height=heightStyle,styles.maxHeight=maxHeightStyle}}}}}(textDiv,_this3.lineHeight*_this3.textLines+5),fastdom.measure((function(){var rect=textDiv.getBoundingClientRect();_this3.textHeight=rect.height,_this3.textWidth=rect.width,fastdom.mutate((function(){_this3.orientations=_this3._calculateOrientations(),_this3.updateCollisionAreas(),_this3.updateStyles(),_this3.mapView.tryRendering()}))}))}))}},{key:"_calculateOrientations",value:function(){var markerSize=this.markerSize,markerBuffer=this.markerBuffer,textWidth=this.textWidth,textHeight=this.textHeight,orientations={};return orientations.north={x:markerSize/2-textWidth/2,y:-1*textHeight-markerBuffer},orientations.east={x:markerSize+markerBuffer,y:markerSize/2+-1*textHeight/2},orientations.west={x:-1*textWidth-markerBuffer,y:markerSize/2-textHeight/2},orientations}},{key:"create",value:function(){var doNotCreate=this.doNotCreate,label=this.label,text=this.text,inactiveColor=this.inactiveColor,created=this.created;if(!doNotCreate&&!created&&(!this.polygonMeshesById[this.polygon.id+"_image"]||this.createDespiteImage)){this.color=inactiveColor,this.polygonHeight=this.calculateHeightOfPolygon();var pinHeight=this.height||this.polygonHeight+this.heightAbovePolygon;this._mPosition.z=pinHeight,this._mOriginalPosition.z=pinHeight,this.height=pinHeight,this.markerDiv=this.createMarkerDiv(),this.textDiv=this.createTextDiv(label||text,!!label),this.updateStyles(),this.created=!0,this.hide()}}},{key:"calculateHeightOfPolygon",value:function(){if(this.polygonMeshesById[this.polygon.id]){var target=this.polygonMeshesById[this.polygon.id];return target.geometry.boundingBox||target.geometry.computeBoundingBox(),target.geometry.boundingBox.max.z}return 0}},{key:"show",value:function(){this.polygon.map===this.mapView.currentMap&&this.isInScreen&&(null!=this._lastTransforms&&this.setTransform(this._lastTransforms,!0),this.isShowing||(this._mShowMarker=!0,this._mShowLabel=!0,this.color=this.activeColor,this.hasNeverBeenShownYet&&(this.hasNeverBeenShownYet=!1,balancetext(this.textDiv)),this.isShowing=!0,this.updateStyles(),this.updateCollisionAreas(),this.mapView.tryRendering()))}},{key:"hide",value:function(){this.isShowing&&(this._mShowLabel=!1,this._mShowMarker=!1,this.polygon.map!==this.mapView.currentMap&&this.deregisterSelf(),this.color=this.inactiveColor,this.isShowing=!1,this.updateStyles(),this.updateCollisionAreas(),this.mapView.tryRendering())}},{key:"updateCollisionAreas",value:function(){if(this.orientations){var textWidth=this.textWidth,textHeight=this.textHeight,markerSize=this.markerSize,markerBuffer=this.markerBuffer,northXY={x:this.orientations.north.x-markerSize/2,y:this.orientations.north.y-markerSize/2},eastXY={x:this.orientations.east.x-markerSize/2,y:this.orientations.east.y-markerSize/2},westXY={x:this.orientations.west.x-markerSize/2,y:this.orientations.west.y-markerSize/2},north=_objectSpread2({w:textWidth,h:textHeight},northXY),east=_objectSpread2({w:textWidth,h:textHeight},eastXY),west=_objectSpread2({w:textWidth,h:textHeight},westXY),marker={w:markerSize+markerBuffer,h:markerSize+markerBuffer,x:-(markerSize+markerBuffer)/2,y:-(markerSize+markerBuffer)/2};north.occupied=null==this.currentOrientation||"north"===this.currentOrientation,east.occupied=null==this.currentOrientation||"east"===this.currentOrientation,west.occupied=null==this.currentOrientation||"west"===this.currentOrientation,this.collider.updateHitAreas({north:north,west:west,east:east,marker:marker})}}},{key:"registerSelf",value:function(){var markerId="".concat(this.polygon.id,"-marker");this.collider=this.collisionEngine.add({hitAreas:{},rank:this.rank,tiebreakerRank:this.tiebreakerRank,id:markerId,userData:{label:this}}),this.collider.update(this.m_translateX,this.m_translateY),this.collider.on("collision",this.updateCollisions),this.collider.on("update",this.update),this.collider.on("hide",this.disable),this.collider.on("show",this.enable)}},{key:"updateCollisions",value:function(collisions){var myCollisions={hasCollided:0,collisionCount:0};if(this.collisionsAgainst.collisionCount>=3)this.determineOrientation(this.collisionsAgainst,this.collisionsAgainst);else{for(var collisionOrientation in collisions){myCollisions[collisionOrientation]=0;for(var i=0;i<collisions[collisionOrientation].length;i++){var _collisions$collision=collisions[collisionOrientation][i],collider=_collisions$collision.collider,hitArea=_collisions$collision.hitArea;if((null==collider.userData.label||collider.userData.label.polygon.map==this.polygon.map)&&(hitArea.occupied&&collider.occupied))if(this.rank<collider.rank||this.rank===collider.rank&&this.tiebreakerRank<=collider.tiebreakerRank)myCollisions[collisionOrientation]||(myCollisions.collisionCount+=1),myCollisions.hasCollided=1,myCollisions[collisionOrientation]=1;else if(null!=collider.userData.label){var collidingLabel=collider.userData.label.collisionsAgainst;collidingLabel.hasCollided=1,collidingLabel.collisionCount||(collidingLabel.collisionCount=0),collidingLabel[collisionOrientation]||(collidingLabel[collisionOrientation]=1,collidingLabel.collisionCount+=1)}}}this.determineOrientation(myCollisions,this.collisionsAgainst)}}},{key:"update",value:function(){switch(this._updateAction){case"show":this.show();break;case"hide":this.hide()}}},{key:"determineOrientation",value:function(collisions,collisionsAgainst){if(collisionsAgainst.hasCollided&&Object.keys(this.orientations).forEach((function(orientation){null==collisions[orientation]&&(collisions[orientation]=collisionsAgainst[orientation])})),collisionsAgainst.marker)this._updateAction="hide";else if(collisions.collisionCount>=3)this._updateAction="hide";else if(this.orientations){var previousOrientation=this.currentOrientation,goalOrientation=null;Object.keys(this.orientations).forEach((function(orientation){collisions[orientation]||null!==goalOrientation&&orientation!==previousOrientation||(goalOrientation=orientation)})),null!==goalOrientation&&this.setOrientation(goalOrientation)}this.hasCollided=0,this.collisionsAgainst={}}},{key:"deregisterSelf",value:function(){this.collider&&(this.collider.off("collision",this.updateCollisions),this.collisionEngine.remove(this.collider))}},{key:"setOrientation",value:function(orientation){var orientationChanged=this.currentOrientation!==orientation;return this.currentOrientation=orientation,this._updateAction="show",orientationChanged&&(this.updateCollisionAreas(),this.updateStyles(),this.mapView.tryRendering()),!0}},{key:"setColor",value:function(textColor){this.textColor=textColor}},{key:"clearColor",value:function(){this.setColor(this.originalColor)}},{key:"setPosition",value:function(position){position&&(this._mPosition=position,this.updateStyles(),this.mapView.tryRendering())}},{key:"setTransform",value:function(transforms){var skipIsShowingCheck=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.polygon.map===this.mapView.currentMap&&!1!==this.isActive){this._lastTransforms=_objectSpread2({},transforms),this.m_translateX=transforms.x,this.m_translateY=transforms.y,this.m_rotateZ=transforms.rotateZ||"",this.m_distanceFromCamera=transforms.distanceFromCamera||0,null!=this.collider&&this.collider.update(this.m_translateX,this.m_translateY,this.m_distanceFromCamera);var translate="translate("+(transforms.x-this.markerSize/2)+"px, "+(transforms.y-this.markerSize/2)+"px)",rotate="rotate("+transforms.rotateZ+"rad)",transform=translate+" "+rotate;return this.markerDiv&&(this.isShowing||skipIsShowingCheck)&&(this.markerDiv.style.transform=transform),this.isInScreen=!0,this.publish("update-position",{x:transforms.x,y:transforms.y,rotateZ:transforms.rotateZ}),!0}}},{key:"removeSelf",value:function(){this.mapView.container.contains(this.markerDiv)&&(this.mapView.container.removeChild(this.markerDiv),this.markerDiv=null,this.textDiv=null),this.deregisterSelf(),this.created?this.mapObject.textObjects=this.mapObject.textObjects.filter((function(object){return object!=this})):this.doNotCreate=!0}},{key:"destroy",value:function(){this.removeSelf()}},{key:"addEventListener",value:function(ev,response){this.markerDiv.addEventListener(ev,response)}}]),SmartLabel}();var DEFAULT_LABEL_SIZING_MARGIN=2,DEFAULT_LABEL_SIZING_HEIGHT_MARGIN=.5,SIZE_IN_METERS=56/1.2,Label=function(){function Label(){_classCallCheck(this,Label),this.x=0,this.y=0,this.width=0,this.height=0,this.layer=null,this.index=null}return _createClass(Label,[{key:"layout",value:function(map,origin,size,rotation,uv,color){var offset,angle=this.canvasBounds.rotation*Math.PI/180,width=this.width*this.pixelsPerMu,height=this.height*this.pixelsPerMu;"left"==this.canvasBounds.align?offset=this.margin:"right"==this.canvasBounds.align?offset=this.canvasBounds.maxWidth-width-this.margin:"center"==this.canvasBounds.align&&(offset=(this.canvasBounds.maxWidth-width-this.margin)/2);var offsetX=offset*Math.cos(angle),offsetY=-offset*Math.sin(angle),index=this.index;origin.setXYZ(index,this.canvasBounds.x-map.width/2+offsetX,-this.canvasBounds.y+map.height/2+offsetY,this.z+.1),size.setXY(index,width,height),rotation.setX(index,angle);var canvas=this.layer.canvas;uv.setXYZW(index,this.x/canvas.width,1-this.y/canvas.height,this.width/canvas.width,this.height/canvas.height),color.setXYZ(index,this.color.r,this.color.g,this.color.b),origin.needsUpdate=!0,size.needsUpdate=!0,rotation.needsUpdate=!0,uv.needsUpdate=!0,color.needsUpdate=!0}}]),Label}(),Slot=function(){function Slot(x,y,width,height){_classCallCheck(this,Slot),this.x=x,this.y=y,this.width=width,this.height=height}return _createClass(Slot,[{key:"leftOverSpace",value:function(glyph){return this.width<glyph.width||this.height<glyph.height?null:this.height*(this.width-glyph.width)+this.width*(this.height-glyph.height)}},{key:"split",value:function(label,spaces,index){label.x=this.x,label.y=this.y,this.width-label.height<16&&this.height-label.height<16?spaces.splice(index,1):this.width===label.width?spaces.splice(index,1,new Slot(this.x,this.y+label.height,this.width,this.height-label.height)):this.height===label.height?spaces.splice(index,1,new Slot(this.x+label.width,this.y,this.width-label.width,this.height)):spaces.splice(index,1,new Slot(this.x+label.width,this.y,this.width-label.width,label.height),new Slot(this.x,this.y+label.height,this.width,this.height-label.height))}}]),Slot}(),AtlasLayer=function(){function AtlasLayer(atlas,map,width,height){_classCallCheck(this,AtlasLayer);for(var power=5;Math.pow(2,power)<height;)power+=1;for(height=Math.pow(2,power),power=10;Math.pow(2,power)<width;)power+=1;width=Math.pow(2,power),this.atlas=atlas,this.map=map,this.canvasWidth=width,this.canvasHeight=height,this.canvas=document.createElement("canvas"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.context=this.canvas.getContext("2d"),this.context.textBaseline="bottom",this.spaces=[new Slot(0,0,this.canvas.width,this.canvas.height)],this.free=[],this.labels=[],this.count=64;var origin=new Float32Array(3*this.count),size=new Float32Array(2*this.count),rotation=new Float32Array(this.count),uv=new Float32Array(4*this.count),color=new Float32Array(3*this.count);this.uv=new InstancedBufferAttribute(uv,4,!1,1),this.uv.setArray(uv),this.uv.needsUpdate=!0,this.origin=new InstancedBufferAttribute(origin,3,!1,1),this.origin.setArray(origin),this.origin.needsUpdate=!0,this.size=new InstancedBufferAttribute(size,2,!1,1),this.size.setArray(size),this.size.needsUpdate=!0,this.rotation=new InstancedBufferAttribute(rotation,1,!1,1),this.rotation.setArray(rotation),this.rotation.needsUpdate=!0,this.color=new InstancedBufferAttribute(color,3,!0,1),this.color.setArray(color),this.color.needsUpdate=!0;for(var i=0;i<this.count;i++)this.zero(i);var positions=new Float32Array([0,0,0,0,1,0,1,1,0,1,0,0]);this.geometry=new InstancedBufferGeometry,this.geometry.setIndex([0,3,1,3,2,1]),this.geometry.addAttribute("position",new BufferAttribute(positions,3)),this.geometry.addAttribute("size",this.size),this.geometry.addAttribute("origin",this.origin),this.geometry.addAttribute("rotation",this.rotation),this.geometry.addAttribute("uv",this.uv),this.geometry.addAttribute("color",this.color),this.texture=new CanvasTexture(this.canvas),this.texture.anisotropy=16,this.material=new RawShaderMaterial,this.material.vertexShader="attribute vec2 position;attribute vec3 origin;attribute vec2 size;attribute float rotation;attribute vec4 uv;attribute vec3 color;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;varying vec2 vUV;varying vec3 vColor;void main(){vec4 mapDirectionVector=vec4(0,1,0,0)*viewMatrix*modelMatrix;float mapDirection=atan(mapDirectionVector.y,mapDirectionVector.x);float cosRotation=cos(rotation);float sinRotation=sin(rotation);mat4 rotationMatrix=mat4(vec4(cosRotation,-sinRotation,0.0,0.0),vec4(sinRotation,cosRotation,0.0,0.0),vec4(0.0,0.0,1.0,0.0),vec4(0.0,0.0,0.0,1.0));mat4 translate=mat4(vec4(1,0,0,0),vec4(0,1,0,0),vec4(0,0,1,0),vec4(origin,1));gl_Position=projectionMatrix*viewMatrix*modelMatrix*translate*rotationMatrix*(vec4(position*size-vec2(0,size.y/2.0),0,1));vec2 uvStart=uv.xy;vec2 uvSize=uv.zw;if(sin(mapDirection+rotation)>0.0){vUV=position*uvSize+vec2(uvStart.x,uvStart.y-uvSize.y);}else{vUV=(vec2(1,1)-position)*uvSize+vec2(uvStart.x,uvStart.y-uvSize.y);}vColor=color;}",this.material.fragmentShader="precision mediump float;uniform sampler2D textureLabel;varying vec2 vUV;varying vec3 vColor;void main(){gl_FragColor=texture2D(textureLabel,vUV);gl_FragColor.rgb=vColor;}",this.material.uniforms={textureLabel:{value:this.texture}},this.material.transparent=!0,this.mesh=new Mesh(this.geometry,this.material),this.obj=new Object3D,this.obj.add(this.mesh),this.obj.frustumCulled=!1,this.mesh.frustumCulled=!1,this.map.add(this.obj)}return _createClass(AtlasLayer,[{key:"space",value:function(){return this.spaces.map((function(x){return x.width*x.height})).reduce((function(x,y){return x+y}))}},{key:"zero",value:function(index){this.origin.array[3*index+0]=0,this.origin.array[3*index+1]=0,this.origin.array[3*index+2]=0,this.size.array[2*index+0]=0,this.size.array[2*index+1]=0,this.rotation.array[index]=0,this.uv.array[4*index+0]=0,this.uv.array[4*index+1]=0,this.uv.array[4*index+2]=0,this.uv.array[4*index+3]=0,this.color.array[3*index+0]=0,this.color.array[3*index+1]=0,this.color.array[3*index+2]=0,this.origin.needsUpdate=!0,this.size.needsUpdate=!0,this.rotation.needsUpdate=!0,this.uv.needsUpdate=!0,this.color.needsUpdate=!0}},{key:"findSpace",value:function(label){if(0!=this.free.length&&this.labels.length==this.count)return!1;for(var best=-1,i=0;i<this.spaces.length;i++){var space=this.spaces[i].leftOverSpace(label);null!==space&&((-1===best||this.spaces[i].leftOverSpace(label)<space)&&(best=i))}return-1!==best&&(this.spaces[best].split(label,this.spaces,best),label.layer=this,0===this.free.length?(label.index=this.labels.length,this.labels.push(label)):(label.index=this.free.pop(),this.labels[label.index]=label)),-1!=best}},{key:"remove",value:function(label){if(void 0!==label.index){this.zero(label.index),this.context.clearRect(label.x,label.y,label.width,label.height),this.spaces.push(new Slot(label.x,label.y,label.width,label.height)),this.free.push(label.index),this.labels[label.index]=null;var empty=!0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.labels[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var iLabel=_step.value;if(!(empty=empty&&null!=iLabel))break}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}empty&&this.atlas.removeLayer(this)}}},{key:"render",value:function(label){this.context.save(),this.context.rect(label.x+1,label.y+1,label.width-2,label.height-2),this.context.clip(),this.context.font=label.size+"px "+label.font;var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=label.lines[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var line=_step2.value;this.context.fillText(line.text,line.x+label.x+4,line.y+label.y+line.height+4)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}this.texture.needsUpdate=!0,this.context.restore()}},{key:"onWebGLContextRestored",value:function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.context=this.canvas.getContext("2d"),this.context.textBaseline="bottom",this.texture=new CanvasTexture(this.canvas),this.texture.anisotropy=16,this.material.uniforms.textureLabel.value=this.texture;var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this.labels[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var label=_step3.value;null!=label&&this.render(label)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose(),this.texture.dispose()}}]),AtlasLayer}(),Atlas=function(){function Atlas(){_classCallCheck(this,Atlas),this.layers=[],this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return _createClass(Atlas,[{key:"addLabel",value:function(map,lines,font,size,scope,pixelsPerScale){var height=0,width=0,_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=lines[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var line=_step4.value;width=Math.max(Math.ceil(line.width+line.x),width),height=Math.max(Math.ceil(line.height+line.y),height)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}var layer,label=new Label;label.map=map,label.width=width+8,label.height=height+8,label.lines=lines,label.font=font,label.size=size,label.canvasBounds=scope.canvasBounds,label.margin=scope.margin,label.heightMargin=scope.heightMargin,label.pixelsPerMu=pixelsPerScale,label.z=scope.height,label.view=scope,label.color=scope.color;var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=this.layers[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){if((layer=_step5.value).map===map){if(layer.findSpace(label))break;layer=null}else layer=null}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}if(null==layer){if(layer=new AtlasLayer(this,map,label.width,label.height),this.layers.push(layer),!layer.findSpace(label))return;this.layers.sort((function(a,b){return b.space()-a.space()}))}return layer.render(label),label.layout(map.mapClass,layer.origin,layer.size,layer.rotation,layer.uv,layer.color),label.layer=layer,label}},{key:"removeLayer",value:function(layer){var index=this.layers.indexOf(layer);-1!=index&&this.layers.splice(index,1)}},{key:"measure",value:function(text,font,size){return this.context.font=size+"px "+font,this.context.measureText(text)}},{key:"onWebGLContextRestored",value:function(){var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=this.layers[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){_step6.value.onWebGLContextRestored()}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}}},{key:"dispose",value:function(){var _iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=this.layers[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){_step7.value.dispose()}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorNormalCompletion7||null==_iterator7.return||_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}}}]),Atlas}(),AtlasTextLabel=function(){function AtlasTextLabel(options,venue,mapObject,DEFAULT_FONT,polygonMeshesById,textLabelsByPolygonId,mapView,scope,atlas){_classCallCheck(this,AtlasTextLabel);var polygon=getObject(options.polygon,venue.polygons);this.text=(options.shortText||options.text).trim(),this.stateText=options.stateText?" ("+options.stateText+")":"",this.font=options.font||DEFAULT_FONT,this.atlas=atlas,this.canvasBounds=options.canvasBounds||polygon.canvasBounds,this.mapScale=mapObject.getMapScale()||1,this.margin=(options.margin||DEFAULT_LABEL_SIZING_MARGIN)*this.mapScale,this.heightMargin=(options.heightMargin||DEFAULT_LABEL_SIZING_HEIGHT_MARGIN)*this.mapScale,this.scaleMin=options.scaleMin||.25,this.scaleStep=options.scaleStep>0?options.scaleStep:.25,this.multiline=null==options.multiline||options.multiline,this.height=Number(options.height)||null,this.polygonMeshesById=polygonMeshesById,this.polyId=options.polygonId||getObjectId(options.polygon,venue.polygons),this.map=mapObject,this.color=new Color(options.color||scope.colors.text||0),this.baseColor=this.color,this.hideOnCreate=!1,this.hoverLabelText=options.text.trim(),this.fontSize=options.fontSize*this.mapScale||options.size*SIZE_IN_METERS||56,this.hoverLabelMode=options.hoverLabelMode3D||HoverLabel.MODES.ALL,this.hoverLabelClass=options.hoverLabelClass||"mMapviewHoverLabel",this.showHoverLabel=this.hoverLabelMode==HoverLabel.MODES.ALL||this.hoverLabelMode==HoverLabel.MODES.NO_TEXT_LABEL_ONLY,this.hoverIfLabelFails=this.hoverLabelMode==HoverLabel.MODES.ALL||this.hoverLabelMode==HoverLabel.MODES.NO_TEXT_LABEL_ONLY,this.textLabelsByPolygonId=textLabelsByPolygonId,this.map.textObjects.push(this)}return _createClass(AtlasTextLabel,[{key:"create",value:function(){var scope=this;if(!this.doNotCreate){if(null==scope.canvasBounds)return scope.invalid=!0,scope.message="No Canvas Bounds. Can't draw text '"+scope.text+"'",void(scope.showHoverLabel=scope.hoverIfLabelFails);scope.showHoverLabel=this.hoverLabelMode==HoverLabel.MODES.ALL;var muPerPixel=1/28*this.mapScale,pixelsPerMu=28/this.mapScale,labelsToAttempt=[this.text];this.stateText.length&&labelsToAttempt.unshift(this.text+this.stateText);for(var _i=0,_labelsToAttempt=labelsToAttempt;_i<_labelsToAttempt.length;_i++){for(var lines,shrinkStep,currentScale,words=_labelsToAttempt[_i].split(" ").map((function(word){return{width:scope.atlas.measure(word,scope.font,scope.fontSize).width,word:word}})),availableWidth=(this.canvasBounds.maxWidth-2*this.margin)*pixelsPerMu,availableHeight=(this.canvasBounds.maxHeight-2*this.heightMargin)*pixelsPerMu,maxShrinkSteps=(1-this.scaleMin)/this.scaleStep,minimumShrinkSteps=0,spaceWidth=this.atlas.measure(" ",this.font,this.fontSize).width,lineHeight=getTextHeight(this.fontSize+"px "+this.font),i=0,iLen=words.length;i<iLen;i++){var width=words[i].width,wShrinkSteps=Math.ceil((width-availableWidth)/(width*this.scaleStep));minimumShrinkSteps=Math.max(wShrinkSteps,minimumShrinkSteps)}if(null==this.height)if(this.polygonMeshesById[this.polyId]){var target=this.polygonMeshesById[this.polyId];target.geometry.boundingBox||target.geometry.computeBoundingBox(),this.height=target.geometry.boundingBox.max.z+target.position.z}else this.height=0;var scaleStep=this.scaleStep;shrink:for(shrinkStep=minimumShrinkSteps;shrinkStep<=maxShrinkSteps;shrinkStep++){currentScale=1-shrinkStep*scaleStep;var thisLineWidth=words[0].width*currentScale;lines=[{text:words[0].word,width:thisLineWidth,height:lineHeight*currentScale,x:0,y:0}];for(var iWordSize=1;iWordSize<words.length;iWordSize++){var wordSize=words[iWordSize],spaceForNextWord=(wordSize.width+spaceWidth)*currentScale;if(thisLineWidth+spaceForNextWord<availableWidth)lines[lines.length-1].text+=" "+wordSize.word,lines[lines.length-1].width+=spaceForNextWord,thisLineWidth+=spaceForNextWord;else{if(!this.multiline)continue shrink;lines[lines.length-1].width=thisLineWidth,thisLineWidth=wordSize.width*currentScale,lines.push({text:wordSize.word,width:thisLineWidth,height:lineHeight*currentScale,x:0,y:lines[lines.length-1].height+lines[lines.length-1].y})}}if(lines.length*lineHeight*currentScale<=availableHeight){this.invalid=!1;break}}if(0==this.invalid)break}if(0==this.invalid){var lineTotalWidth=lines.map((function(x){return Math.ceil(x.width)})).reduce((function(a,b){return Math.max(a,b)})),_iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=lines[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var line=_step8.value;line.x=(lineTotalWidth-line.width)/2}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorNormalCompletion8||null==_iterator8.return||_iterator8.return()}finally{if(_didIteratorError8)throw _iteratorError8}}this.label=this.atlas.addLabel(this.map,lines,this.font,this.fontSize*currentScale,this,muPerPixel)}this.created=!0}}},{key:"flipIfNeeded",value:function(cameraAngle){}},{key:"removeSelf",value:function(bulk){var _this=this;this.created?(null!=this.label&&(this.label.layer.remove(this.label),this.label=null),bulk||(this.map.textObjects=this.map.textObjects.filter((function(object){return object!=_this})),Object.keys(this.textLabelsByPolygonId).forEach((function(key){_this.textLabelsByPolygonId[key]==_this&&delete _this.textLabelsByPolygonId[key]})))):this.doNotCreate=!0}},{key:"setColor",value:function(textColor){this.color=new Color(textColor),null!=this.label&&null!=this.label.layer&&(this.label.color=this.color,this.label.layout(this.map.mapClass,this.label.layer.origin,this.label.layer.size,this.label.layer.rotation,this.label.layer.uv,this.label.layer.color))}},{key:"clearColor",value:function(){this.setColor(this.baseColor)}},{key:"hide",value:function(){this.label?this.label.layer.zero(this.label.index):this.hideOnCreate=!0}},{key:"show",value:function(){if(this.label){var layer=this.label.layer,map=this.map;this.label.layout(map.mapClass,layer.origin,layer.size,layer.rotation,layer.uv,layer.color)}else this.hideOnCreate=!1}},{key:"toString",value:function(){return this.hoverLabelText}}]),AtlasTextLabel}(),textHeightCache=new Map,getTextHeight=function(font){var height=textHeightCache[font];if(null!=height)return height;var text=document.createElement("span");text.textContent="Hg",text.style.font=font;var block=document.createElement("div");block.style.cssText="display: inline-block; width: 1px; height: 0px;";var div=document.createElement("div");div.appendChild(text),div.appendChild(block),document.body.appendChild(div);try{var bounding=text.getBoundingClientRect()}finally{div.remove()}return null!=bounding.height&&(textHeightCache[font]=bounding.height,height=bounding.height),height},FlippableImage=function(options){var image=options.image,radiansRotation=options.rotation||0,originalPosition=image.position.clone(),originalRotation=image.rotation.z,originalRadiansRotation=radiansRotation;this.flipIfNeeded=function(cameraAngle){var geo,angle=(radiansRotation-cameraAngle)%TWO_PI;(angle>HALF_PI&&angle<ONE_AND_A_HALF_PI||angle<-HALF_PI&&angle>-ONE_AND_A_HALF_PI)&&((geo=image.geometry).boundingBox||geo.computeBoundingBox(),radiansRotation=(radiansRotation+Math.PI)%TWO_PI,image.rotation.z=image.rotation.z+Math.PI,image.translateX(-2*(geo.boundingBox.min.x+(geo.boundingBox.max.x-geo.boundingBox.min.x)/2)),image.translateY(-2*(geo.boundingBox.min.y+(geo.boundingBox.max.y-geo.boundingBox.min.y)/2)))},this.reset=function(){image.position.x=originalPosition.x,image.position.y=originalPosition.y,image.rotation.z=originalRotation,radiansRotation=originalRadiansRotation}},OBJLoader=function(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this.materials=null};OBJLoader.prototype={constructor:OBJLoader,load:function(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(scope.manager);loader.setPath(this.path),loader.load(url,(function(text){onLoad(scope.parse(text))}),onProgress,onError)},setPath:function(value){this.path=value},setMaterials:function(materials){this.materials=materials},parse:function(text){console.time("OBJLoader");var object,objects=[],foundObjects=!1,vertices=[],normals=[],uvs=[];function addObject(name){object={name:name,geometry:{vertices:[],normals:[],uvs:[]},material:{name:"",smooth:!0}},objects.push(object)}function parseVertexIndex(value){var index=parseInt(value);return 3*(index>=0?index-1:index+vertices.length/3)}function parseNormalIndex(value){var index=parseInt(value);return 3*(index>=0?index-1:index+normals.length/3)}function parseUVIndex(value){var index=parseInt(value);return 2*(index>=0?index-1:index+uvs.length/2)}function addVertex(a,b,c){object.geometry.vertices.push(vertices[a],vertices[a+1],vertices[a+2],vertices[b],vertices[b+1],vertices[b+2],vertices[c],vertices[c+1],vertices[c+2])}function addNormal(a,b,c){object.geometry.normals.push(normals[a],normals[a+1],normals[a+2],normals[b],normals[b+1],normals[b+2],normals[c],normals[c+1],normals[c+2])}function addUV(a,b,c){object.geometry.uvs.push(uvs[a],uvs[a+1],uvs[b],uvs[b+1],uvs[c],uvs[c+1])}function addFace(a,b,c,d,ua,ub,uc,ud,na,nb,nc,nd){var id,ia=parseVertexIndex(a),ib=parseVertexIndex(b),ic=parseVertexIndex(c);void 0===d?addVertex(ia,ib,ic):(addVertex(ia,ib,id=parseVertexIndex(d)),addVertex(ib,ic,id)),void 0!==ua&&(ia=parseUVIndex(ua),ib=parseUVIndex(ub),ic=parseUVIndex(uc),void 0===d?addUV(ia,ib,ic):(addUV(ia,ib,id=parseUVIndex(ud)),addUV(ib,ic,id))),void 0!==na&&(ia=parseNormalIndex(na),ib=parseNormalIndex(nb),ic=parseNormalIndex(nc),void 0===d?addNormal(ia,ib,ic):(addNormal(ia,ib,id=parseNormalIndex(nd)),addNormal(ib,ic,id)))}addObject("");for(var vertex_pattern=/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern=/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern=/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_pattern1=/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_pattern2=/^f\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)))?/,face_pattern3=/^f\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)\/(-?\d+)))?/,face_pattern4=/^f\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))(?:\s+((-?\d+)\/\/(-?\d+)))?/,object_pattern=/^[og]\s+(.+)/,smoothing_pattern=/^s\s+(\d+|on|off)/,lines=text.split("\n"),i=0;i<lines.length;i++){var result,line=lines[i];if(0!==(line=line.trim()).length&&"#"!==line.charAt(0))if(null!==(result=vertex_pattern.exec(line)))vertices.push(parseFloat(result[1]),parseFloat(result[2]),parseFloat(result[3]));else if(null!==(result=normal_pattern.exec(line)))normals.push(parseFloat(result[1]),parseFloat(result[2]),parseFloat(result[3]));else if(null!==(result=uv_pattern.exec(line)))uvs.push(parseFloat(result[1]),parseFloat(result[2]));else if(null!==(result=face_pattern1.exec(line)))addFace(result[1],result[2],result[3],result[4]);else if(null!==(result=face_pattern2.exec(line)))addFace(result[2],result[5],result[8],result[11],result[3],result[6],result[9],result[12]);else if(null!==(result=face_pattern3.exec(line)))addFace(result[2],result[6],result[10],result[14],result[3],result[7],result[11],result[15],result[4],result[8],result[12],result[16]);else if(null!==(result=face_pattern4.exec(line)))addFace(result[2],result[5],result[8],result[11],void 0,void 0,void 0,void 0,result[3],result[6],result[9],result[12]);else if(null!==(result=object_pattern.exec(line))){var name=result[1].trim();!1===foundObjects?(foundObjects=!0,object.name=name):addObject(name)}else if(/^usemtl /.test(line))object.material.name=line.substring(7).trim();else if(/^mtllib /.test(line));else{if(null===(result=smoothing_pattern.exec(line)))throw new Error("Unexpected line: "+line);object.material.smooth="1"===result[1]||"on"===result[1]}}for(var container=new Group,l=(i=0,objects.length);i<l;i++){var material,geometry=(object=objects[i]).geometry,buffergeometry=new BufferGeometry;buffergeometry.addAttribute("position",new BufferAttribute(new Float32Array(geometry.vertices),3)),geometry.normals.length>0?buffergeometry.addAttribute("normal",new BufferAttribute(new Float32Array(geometry.normals),3)):buffergeometry.computeVertexNormals(),geometry.uvs.length>0&&buffergeometry.addAttribute("uv",new BufferAttribute(new Float32Array(geometry.uvs),2)),null!==this.materials&&(material=this.materials.create(object.material.name)),material||((material=new MeshPhongMaterial).name=object.material.name),material.flatShading=!object.material.smooth;var mesh=new Mesh(buffergeometry,material);mesh.name=object.name,container.add(mesh)}return console.timeEnd("OBJLoader"),container}};var MTLLoader=function(manager){Object.assign(this,EventDispatcher.prototype),this.baseUrl="",this.manager=void 0!==manager?manager:DefaultLoadingManager};MTLLoader.prototype={constructor:MTLLoader,load:function(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(this.manager);loader.setPath(this.path),loader.load(url,(function(text){onLoad(scope.parse(text))}),onProgress,onError)},setPath:function(value){this.path=value},setBaseUrl:function(value){this.baseUrl=value},setCrossOrigin:function(value){this.crossOrigin=value},setMaterialOptions:function(value){this.materialOptions=value},parse:function(text){for(var lines=text.split("\n"),info={},delimiter_pattern=/\s+/,materialsInfo={},i=0;i<lines.length;i++){var line=lines[i];if(0!==(line=line.trim()).length&&"#"!==line.charAt(0)){var pos=line.indexOf(" "),key=pos>=0?line.substring(0,pos):line;key=key.toLowerCase();var value=pos>=0?line.substring(pos+1):"";if(value=value.trim(),"newmtl"===key)info={name:value},materialsInfo[value]=info;else if(info)if("ka"===key||"kd"===key||"ks"===key){var ss=value.split(delimiter_pattern,3);info[key]=[parseFloat(ss[0]),parseFloat(ss[1]),parseFloat(ss[2])]}else info[key]=value}}var materialCreator=new MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions);return materialCreator.setCrossOrigin(this.crossOrigin),materialCreator.setManager(this.manager),materialCreator.setMaterials(materialsInfo),materialCreator}},(MTLLoader.MaterialCreator=function(baseUrl,options){this.baseUrl=baseUrl,this.options=options,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.loader=void 0,this.side=this.options&&this.options.side?this.options.side:FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:RepeatWrapping}).prototype={constructor:MTLLoader.MaterialCreator,setCrossOrigin:function(value){this.crossOrigin=value},setManager:function(value){this.manager=value},setLoader:function(value){this.loader=value},setMaterials:function(materialsInfo){this.materialsInfo=this.convert(materialsInfo),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(materialsInfo){if(!this.options)return materialsInfo;var converted={};for(var mn in materialsInfo){var mat=materialsInfo[mn],covmat={};for(var prop in converted[mn]=covmat,mat){var save=!0,value=mat[prop],lprop=prop.toLowerCase();switch(lprop){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(value=[value[0]/255,value[1]/255,value[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===value[0]&&0===value[1]&&0===value[1]&&(save=!1)}save&&(covmat[lprop]=value)}}return converted},preload:function(){for(var mn in this.materialsInfo)this.create(mn)},getIndex:function(materialName){return this.nameLookup[materialName]},getAsArray:function(){var index=0;for(var mn in this.materialsInfo)this.materialsArray[index]=this.create(mn),this.nameLookup[mn]=index,index++;return this.materialsArray},create:function(materialName){return void 0===this.materials[materialName]&&this.createMaterial_(materialName),this.materials[materialName]},createMaterial_:function(materialName){var mat=this.materialsInfo[materialName],params={name:materialName,side:this.side};for(var prop in mat){var value=mat[prop];if(""!==value)switch(prop.toLowerCase()){case"kd":params.color=(new Color).fromArray(value);break;case"ks":params.specular=(new Color).fromArray(value);break;case"map_kd":params.map=this.loadTexture(this.baseUrl+value),params.map.wrapS=this.wrap,params.map.wrapT=this.wrap;break;case"ns":params.shininess=parseFloat(value);break;case"d":(value<1||materialName.indexOf("_image")>0)&&(params.opacity=value,params.transparent=!0,params.alphaTest=.1);break;case"Tr":value>0&&(params.opacity=1-value,params.transparent=!0);break;case"map_bump":case"bump":if(params.bumpMap)break;params.bumpMap=this.loadTexture(this.baseUrl+value),params.bumpMap.wrapS=this.wrap,params.bumpMap.wrapT=this.wrap}}return this.materials[materialName]=new MeshPhongMaterial(params),this.materials[materialName]},loadTexture:function(url,mapping,onLoad,onProgress,onError){var texture,loader=Loader.Handlers.get(url),manager=void 0!==this.manager?this.manager:DefaultLoadingManager;return null===loader&&(loader=void 0!==this.loader?this.loader:new TextureLoader(manager)),loader.setCrossOrigin&&loader.setCrossOrigin(this.crossOrigin),texture=loader.load(url,onLoad,onProgress,onError),void 0!==mapping&&(texture.mapping=mapping),null!=texture&&(texture.anisotropy=16),texture}};var BASE_URL=/^https?:\/\/.*\//;var SceneLoader={load:function(obj,mtl,textureLoader){return new Promise((function(resolve,reject){var mtlLoader=new MTLLoader,match=BASE_URL.exec(mtl);if(null!=match){var baseUrl=match[0];mtlLoader.setBaseUrl(baseUrl),mtlLoader.setCrossOrigin("*")}mtlLoader.load(mtl,(function(materials){void 0!==textureLoader&&materials.setLoader(textureLoader),materials.preload();var objLoader=new OBJLoader;objLoader.setMaterials(materials),objLoader.load(obj,(function(container){container.children.forEach((function(child){null!=child.material&&(child.name.includes("_image")&&null!=child.material.map&&(child.material.map.wrapS=ClampToEdgeWrapping,child.material.map.wrapT=ClampToEdgeWrapping),child.material.side=DoubleSide)})),resolve(container)}),void 0,reject)}),void 0,reject)}))}},reIsUint=/^(?:0|[1-9]\d*)$/;function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,propertyIsEnumerable=objectProto.propertyIsEnumerable,nativeMax=Math.max;function arrayLikeKeys(value,inherited){var result=isArray(value)||function(value){return function(value){return function(value){return!!value&&"object"==typeof value}(value)&&isArrayLike(value)}(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||"[object Arguments]"==objectToString.call(value))}(value)?function(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}(value.length,String):[],length=result.length,skipIndexes=!!length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isIndex(key,length))||result.push(key);return result}function assignInDefaults(objValue,srcValue,key,object){return void 0===objValue||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)?srcValue:objValue}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||(object[key]=value)}function baseKeysIn(object){if(!isObject(object))return function(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}(object);var value,Ctor,proto,isProto=(Ctor=(value=object)&&value.constructor,proto="function"==typeof Ctor&&Ctor.prototype||objectProto,value===proto),result=[];for(var key in object)("constructor"!=key||!isProto&&hasOwnProperty.call(object,key))&&result.push(key);return result}function baseRest(func,start){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=array,apply(func,this,otherArgs)}}function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function eq(value,other){return value===other||value!=value&&other!=other}var isArray=Array.isArray;function isArrayLike(value){return null!=value&&function(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991}(value.length)&&!function(value){var tag=isObject(value)?objectToString.call(value):"";return"[object Function]"==tag||"[object GeneratorFunction]"==tag}(value)}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}var assigner,assignInWith=(assigner=function(object,source,srcIndex,customizer){!function(source,props,object,customizer){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;assignValue(object,key,void 0===newValue?source[key]:newValue)}}(source,function(object){return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}(source),object,customizer)},baseRest((function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:void 0,guard=length>2?sources[2]:void 0;for(customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):void 0,guard&&function(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}(sources[0],sources[1],guard)&&(customizer=length<3?void 0:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object})));var lodash_defaults=baseRest((function(args){return args.push(void 0,assignInDefaults),apply(assignInWith,void 0,args)})),clipper=createCommonjsModule((function(module){var navigator_appName,ClipperLib={},isNode=!1;if(module.exports?(module.exports=ClipperLib,isNode=!0):"undefined"!=typeof document?window.ClipperLib=ClipperLib:self.ClipperLib=ClipperLib,isNode){nav="chrome";navigator_appName="Netscape"}else{var nav=navigator.userAgent.toString().toLowerCase();navigator_appName=navigator.appName}var dbits,browser={};function BigInteger(a,b,c){ClipperLib.biginteger_used=1,null!=a&&("number"==typeof a&&void 0===b?this.fromInt(a):"number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function nbi(){return new BigInteger(null)}-1!=nav.indexOf("chrome")&&-1==nav.indexOf("chromium")?browser.chrome=1:browser.chrome=0,-1!=nav.indexOf("chromium")?browser.chromium=1:browser.chromium=0,-1!=nav.indexOf("safari")&&-1==nav.indexOf("chrome")&&-1==nav.indexOf("chromium")?browser.safari=1:browser.safari=0,-1!=nav.indexOf("firefox")?browser.firefox=1:browser.firefox=0,-1!=nav.indexOf("firefox/17")?browser.firefox17=1:browser.firefox17=0,-1!=nav.indexOf("firefox/15")?browser.firefox15=1:browser.firefox15=0,-1!=nav.indexOf("firefox/3")?browser.firefox3=1:browser.firefox3=0,-1!=nav.indexOf("opera")?browser.opera=1:browser.opera=0,-1!=nav.indexOf("msie 10")?browser.msie10=1:browser.msie10=0,-1!=nav.indexOf("msie 9")?browser.msie9=1:browser.msie9=0,-1!=nav.indexOf("msie 8")?browser.msie8=1:browser.msie8=0,-1!=nav.indexOf("msie 7")?browser.msie7=1:browser.msie7=0,-1!=nav.indexOf("msie ")?browser.msie=1:browser.msie=0,ClipperLib.biginteger_used=null,"Microsoft Internet Explorer"==navigator_appName?(BigInteger.prototype.am=function(i,x,w,j,c,n){for(var xl=32767&x,xh=x>>15;--n>=0;){var l=32767&this[i],h=this[i++]>>15,m=xh*l+h*xl;c=((l=xl*l+((32767&m)<<15)+w[j]+(1073741823&c))>>>30)+(m>>>15)+xh*h+(c>>>30),w[j++]=1073741823&l}return c},dbits=30):"Netscape"!=navigator_appName?(BigInteger.prototype.am=function(i,x,w,j,c,n){for(;--n>=0;){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864),w[j++]=67108863&v}return c},dbits=26):(BigInteger.prototype.am=function(i,x,w,j,c,n){for(var xl=16383&x,xh=x>>14;--n>=0;){var l=16383&this[i],h=this[i++]>>14,m=xh*l+h*xl;c=((l=xl*l+((16383&m)<<14)+w[j]+c)>>28)+(m>>14)+xh*h,w[j++]=268435455&l}return c},dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;BigInteger.prototype.FV=Math.pow(2,52),BigInteger.prototype.F1=52-dbits,BigInteger.prototype.F2=2*dbits-52;var rr,vv,BI_RC=new Array;for(rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return null==c?-1:c}function nbv(i){var r=nbi();return r.fromInt(i),r}function nbits(x){var t,r=1;return 0!=(t=x>>>16)&&(x=t,r+=16),0!=(t=x>>8)&&(x=t,r+=8),0!=(t=x>>4)&&(x=t,r+=4),0!=(t=x>>2)&&(x=t,r+=2),0!=(t=x>>1)&&(x=t,r+=1),r}function Classic(m){this.m=m}function Montgomery(m){this.m=m,this.mp=m.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function op_and(x,y){return x&y}function op_or(x,y){return x|y}function op_xor(x,y){return x^y}function op_andnot(x,y){return x&~y}function lbit(x){if(0==x)return-1;var r=0;return 0==(65535&x)&&(x>>=16,r+=16),0==(255&x)&&(x>>=8,r+=8),0==(15&x)&&(x>>=4,r+=4),0==(3&x)&&(x>>=2,r+=2),0==(1&x)&&++r,r}function cbit(x){for(var r=0;0!=x;)x&=x-1,++r;return r}function NullExp(){}function nNop(x){return x}function Barrett(m){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}Classic.prototype.convert=function(x){return x.s<0||x.compareTo(this.m)>=0?x.mod(this.m):x},Classic.prototype.revert=function(x){return x},Classic.prototype.reduce=function(x){x.divRemTo(this.m,null,x)},Classic.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r),this.reduce(r)},Classic.prototype.sqrTo=function(x,r){x.squareTo(r),this.reduce(r)},Montgomery.prototype.convert=function(x){var r=nbi();return x.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),x.s<0&&r.compareTo(BigInteger.ZERO)>0&&this.m.subTo(r,r),r},Montgomery.prototype.revert=function(x){var r=nbi();return x.copyTo(r),this.reduce(r),r},Montgomery.prototype.reduce=function(x){for(;x.t<=this.mt2;)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=32767&x[i],u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;for(x[j=i+this.m.t]+=this.m.am(0,u0,x,i,0,this.m.t);x[j]>=x.DV;)x[j]-=x.DV,x[++j]++}x.clamp(),x.drShiftTo(this.m.t,x),x.compareTo(this.m)>=0&&x.subTo(this.m,x)},Montgomery.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r),this.reduce(r)},Montgomery.prototype.sqrTo=function(x,r){x.squareTo(r),this.reduce(r)},BigInteger.prototype.copyTo=function(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t,r.s=this.s},BigInteger.prototype.fromInt=function(x){this.t=1,this.s=x<0?-1:0,x>0?this[0]=x:x<-1?this[0]=x+this.DV:this.t=0},BigInteger.prototype.fromString=function(s,b){var k;if(16==b)k=4;else if(8==b)k=3;else if(256==b)k=8;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return void this.fromRadix(s,b);k=2}this.t=0,this.s=0;for(var i=s.length,mi=!1,sh=0;--i>=0;){var x=8==k?255&s[i]:intAt(s,i);x<0?"-"==s.charAt(i)&&(mi=!0):(mi=!1,0==sh?this[this.t++]=x:sh+k>this.DB?(this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh,this[this.t++]=x>>this.DB-sh):this[this.t-1]|=x<<sh,(sh+=k)>=this.DB&&(sh-=this.DB))}8==k&&0!=(128&s[0])&&(this.s=-1,sh>0&&(this[this.t-1]|=(1<<this.DB-sh)-1<<sh)),this.clamp(),mi&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.clamp=function(){for(var c=this.s&this.DM;this.t>0&&this[this.t-1]==c;)--this.t},BigInteger.prototype.dlShiftTo=function(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n,r.s=this.s},BigInteger.prototype.drShiftTo=function(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0),r.s=this.s},BigInteger.prototype.lShiftTo=function(n,r){var i,bs=n%this.DB,cbs=this.DB-bs,bm=(1<<cbs)-1,ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM;for(i=this.t-1;i>=0;--i)r[i+ds+1]=this[i]>>cbs|c,c=(this[i]&bm)<<bs;for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c,r.t=this.t+ds+1,r.s=this.s,r.clamp()},BigInteger.prototype.rShiftTo=function(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t)r.t=0;else{var bs=n%this.DB,cbs=this.DB-bs,bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i)r[i-ds-1]|=(this[i]&bm)<<cbs,r[i-ds]=this[i]>>bs;bs>0&&(r[this.t-ds-1]|=(this.s&bm)<<cbs),r.t=this.t-ds,r.clamp()}},BigInteger.prototype.subTo=function(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);i<m;)c+=this[i]-a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c-=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c-=a[i],r[i++]=c&this.DM,c>>=this.DB;c-=a.s}r.s=c<0?-1:0,c<-1?r[i++]=this.DV+c:c>0&&(r[i++]=c),r.t=i,r.clamp()},BigInteger.prototype.multiplyTo=function(a,r){var x=this.abs(),y=a.abs(),i=x.t;for(r.t=i+y.t;--i>=0;)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0,r.clamp(),this.s!=a.s&&BigInteger.ZERO.subTo(r,r)},BigInteger.prototype.squareTo=function(r){for(var x=this.abs(),i=r.t=2*x.t;--i>=0;)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);(r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV&&(r[i+x.t]-=x.DV,r[i+x.t+1]=1)}r.t>0&&(r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)),r.s=0,r.clamp()},BigInteger.prototype.divRemTo=function(m,q,r){var pm=m.abs();if(!(pm.t<=0)){var pt=this.abs();if(pt.t<pm.t)return null!=q&&q.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=nbi());var y=nbi(),ts=this.s,ms=m.s,nsh=this.DB-nbits(pm[pm.t-1]);nsh>0?(pm.lShiftTo(nsh,y),pt.lShiftTo(nsh,r)):(pm.copyTo(y),pt.copyTo(r));var ys=y.t,y0=y[ys-1];if(0!=y0){var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0),d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2,i=r.t,j=i-ys,t=null==q?nbi():q;for(y.dlShiftTo(j,t),r.compareTo(t)>=0&&(r[r.t++]=1,r.subTo(t,r)),BigInteger.ONE.dlShiftTo(ys,t),t.subTo(y,y);y.t<ys;)y[y.t++]=0;for(;--j>=0;){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd)for(y.dlShiftTo(j,t),r.subTo(t,r);r[i]<--qd;)r.subTo(t,r)}null!=q&&(r.drShiftTo(ys,q),ts!=ms&&BigInteger.ZERO.subTo(q,q)),r.t=ys,r.clamp(),nsh>0&&r.rShiftTo(nsh,r),ts<0&&BigInteger.ZERO.subTo(r,r)}}},BigInteger.prototype.invDigit=function(){if(this.t<1)return 0;var x=this[0];if(0==(1&x))return 0;var y=3&x;return(y=(y=(y=(y=y*(2-(15&x)*y)&15)*(2-(255&x)*y)&255)*(2-((65535&x)*y&65535))&65535)*(2-x*y%this.DV)%this.DV)>0?this.DV-y:-y},BigInteger.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},BigInteger.prototype.exp=function(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;for(g.copyTo(r);--i>=0;)if(z.sqrTo(r,r2),(e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2,r2=t}return z.revert(r)},BigInteger.prototype.toString=function(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(16==b)k=4;else if(8==b)k=3;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return this.toRadix(b);k=2}var d,km=(1<<k)-1,m=!1,r="",i=this.t,p=this.DB-i*this.DB%k;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)>0&&(m=!0,r=int2char(d));i>=0;)p<k?(d=(this[i]&(1<<p)-1)<<k-p,d|=this[--i]>>(p+=this.DB-k)):(d=this[i]>>(p-=k)&km,p<=0&&(p+=this.DB,--i)),d>0&&(m=!0),m&&(r+=int2char(d));return m?r:"0"},BigInteger.prototype.negate=function(){var r=nbi();return BigInteger.ZERO.subTo(this,r),r},BigInteger.prototype.abs=function(){return this.s<0?this.negate():this},BigInteger.prototype.compareTo=function(a){var r=this.s-a.s;if(0!=r)return r;var i=this.t;if(0!=(r=i-a.t))return this.s<0?-r:r;for(;--i>=0;)if(0!=(r=this[i]-a[i]))return r;return 0},BigInteger.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)},BigInteger.prototype.mod=function(a){var r=nbi();return this.abs().divRemTo(a,null,r),this.s<0&&r.compareTo(BigInteger.ZERO)>0&&a.subTo(r,r),r},BigInteger.prototype.modPowInt=function(e,m){var z;return z=e<256||m.isEven()?new Classic(m):new Montgomery(m),this.exp(e,z)},BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r)},NullExp.prototype.sqrTo=function(x,r){x.squareTo(r)},Barrett.prototype.convert=function(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);if(x.compareTo(this.m)<0)return x;var r=nbi();return x.copyTo(r),this.reduce(r),r},Barrett.prototype.revert=function(x){return x},Barrett.prototype.reduce=function(x){for(x.drShiftTo(this.m.t-1,this.r2),x.t>this.m.t+1&&(x.t=this.m.t+1,x.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);x.compareTo(this.r2)<0;)x.dAddOffset(1,this.m.t+1);for(x.subTo(this.r2,x);x.compareTo(this.m)>=0;)x.subTo(this.m,x)},Barrett.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r),this.reduce(r)},Barrett.prototype.sqrTo=function(x,r){x.squareTo(r),this.reduce(r)};var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=function(r){return Math.floor(Math.LN2*this.DB/Math.log(r))},BigInteger.prototype.toRadix=function(b){if(null==b&&(b=10),0==this.signum()||b<2||b>36)return"0";var cs=this.chunkSize(b),a=Math.pow(b,cs),d=nbv(a),y=nbi(),z=nbi(),r="";for(this.divRemTo(d,y,z);y.signum()>0;)r=(a+z.intValue()).toString(b).substr(1)+r,y.divRemTo(d,y,z);return z.intValue().toString(b)+r},BigInteger.prototype.fromRadix=function(s,b){this.fromInt(0),null==b&&(b=10);for(var cs=this.chunkSize(b),d=Math.pow(b,cs),mi=!1,j=0,w=0,i=0;i<s.length;++i){var x=intAt(s,i);x<0?"-"==s.charAt(i)&&0==this.signum()&&(mi=!0):(w=b*w+x,++j>=cs&&(this.dMultiply(d),this.dAddOffset(w,0),j=0,w=0))}j>0&&(this.dMultiply(Math.pow(b,j)),this.dAddOffset(w,0)),mi&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.fromNumber=function(a,b,c){if("number"==typeof b)if(a<2)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(BigInteger.ONE.shiftLeft(a-1),this);else{var x=new Array,t=7&a;x.length=1+(a>>3),b.nextBytes(x),t>0?x[0]&=(1<<t)-1:x[0]=0,this.fromString(x,256)}},BigInteger.prototype.bitwiseTo=function(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){for(f=a.s&this.DM,i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{for(f=this.s&this.DM,i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s),r.clamp()},BigInteger.prototype.changeBit=function(n,op){var r=BigInteger.ONE.shiftLeft(n);return this.bitwiseTo(r,op,r),r},BigInteger.prototype.addTo=function(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);i<m;)c+=this[i]+a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c+=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c+=a[i],r[i++]=c&this.DM,c>>=this.DB;c+=a.s}r.s=c<0?-1:0,c>0?r[i++]=c:c<-1&&(r[i++]=this.DV+c),r.t=i,r.clamp()},BigInteger.prototype.dMultiply=function(n){this[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()},BigInteger.prototype.dAddOffset=function(n,w){if(0!=n){for(;this.t<=w;)this[this.t++]=0;for(this[w]+=n;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}},BigInteger.prototype.multiplyLowerTo=function(a,n,r){var j,i=Math.min(this.t+a.t,n);for(r.s=0,r.t=i;i>0;)r[--i]=0;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()},BigInteger.prototype.multiplyUpperTo=function(a,n,r){--n;var i=r.t=this.t+a.t-n;for(r.s=0;--i>=0;)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp(),r.drShiftTo(1,r)},BigInteger.prototype.modInt=function(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(0==d)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r},BigInteger.prototype.millerRabin=function(t){var n1=this.subtract(BigInteger.ONE),k=n1.getLowestSetBit();if(k<=0)return!1;var r=n1.shiftRight(k);(t=t+1>>1)>lowprimes.length&&(t=lowprimes.length);for(var a=nbi(),i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(0!=y.compareTo(BigInteger.ONE)&&0!=y.compareTo(n1)){for(var j=1;j++<k&&0!=y.compareTo(n1);)if(0==(y=y.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=y.compareTo(n1))return!1}}return!0},BigInteger.prototype.clone=function(){var r=nbi();return this.copyTo(r),r},BigInteger.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},BigInteger.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},BigInteger.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},BigInteger.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},BigInteger.prototype.toByteArray=function(){var i=this.t,r=new Array;r[0]=this.s;var d,p=this.DB-i*this.DB%8,k=0;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p&&(r[k++]=d|this.s<<this.DB-p);i>=0;)p<8?(d=(this[i]&(1<<p)-1)<<8-p,d|=this[--i]>>(p+=this.DB-8)):(d=this[i]>>(p-=8)&255,p<=0&&(p+=this.DB,--i)),0!=(128&d)&&(d|=-256),0==k&&(128&this.s)!=(128&d)&&++k,(k>0||d!=this.s)&&(r[k++]=d);return r},BigInteger.prototype.equals=function(a){return 0==this.compareTo(a)},BigInteger.prototype.min=function(a){return this.compareTo(a)<0?this:a},BigInteger.prototype.max=function(a){return this.compareTo(a)>0?this:a},BigInteger.prototype.and=function(a){var r=nbi();return this.bitwiseTo(a,op_and,r),r},BigInteger.prototype.or=function(a){var r=nbi();return this.bitwiseTo(a,op_or,r),r},BigInteger.prototype.xor=function(a){var r=nbi();return this.bitwiseTo(a,op_xor,r),r},BigInteger.prototype.andNot=function(a){var r=nbi();return this.bitwiseTo(a,op_andnot,r),r},BigInteger.prototype.not=function(){for(var r=nbi(),i=0;i<this.t;++i)r[i]=this.DM&~this[i];return r.t=this.t,r.s=~this.s,r},BigInteger.prototype.shiftLeft=function(n){var r=nbi();return n<0?this.rShiftTo(-n,r):this.lShiftTo(n,r),r},BigInteger.prototype.shiftRight=function(n){var r=nbi();return n<0?this.lShiftTo(-n,r):this.rShiftTo(n,r),r},BigInteger.prototype.getLowestSetBit=function(){for(var i=0;i<this.t;++i)if(0!=this[i])return i*this.DB+lbit(this[i]);return this.s<0?this.t*this.DB:-1},BigInteger.prototype.bitCount=function(){for(var r=0,x=this.s&this.DM,i=0;i<this.t;++i)r+=cbit(this[i]^x);return r},BigInteger.prototype.testBit=function(n){var j=Math.floor(n/this.DB);return j>=this.t?0!=this.s:0!=(this[j]&1<<n%this.DB)},BigInteger.prototype.setBit=function(n){return this.changeBit(n,op_or)},BigInteger.prototype.clearBit=function(n){return this.changeBit(n,op_andnot)},BigInteger.prototype.flipBit=function(n){return this.changeBit(n,op_xor)},BigInteger.prototype.add=function(a){var r=nbi();return this.addTo(a,r),r},BigInteger.prototype.subtract=function(a){var r=nbi();return this.subTo(a,r),r},BigInteger.prototype.multiply=function(a){var r=nbi();return this.multiplyTo(a,r),r},BigInteger.prototype.divide=function(a){var r=nbi();return this.divRemTo(a,r,null),r},BigInteger.prototype.remainder=function(a){var r=nbi();return this.divRemTo(a,null,r),r},BigInteger.prototype.divideAndRemainder=function(a){var q=nbi(),r=nbi();return this.divRemTo(a,q,r),new Array(q,r)},BigInteger.prototype.modPow=function(e,m){var k,z,i=e.bitLength(),r=nbv(1);if(i<=0)return r;k=i<18?1:i<48?3:i<144?4:i<768?5:6,z=i<8?new Classic(m):m.isEven()?new Barrett(m):new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;if(g[1]=z.convert(this),k>1){var g2=nbi();for(z.sqrTo(g[1],g2);n<=km;)g[n]=nbi(),z.mulTo(g2,g[n-2],g[n]),n+=2}var w,t,j=e.t-1,is1=!0,r2=nbi();for(i=nbits(e[j])-1;j>=0;){for(i>=k1?w=e[j]>>i-k1&km:(w=(e[j]&(1<<i+1)-1)<<k1-i,j>0&&(w|=e[j-1]>>this.DB+i-k1)),n=k;0==(1&w);)w>>=1,--n;if((i-=n)<0&&(i+=this.DB,--j),is1)g[w].copyTo(r),is1=!1;else{for(;n>1;)z.sqrTo(r,r2),z.sqrTo(r2,r),n-=2;n>0?z.sqrTo(r,r2):(t=r,r=r2,r2=t),z.mulTo(r2,g[w],r)}for(;j>=0&&0==(e[j]&1<<i);)z.sqrTo(r,r2),t=r,r=r2,r2=t,--i<0&&(i=this.DB-1,--j)}return z.revert(r)},BigInteger.prototype.modInverse=function(m){var ac=m.isEven();if(this.isEven()&&ac||0==m.signum())return BigInteger.ZERO;for(var u=m.clone(),v=this.clone(),a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);0!=u.signum();){for(;u.isEven();)u.rShiftTo(1,u),ac?(a.isEven()&&b.isEven()||(a.addTo(this,a),b.subTo(m,b)),a.rShiftTo(1,a)):b.isEven()||b.subTo(m,b),b.rShiftTo(1,b);for(;v.isEven();)v.rShiftTo(1,v),ac?(c.isEven()&&d.isEven()||(c.addTo(this,c),d.subTo(m,d)),c.rShiftTo(1,c)):d.isEven()||d.subTo(m,d),d.rShiftTo(1,d);u.compareTo(v)>=0?(u.subTo(v,u),ac&&a.subTo(c,a),b.subTo(d,b)):(v.subTo(u,v),ac&&c.subTo(a,c),d.subTo(b,d))}return 0!=v.compareTo(BigInteger.ONE)?BigInteger.ZERO:d.compareTo(m)>=0?d.subtract(m):d.signum()<0?(d.addTo(m,d),d.signum()<0?d.add(m):d):d},BigInteger.prototype.pow=function(e){return this.exp(e,new NullExp)},BigInteger.prototype.gcd=function(a){var x=this.s<0?this.negate():this.clone(),y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y,y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;for(i<g&&(g=i),g>0&&(x.rShiftTo(g,x),y.rShiftTo(g,y));x.signum()>0;)(i=x.getLowestSetBit())>0&&x.rShiftTo(i,x),(i=y.getLowestSetBit())>0&&y.rShiftTo(i,y),x.compareTo(y)>=0?(x.subTo(y,x),x.rShiftTo(1,x)):(y.subTo(x,y),y.rShiftTo(1,y));return g>0&&y.lShiftTo(g,y),y},BigInteger.prototype.isProbablePrime=function(t){var i,x=this.abs();if(1==x.t&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return!0;return!1}if(x.isEven())return!1;for(i=1;i<lowprimes.length;){for(var m=lowprimes[i],j=i+1;j<lowprimes.length&&m<lplim;)m*=lowprimes[j++];for(m=x.modInt(m);i<j;)if(m%lowprimes[i++]==0)return!1}return x.millerRabin(t)},BigInteger.prototype.square=function(){var r=nbi();return this.squareTo(r),r};var Int128=BigInteger;if(Int128.prototype.IsNegative=function(){return-1==this.compareTo(Int128.ZERO)},Int128.op_Equality=function(val1,val2){return 0==val1.compareTo(val2)},Int128.op_Inequality=function(val1,val2){return 0!=val1.compareTo(val2)},Int128.op_GreaterThan=function(val1,val2){return val1.compareTo(val2)>0},Int128.op_LessThan=function(val1,val2){return val1.compareTo(val2)<0},Int128.op_Addition=function(lhs,rhs){return new Int128(lhs).add(new Int128(rhs))},Int128.op_Subtraction=function(lhs,rhs){return new Int128(lhs).subtract(new Int128(rhs))},Int128.Int128Mul=function(lhs,rhs){return new Int128(lhs).multiply(new Int128(rhs))},Int128.op_Division=function(lhs,rhs){return lhs.divide(rhs)},Int128.prototype.ToDouble=function(){return parseFloat(this.toString())},void 0===Inherit)var Inherit=function(ce,ce2){var p;if(void 0===Object.getOwnPropertyNames){for(p in ce2.prototype)void 0!==ce.prototype[p]&&ce.prototype[p]!=Object.prototype[p]||(ce.prototype[p]=ce2.prototype[p]);for(p in ce2)void 0===ce[p]&&(ce[p]=ce2[p]);ce.$baseCtor=ce2}else{for(var props=Object.getOwnPropertyNames(ce2.prototype),i=0;i<props.length;i++)void 0===Object.getOwnPropertyDescriptor(ce.prototype,props[i])&&Object.defineProperty(ce.prototype,props[i],Object.getOwnPropertyDescriptor(ce2.prototype,props[i]));for(p in ce2)void 0===ce[p]&&(ce[p]=ce2[p]);ce.$baseCtor=ce2}};ClipperLib.Path=function(){return[]},ClipperLib.Paths=function(){return[]},ClipperLib.DoublePoint=function(){var a=arguments;this.X=0,this.Y=0,1==a.length?(this.X=a[0].X,this.Y=a[0].Y):2==a.length&&(this.X=a[0],this.Y=a[1])},ClipperLib.DoublePoint0=function(){this.X=0,this.Y=0},ClipperLib.DoublePoint1=function(dp){this.X=dp.X,this.Y=dp.Y},ClipperLib.DoublePoint2=function(x,y){this.X=x,this.Y=y},ClipperLib.PolyNode=function(){this.m_Parent=null,this.m_polygon=new ClipperLib.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},ClipperLib.PolyNode.prototype.IsHoleNode=function(){for(var result=!0,node=this.m_Parent;null!==node;)result=!result,node=node.m_Parent;return result},ClipperLib.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},ClipperLib.PolyNode.prototype.Contour=function(){return this.m_polygon},ClipperLib.PolyNode.prototype.AddChild=function(Child){var cnt=this.m_Childs.length;this.m_Childs.push(Child),Child.m_Parent=this,Child.m_Index=cnt},ClipperLib.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},ClipperLib.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},ClipperLib.PolyNode.prototype.Childs=function(){return this.m_Childs},ClipperLib.PolyNode.prototype.Parent=function(){return this.m_Parent},ClipperLib.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},ClipperLib.PolyTree=function(){this.m_AllPolys=[],ClipperLib.PolyNode.call(this)},ClipperLib.PolyTree.prototype.Clear=function(){for(var i=0,ilen=this.m_AllPolys.length;i<ilen;i++)this.m_AllPolys[i]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},ClipperLib.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},ClipperLib.PolyTree.prototype.Total=function(){return this.m_AllPolys.length},Inherit(ClipperLib.PolyTree,ClipperLib.PolyNode),ClipperLib.Math_Abs_Int64=ClipperLib.Math_Abs_Int32=ClipperLib.Math_Abs_Double=function(a){return Math.abs(a)},ClipperLib.Math_Max_Int32_Int32=function(a,b){return Math.max(a,b)},browser.msie||browser.opera||browser.safari?ClipperLib.Cast_Int32=function(a){return 0|a}:ClipperLib.Cast_Int32=function(a){return~~a},browser.chrome?ClipperLib.Cast_Int64=function(a){return a<-2147483648||a>2147483647?a<0?Math.ceil(a):Math.floor(a):~~a}:browser.firefox&&"function"==typeof Number.toInteger?ClipperLib.Cast_Int64=function(a){return Number.toInteger(a)}:browser.msie7||browser.msie8?ClipperLib.Cast_Int64=function(a){return parseInt(a,10)}:browser.msie?ClipperLib.Cast_Int64=function(a){return a<-2147483648||a>2147483647?a<0?Math.ceil(a):Math.floor(a):0|a}:ClipperLib.Cast_Int64=function(a){return a<0?Math.ceil(a):Math.floor(a)},ClipperLib.Clear=function(a){a.length=0},ClipperLib.PI=3.141592653589793,ClipperLib.PI2=6.283185307179586,ClipperLib.IntPoint=function(){var a=arguments,alen=a.length;if(this.X=0,this.Y=0,2==alen)this.X=a[0],this.Y=a[1];else if(1==alen)if(a[0]instanceof ClipperLib.DoublePoint){var dp=a[0];this.X=ClipperLib.Clipper.Round(dp.X),this.Y=ClipperLib.Clipper.Round(dp.Y)}else{var pt=a[0];this.X=pt.X,this.Y=pt.Y}else this.X=0,this.Y=0},ClipperLib.IntPoint.op_Equality=function(a,b){return a.X==b.X&&a.Y==b.Y},ClipperLib.IntPoint.op_Inequality=function(a,b){return a.X!=b.X||a.Y!=b.Y},ClipperLib.IntPoint0=function(){this.X=0,this.Y=0},ClipperLib.IntPoint1=function(pt){this.X=pt.X,this.Y=pt.Y},ClipperLib.IntPoint1dp=function(dp){this.X=ClipperLib.Clipper.Round(dp.X),this.Y=ClipperLib.Clipper.Round(dp.Y)},ClipperLib.IntPoint2=function(x,y){this.X=x,this.Y=y},ClipperLib.IntRect=function(){var a=arguments,alen=a.length;4==alen?(this.left=a[0],this.top=a[1],this.right=a[2],this.bottom=a[3]):1==alen?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):(this.left=0,this.top=0,this.right=0,this.bottom=0)},ClipperLib.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},ClipperLib.IntRect1=function(ir){this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom},ClipperLib.IntRect4=function(l,t,r,b){this.left=l,this.top=t,this.right=r,this.bottom=b},ClipperLib.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},ClipperLib.PolyType={ptSubject:0,ptClip:1},ClipperLib.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},ClipperLib.JoinType={jtSquare:0,jtRound:1,jtMiter:2},ClipperLib.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},ClipperLib.EdgeSide={esLeft:0,esRight:1},ClipperLib.Direction={dRightToLeft:0,dLeftToRight:1},ClipperLib.TEdge=function(){this.Bot=new ClipperLib.IntPoint,this.Curr=new ClipperLib.IntPoint,this.Top=new ClipperLib.IntPoint,this.Delta=new ClipperLib.IntPoint,this.Dx=0,this.PolyTyp=ClipperLib.PolyType.ptSubject,this.Side=ClipperLib.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},ClipperLib.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new ClipperLib.IntPoint},ClipperLib.MyIntersectNodeSort=function(){},ClipperLib.MyIntersectNodeSort.Compare=function(node1,node2){return node2.Pt.Y-node1.Pt.Y},ClipperLib.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},ClipperLib.Scanbeam=function(){this.Y=0,this.Next=null},ClipperLib.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},ClipperLib.OutPt=function(){this.Idx=0,this.Pt=new ClipperLib.IntPoint,this.Next=null,this.Prev=null},ClipperLib.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new ClipperLib.IntPoint},ClipperLib.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_MinimaList=null,this.m_CurrentLM=null,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},ClipperLib.ClipperBase.horizontal=-9007199254740992,ClipperLib.ClipperBase.Skip=-2,ClipperLib.ClipperBase.Unassigned=-1,ClipperLib.ClipperBase.tolerance=1e-20,ClipperLib.ClipperBase.loRange=47453132,ClipperLib.ClipperBase.hiRange=0xfffffffffffff,ClipperLib.ClipperBase.near_zero=function(val){return val>-ClipperLib.ClipperBase.tolerance&&val<ClipperLib.ClipperBase.tolerance},ClipperLib.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y},ClipperLib.ClipperBase.prototype.PointIsVertex=function(pt,pp){var pp2=pp;do{if(ClipperLib.IntPoint.op_Equality(pp2.Pt,pt))return!0;pp2=pp2.Next}while(pp2!=pp);return!1},ClipperLib.ClipperBase.prototype.PointOnLineSegment=function(pt,linePt1,linePt2,UseFullRange){return UseFullRange?pt.X==linePt1.X&&pt.Y==linePt1.Y||pt.X==linePt2.X&&pt.Y==linePt2.Y||pt.X>linePt1.X==pt.X<linePt2.X&&pt.Y>linePt1.Y==pt.Y<linePt2.Y&&Int128.op_Equality(Int128.Int128Mul(pt.X-linePt1.X,linePt2.Y-linePt1.Y),Int128.Int128Mul(linePt2.X-linePt1.X,pt.Y-linePt1.Y)):pt.X==linePt1.X&&pt.Y==linePt1.Y||pt.X==linePt2.X&&pt.Y==linePt2.Y||pt.X>linePt1.X==pt.X<linePt2.X&&pt.Y>linePt1.Y==pt.Y<linePt2.Y&&(pt.X-linePt1.X)*(linePt2.Y-linePt1.Y)==(linePt2.X-linePt1.X)*(pt.Y-linePt1.Y)},ClipperLib.ClipperBase.prototype.PointOnPolygon=function(pt,pp,UseFullRange){for(var pp2=pp;;){if(this.PointOnLineSegment(pt,pp2.Pt,pp2.Next.Pt,UseFullRange))return!0;if((pp2=pp2.Next)==pp)break}return!1},ClipperLib.ClipperBase.prototype.SlopesEqual=ClipperLib.ClipperBase.SlopesEqual=function(){var e1,e2,pt1,pt2,pt3,pt4,a=arguments,alen=a.length;return 3==alen?(e1=a[0],e2=a[1],a[2]?Int128.op_Equality(Int128.Int128Mul(e1.Delta.Y,e2.Delta.X),Int128.Int128Mul(e1.Delta.X,e2.Delta.Y)):ClipperLib.Cast_Int64(e1.Delta.Y*e2.Delta.X)==ClipperLib.Cast_Int64(e1.Delta.X*e2.Delta.Y)):4==alen?(pt1=a[0],pt2=a[1],pt3=a[2],a[3]?Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt2.X-pt3.X),Int128.Int128Mul(pt1.X-pt2.X,pt2.Y-pt3.Y)):ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt2.X-pt3.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt2.Y-pt3.Y))==0):(pt1=a[0],pt2=a[1],pt3=a[2],pt4=a[3],a[4]?Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt3.X-pt4.X),Int128.Int128Mul(pt1.X-pt2.X,pt3.Y-pt4.Y)):ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt3.X-pt4.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt3.Y-pt4.Y))==0)},ClipperLib.ClipperBase.SlopesEqual3=function(e1,e2,UseFullRange){return UseFullRange?Int128.op_Equality(Int128.Int128Mul(e1.Delta.Y,e2.Delta.X),Int128.Int128Mul(e1.Delta.X,e2.Delta.Y)):ClipperLib.Cast_Int64(e1.Delta.Y*e2.Delta.X)==ClipperLib.Cast_Int64(e1.Delta.X*e2.Delta.Y)},ClipperLib.ClipperBase.SlopesEqual4=function(pt1,pt2,pt3,UseFullRange){return UseFullRange?Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt2.X-pt3.X),Int128.Int128Mul(pt1.X-pt2.X,pt2.Y-pt3.Y)):ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt2.X-pt3.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt2.Y-pt3.Y))==0},ClipperLib.ClipperBase.SlopesEqual5=function(pt1,pt2,pt3,pt4,UseFullRange){return UseFullRange?Int128.op_Equality(Int128.Int128Mul(pt1.Y-pt2.Y,pt3.X-pt4.X),Int128.Int128Mul(pt1.X-pt2.X,pt3.Y-pt4.Y)):ClipperLib.Cast_Int64((pt1.Y-pt2.Y)*(pt3.X-pt4.X))-ClipperLib.Cast_Int64((pt1.X-pt2.X)*(pt3.Y-pt4.Y))==0},ClipperLib.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var i=0,ilen=this.m_edges.length;i<ilen;++i){for(var j=0,jlen=this.m_edges[i].length;j<jlen;++j)this.m_edges[i][j]=null;ClipperLib.Clear(this.m_edges[i])}ClipperLib.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},ClipperLib.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var tmpLm=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=tmpLm}this.m_CurrentLM=null},ClipperLib.ClipperBase.prototype.RangeTest=function(Pt,useFullRange){useFullRange.Value?(Pt.X>ClipperLib.ClipperBase.hiRange||Pt.Y>ClipperLib.ClipperBase.hiRange||-Pt.X>ClipperLib.ClipperBase.hiRange||-Pt.Y>ClipperLib.ClipperBase.hiRange)&&ClipperLib.Error("Coordinate outside allowed range in RangeTest()."):(Pt.X>ClipperLib.ClipperBase.loRange||Pt.Y>ClipperLib.ClipperBase.loRange||-Pt.X>ClipperLib.ClipperBase.loRange||-Pt.Y>ClipperLib.ClipperBase.loRange)&&(useFullRange.Value=!0,this.RangeTest(Pt,useFullRange))},ClipperLib.ClipperBase.prototype.InitEdge=function(e,eNext,ePrev,pt){e.Next=eNext,e.Prev=ePrev,e.Curr.X=pt.X,e.Curr.Y=pt.Y,e.OutIdx=-1},ClipperLib.ClipperBase.prototype.InitEdge2=function(e,polyType){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y),this.SetDx(e),e.PolyTyp=polyType},ClipperLib.ClipperBase.prototype.FindNextLocMin=function(E){for(var E2;;){for(;ClipperLib.IntPoint.op_Inequality(E.Bot,E.Prev.Bot)||ClipperLib.IntPoint.op_Equality(E.Curr,E.Top);)E=E.Next;if(E.Dx!=ClipperLib.ClipperBase.horizontal&&E.Prev.Dx!=ClipperLib.ClipperBase.horizontal)break;for(;E.Prev.Dx==ClipperLib.ClipperBase.horizontal;)E=E.Prev;for(E2=E;E.Dx==ClipperLib.ClipperBase.horizontal;)E=E.Next;if(E.Top.Y!=E.Prev.Bot.Y){E2.Prev.Bot.X<E.Bot.X&&(E=E2);break}}return E},ClipperLib.ClipperBase.prototype.ProcessBound=function(E,IsClockwise){var Horz,StartX,EStart=E,Result=E;if(E.Dx==ClipperLib.ClipperBase.horizontal&&(StartX=IsClockwise?E.Prev.Bot.X:E.Next.Bot.X,E.Bot.X!=StartX&&this.ReverseHorizontal(E)),Result.OutIdx!=ClipperLib.ClipperBase.Skip)if(IsClockwise){for(;Result.Top.Y==Result.Next.Bot.Y&&Result.Next.OutIdx!=ClipperLib.ClipperBase.Skip;)Result=Result.Next;if(Result.Dx==ClipperLib.ClipperBase.horizontal&&Result.Next.OutIdx!=ClipperLib.ClipperBase.Skip){for(Horz=Result;Horz.Prev.Dx==ClipperLib.ClipperBase.horizontal;)Horz=Horz.Prev;Horz.Prev.Top.X==Result.Next.Top.X?IsClockwise||(Result=Horz.Prev):Horz.Prev.Top.X>Result.Next.Top.X&&(Result=Horz.Prev)}for(;E!=Result;)E.NextInLML=E.Next,E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Prev.Top.X&&this.ReverseHorizontal(E),E=E.Next;E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Prev.Top.X&&this.ReverseHorizontal(E),Result=Result.Next}else{for(;Result.Top.Y==Result.Prev.Bot.Y&&Result.Prev.OutIdx!=ClipperLib.ClipperBase.Skip;)Result=Result.Prev;if(Result.Dx==ClipperLib.ClipperBase.horizontal&&Result.Prev.OutIdx!=ClipperLib.ClipperBase.Skip){for(Horz=Result;Horz.Next.Dx==ClipperLib.ClipperBase.horizontal;)Horz=Horz.Next;Horz.Next.Top.X==Result.Prev.Top.X?IsClockwise||(Result=Horz.Next):Horz.Next.Top.X>Result.Prev.Top.X&&(Result=Horz.Next)}for(;E!=Result;)E.NextInLML=E.Prev,E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Next.Top.X&&this.ReverseHorizontal(E),E=E.Prev;E.Dx==ClipperLib.ClipperBase.horizontal&&E!=EStart&&E.Bot.X!=E.Next.Top.X&&this.ReverseHorizontal(E),Result=Result.Prev}if(Result.OutIdx==ClipperLib.ClipperBase.Skip){if(E=Result,IsClockwise){for(;E.Top.Y==E.Next.Bot.Y;)E=E.Next;for(;E!=Result&&E.Dx==ClipperLib.ClipperBase.horizontal;)E=E.Prev}else{for(;E.Top.Y==E.Prev.Bot.Y;)E=E.Prev;for(;E!=Result&&E.Dx==ClipperLib.ClipperBase.horizontal;)E=E.Next}if(E==Result)Result=IsClockwise?E.Next:E.Prev;else{E=IsClockwise?Result.Next:Result.Prev;var locMin=new ClipperLib.LocalMinima;locMin.Next=null,locMin.Y=E.Bot.Y,locMin.LeftBound=null,locMin.RightBound=E,locMin.RightBound.WindDelta=0,Result=this.ProcessBound(locMin.RightBound,IsClockwise),this.InsertLocalMinima(locMin)}}return Result},ClipperLib.ClipperBase.prototype.AddPath=function(pg,polyType,Closed){Closed||polyType!=ClipperLib.PolyType.ptClip||ClipperLib.Error("AddPath: Open paths must be subject.");var highI=pg.length-1;if(Closed)for(;highI>0&&ClipperLib.IntPoint.op_Equality(pg[highI],pg[0]);)--highI;for(;highI>0&&ClipperLib.IntPoint.op_Equality(pg[highI],pg[highI-1]);)--highI;if(Closed&&highI<2||!Closed&&highI<1)return!1;for(var edges=new Array,i=0;i<=highI;i++)edges.push(new ClipperLib.TEdge);var IsFlat=!0;edges[1].Curr.X=pg[1].X,edges[1].Curr.Y=pg[1].Y;var $1={Value:this.m_UseFullRange};this.RangeTest(pg[0],$1),this.m_UseFullRange=$1.Value,$1.Value=this.m_UseFullRange,this.RangeTest(pg[highI],$1),this.m_UseFullRange=$1.Value,this.InitEdge(edges[0],edges[1],edges[highI],pg[0]),this.InitEdge(edges[highI],edges[0],edges[highI-1],pg[highI]);for(i=highI-1;i>=1;--i)$1.Value=this.m_UseFullRange,this.RangeTest(pg[i],$1),this.m_UseFullRange=$1.Value,this.InitEdge(edges[i],edges[i+1],edges[i-1],pg[i]);for(var clockwise,eStart=edges[0],E=eStart,eLoopStop=eStart;;)if(ClipperLib.IntPoint.op_Equality(E.Curr,E.Next.Curr)){if(E==E.Next)break;E==eStart&&(eStart=E.Next),eLoopStop=E=this.RemoveEdge(E)}else{if(E.Prev==E.Next)break;if(!Closed||!ClipperLib.ClipperBase.SlopesEqual(E.Prev.Curr,E.Curr,E.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(E.Prev.Curr,E.Curr,E.Next.Curr)){if((E=E.Next)==eLoopStop)break}else E==eStart&&(eStart=E.Next),eLoopStop=E=(E=this.RemoveEdge(E)).Prev}if(!Closed&&E==E.Next||Closed&&E.Prev==E.Next)return!1;Closed||(this.m_HasOpenPaths=!0,eStart.Prev.OutIdx=ClipperLib.ClipperBase.Skip),E=eStart;do{this.InitEdge2(E,polyType),E=E.Next,IsFlat&&E.Curr.Y!=eStart.Curr.Y&&(IsFlat=!1)}while(E!=eStart);if(IsFlat){if(Closed)return!1;for(E.Prev.OutIdx=ClipperLib.ClipperBase.Skip,E.Prev.Bot.X<E.Prev.Top.X&&this.ReverseHorizontal(E.Prev),(locMin=new ClipperLib.LocalMinima).Next=null,locMin.Y=E.Bot.Y,locMin.LeftBound=null,locMin.RightBound=E,locMin.RightBound.Side=ClipperLib.EdgeSide.esRight,locMin.RightBound.WindDelta=0;E.Next.OutIdx!=ClipperLib.ClipperBase.Skip;)E.NextInLML=E.Next,E.Bot.X!=E.Prev.Top.X&&this.ReverseHorizontal(E),E=E.Next;return this.InsertLocalMinima(locMin),this.m_edges.push(edges),!0}this.m_edges.push(edges);for(var EMin=null;(E=this.FindNextLocMin(E))!=EMin;){var locMin;null==EMin&&(EMin=E),(locMin=new ClipperLib.LocalMinima).Next=null,locMin.Y=E.Bot.Y,E.Dx<E.Prev.Dx?(locMin.LeftBound=E.Prev,locMin.RightBound=E,clockwise=!1):(locMin.LeftBound=E,locMin.RightBound=E.Prev,clockwise=!0),locMin.LeftBound.Side=ClipperLib.EdgeSide.esLeft,locMin.RightBound.Side=ClipperLib.EdgeSide.esRight,Closed?locMin.LeftBound.Next==locMin.RightBound?locMin.LeftBound.WindDelta=-1:locMin.LeftBound.WindDelta=1:locMin.LeftBound.WindDelta=0,locMin.RightBound.WindDelta=-locMin.LeftBound.WindDelta,E=this.ProcessBound(locMin.LeftBound,clockwise);var E2=this.ProcessBound(locMin.RightBound,!clockwise);locMin.LeftBound.OutIdx==ClipperLib.ClipperBase.Skip?locMin.LeftBound=null:locMin.RightBound.OutIdx==ClipperLib.ClipperBase.Skip&&(locMin.RightBound=null),this.InsertLocalMinima(locMin),clockwise||(E=E2)}return!0},ClipperLib.ClipperBase.prototype.AddPaths=function(ppg,polyType,closed){for(var result=!1,i=0,ilen=ppg.length;i<ilen;++i)this.AddPath(ppg[i],polyType,closed)&&(result=!0);return result},ClipperLib.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(pt1,pt2,pt3){return!(ClipperLib.IntPoint.op_Equality(pt1,pt3)||ClipperLib.IntPoint.op_Equality(pt1,pt2)||ClipperLib.IntPoint.op_Equality(pt3,pt2))&&(pt1.X!=pt3.X?pt2.X>pt1.X==pt2.X<pt3.X:pt2.Y>pt1.Y==pt2.Y<pt3.Y)},ClipperLib.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var result=e.Next;return e.Prev=null,result},ClipperLib.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,0===e.Delta.Y?e.Dx=ClipperLib.ClipperBase.horizontal:e.Dx=e.Delta.X/e.Delta.Y},ClipperLib.ClipperBase.prototype.InsertLocalMinima=function(newLm){if(null===this.m_MinimaList)this.m_MinimaList=newLm;else if(newLm.Y>=this.m_MinimaList.Y)newLm.Next=this.m_MinimaList,this.m_MinimaList=newLm;else{for(var tmpLm=this.m_MinimaList;null!==tmpLm.Next&&newLm.Y<tmpLm.Next.Y;)tmpLm=tmpLm.Next;newLm.Next=tmpLm.Next,tmpLm.Next=newLm}},ClipperLib.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)},ClipperLib.ClipperBase.prototype.ReverseHorizontal=function(e){var tmp=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=tmp},ClipperLib.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!=this.m_CurrentLM)for(var lm=this.m_MinimaList;null!=lm;){var e=lm.LeftBound;null!=e&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.Side=ClipperLib.EdgeSide.esLeft,e.OutIdx=ClipperLib.ClipperBase.Unassigned),null!=(e=lm.RightBound)&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.Side=ClipperLib.EdgeSide.esRight,e.OutIdx=ClipperLib.ClipperBase.Unassigned),lm=lm.Next}},ClipperLib.Clipper=function(InitOptions){void 0===InitOptions&&(InitOptions=0),this.m_PolyOuts=null,this.m_ClipType=ClipperLib.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=ClipperLib.PolyFillType.pftEvenOdd,this.m_SubjFillType=ClipperLib.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,ClipperLib.ClipperBase.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=ClipperLib.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!=(1&InitOptions),this.StrictlySimple=0!=(2&InitOptions),this.PreserveCollinear=0!=(4&InitOptions)},ClipperLib.Clipper.ioReverseSolution=1,ClipperLib.Clipper.ioStrictlySimple=2,ClipperLib.Clipper.ioPreserveCollinear=4,ClipperLib.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),ClipperLib.ClipperBase.prototype.Clear.call(this))},ClipperLib.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var sb2=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=sb2}},ClipperLib.Clipper.prototype.Reset=function(){ClipperLib.ClipperBase.prototype.Reset.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null;for(var lm=this.m_MinimaList;null!==lm;)this.InsertScanbeam(lm.Y),lm=lm.Next},ClipperLib.Clipper.prototype.InsertScanbeam=function(Y){if(null===this.m_Scanbeam)this.m_Scanbeam=new ClipperLib.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=Y;else if(Y>this.m_Scanbeam.Y){(newSb=new ClipperLib.Scanbeam).Y=Y,newSb.Next=this.m_Scanbeam,this.m_Scanbeam=newSb}else{for(var sb2=this.m_Scanbeam;null!==sb2.Next&&Y<=sb2.Next.Y;)sb2=sb2.Next;if(Y==sb2.Y)return;var newSb;(newSb=new ClipperLib.Scanbeam).Y=Y,newSb.Next=sb2.Next,sb2.Next=newSb}},ClipperLib.Clipper.prototype.Execute=function(){var a=arguments,alen=a.length,ispolytree=a[1]instanceof ClipperLib.PolyTree;if(4==alen&&!ispolytree){var clipType=a[0],solution=a[1],subjFillType=a[2],clipFillType=a[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&ClipperLib.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,ClipperLib.Clear(solution),this.m_SubjFillType=subjFillType,this.m_ClipFillType=clipFillType,this.m_ClipType=clipType,this.m_UsingPolyTree=!1;try{(succeeded=this.ExecuteInternal())&&this.BuildResult(solution)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return succeeded}if(4==alen&&ispolytree){clipType=a[0];var polytree=a[1];subjFillType=a[2],clipFillType=a[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=subjFillType,this.m_ClipFillType=clipFillType,this.m_ClipType=clipType,this.m_UsingPolyTree=!0;try{var succeeded;(succeeded=this.ExecuteInternal())&&this.BuildResult2(polytree)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return succeeded}if(2==alen&&!ispolytree){clipType=a[0],solution=a[1];return this.Execute(clipType,solution,ClipperLib.PolyFillType.pftEvenOdd,ClipperLib.PolyFillType.pftEvenOdd)}if(2==alen&&ispolytree){clipType=a[0],polytree=a[1];return this.Execute(clipType,polytree,ClipperLib.PolyFillType.pftEvenOdd,ClipperLib.PolyFillType.pftEvenOdd)}},ClipperLib.Clipper.prototype.FixHoleLinkage=function(outRec){if(null!==outRec.FirstLeft&&(outRec.IsHole==outRec.FirstLeft.IsHole||null===outRec.FirstLeft.Pts)){for(var orfl=outRec.FirstLeft;null!==orfl&&(orfl.IsHole==outRec.IsHole||null===orfl.Pts);)orfl=orfl.FirstLeft;outRec.FirstLeft=orfl}},ClipperLib.Clipper.prototype.ExecuteInternal=function(){try{if(this.Reset(),null===this.m_CurrentLM)return!1;var botY=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(botY),ClipperLib.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),null===this.m_Scanbeam)break;var topY=this.PopScanbeam();if(!this.ProcessIntersections(botY,topY))return!1;this.ProcessEdgesAtTopOfScanbeam(topY),botY=topY}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){null===(outRec=this.m_PolyOuts[i]).Pts||outRec.IsOpen||(outRec.IsHole^this.ReverseSolution)==this.Area(outRec)>0&&this.ReversePolyPtLinks(outRec.Pts)}this.JoinCommonEdges();for(i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec;null===(outRec=this.m_PolyOuts[i]).Pts||outRec.IsOpen||this.FixupOutPolygon(outRec)}return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{ClipperLib.Clear(this.m_Joins),ClipperLib.Clear(this.m_GhostJoins)}},ClipperLib.Clipper.prototype.PopScanbeam=function(){var Y=this.m_Scanbeam.Y;this.m_Scanbeam;return this.m_Scanbeam=this.m_Scanbeam.Next,null,Y},ClipperLib.Clipper.prototype.DisposeAllPolyPts=function(){for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;++i)this.DisposeOutRec(i);ClipperLib.Clear(this.m_PolyOuts)},ClipperLib.Clipper.prototype.DisposeOutRec=function(index){var outRec=this.m_PolyOuts[index];null!==outRec.Pts&&this.DisposeOutPts(outRec.Pts),outRec=null,this.m_PolyOuts[index]=null},ClipperLib.Clipper.prototype.DisposeOutPts=function(pp){if(null!==pp)for(pp.Prev.Next=null;null!==pp;)pp=pp.Next},ClipperLib.Clipper.prototype.AddJoin=function(Op1,Op2,OffPt){var j=new ClipperLib.Join;j.OutPt1=Op1,j.OutPt2=Op2,j.OffPt.X=OffPt.X,j.OffPt.Y=OffPt.Y,this.m_Joins.push(j)},ClipperLib.Clipper.prototype.AddGhostJoin=function(Op,OffPt){var j=new ClipperLib.Join;j.OutPt1=Op,j.OffPt.X=OffPt.X,j.OffPt.Y=OffPt.Y,this.m_GhostJoins.push(j)},ClipperLib.Clipper.prototype.InsertLocalMinimaIntoAEL=function(botY){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==botY;){var lb=this.m_CurrentLM.LeftBound,rb=this.m_CurrentLM.RightBound;this.PopLocalMinima();var Op1=null;if(null===lb?(this.InsertEdgeIntoAEL(rb,null),this.SetWindingCount(rb),this.IsContributing(rb)&&(Op1=this.AddOutPt(rb,rb.Bot))):null==rb?(this.InsertEdgeIntoAEL(lb,null),this.SetWindingCount(lb),this.IsContributing(lb)&&(Op1=this.AddOutPt(lb,lb.Bot)),this.InsertScanbeam(lb.Top.Y)):(this.InsertEdgeIntoAEL(lb,null),this.InsertEdgeIntoAEL(rb,lb),this.SetWindingCount(lb),rb.WindCnt=lb.WindCnt,rb.WindCnt2=lb.WindCnt2,this.IsContributing(lb)&&(Op1=this.AddLocalMinPoly(lb,rb,lb.Bot)),this.InsertScanbeam(lb.Top.Y)),null!=rb&&(ClipperLib.ClipperBase.IsHorizontal(rb)?this.AddEdgeToSEL(rb):this.InsertScanbeam(rb.Top.Y)),null!=lb&&null!=rb){if(null!==Op1&&ClipperLib.ClipperBase.IsHorizontal(rb)&&this.m_GhostJoins.length>0&&0!==rb.WindDelta)for(var i=0,ilen=this.m_GhostJoins.length;i<ilen;i++){var j=this.m_GhostJoins[i];this.HorzSegmentsOverlap(j.OutPt1.Pt,j.OffPt,rb.Bot,rb.Top)&&this.AddJoin(j.OutPt1,Op1,j.OffPt)}if(lb.OutIdx>=0&&null!==lb.PrevInAEL&&lb.PrevInAEL.Curr.X==lb.Bot.X&&lb.PrevInAEL.OutIdx>=0&&ClipperLib.ClipperBase.SlopesEqual(lb.PrevInAEL,lb,this.m_UseFullRange)&&0!==lb.WindDelta&&0!==lb.PrevInAEL.WindDelta){var Op2=this.AddOutPt(lb.PrevInAEL,lb.Bot);this.AddJoin(Op1,Op2,lb.Top)}if(lb.NextInAEL!=rb){if(rb.OutIdx>=0&&rb.PrevInAEL.OutIdx>=0&&ClipperLib.ClipperBase.SlopesEqual(rb.PrevInAEL,rb,this.m_UseFullRange)&&0!==rb.WindDelta&&0!==rb.PrevInAEL.WindDelta){Op2=this.AddOutPt(rb.PrevInAEL,rb.Bot);this.AddJoin(Op1,Op2,rb.Top)}var e=lb.NextInAEL;if(null!==e)for(;e!=rb;)this.IntersectEdges(rb,e,lb.Curr,!1),e=e.NextInAEL}}}},ClipperLib.Clipper.prototype.InsertEdgeIntoAEL=function(edge,startEdge){if(null===this.m_ActiveEdges)edge.PrevInAEL=null,edge.NextInAEL=null,this.m_ActiveEdges=edge;else if(null===startEdge&&this.E2InsertsBeforeE1(this.m_ActiveEdges,edge))edge.PrevInAEL=null,edge.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=edge,this.m_ActiveEdges=edge;else{for(null===startEdge&&(startEdge=this.m_ActiveEdges);null!==startEdge.NextInAEL&&!this.E2InsertsBeforeE1(startEdge.NextInAEL,edge);)startEdge=startEdge.NextInAEL;edge.NextInAEL=startEdge.NextInAEL,null!==startEdge.NextInAEL&&(startEdge.NextInAEL.PrevInAEL=edge),edge.PrevInAEL=startEdge,startEdge.NextInAEL=edge}},ClipperLib.Clipper.prototype.E2InsertsBeforeE1=function(e1,e2){return e2.Curr.X==e1.Curr.X?e2.Top.Y>e1.Top.Y?e2.Top.X<ClipperLib.Clipper.TopX(e1,e2.Top.Y):e1.Top.X>ClipperLib.Clipper.TopX(e2,e1.Top.Y):e2.Curr.X<e1.Curr.X},ClipperLib.Clipper.prototype.IsEvenOddFillType=function(edge){return edge.PolyTyp==ClipperLib.PolyType.ptSubject?this.m_SubjFillType==ClipperLib.PolyFillType.pftEvenOdd:this.m_ClipFillType==ClipperLib.PolyFillType.pftEvenOdd},ClipperLib.Clipper.prototype.IsEvenOddAltFillType=function(edge){return edge.PolyTyp==ClipperLib.PolyType.ptSubject?this.m_ClipFillType==ClipperLib.PolyFillType.pftEvenOdd:this.m_SubjFillType==ClipperLib.PolyFillType.pftEvenOdd},ClipperLib.Clipper.prototype.IsContributing=function(edge){var pft,pft2;switch(edge.PolyTyp==ClipperLib.PolyType.ptSubject?(pft=this.m_SubjFillType,pft2=this.m_ClipFillType):(pft=this.m_ClipFillType,pft2=this.m_SubjFillType),pft){case ClipperLib.PolyFillType.pftEvenOdd:if(0===edge.WindDelta&&1!=edge.WindCnt)return!1;break;case ClipperLib.PolyFillType.pftNonZero:if(1!=Math.abs(edge.WindCnt))return!1;break;case ClipperLib.PolyFillType.pftPositive:if(1!=edge.WindCnt)return!1;break;default:if(-1!=edge.WindCnt)return!1}switch(this.m_ClipType){case ClipperLib.ClipType.ctIntersection:switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0!==edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return edge.WindCnt2>0;default:return edge.WindCnt2<0}case ClipperLib.ClipType.ctUnion:switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0===edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return edge.WindCnt2<=0;default:return edge.WindCnt2>=0}case ClipperLib.ClipType.ctDifference:if(edge.PolyTyp==ClipperLib.PolyType.ptSubject)switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0===edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return edge.WindCnt2<=0;default:return edge.WindCnt2>=0}else switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0!==edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return edge.WindCnt2>0;default:return edge.WindCnt2<0}case ClipperLib.ClipType.ctXor:if(0!==edge.WindDelta)return!0;switch(pft2){case ClipperLib.PolyFillType.pftEvenOdd:case ClipperLib.PolyFillType.pftNonZero:return 0===edge.WindCnt2;case ClipperLib.PolyFillType.pftPositive:return edge.WindCnt2<=0;default:return edge.WindCnt2>=0}}return!0},ClipperLib.Clipper.prototype.SetWindingCount=function(edge){for(var e=edge.PrevInAEL;null!==e&&(e.PolyTyp!=edge.PolyTyp||0===e.WindDelta);)e=e.PrevInAEL;if(null===e)edge.WindCnt=0===edge.WindDelta?1:edge.WindDelta,edge.WindCnt2=0,e=this.m_ActiveEdges;else if(0===edge.WindDelta&&this.m_ClipType!=ClipperLib.ClipType.ctUnion)edge.WindCnt=1,edge.WindCnt2=e.WindCnt2,e=e.NextInAEL;else if(this.IsEvenOddFillType(edge)){if(0===edge.WindDelta){for(var Inside=!0,e2=e.PrevInAEL;null!==e2;)e2.PolyTyp==e.PolyTyp&&0!==e2.WindDelta&&(Inside=!Inside),e2=e2.PrevInAEL;edge.WindCnt=Inside?0:1}else edge.WindCnt=edge.WindDelta;edge.WindCnt2=e.WindCnt2,e=e.NextInAEL}else e.WindCnt*e.WindDelta<0?Math.abs(e.WindCnt)>1?e.WindDelta*edge.WindDelta<0?edge.WindCnt=e.WindCnt:edge.WindCnt=e.WindCnt+edge.WindDelta:edge.WindCnt=0===edge.WindDelta?1:edge.WindDelta:0===edge.WindDelta?edge.WindCnt=e.WindCnt<0?e.WindCnt-1:e.WindCnt+1:e.WindDelta*edge.WindDelta<0?edge.WindCnt=e.WindCnt:edge.WindCnt=e.WindCnt+edge.WindDelta,edge.WindCnt2=e.WindCnt2,e=e.NextInAEL;if(this.IsEvenOddAltFillType(edge))for(;e!=edge;)0!==e.WindDelta&&(edge.WindCnt2=0===edge.WindCnt2?1:0),e=e.NextInAEL;else for(;e!=edge;)edge.WindCnt2+=e.WindDelta,e=e.NextInAEL},ClipperLib.Clipper.prototype.AddEdgeToSEL=function(edge){null===this.m_SortedEdges?(this.m_SortedEdges=edge,edge.PrevInSEL=null,edge.NextInSEL=null):(edge.NextInSEL=this.m_SortedEdges,edge.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=edge,this.m_SortedEdges=edge)},ClipperLib.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e=e.NextInAEL},ClipperLib.Clipper.prototype.SwapPositionsInAEL=function(edge1,edge2){if(edge1.NextInAEL!=edge1.PrevInAEL&&edge2.NextInAEL!=edge2.PrevInAEL){if(edge1.NextInAEL==edge2)null!==(next=edge2.NextInAEL)&&(next.PrevInAEL=edge1),null!==(prev=edge1.PrevInAEL)&&(prev.NextInAEL=edge2),edge2.PrevInAEL=prev,edge2.NextInAEL=edge1,edge1.PrevInAEL=edge2,edge1.NextInAEL=next;else if(edge2.NextInAEL==edge1){null!==(next=edge1.NextInAEL)&&(next.PrevInAEL=edge2),null!==(prev=edge2.PrevInAEL)&&(prev.NextInAEL=edge1),edge1.PrevInAEL=prev,edge1.NextInAEL=edge2,edge2.PrevInAEL=edge1,edge2.NextInAEL=next}else{var next=edge1.NextInAEL,prev=edge1.PrevInAEL;edge1.NextInAEL=edge2.NextInAEL,null!==edge1.NextInAEL&&(edge1.NextInAEL.PrevInAEL=edge1),edge1.PrevInAEL=edge2.PrevInAEL,null!==edge1.PrevInAEL&&(edge1.PrevInAEL.NextInAEL=edge1),edge2.NextInAEL=next,null!==edge2.NextInAEL&&(edge2.NextInAEL.PrevInAEL=edge2),edge2.PrevInAEL=prev,null!==edge2.PrevInAEL&&(edge2.PrevInAEL.NextInAEL=edge2)}null===edge1.PrevInAEL?this.m_ActiveEdges=edge1:null===edge2.PrevInAEL&&(this.m_ActiveEdges=edge2)}},ClipperLib.Clipper.prototype.SwapPositionsInSEL=function(edge1,edge2){if(!(null===edge1.NextInSEL&&null===edge1.PrevInSEL||null===edge2.NextInSEL&&null===edge2.PrevInSEL)){if(edge1.NextInSEL==edge2)null!==(next=edge2.NextInSEL)&&(next.PrevInSEL=edge1),null!==(prev=edge1.PrevInSEL)&&(prev.NextInSEL=edge2),edge2.PrevInSEL=prev,edge2.NextInSEL=edge1,edge1.PrevInSEL=edge2,edge1.NextInSEL=next;else if(edge2.NextInSEL==edge1){null!==(next=edge1.NextInSEL)&&(next.PrevInSEL=edge2),null!==(prev=edge2.PrevInSEL)&&(prev.NextInSEL=edge1),edge1.PrevInSEL=prev,edge1.NextInSEL=edge2,edge2.PrevInSEL=edge1,edge2.NextInSEL=next}else{var next=edge1.NextInSEL,prev=edge1.PrevInSEL;edge1.NextInSEL=edge2.NextInSEL,null!==edge1.NextInSEL&&(edge1.NextInSEL.PrevInSEL=edge1),edge1.PrevInSEL=edge2.PrevInSEL,null!==edge1.PrevInSEL&&(edge1.PrevInSEL.NextInSEL=edge1),edge2.NextInSEL=next,null!==edge2.NextInSEL&&(edge2.NextInSEL.PrevInSEL=edge2),edge2.PrevInSEL=prev,null!==edge2.PrevInSEL&&(edge2.PrevInSEL.NextInSEL=edge2)}null===edge1.PrevInSEL?this.m_SortedEdges=edge1:null===edge2.PrevInSEL&&(this.m_SortedEdges=edge2)}},ClipperLib.Clipper.prototype.AddLocalMaxPoly=function(e1,e2,pt){this.AddOutPt(e1,pt),0==e2.WindDelta&&this.AddOutPt(e2,pt),e1.OutIdx==e2.OutIdx?(e1.OutIdx=-1,e2.OutIdx=-1):e1.OutIdx<e2.OutIdx?this.AppendPolygon(e1,e2):this.AppendPolygon(e2,e1)},ClipperLib.Clipper.prototype.AddLocalMinPoly=function(e1,e2,pt){var result,e,prevE;if(ClipperLib.ClipperBase.IsHorizontal(e2)||e1.Dx>e2.Dx?(result=this.AddOutPt(e1,pt),e2.OutIdx=e1.OutIdx,e1.Side=ClipperLib.EdgeSide.esLeft,e2.Side=ClipperLib.EdgeSide.esRight,prevE=(e=e1).PrevInAEL==e2?e2.PrevInAEL:e.PrevInAEL):(result=this.AddOutPt(e2,pt),e1.OutIdx=e2.OutIdx,e1.Side=ClipperLib.EdgeSide.esRight,e2.Side=ClipperLib.EdgeSide.esLeft,prevE=(e=e2).PrevInAEL==e1?e1.PrevInAEL:e.PrevInAEL),null!==prevE&&prevE.OutIdx>=0&&ClipperLib.Clipper.TopX(prevE,pt.Y)==ClipperLib.Clipper.TopX(e,pt.Y)&&ClipperLib.ClipperBase.SlopesEqual(e,prevE,this.m_UseFullRange)&&0!==e.WindDelta&&0!==prevE.WindDelta){var outPt=this.AddOutPt(prevE,pt);this.AddJoin(result,outPt,e.Top)}return result},ClipperLib.Clipper.prototype.CreateOutRec=function(){var result=new ClipperLib.OutRec;return result.Idx=-1,result.IsHole=!1,result.IsOpen=!1,result.FirstLeft=null,result.Pts=null,result.BottomPt=null,result.PolyNode=null,this.m_PolyOuts.push(result),result.Idx=this.m_PolyOuts.length-1,result},ClipperLib.Clipper.prototype.AddOutPt=function(e,pt){var ToFront=e.Side==ClipperLib.EdgeSide.esLeft;if(e.OutIdx<0){(outRec=this.CreateOutRec()).IsOpen=0===e.WindDelta;var newOp=new ClipperLib.OutPt;return outRec.Pts=newOp,newOp.Idx=outRec.Idx,newOp.Pt.X=pt.X,newOp.Pt.Y=pt.Y,newOp.Next=newOp,newOp.Prev=newOp,outRec.IsOpen||this.SetHoleState(e,outRec),e.OutIdx=outRec.Idx,newOp}var outRec,op=(outRec=this.m_PolyOuts[e.OutIdx]).Pts;return ToFront&&ClipperLib.IntPoint.op_Equality(pt,op.Pt)?op:!ToFront&&ClipperLib.IntPoint.op_Equality(pt,op.Prev.Pt)?op.Prev:((newOp=new ClipperLib.OutPt).Idx=outRec.Idx,newOp.Pt.X=pt.X,newOp.Pt.Y=pt.Y,newOp.Next=op,newOp.Prev=op.Prev,newOp.Prev.Next=newOp,op.Prev=newOp,ToFront&&(outRec.Pts=newOp),newOp)},ClipperLib.Clipper.prototype.SwapPoints=function(pt1,pt2){var tmp=new ClipperLib.IntPoint(pt1.Value);pt1.Value.X=pt2.Value.X,pt1.Value.Y=pt2.Value.Y,pt2.Value.X=tmp.X,pt2.Value.Y=tmp.Y},ClipperLib.Clipper.prototype.HorzSegmentsOverlap=function(Pt1a,Pt1b,Pt2a,Pt2b){return Pt1a.X>Pt2a.X==Pt1a.X<Pt2b.X||(Pt1b.X>Pt2a.X==Pt1b.X<Pt2b.X||(Pt2a.X>Pt1a.X==Pt2a.X<Pt1b.X||(Pt2b.X>Pt1a.X==Pt2b.X<Pt1b.X||(Pt1a.X==Pt2a.X&&Pt1b.X==Pt2b.X||Pt1a.X==Pt2b.X&&Pt1b.X==Pt2a.X))))},ClipperLib.Clipper.prototype.InsertPolyPtBetween=function(p1,p2,pt){var result=new ClipperLib.OutPt;return result.Pt.X=pt.X,result.Pt.Y=pt.Y,p2==p1.Next?(p1.Next=result,p2.Prev=result,result.Next=p2,result.Prev=p1):(p2.Next=result,p1.Prev=result,result.Next=p1,result.Prev=p2),result},ClipperLib.Clipper.prototype.SetHoleState=function(e,outRec){for(var isHole=!1,e2=e.PrevInAEL;null!==e2;)e2.OutIdx>=0&&0!=e2.WindDelta&&(isHole=!isHole,null===outRec.FirstLeft&&(outRec.FirstLeft=this.m_PolyOuts[e2.OutIdx])),e2=e2.PrevInAEL;isHole&&(outRec.IsHole=!0)},ClipperLib.Clipper.prototype.GetDx=function(pt1,pt2){return pt1.Y==pt2.Y?ClipperLib.ClipperBase.horizontal:(pt2.X-pt1.X)/(pt2.Y-pt1.Y)},ClipperLib.Clipper.prototype.FirstIsBottomPt=function(btmPt1,btmPt2){for(var p=btmPt1.Prev;ClipperLib.IntPoint.op_Equality(p.Pt,btmPt1.Pt)&&p!=btmPt1;)p=p.Prev;var dx1p=Math.abs(this.GetDx(btmPt1.Pt,p.Pt));for(p=btmPt1.Next;ClipperLib.IntPoint.op_Equality(p.Pt,btmPt1.Pt)&&p!=btmPt1;)p=p.Next;var dx1n=Math.abs(this.GetDx(btmPt1.Pt,p.Pt));for(p=btmPt2.Prev;ClipperLib.IntPoint.op_Equality(p.Pt,btmPt2.Pt)&&p!=btmPt2;)p=p.Prev;var dx2p=Math.abs(this.GetDx(btmPt2.Pt,p.Pt));for(p=btmPt2.Next;ClipperLib.IntPoint.op_Equality(p.Pt,btmPt2.Pt)&&p!=btmPt2;)p=p.Next;var dx2n=Math.abs(this.GetDx(btmPt2.Pt,p.Pt));return dx1p>=dx2p&&dx1p>=dx2n||dx1n>=dx2p&&dx1n>=dx2n},ClipperLib.Clipper.prototype.GetBottomPt=function(pp){for(var dups=null,p=pp.Next;p!=pp;)p.Pt.Y>pp.Pt.Y?(pp=p,dups=null):p.Pt.Y==pp.Pt.Y&&p.Pt.X<=pp.Pt.X&&(p.Pt.X<pp.Pt.X?(dups=null,pp=p):p.Next!=pp&&p.Prev!=pp&&(dups=p)),p=p.Next;if(null!==dups)for(;dups!=p;)for(this.FirstIsBottomPt(p,dups)||(pp=dups),dups=dups.Next;ClipperLib.IntPoint.op_Inequality(dups.Pt,pp.Pt);)dups=dups.Next;return pp},ClipperLib.Clipper.prototype.GetLowermostRec=function(outRec1,outRec2){null===outRec1.BottomPt&&(outRec1.BottomPt=this.GetBottomPt(outRec1.Pts)),null===outRec2.BottomPt&&(outRec2.BottomPt=this.GetBottomPt(outRec2.Pts));var bPt1=outRec1.BottomPt,bPt2=outRec2.BottomPt;return bPt1.Pt.Y>bPt2.Pt.Y?outRec1:bPt1.Pt.Y<bPt2.Pt.Y?outRec2:bPt1.Pt.X<bPt2.Pt.X?outRec1:bPt1.Pt.X>bPt2.Pt.X||bPt1.Next==bPt1?outRec2:bPt2.Next==bPt2||this.FirstIsBottomPt(bPt1,bPt2)?outRec1:outRec2},ClipperLib.Clipper.prototype.Param1RightOfParam2=function(outRec1,outRec2){do{if((outRec1=outRec1.FirstLeft)==outRec2)return!0}while(null!==outRec1);return!1},ClipperLib.Clipper.prototype.GetOutRec=function(idx){for(var outrec=this.m_PolyOuts[idx];outrec!=this.m_PolyOuts[outrec.Idx];)outrec=this.m_PolyOuts[outrec.Idx];return outrec},ClipperLib.Clipper.prototype.AppendPolygon=function(e1,e2){var holeStateRec,outRec1=this.m_PolyOuts[e1.OutIdx],outRec2=this.m_PolyOuts[e2.OutIdx];holeStateRec=this.Param1RightOfParam2(outRec1,outRec2)?outRec2:this.Param1RightOfParam2(outRec2,outRec1)?outRec1:this.GetLowermostRec(outRec1,outRec2);var side,p1_lft=outRec1.Pts,p1_rt=p1_lft.Prev,p2_lft=outRec2.Pts,p2_rt=p2_lft.Prev;e1.Side==ClipperLib.EdgeSide.esLeft?(e2.Side==ClipperLib.EdgeSide.esLeft?(this.ReversePolyPtLinks(p2_lft),p2_lft.Next=p1_lft,p1_lft.Prev=p2_lft,p1_rt.Next=p2_rt,p2_rt.Prev=p1_rt,outRec1.Pts=p2_rt):(p2_rt.Next=p1_lft,p1_lft.Prev=p2_rt,p2_lft.Prev=p1_rt,p1_rt.Next=p2_lft,outRec1.Pts=p2_lft),side=ClipperLib.EdgeSide.esLeft):(e2.Side==ClipperLib.EdgeSide.esRight?(this.ReversePolyPtLinks(p2_lft),p1_rt.Next=p2_rt,p2_rt.Prev=p1_rt,p2_lft.Next=p1_lft,p1_lft.Prev=p2_lft):(p1_rt.Next=p2_lft,p2_lft.Prev=p1_rt,p1_lft.Prev=p2_rt,p2_rt.Next=p1_lft),side=ClipperLib.EdgeSide.esRight),outRec1.BottomPt=null,holeStateRec==outRec2&&(outRec2.FirstLeft!=outRec1&&(outRec1.FirstLeft=outRec2.FirstLeft),outRec1.IsHole=outRec2.IsHole),outRec2.Pts=null,outRec2.BottomPt=null,outRec2.FirstLeft=outRec1;var OKIdx=e1.OutIdx,ObsoleteIdx=e2.OutIdx;e1.OutIdx=-1,e2.OutIdx=-1;for(var e=this.m_ActiveEdges;null!==e;){if(e.OutIdx==ObsoleteIdx){e.OutIdx=OKIdx,e.Side=side;break}e=e.NextInAEL}outRec2.Idx=outRec1.Idx},ClipperLib.Clipper.prototype.ReversePolyPtLinks=function(pp){if(null!==pp){var pp1,pp2;pp1=pp;do{pp2=pp1.Next,pp1.Next=pp1.Prev,pp1.Prev=pp2,pp1=pp2}while(pp1!=pp)}},ClipperLib.Clipper.SwapSides=function(edge1,edge2){var side=edge1.Side;edge1.Side=edge2.Side,edge2.Side=side},ClipperLib.Clipper.SwapPolyIndexes=function(edge1,edge2){var outIdx=edge1.OutIdx;edge1.OutIdx=edge2.OutIdx,edge2.OutIdx=outIdx},ClipperLib.Clipper.prototype.IntersectEdges=function(e1,e2,pt,protect){var e1FillType,e2FillType,e1FillType2,e2FillType2,e1Wc,e2Wc,e1stops=!protect&&null===e1.NextInLML&&e1.Top.X==pt.X&&e1.Top.Y==pt.Y,e2stops=!protect&&null===e2.NextInLML&&e2.Top.X==pt.X&&e2.Top.Y==pt.Y,e1Contributing=e1.OutIdx>=0,e2Contributing=e2.OutIdx>=0;if(0===e1.WindDelta||0===e2.WindDelta)return 0===e1.WindDelta&&0===e2.WindDelta?(e1stops||e2stops)&&e1Contributing&&e2Contributing&&this.AddLocalMaxPoly(e1,e2,pt):e1.PolyTyp==e2.PolyTyp&&e1.WindDelta!=e2.WindDelta&&this.m_ClipType==ClipperLib.ClipType.ctUnion?0===e1.WindDelta?e2Contributing&&(this.AddOutPt(e1,pt),e1Contributing&&(e1.OutIdx=-1)):e1Contributing&&(this.AddOutPt(e2,pt),e2Contributing&&(e2.OutIdx=-1)):e1.PolyTyp!=e2.PolyTyp&&(0!==e1.WindDelta||1!=Math.abs(e2.WindCnt)||this.m_ClipType==ClipperLib.ClipType.ctUnion&&0!==e2.WindCnt2?0!==e2.WindDelta||1!=Math.abs(e1.WindCnt)||this.m_ClipType==ClipperLib.ClipType.ctUnion&&0!==e1.WindCnt2||(this.AddOutPt(e2,pt),e2Contributing&&(e2.OutIdx=-1)):(this.AddOutPt(e1,pt),e1Contributing&&(e1.OutIdx=-1))),e1stops&&(e1.OutIdx<0?this.DeleteFromAEL(e1):ClipperLib.Error("Error intersecting polylines")),void(e2stops&&(e2.OutIdx<0?this.DeleteFromAEL(e2):ClipperLib.Error("Error intersecting polylines")));if(e1.PolyTyp==e2.PolyTyp)if(this.IsEvenOddFillType(e1)){var oldE1WindCnt=e1.WindCnt;e1.WindCnt=e2.WindCnt,e2.WindCnt=oldE1WindCnt}else e1.WindCnt+e2.WindDelta===0?e1.WindCnt=-e1.WindCnt:e1.WindCnt+=e2.WindDelta,e2.WindCnt-e1.WindDelta==0?e2.WindCnt=-e2.WindCnt:e2.WindCnt-=e1.WindDelta;else this.IsEvenOddFillType(e2)?e1.WindCnt2=0===e1.WindCnt2?1:0:e1.WindCnt2+=e2.WindDelta,this.IsEvenOddFillType(e1)?e2.WindCnt2=0===e2.WindCnt2?1:0:e2.WindCnt2-=e1.WindDelta;switch(e1.PolyTyp==ClipperLib.PolyType.ptSubject?(e1FillType=this.m_SubjFillType,e1FillType2=this.m_ClipFillType):(e1FillType=this.m_ClipFillType,e1FillType2=this.m_SubjFillType),e2.PolyTyp==ClipperLib.PolyType.ptSubject?(e2FillType=this.m_SubjFillType,e2FillType2=this.m_ClipFillType):(e2FillType=this.m_ClipFillType,e2FillType2=this.m_SubjFillType),e1FillType){case ClipperLib.PolyFillType.pftPositive:e1Wc=e1.WindCnt;break;case ClipperLib.PolyFillType.pftNegative:e1Wc=-e1.WindCnt;break;default:e1Wc=Math.abs(e1.WindCnt)}switch(e2FillType){case ClipperLib.PolyFillType.pftPositive:e2Wc=e2.WindCnt;break;case ClipperLib.PolyFillType.pftNegative:e2Wc=-e2.WindCnt;break;default:e2Wc=Math.abs(e2.WindCnt)}if(e1Contributing&&e2Contributing)e1stops||e2stops||0!==e1Wc&&1!=e1Wc||0!==e2Wc&&1!=e2Wc||e1.PolyTyp!=e2.PolyTyp&&this.m_ClipType!=ClipperLib.ClipType.ctXor?this.AddLocalMaxPoly(e1,e2,pt):(this.AddOutPt(e1,pt),this.AddOutPt(e2,pt),ClipperLib.Clipper.SwapSides(e1,e2),ClipperLib.Clipper.SwapPolyIndexes(e1,e2));else if(e1Contributing)0!==e2Wc&&1!=e2Wc||(this.AddOutPt(e1,pt),ClipperLib.Clipper.SwapSides(e1,e2),ClipperLib.Clipper.SwapPolyIndexes(e1,e2));else if(e2Contributing)0!==e1Wc&&1!=e1Wc||(this.AddOutPt(e2,pt),ClipperLib.Clipper.SwapSides(e1,e2),ClipperLib.Clipper.SwapPolyIndexes(e1,e2));else if(!(0!==e1Wc&&1!=e1Wc||0!==e2Wc&&1!=e2Wc||e1stops||e2stops)){var e1Wc2,e2Wc2;switch(e1FillType2){case ClipperLib.PolyFillType.pftPositive:e1Wc2=e1.WindCnt2;break;case ClipperLib.PolyFillType.pftNegative:e1Wc2=-e1.WindCnt2;break;default:e1Wc2=Math.abs(e1.WindCnt2)}switch(e2FillType2){case ClipperLib.PolyFillType.pftPositive:e2Wc2=e2.WindCnt2;break;case ClipperLib.PolyFillType.pftNegative:e2Wc2=-e2.WindCnt2;break;default:e2Wc2=Math.abs(e2.WindCnt2)}if(e1.PolyTyp!=e2.PolyTyp)this.AddLocalMinPoly(e1,e2,pt);else if(1==e1Wc&&1==e2Wc)switch(this.m_ClipType){case ClipperLib.ClipType.ctIntersection:e1Wc2>0&&e2Wc2>0&&this.AddLocalMinPoly(e1,e2,pt);break;case ClipperLib.ClipType.ctUnion:e1Wc2<=0&&e2Wc2<=0&&this.AddLocalMinPoly(e1,e2,pt);break;case ClipperLib.ClipType.ctDifference:(e1.PolyTyp==ClipperLib.PolyType.ptClip&&e1Wc2>0&&e2Wc2>0||e1.PolyTyp==ClipperLib.PolyType.ptSubject&&e1Wc2<=0&&e2Wc2<=0)&&this.AddLocalMinPoly(e1,e2,pt);break;case ClipperLib.ClipType.ctXor:this.AddLocalMinPoly(e1,e2,pt)}else ClipperLib.Clipper.SwapSides(e1,e2)}e1stops!=e2stops&&(e1stops&&e1.OutIdx>=0||e2stops&&e2.OutIdx>=0)&&(ClipperLib.Clipper.SwapSides(e1,e2),ClipperLib.Clipper.SwapPolyIndexes(e1,e2)),e1stops&&this.DeleteFromAEL(e1),e2stops&&this.DeleteFromAEL(e2)},ClipperLib.Clipper.prototype.DeleteFromAEL=function(e){var AelPrev=e.PrevInAEL,AelNext=e.NextInAEL;null===AelPrev&&null===AelNext&&e!=this.m_ActiveEdges||(null!==AelPrev?AelPrev.NextInAEL=AelNext:this.m_ActiveEdges=AelNext,null!==AelNext&&(AelNext.PrevInAEL=AelPrev),e.NextInAEL=null,e.PrevInAEL=null)},ClipperLib.Clipper.prototype.DeleteFromSEL=function(e){var SelPrev=e.PrevInSEL,SelNext=e.NextInSEL;null===SelPrev&&null===SelNext&&e!=this.m_SortedEdges||(null!==SelPrev?SelPrev.NextInSEL=SelNext:this.m_SortedEdges=SelNext,null!==SelNext&&(SelNext.PrevInSEL=SelPrev),e.NextInSEL=null,e.PrevInSEL=null)},ClipperLib.Clipper.prototype.UpdateEdgeIntoAEL=function(e){null===e.NextInLML&&ClipperLib.Error("UpdateEdgeIntoAEL: invalid call");var AelPrev=e.PrevInAEL,AelNext=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,null!==AelPrev?AelPrev.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,null!==AelNext&&(AelNext.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,(e=e.NextInLML).Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.PrevInAEL=AelPrev,e.NextInAEL=AelNext,ClipperLib.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},ClipperLib.Clipper.prototype.ProcessHorizontals=function(isTopOfScanbeam){for(var horzEdge=this.m_SortedEdges;null!==horzEdge;)this.DeleteFromSEL(horzEdge),this.ProcessHorizontal(horzEdge,isTopOfScanbeam),horzEdge=this.m_SortedEdges},ClipperLib.Clipper.prototype.GetHorzDirection=function(HorzEdge,$var){HorzEdge.Bot.X<HorzEdge.Top.X?($var.Left=HorzEdge.Bot.X,$var.Right=HorzEdge.Top.X,$var.Dir=ClipperLib.Direction.dLeftToRight):($var.Left=HorzEdge.Top.X,$var.Right=HorzEdge.Bot.X,$var.Dir=ClipperLib.Direction.dRightToLeft)},ClipperLib.Clipper.prototype.PrepareHorzJoins=function(horzEdge,isTopOfScanbeam){var outPt=this.m_PolyOuts[horzEdge.OutIdx].Pts;horzEdge.Side!=ClipperLib.EdgeSide.esLeft&&(outPt=outPt.Prev),isTopOfScanbeam&&(ClipperLib.IntPoint.op_Equality(outPt.Pt,horzEdge.Top)?this.AddGhostJoin(outPt,horzEdge.Bot):this.AddGhostJoin(outPt,horzEdge.Top))},ClipperLib.Clipper.prototype.ProcessHorizontal=function(horzEdge,isTopOfScanbeam){var $var={Dir:null,Left:null,Right:null};this.GetHorzDirection(horzEdge,$var);for(var dir=$var.Dir,horzLeft=$var.Left,horzRight=$var.Right,eLastHorz=horzEdge,eMaxPair=null;null!==eLastHorz.NextInLML&&ClipperLib.ClipperBase.IsHorizontal(eLastHorz.NextInLML);)eLastHorz=eLastHorz.NextInLML;for(null===eLastHorz.NextInLML&&(eMaxPair=this.GetMaximaPair(eLastHorz));;){for(var IsLastHorz=horzEdge==eLastHorz,e=this.GetNextInAEL(horzEdge,dir);null!==e&&!(e.Curr.X==horzEdge.Top.X&&null!==horzEdge.NextInLML&&e.Dx<horzEdge.NextInLML.Dx);){var eNext=this.GetNextInAEL(e,dir);if(dir==ClipperLib.Direction.dLeftToRight&&e.Curr.X<=horzRight||dir==ClipperLib.Direction.dRightToLeft&&e.Curr.X>=horzLeft){if(horzEdge.OutIdx>=0&&0!=horzEdge.WindDelta&&this.PrepareHorzJoins(horzEdge,isTopOfScanbeam),e==eMaxPair&&IsLastHorz)return dir==ClipperLib.Direction.dLeftToRight?this.IntersectEdges(horzEdge,e,e.Top,!1):this.IntersectEdges(e,horzEdge,e.Top,!1),void(eMaxPair.OutIdx>=0&&ClipperLib.Error("ProcessHorizontal error"));if(dir==ClipperLib.Direction.dLeftToRight){var Pt=new ClipperLib.IntPoint(e.Curr.X,horzEdge.Curr.Y);this.IntersectEdges(horzEdge,e,Pt,!0)}else{Pt=new ClipperLib.IntPoint(e.Curr.X,horzEdge.Curr.Y);this.IntersectEdges(e,horzEdge,Pt,!0)}this.SwapPositionsInAEL(horzEdge,e)}else if(dir==ClipperLib.Direction.dLeftToRight&&e.Curr.X>=horzRight||dir==ClipperLib.Direction.dRightToLeft&&e.Curr.X<=horzLeft)break;e=eNext}if(horzEdge.OutIdx>=0&&0!==horzEdge.WindDelta&&this.PrepareHorzJoins(horzEdge,isTopOfScanbeam),null===horzEdge.NextInLML||!ClipperLib.ClipperBase.IsHorizontal(horzEdge.NextInLML))break;(horzEdge=this.UpdateEdgeIntoAEL(horzEdge)).OutIdx>=0&&this.AddOutPt(horzEdge,horzEdge.Bot);$var={Dir:dir,Left:horzLeft,Right:horzRight};this.GetHorzDirection(horzEdge,$var),dir=$var.Dir,horzLeft=$var.Left,horzRight=$var.Right}if(null!==horzEdge.NextInLML)if(horzEdge.OutIdx>=0){var op1=this.AddOutPt(horzEdge,horzEdge.Top);if(0===(horzEdge=this.UpdateEdgeIntoAEL(horzEdge)).WindDelta)return;var ePrev=horzEdge.PrevInAEL;eNext=horzEdge.NextInAEL;if(null!==ePrev&&ePrev.Curr.X==horzEdge.Bot.X&&ePrev.Curr.Y==horzEdge.Bot.Y&&0!==ePrev.WindDelta&&ePrev.OutIdx>=0&&ePrev.Curr.Y>ePrev.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(horzEdge,ePrev,this.m_UseFullRange)){var op2=this.AddOutPt(ePrev,horzEdge.Bot);this.AddJoin(op1,op2,horzEdge.Top)}else if(null!==eNext&&eNext.Curr.X==horzEdge.Bot.X&&eNext.Curr.Y==horzEdge.Bot.Y&&0!==eNext.WindDelta&&eNext.OutIdx>=0&&eNext.Curr.Y>eNext.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(horzEdge,eNext,this.m_UseFullRange)){op2=this.AddOutPt(eNext,horzEdge.Bot);this.AddJoin(op1,op2,horzEdge.Top)}}else horzEdge=this.UpdateEdgeIntoAEL(horzEdge);else null!==eMaxPair?eMaxPair.OutIdx>=0?(dir==ClipperLib.Direction.dLeftToRight?this.IntersectEdges(horzEdge,eMaxPair,horzEdge.Top,!1):this.IntersectEdges(eMaxPair,horzEdge,horzEdge.Top,!1),eMaxPair.OutIdx>=0&&ClipperLib.Error("ProcessHorizontal error")):(this.DeleteFromAEL(horzEdge),this.DeleteFromAEL(eMaxPair)):(horzEdge.OutIdx>=0&&this.AddOutPt(horzEdge,horzEdge.Top),this.DeleteFromAEL(horzEdge))},ClipperLib.Clipper.prototype.GetNextInAEL=function(e,Direction){return Direction==ClipperLib.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},ClipperLib.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!=e&&e.Next.NextInLML!=e},ClipperLib.Clipper.prototype.IsMaxima=function(e,Y){return null!==e&&e.Top.Y==Y&&null===e.NextInLML},ClipperLib.Clipper.prototype.IsIntermediate=function(e,Y){return e.Top.Y==Y&&null!==e.NextInLML},ClipperLib.Clipper.prototype.GetMaximaPair=function(e){var result=null;return ClipperLib.IntPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML?result=e.Next:ClipperLib.IntPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML&&(result=e.Prev),null===result||-2!=result.OutIdx&&(result.NextInAEL!=result.PrevInAEL||ClipperLib.ClipperBase.IsHorizontal(result))?result:null},ClipperLib.Clipper.prototype.ProcessIntersections=function(botY,topY){if(null==this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(botY,topY),0==this.m_IntersectList.length)return!0;if(1!=this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch($$e2){this.m_SortedEdges=null,this.m_IntersectList.length=0,ClipperLib.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},ClipperLib.Clipper.prototype.BuildIntersectList=function(botY,topY){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=ClipperLib.Clipper.TopX(e,topY),e=e.NextInAEL;for(var isModified=!0;isModified&&null!==this.m_SortedEdges;){for(isModified=!1,e=this.m_SortedEdges;null!==e.NextInSEL;){var eNext=e.NextInSEL,pt=new ClipperLib.IntPoint;if(e.Curr.X>eNext.Curr.X){!this.IntersectPoint(e,eNext,pt)&&e.Curr.X>eNext.Curr.X+1&&ClipperLib.Error("Intersection error"),pt.Y>botY&&(pt.Y=botY,Math.abs(e.Dx)>Math.abs(eNext.Dx)?pt.X=ClipperLib.Clipper.TopX(eNext,botY):pt.X=ClipperLib.Clipper.TopX(e,botY));var newNode=new ClipperLib.IntersectNode;newNode.Edge1=e,newNode.Edge2=eNext,newNode.Pt.X=pt.X,newNode.Pt.Y=pt.Y,this.m_IntersectList.push(newNode),this.SwapPositionsInSEL(e,eNext),isModified=!0}else e=eNext}if(null===e.PrevInSEL)break;e.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},ClipperLib.Clipper.prototype.EdgesAdjacent=function(inode){return inode.Edge1.NextInSEL==inode.Edge2||inode.Edge1.PrevInSEL==inode.Edge2},ClipperLib.Clipper.IntersectNodeSort=function(node1,node2){return node2.Pt.Y-node1.Pt.Y},ClipperLib.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var cnt=this.m_IntersectList.length,i=0;i<cnt;i++){if(!this.EdgesAdjacent(this.m_IntersectList[i])){for(var j=i+1;j<cnt&&!this.EdgesAdjacent(this.m_IntersectList[j]);)j++;if(j==cnt)return!1;var tmp=this.m_IntersectList[i];this.m_IntersectList[i]=this.m_IntersectList[j],this.m_IntersectList[j]=tmp}this.SwapPositionsInSEL(this.m_IntersectList[i].Edge1,this.m_IntersectList[i].Edge2)}return!0},ClipperLib.Clipper.prototype.ProcessIntersectList=function(){for(var i=0,ilen=this.m_IntersectList.length;i<ilen;i++){var iNode=this.m_IntersectList[i];this.IntersectEdges(iNode.Edge1,iNode.Edge2,iNode.Pt,!0),this.SwapPositionsInAEL(iNode.Edge1,iNode.Edge2)}this.m_IntersectList.length=0};browser.msie?ClipperLib.Clipper.Round=function(a){return a<0?Math.ceil(a-.5):Math.round(a)}:browser.chromium?ClipperLib.Clipper.Round=function(a){return a<0?-Math.round(Math.abs(a)):Math.round(a)}:browser.safari?ClipperLib.Clipper.Round=function(a){return a<0?(a-=.5)<-2147483648?Math.ceil(a):0|a:(a+=.5)>2147483647?Math.floor(a):0|a}:ClipperLib.Clipper.Round=function(a){return a<0?Math.ceil(a-.5):Math.floor(a+.5)},ClipperLib.Clipper.TopX=function(edge,currentY){return currentY==edge.Top.Y?edge.Top.X:edge.Bot.X+ClipperLib.Clipper.Round(edge.Dx*(currentY-edge.Bot.Y))},ClipperLib.Clipper.prototype.IntersectPoint=function(edge1,edge2,ip){var b1,b2;if(ip.X=0,ip.Y=0,ClipperLib.ClipperBase.SlopesEqual(edge1,edge2,this.m_UseFullRange)||edge1.Dx==edge2.Dx)return edge2.Bot.Y>edge1.Bot.Y?(ip.X=edge2.Bot.X,ip.Y=edge2.Bot.Y):(ip.X=edge1.Bot.X,ip.Y=edge1.Bot.Y),!1;if(0===edge1.Delta.X)ip.X=edge1.Bot.X,ClipperLib.ClipperBase.IsHorizontal(edge2)?ip.Y=edge2.Bot.Y:(b2=edge2.Bot.Y-edge2.Bot.X/edge2.Dx,ip.Y=ClipperLib.Clipper.Round(ip.X/edge2.Dx+b2));else if(0===edge2.Delta.X)ip.X=edge2.Bot.X,ClipperLib.ClipperBase.IsHorizontal(edge1)?ip.Y=edge1.Bot.Y:(b1=edge1.Bot.Y-edge1.Bot.X/edge1.Dx,ip.Y=ClipperLib.Clipper.Round(ip.X/edge1.Dx+b1));else{b1=edge1.Bot.X-edge1.Bot.Y*edge1.Dx;var q=((b2=edge2.Bot.X-edge2.Bot.Y*edge2.Dx)-b1)/(edge1.Dx-edge2.Dx);ip.Y=ClipperLib.Clipper.Round(q),Math.abs(edge1.Dx)<Math.abs(edge2.Dx)?ip.X=ClipperLib.Clipper.Round(edge1.Dx*q+b1):ip.X=ClipperLib.Clipper.Round(edge2.Dx*q+b2)}if(ip.Y<edge1.Top.Y||ip.Y<edge2.Top.Y){if(edge1.Top.Y>edge2.Top.Y)return ip.Y=edge1.Top.Y,ip.X=ClipperLib.Clipper.TopX(edge2,edge1.Top.Y),ip.X<edge1.Top.X;ip.Y=edge2.Top.Y,Math.abs(edge1.Dx)<Math.abs(edge2.Dx)?ip.X=ClipperLib.Clipper.TopX(edge1,ip.Y):ip.X=ClipperLib.Clipper.TopX(edge2,ip.Y)}return!0},ClipperLib.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(topY){for(var e=this.m_ActiveEdges;null!==e;){var IsMaximaEdge=this.IsMaxima(e,topY);if(IsMaximaEdge){var eMaxPair=this.GetMaximaPair(e);IsMaximaEdge=null===eMaxPair||!ClipperLib.ClipperBase.IsHorizontal(eMaxPair)}if(IsMaximaEdge){var ePrev=e.PrevInAEL;this.DoMaxima(e),e=null===ePrev?this.m_ActiveEdges:ePrev.NextInAEL}else{if(this.IsIntermediate(e,topY)&&ClipperLib.ClipperBase.IsHorizontal(e.NextInLML)?((e=this.UpdateEdgeIntoAEL(e)).OutIdx>=0&&this.AddOutPt(e,e.Bot),this.AddEdgeToSEL(e)):(e.Curr.X=ClipperLib.Clipper.TopX(e,topY),e.Curr.Y=topY),this.StrictlySimple){ePrev=e.PrevInAEL;if(e.OutIdx>=0&&0!==e.WindDelta&&null!==ePrev&&ePrev.OutIdx>=0&&ePrev.Curr.X==e.Curr.X&&0!==ePrev.WindDelta){var op=this.AddOutPt(ePrev,e.Curr),op2=this.AddOutPt(e,e.Curr);this.AddJoin(op,op2,e.Curr)}}e=e.NextInAEL}}for(this.ProcessHorizontals(!0),e=this.m_ActiveEdges;null!==e;){if(this.IsIntermediate(e,topY)){op=null;e.OutIdx>=0&&(op=this.AddOutPt(e,e.Top));ePrev=(e=this.UpdateEdgeIntoAEL(e)).PrevInAEL;var eNext=e.NextInAEL;if(null!==ePrev&&ePrev.Curr.X==e.Bot.X&&ePrev.Curr.Y==e.Bot.Y&&null!==op&&ePrev.OutIdx>=0&&ePrev.Curr.Y>ePrev.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(e,ePrev,this.m_UseFullRange)&&0!==e.WindDelta&&0!==ePrev.WindDelta){op2=this.AddOutPt(ePrev,e.Bot);this.AddJoin(op,op2,e.Top)}else if(null!==eNext&&eNext.Curr.X==e.Bot.X&&eNext.Curr.Y==e.Bot.Y&&null!==op&&eNext.OutIdx>=0&&eNext.Curr.Y>eNext.Top.Y&&ClipperLib.ClipperBase.SlopesEqual(e,eNext,this.m_UseFullRange)&&0!==e.WindDelta&&0!==eNext.WindDelta){op2=this.AddOutPt(eNext,e.Bot);this.AddJoin(op,op2,e.Top)}}e=e.NextInAEL}},ClipperLib.Clipper.prototype.DoMaxima=function(e){var eMaxPair=this.GetMaximaPair(e);if(null===eMaxPair)return e.OutIdx>=0&&this.AddOutPt(e,e.Top),void this.DeleteFromAEL(e);for(var eNext=e.NextInAEL;null!==eNext&&eNext!=eMaxPair;)this.IntersectEdges(e,eNext,e.Top,!0),this.SwapPositionsInAEL(e,eNext),eNext=e.NextInAEL;-1==e.OutIdx&&-1==eMaxPair.OutIdx?(this.DeleteFromAEL(e),this.DeleteFromAEL(eMaxPair)):e.OutIdx>=0&&eMaxPair.OutIdx>=0?this.IntersectEdges(e,eMaxPair,e.Top,!1):0===e.WindDelta?(e.OutIdx>=0&&(this.AddOutPt(e,e.Top),e.OutIdx=-1),this.DeleteFromAEL(e),eMaxPair.OutIdx>=0&&(this.AddOutPt(eMaxPair,e.Top),eMaxPair.OutIdx=-1),this.DeleteFromAEL(eMaxPair)):ClipperLib.Error("DoMaxima error")},ClipperLib.Clipper.ReversePaths=function(polys){for(var i=0,len=polys.length;i<len;i++)polys[i].reverse()},ClipperLib.Clipper.Orientation=function(poly){return ClipperLib.Clipper.Area(poly)>=0},ClipperLib.Clipper.prototype.PointCount=function(pts){if(null===pts)return 0;var result=0,p=pts;do{result++,p=p.Next}while(p!=pts);return result},ClipperLib.Clipper.prototype.BuildResult=function(polyg){ClipperLib.Clear(polyg);for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];if(null!==outRec.Pts){var p=outRec.Pts.Prev,cnt=this.PointCount(p);if(!(cnt<2)){for(var pg=new Array(cnt),j=0;j<cnt;j++)pg[j]=p.Pt,p=p.Prev;polyg.push(pg)}}}},ClipperLib.Clipper.prototype.BuildResult2=function(polytree){polytree.Clear();for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i],cnt=this.PointCount(outRec.Pts);if(!(outRec.IsOpen&&cnt<2||!outRec.IsOpen&&cnt<3)){this.FixHoleLinkage(outRec);var pn=new ClipperLib.PolyNode;polytree.m_AllPolys.push(pn),outRec.PolyNode=pn,pn.m_polygon.length=cnt;for(var op=outRec.Pts.Prev,j=0;j<cnt;j++)pn.m_polygon[j]=op.Pt,op=op.Prev}}for(i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){null!==(outRec=this.m_PolyOuts[i]).PolyNode&&(outRec.IsOpen?(outRec.PolyNode.IsOpen=!0,polytree.AddChild(outRec.PolyNode)):null!==outRec.FirstLeft&&null!=outRec.FirstLeft.PolyNode?outRec.FirstLeft.PolyNode.AddChild(outRec.PolyNode):polytree.AddChild(outRec.PolyNode))}},ClipperLib.Clipper.prototype.FixupOutPolygon=function(outRec){var lastOK=null;outRec.BottomPt=null;for(var pp=outRec.Pts;;){if(pp.Prev==pp||pp.Prev==pp.Next)return this.DisposeOutPts(pp),void(outRec.Pts=null);if(ClipperLib.IntPoint.op_Equality(pp.Pt,pp.Next.Pt)||ClipperLib.IntPoint.op_Equality(pp.Pt,pp.Prev.Pt)||ClipperLib.ClipperBase.SlopesEqual(pp.Prev.Pt,pp.Pt,pp.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(pp.Prev.Pt,pp.Pt,pp.Next.Pt)))lastOK=null,pp.Prev.Next=pp.Next,pp.Next.Prev=pp.Prev,pp=pp.Prev;else{if(pp==lastOK)break;null===lastOK&&(lastOK=pp),pp=pp.Next}}outRec.Pts=pp},ClipperLib.Clipper.prototype.DupOutPt=function(outPt,InsertAfter){var result=new ClipperLib.OutPt;return result.Pt.X=outPt.Pt.X,result.Pt.Y=outPt.Pt.Y,result.Idx=outPt.Idx,InsertAfter?(result.Next=outPt.Next,result.Prev=outPt,outPt.Next.Prev=result,outPt.Next=result):(result.Prev=outPt.Prev,result.Next=outPt,outPt.Prev.Next=result,outPt.Prev=result),result},ClipperLib.Clipper.prototype.GetOverlap=function(a1,a2,b1,b2,$val){return a1<a2?b1<b2?($val.Left=Math.max(a1,b1),$val.Right=Math.min(a2,b2)):($val.Left=Math.max(a1,b2),$val.Right=Math.min(a2,b1)):b1<b2?($val.Left=Math.max(a2,b1),$val.Right=Math.min(a1,b2)):($val.Left=Math.max(a2,b2),$val.Right=Math.min(a1,b1)),$val.Left<$val.Right},ClipperLib.Clipper.prototype.JoinHorz=function(op1,op1b,op2,op2b,Pt,DiscardLeft){var Dir1=op1.Pt.X>op1b.Pt.X?ClipperLib.Direction.dRightToLeft:ClipperLib.Direction.dLeftToRight,Dir2=op2.Pt.X>op2b.Pt.X?ClipperLib.Direction.dRightToLeft:ClipperLib.Direction.dLeftToRight;if(Dir1==Dir2)return!1;if(Dir1==ClipperLib.Direction.dLeftToRight){for(;op1.Next.Pt.X<=Pt.X&&op1.Next.Pt.X>=op1.Pt.X&&op1.Next.Pt.Y==Pt.Y;)op1=op1.Next;DiscardLeft&&op1.Pt.X!=Pt.X&&(op1=op1.Next),op1b=this.DupOutPt(op1,!DiscardLeft),ClipperLib.IntPoint.op_Inequality(op1b.Pt,Pt)&&((op1=op1b).Pt.X=Pt.X,op1.Pt.Y=Pt.Y,op1b=this.DupOutPt(op1,!DiscardLeft))}else{for(;op1.Next.Pt.X>=Pt.X&&op1.Next.Pt.X<=op1.Pt.X&&op1.Next.Pt.Y==Pt.Y;)op1=op1.Next;DiscardLeft||op1.Pt.X==Pt.X||(op1=op1.Next),op1b=this.DupOutPt(op1,DiscardLeft),ClipperLib.IntPoint.op_Inequality(op1b.Pt,Pt)&&((op1=op1b).Pt.X=Pt.X,op1.Pt.Y=Pt.Y,op1b=this.DupOutPt(op1,DiscardLeft))}if(Dir2==ClipperLib.Direction.dLeftToRight){for(;op2.Next.Pt.X<=Pt.X&&op2.Next.Pt.X>=op2.Pt.X&&op2.Next.Pt.Y==Pt.Y;)op2=op2.Next;DiscardLeft&&op2.Pt.X!=Pt.X&&(op2=op2.Next),op2b=this.DupOutPt(op2,!DiscardLeft),ClipperLib.IntPoint.op_Inequality(op2b.Pt,Pt)&&((op2=op2b).Pt.X=Pt.X,op2.Pt.Y=Pt.Y,op2b=this.DupOutPt(op2,!DiscardLeft))}else{for(;op2.Next.Pt.X>=Pt.X&&op2.Next.Pt.X<=op2.Pt.X&&op2.Next.Pt.Y==Pt.Y;)op2=op2.Next;DiscardLeft||op2.Pt.X==Pt.X||(op2=op2.Next),op2b=this.DupOutPt(op2,DiscardLeft),ClipperLib.IntPoint.op_Inequality(op2b.Pt,Pt)&&((op2=op2b).Pt.X=Pt.X,op2.Pt.Y=Pt.Y,op2b=this.DupOutPt(op2,DiscardLeft))}return Dir1==ClipperLib.Direction.dLeftToRight==DiscardLeft?(op1.Prev=op2,op2.Next=op1,op1b.Next=op2b,op2b.Prev=op1b):(op1.Next=op2,op2.Prev=op1,op1b.Prev=op2b,op2b.Next=op1b),!0},ClipperLib.Clipper.prototype.JoinPoints=function(j,outRec1,outRec2){var op1=j.OutPt1,op1b=new ClipperLib.OutPt,op2=j.OutPt2,op2b=new ClipperLib.OutPt,isHorizontal=j.OutPt1.Pt.Y==j.OffPt.Y;if(isHorizontal&&ClipperLib.IntPoint.op_Equality(j.OffPt,j.OutPt1.Pt)&&ClipperLib.IntPoint.op_Equality(j.OffPt,j.OutPt2.Pt)){for(op1b=j.OutPt1.Next;op1b!=op1&&ClipperLib.IntPoint.op_Equality(op1b.Pt,j.OffPt);)op1b=op1b.Next;var reverse1=op1b.Pt.Y>j.OffPt.Y;for(op2b=j.OutPt2.Next;op2b!=op2&&ClipperLib.IntPoint.op_Equality(op2b.Pt,j.OffPt);)op2b=op2b.Next;return reverse1!=op2b.Pt.Y>j.OffPt.Y&&(reverse1?(op1b=this.DupOutPt(op1,!1),op2b=this.DupOutPt(op2,!0),op1.Prev=op2,op2.Next=op1,op1b.Next=op2b,op2b.Prev=op1b,j.OutPt1=op1,j.OutPt2=op1b,!0):(op1b=this.DupOutPt(op1,!0),op2b=this.DupOutPt(op2,!1),op1.Next=op2,op2.Prev=op1,op1b.Prev=op2b,op2b.Next=op1b,j.OutPt1=op1,j.OutPt2=op1b,!0))}if(isHorizontal){for(op1b=op1;op1.Prev.Pt.Y==op1.Pt.Y&&op1.Prev!=op1b&&op1.Prev!=op2;)op1=op1.Prev;for(;op1b.Next.Pt.Y==op1b.Pt.Y&&op1b.Next!=op1&&op1b.Next!=op2;)op1b=op1b.Next;if(op1b.Next==op1||op1b.Next==op2)return!1;for(op2b=op2;op2.Prev.Pt.Y==op2.Pt.Y&&op2.Prev!=op2b&&op2.Prev!=op1b;)op2=op2.Prev;for(;op2b.Next.Pt.Y==op2b.Pt.Y&&op2b.Next!=op2&&op2b.Next!=op1;)op2b=op2b.Next;if(op2b.Next==op2||op2b.Next==op1)return!1;var $val={Left:null,Right:null};if(!this.GetOverlap(op1.Pt.X,op1b.Pt.X,op2.Pt.X,op2b.Pt.X,$val))return!1;var DiscardLeftSide,Left=$val.Left,Right=$val.Right,Pt=new ClipperLib.IntPoint;return op1.Pt.X>=Left&&op1.Pt.X<=Right?(Pt.X=op1.Pt.X,Pt.Y=op1.Pt.Y,DiscardLeftSide=op1.Pt.X>op1b.Pt.X):op2.Pt.X>=Left&&op2.Pt.X<=Right?(Pt.X=op2.Pt.X,Pt.Y=op2.Pt.Y,DiscardLeftSide=op2.Pt.X>op2b.Pt.X):op1b.Pt.X>=Left&&op1b.Pt.X<=Right?(Pt.X=op1b.Pt.X,Pt.Y=op1b.Pt.Y,DiscardLeftSide=op1b.Pt.X>op1.Pt.X):(Pt.X=op2b.Pt.X,Pt.Y=op2b.Pt.Y,DiscardLeftSide=op2b.Pt.X>op2.Pt.X),j.OutPt1=op1,j.OutPt2=op2,this.JoinHorz(op1,op1b,op2,op2b,Pt,DiscardLeftSide)}for(op1b=op1.Next;ClipperLib.IntPoint.op_Equality(op1b.Pt,op1.Pt)&&op1b!=op1;)op1b=op1b.Next;var Reverse1=op1b.Pt.Y>op1.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op1.Pt,op1b.Pt,j.OffPt,this.m_UseFullRange);if(Reverse1){for(op1b=op1.Prev;ClipperLib.IntPoint.op_Equality(op1b.Pt,op1.Pt)&&op1b!=op1;)op1b=op1b.Prev;if(op1b.Pt.Y>op1.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op1.Pt,op1b.Pt,j.OffPt,this.m_UseFullRange))return!1}for(op2b=op2.Next;ClipperLib.IntPoint.op_Equality(op2b.Pt,op2.Pt)&&op2b!=op2;)op2b=op2b.Next;var Reverse2=op2b.Pt.Y>op2.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op2.Pt,op2b.Pt,j.OffPt,this.m_UseFullRange);if(Reverse2){for(op2b=op2.Prev;ClipperLib.IntPoint.op_Equality(op2b.Pt,op2.Pt)&&op2b!=op2;)op2b=op2b.Prev;if(op2b.Pt.Y>op2.Pt.Y||!ClipperLib.ClipperBase.SlopesEqual(op2.Pt,op2b.Pt,j.OffPt,this.m_UseFullRange))return!1}return op1b!=op1&&op2b!=op2&&op1b!=op2b&&(outRec1!=outRec2||Reverse1!=Reverse2)&&(Reverse1?(op1b=this.DupOutPt(op1,!1),op2b=this.DupOutPt(op2,!0),op1.Prev=op2,op2.Next=op1,op1b.Next=op2b,op2b.Prev=op1b,j.OutPt1=op1,j.OutPt2=op1b,!0):(op1b=this.DupOutPt(op1,!0),op2b=this.DupOutPt(op2,!1),op1.Next=op2,op2.Prev=op1,op1b.Prev=op2b,op2b.Next=op1b,j.OutPt1=op1,j.OutPt2=op1b,!0))},ClipperLib.Clipper.GetBounds=function(paths){for(var i=0,cnt=paths.length;i<cnt&&0==paths[i].length;)i++;if(i==cnt)return new ClipperLib.IntRect(0,0,0,0);var result=new ClipperLib.IntRect;for(result.left=paths[i][0].X,result.right=result.left,result.top=paths[i][0].Y,result.bottom=result.top;i<cnt;i++)for(var j=0,jlen=paths[i].length;j<jlen;j++)paths[i][j].X<result.left?result.left=paths[i][j].X:paths[i][j].X>result.right&&(result.right=paths[i][j].X),paths[i][j].Y<result.top?result.top=paths[i][j].Y:paths[i][j].Y>result.bottom&&(result.bottom=paths[i][j].Y);return result},ClipperLib.Clipper.prototype.GetBounds2=function(ops){var opStart=ops,result=new ClipperLib.IntRect;for(result.left=ops.Pt.X,result.right=ops.Pt.X,result.top=ops.Pt.Y,result.bottom=ops.Pt.Y,ops=ops.Next;ops!=opStart;)ops.Pt.X<result.left&&(result.left=ops.Pt.X),ops.Pt.X>result.right&&(result.right=ops.Pt.X),ops.Pt.Y<result.top&&(result.top=ops.Pt.Y),ops.Pt.Y>result.bottom&&(result.bottom=ops.Pt.Y),ops=ops.Next;return result},ClipperLib.Clipper.PointInPolygon=function(pt,path){var result=0,cnt=path.length;if(cnt<3)return 0;for(var ip=path[0],i=1;i<=cnt;++i){var ipNext=i==cnt?path[0]:path[i];if(ipNext.Y==pt.Y&&(ipNext.X==pt.X||ip.Y==pt.Y&&ipNext.X>pt.X==ip.X<pt.X))return-1;if(ip.Y<pt.Y!=ipNext.Y<pt.Y)if(ip.X>=pt.X)if(ipNext.X>pt.X)result=1-result;else{if(0==(d=(ip.X-pt.X)*(ipNext.Y-pt.Y)-(ipNext.X-pt.X)*(ip.Y-pt.Y)))return-1;d>0==ipNext.Y>ip.Y&&(result=1-result)}else if(ipNext.X>pt.X){var d;if(0==(d=(ip.X-pt.X)*(ipNext.Y-pt.Y)-(ipNext.X-pt.X)*(ip.Y-pt.Y)))return-1;d>0==ipNext.Y>ip.Y&&(result=1-result)}ip=ipNext}return result},ClipperLib.Clipper.prototype.PointInPolygon=function(pt,op){for(var result=0,startOp=op;;){var poly0x=op.Pt.X,poly0y=op.Pt.Y,poly1x=op.Next.Pt.X,poly1y=op.Next.Pt.Y;if(poly1y==pt.Y&&(poly1x==pt.X||poly0y==pt.Y&&poly1x>pt.X==poly0x<pt.X))return-1;if(poly0y<pt.Y!=poly1y<pt.Y)if(poly0x>=pt.X)if(poly1x>pt.X)result=1-result;else{if(0==(d=(poly0x-pt.X)*(poly1y-pt.Y)-(poly1x-pt.X)*(poly0y-pt.Y)))return-1;d>0==poly1y>poly0y&&(result=1-result)}else if(poly1x>pt.X){var d;if(0==(d=(poly0x-pt.X)*(poly1y-pt.Y)-(poly1x-pt.X)*(poly0y-pt.Y)))return-1;d>0==poly1y>poly0y&&(result=1-result)}if(startOp==(op=op.Next))break}return result},ClipperLib.Clipper.prototype.Poly2ContainsPoly1=function(outPt1,outPt2){var op=outPt1;do{var res=this.PointInPolygon(op.Pt,outPt2);if(res>=0)return 0!=res;op=op.Next}while(op!=outPt1);return!0},ClipperLib.Clipper.prototype.FixupFirstLefts1=function(OldOutRec,NewOutRec){for(var i=0,ilen=this.m_PolyOuts.length;i<ilen;i++){var outRec=this.m_PolyOuts[i];null!==outRec.Pts&&outRec.FirstLeft==OldOutRec&&this.Poly2ContainsPoly1(outRec.Pts,NewOutRec.Pts)&&(outRec.FirstLeft=NewOutRec)}},ClipperLib.Clipper.prototype.FixupFirstLefts2=function(OldOutRec,NewOutRec){for(var $i2=0,$t2=this.m_PolyOuts,$l2=$t2.length,outRec=$t2[$i2];$i2<$l2;outRec=$t2[++$i2])outRec.FirstLeft==OldOutRec&&(outRec.FirstLeft=NewOutRec)},ClipperLib.Clipper.ParseFirstLeft=function(FirstLeft){for(;null!=FirstLeft&&null==FirstLeft.Pts;)FirstLeft=FirstLeft.FirstLeft;return FirstLeft},ClipperLib.Clipper.prototype.JoinCommonEdges=function(){for(var i=0,ilen=this.m_Joins.length;i<ilen;i++){var holeStateRec,join=this.m_Joins[i],outRec1=this.GetOutRec(join.OutPt1.Idx),outRec2=this.GetOutRec(join.OutPt2.Idx);if(null!=outRec1.Pts&&null!=outRec2.Pts)if(holeStateRec=outRec1==outRec2?outRec1:this.Param1RightOfParam2(outRec1,outRec2)?outRec2:this.Param1RightOfParam2(outRec2,outRec1)?outRec1:this.GetLowermostRec(outRec1,outRec2),this.JoinPoints(join,outRec1,outRec2))if(outRec1==outRec2){if(outRec1.Pts=join.OutPt1,outRec1.BottomPt=null,(outRec2=this.CreateOutRec()).Pts=join.OutPt2,this.UpdateOutPtIdxs(outRec2),this.m_UsingPolyTree)for(var j=0,jlen=this.m_PolyOuts.length;j<jlen-1;j++){var oRec=this.m_PolyOuts[j];null!=oRec.Pts&&ClipperLib.Clipper.ParseFirstLeft(oRec.FirstLeft)==outRec1&&oRec.IsHole!=outRec1.IsHole&&(this.Poly2ContainsPoly1(oRec.Pts,join.OutPt2)&&(oRec.FirstLeft=outRec2))}this.Poly2ContainsPoly1(outRec2.Pts,outRec1.Pts)?(outRec2.IsHole=!outRec1.IsHole,outRec2.FirstLeft=outRec1,this.m_UsingPolyTree&&this.FixupFirstLefts2(outRec2,outRec1),(outRec2.IsHole^this.ReverseSolution)==this.Area(outRec2)>0&&this.ReversePolyPtLinks(outRec2.Pts)):this.Poly2ContainsPoly1(outRec1.Pts,outRec2.Pts)?(outRec2.IsHole=outRec1.IsHole,outRec1.IsHole=!outRec2.IsHole,outRec2.FirstLeft=outRec1.FirstLeft,outRec1.FirstLeft=outRec2,this.m_UsingPolyTree&&this.FixupFirstLefts2(outRec1,outRec2),(outRec1.IsHole^this.ReverseSolution)==this.Area(outRec1)>0&&this.ReversePolyPtLinks(outRec1.Pts)):(outRec2.IsHole=outRec1.IsHole,outRec2.FirstLeft=outRec1.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(outRec1,outRec2))}else outRec2.Pts=null,outRec2.BottomPt=null,outRec2.Idx=outRec1.Idx,outRec1.IsHole=holeStateRec.IsHole,holeStateRec==outRec2&&(outRec1.FirstLeft=outRec2.FirstLeft),outRec2.FirstLeft=outRec1,this.m_UsingPolyTree&&this.FixupFirstLefts2(outRec2,outRec1)}},ClipperLib.Clipper.prototype.UpdateOutPtIdxs=function(outrec){var op=outrec.Pts;do{op.Idx=outrec.Idx,op=op.Prev}while(op!=outrec.Pts)},ClipperLib.Clipper.prototype.DoSimplePolygons=function(){for(var i=0;i<this.m_PolyOuts.length;){var outrec=this.m_PolyOuts[i++],op=outrec.Pts;if(null!==op)do{for(var op2=op.Next;op2!=outrec.Pts;){if(ClipperLib.IntPoint.op_Equality(op.Pt,op2.Pt)&&op2.Next!=op&&op2.Prev!=op){var op3=op.Prev,op4=op2.Prev;op.Prev=op4,op4.Next=op,op2.Prev=op3,op3.Next=op2,outrec.Pts=op;var outrec2=this.CreateOutRec();outrec2.Pts=op2,this.UpdateOutPtIdxs(outrec2),this.Poly2ContainsPoly1(outrec2.Pts,outrec.Pts)?(outrec2.IsHole=!outrec.IsHole,outrec2.FirstLeft=outrec):this.Poly2ContainsPoly1(outrec.Pts,outrec2.Pts)?(outrec2.IsHole=outrec.IsHole,outrec.IsHole=!outrec2.IsHole,outrec2.FirstLeft=outrec.FirstLeft,outrec.FirstLeft=outrec2):(outrec2.IsHole=outrec.IsHole,outrec2.FirstLeft=outrec.FirstLeft),op2=op}op2=op2.Next}op=op.Next}while(op!=outrec.Pts)}},ClipperLib.Clipper.Area=function(poly){var cnt=poly.length;if(cnt<3)return 0;for(var a=0,i=0,j=cnt-1;i<cnt;++i)a+=(poly[j].X+poly[i].X)*(poly[j].Y-poly[i].Y),j=i;return.5*-a},ClipperLib.Clipper.prototype.Area=function(outRec){var op=outRec.Pts;if(null==op)return 0;var a=0;do{a+=(op.Prev.Pt.X+op.Pt.X)*(op.Prev.Pt.Y-op.Pt.Y),op=op.Next}while(op!=outRec.Pts);return.5*a},ClipperLib.Clipper.SimplifyPolygon=function(poly,fillType){var result=new Array,c=new ClipperLib.Clipper(0);return c.StrictlySimple=!0,c.AddPath(poly,ClipperLib.PolyType.ptSubject,!0),c.Execute(ClipperLib.ClipType.ctUnion,result,fillType,fillType),result},ClipperLib.Clipper.SimplifyPolygons=function(polys,fillType){void 0===fillType&&(fillType=ClipperLib.PolyFillType.pftEvenOdd);var result=new Array,c=new ClipperLib.Clipper(0);return c.StrictlySimple=!0,c.AddPaths(polys,ClipperLib.PolyType.ptSubject,!0),c.Execute(ClipperLib.ClipType.ctUnion,result,fillType,fillType),result},ClipperLib.Clipper.DistanceSqrd=function(pt1,pt2){var dx=pt1.X-pt2.X,dy=pt1.Y-pt2.Y;return dx*dx+dy*dy},ClipperLib.Clipper.DistanceFromLineSqrd=function(pt,ln1,ln2){var A=ln1.Y-ln2.Y,B=ln2.X-ln1.X,C=A*ln1.X+B*ln1.Y;return(C=A*pt.X+B*pt.Y-C)*C/(A*A+B*B)},ClipperLib.Clipper.SlopesNearCollinear=function(pt1,pt2,pt3,distSqrd){return ClipperLib.Clipper.DistanceFromLineSqrd(pt2,pt1,pt3)<distSqrd},ClipperLib.Clipper.PointsAreClose=function(pt1,pt2,distSqrd){var dx=pt1.X-pt2.X,dy=pt1.Y-pt2.Y;return dx*dx+dy*dy<=distSqrd},ClipperLib.Clipper.ExcludeOp=function(op){var result=op.Prev;return result.Next=op.Next,op.Next.Prev=result,result.Idx=0,result},ClipperLib.Clipper.CleanPolygon=function(path,distance){void 0===distance&&(distance=1.415);var cnt=path.length;if(0==cnt)return new Array;for(var outPts=new Array(cnt),i=0;i<cnt;++i)outPts[i]=new ClipperLib.OutPt;for(i=0;i<cnt;++i)outPts[i].Pt=path[i],outPts[i].Next=outPts[(i+1)%cnt],outPts[i].Next.Prev=outPts[i],outPts[i].Idx=0;for(var distSqrd=distance*distance,op=outPts[0];0==op.Idx&&op.Next!=op.Prev;)ClipperLib.Clipper.PointsAreClose(op.Pt,op.Prev.Pt,distSqrd)?(op=ClipperLib.Clipper.ExcludeOp(op),cnt--):ClipperLib.Clipper.PointsAreClose(op.Prev.Pt,op.Next.Pt,distSqrd)?(ClipperLib.Clipper.ExcludeOp(op.Next),op=ClipperLib.Clipper.ExcludeOp(op),cnt-=2):ClipperLib.Clipper.SlopesNearCollinear(op.Prev.Pt,op.Pt,op.Next.Pt,distSqrd)?(op=ClipperLib.Clipper.ExcludeOp(op),cnt--):(op.Idx=1,op=op.Next);cnt<3&&(cnt=0);var result=new Array(cnt);for(i=0;i<cnt;++i)result[i]=new ClipperLib.IntPoint(op.Pt),op=op.Next;return outPts=null,result},ClipperLib.Clipper.CleanPolygons=function(polys,distance){for(var result=new Array(polys.length),i=0,ilen=polys.length;i<ilen;i++)result[i]=ClipperLib.Clipper.CleanPolygon(polys[i],distance);return result},ClipperLib.Clipper.Minkowski=function(pattern,path,IsSum,IsClosed){var delta=IsClosed?1:0,polyCnt=pattern.length,pathCnt=path.length,result=new Array;if(IsSum)for(var i=0;i<pathCnt;i++){for(var p=new Array(polyCnt),j=0,jlen=pattern.length,ip=pattern[j];j<jlen;ip=pattern[++j])p[j]=new ClipperLib.IntPoint(path[i].X+ip.X,path[i].Y+ip.Y);result.push(p)}else for(i=0;i<pathCnt;i++){for(p=new Array(polyCnt),j=0,jlen=pattern.length,ip=pattern[j];j<jlen;ip=pattern[++j])p[j]=new ClipperLib.IntPoint(path[i].X-ip.X,path[i].Y-ip.Y);result.push(p)}var quads=new Array;for(i=0;i<pathCnt-1+delta;i++)for(j=0;j<polyCnt;j++){var quad=new Array;quad.push(result[i%pathCnt][j%polyCnt]),quad.push(result[(i+1)%pathCnt][j%polyCnt]),quad.push(result[(i+1)%pathCnt][(j+1)%polyCnt]),quad.push(result[i%pathCnt][(j+1)%polyCnt]),ClipperLib.Clipper.Orientation(quad)||quad.reverse(),quads.push(quad)}var c=new ClipperLib.Clipper(0);return c.AddPaths(quads,ClipperLib.PolyType.ptSubject,!0),c.Execute(ClipperLib.ClipType.ctUnion,result,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero),result},ClipperLib.Clipper.MinkowskiSum=function(){var a=arguments,alen=a.length;if(3==alen){var pattern=a[0],path=a[1],pathIsClosed=a[2];return ClipperLib.Clipper.Minkowski(pattern,path,!0,pathIsClosed)}if(4==alen){pattern=a[0];for(var paths=a[1],pathFillType=a[2],c=(pathIsClosed=a[3],new ClipperLib.Clipper),i=0,ilen=paths.length;i<ilen;++i){var tmp=ClipperLib.Clipper.Minkowski(pattern,paths[i],!0,pathIsClosed);c.AddPaths(tmp,ClipperLib.PolyType.ptSubject,!0)}pathIsClosed&&c.AddPaths(paths,ClipperLib.PolyType.ptClip,!0);var solution=new ClipperLib.Paths;return c.Execute(ClipperLib.ClipType.ctUnion,solution,pathFillType,pathFillType),solution}},ClipperLib.Clipper.MinkowskiDiff=function(pattern,path,pathIsClosed){return ClipperLib.Clipper.Minkowski(pattern,path,!1,pathIsClosed)},ClipperLib.Clipper.PolyTreeToPaths=function(polytree){var result=new Array;return ClipperLib.Clipper.AddPolyNodeToPaths(polytree,ClipperLib.Clipper.NodeType.ntAny,result),result},ClipperLib.Clipper.AddPolyNodeToPaths=function(polynode,nt,paths){var match=!0;switch(nt){case ClipperLib.Clipper.NodeType.ntOpen:return;case ClipperLib.Clipper.NodeType.ntClosed:match=!polynode.IsOpen}polynode.m_polygon.length>0&&match&&paths.push(polynode.m_polygon);for(var $i3=0,$t3=polynode.Childs(),$l3=$t3.length,pn=$t3[$i3];$i3<$l3;pn=$t3[++$i3])ClipperLib.Clipper.AddPolyNodeToPaths(pn,nt,paths)},ClipperLib.Clipper.OpenPathsFromPolyTree=function(polytree){for(var result=new ClipperLib.Paths,i=0,ilen=polytree.ChildCount();i<ilen;i++)polytree.Childs()[i].IsOpen&&result.push(polytree.Childs()[i].m_polygon);return result},ClipperLib.Clipper.ClosedPathsFromPolyTree=function(polytree){var result=new ClipperLib.Paths;return ClipperLib.Clipper.AddPolyNodeToPaths(polytree,ClipperLib.Clipper.NodeType.ntClosed,result),result},Inherit(ClipperLib.Clipper,ClipperLib.ClipperBase),ClipperLib.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},ClipperLib.ClipperOffset=function(miterLimit,arcTolerance){void 0===miterLimit&&(miterLimit=2),void 0===arcTolerance&&(arcTolerance=ClipperLib.ClipperOffset.def_arc_tolerance),this.m_destPolys=new ClipperLib.Paths,this.m_srcPoly=new ClipperLib.Path,this.m_destPoly=new ClipperLib.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new ClipperLib.IntPoint,this.m_polyNodes=new ClipperLib.PolyNode,this.MiterLimit=miterLimit,this.ArcTolerance=arcTolerance,this.m_lowest.X=-1},ClipperLib.ClipperOffset.two_pi=6.28318530717959,ClipperLib.ClipperOffset.def_arc_tolerance=.25,ClipperLib.ClipperOffset.prototype.Clear=function(){ClipperLib.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},ClipperLib.ClipperOffset.Round=ClipperLib.Clipper.Round,ClipperLib.ClipperOffset.prototype.AddPath=function(path,joinType,endType){var highI=path.length-1;if(!(highI<0)){var newNode=new ClipperLib.PolyNode;if(newNode.m_jointype=joinType,newNode.m_endtype=endType,endType==ClipperLib.EndType.etClosedLine||endType==ClipperLib.EndType.etClosedPolygon)for(;highI>0&&ClipperLib.IntPoint.op_Equality(path[0],path[highI]);)highI--;newNode.m_polygon.push(path[0]);for(var j=0,k=0,i=1;i<=highI;i++)ClipperLib.IntPoint.op_Inequality(newNode.m_polygon[j],path[i])&&(j++,newNode.m_polygon.push(path[i]),(path[i].Y>newNode.m_polygon[k].Y||path[i].Y==newNode.m_polygon[k].Y&&path[i].X<newNode.m_polygon[k].X)&&(k=j));if(!(endType==ClipperLib.EndType.etClosedPolygon&&j<2||endType!=ClipperLib.EndType.etClosedPolygon&&j<0)&&(this.m_polyNodes.AddChild(newNode),endType==ClipperLib.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new ClipperLib.IntPoint(0,k);else{var ip=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(newNode.m_polygon[k].Y>ip.Y||newNode.m_polygon[k].Y==ip.Y&&newNode.m_polygon[k].X<ip.X)&&(this.m_lowest=new ClipperLib.IntPoint(this.m_polyNodes.ChildCount()-1,k))}}},ClipperLib.ClipperOffset.prototype.AddPaths=function(paths,joinType,endType){for(var i=0,ilen=paths.length;i<ilen;i++)this.AddPath(paths[i],joinType,endType)},ClipperLib.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!ClipperLib.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var i=0;i<this.m_polyNodes.ChildCount();i++){((node=this.m_polyNodes.Childs()[i]).m_endtype==ClipperLib.EndType.etClosedPolygon||node.m_endtype==ClipperLib.EndType.etClosedLine&&ClipperLib.Clipper.Orientation(node.m_polygon))&&node.m_polygon.reverse()}else for(i=0;i<this.m_polyNodes.ChildCount();i++){var node;(node=this.m_polyNodes.Childs()[i]).m_endtype!=ClipperLib.EndType.etClosedLine||ClipperLib.Clipper.Orientation(node.m_polygon)||node.m_polygon.reverse()}},ClipperLib.ClipperOffset.GetUnitNormal=function(pt1,pt2){var dx=pt2.X-pt1.X,dy=pt2.Y-pt1.Y;if(0==dx&&0==dy)return new ClipperLib.DoublePoint(0,0);var f=1/Math.sqrt(dx*dx+dy*dy);return dx*=f,dy*=f,new ClipperLib.DoublePoint(dy,-dx)},ClipperLib.ClipperOffset.prototype.DoOffset=function(delta){if(this.m_destPolys=new Array,this.m_delta=delta,ClipperLib.ClipperBase.near_zero(delta))for(var i=0;i<this.m_polyNodes.ChildCount();i++){(node=this.m_polyNodes.Childs()[i]).m_endtype==ClipperLib.EndType.etClosedPolygon&&this.m_destPolys.push(node.m_polygon)}else{var y;this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5,y=this.ArcTolerance<=0?ClipperLib.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(delta)*ClipperLib.ClipperOffset.def_arc_tolerance?Math.abs(delta)*ClipperLib.ClipperOffset.def_arc_tolerance:this.ArcTolerance;var steps=3.14159265358979/Math.acos(1-y/Math.abs(delta));this.m_sin=Math.sin(ClipperLib.ClipperOffset.two_pi/steps),this.m_cos=Math.cos(ClipperLib.ClipperOffset.two_pi/steps),this.m_StepsPerRad=steps/ClipperLib.ClipperOffset.two_pi,delta<0&&(this.m_sin=-this.m_sin);for(i=0;i<this.m_polyNodes.ChildCount();i++){var node=this.m_polyNodes.Childs()[i];this.m_srcPoly=node.m_polygon;var len=this.m_srcPoly.length;if(!(0==len||delta<=0&&(len<3||node.m_endtype!=ClipperLib.EndType.etClosedPolygon)))if(this.m_destPoly=new Array,1!=len){this.m_normals.length=0;for(j=0;j<len-1;j++)this.m_normals.push(ClipperLib.ClipperOffset.GetUnitNormal(this.m_srcPoly[j],this.m_srcPoly[j+1]));if(node.m_endtype==ClipperLib.EndType.etClosedLine||node.m_endtype==ClipperLib.EndType.etClosedPolygon?this.m_normals.push(ClipperLib.ClipperOffset.GetUnitNormal(this.m_srcPoly[len-1],this.m_srcPoly[0])):this.m_normals.push(new ClipperLib.DoublePoint(this.m_normals[len-2])),node.m_endtype==ClipperLib.EndType.etClosedPolygon){var k=len-1;for(j=0;j<len;j++)k=this.OffsetPoint(j,k,node.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(node.m_endtype==ClipperLib.EndType.etClosedLine){for(k=len-1,j=0;j<len;j++)k=this.OffsetPoint(j,k,node.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;var n=this.m_normals[len-1];for(j=len-1;j>0;j--)this.m_normals[j]=new ClipperLib.DoublePoint(-this.m_normals[j-1].X,-this.m_normals[j-1].Y);this.m_normals[0]=new ClipperLib.DoublePoint(-n.X,-n.Y),k=0;for(j=len-1;j>=0;j--)k=this.OffsetPoint(j,k,node.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{var pt1;for(k=0,j=1;j<len-1;++j)k=this.OffsetPoint(j,k,node.m_jointype);if(node.m_endtype==ClipperLib.EndType.etOpenButt){j=len-1;pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[j].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[j].Y*delta)),this.m_destPoly.push(pt1),pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X-this.m_normals[j].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y-this.m_normals[j].Y*delta)),this.m_destPoly.push(pt1)}else{j=len-1;k=len-2,this.m_sinA=0,this.m_normals[j]=new ClipperLib.DoublePoint(-this.m_normals[j].X,-this.m_normals[j].Y),node.m_endtype==ClipperLib.EndType.etOpenSquare?this.DoSquare(j,k):this.DoRound(j,k)}for(j=len-1;j>0;j--)this.m_normals[j]=new ClipperLib.DoublePoint(-this.m_normals[j-1].X,-this.m_normals[j-1].Y);this.m_normals[0]=new ClipperLib.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y);for(j=(k=len-1)-1;j>0;--j)k=this.OffsetPoint(j,k,node.m_jointype);node.m_endtype==ClipperLib.EndType.etOpenButt?(pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*delta)),this.m_destPoly.push(pt1),pt1=new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*delta)),this.m_destPoly.push(pt1)):(k=1,this.m_sinA=0,node.m_endtype==ClipperLib.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}else{if(node.m_jointype==ClipperLib.JoinType.jtRound)for(var X=1,Y=0,j=1;j<=steps;j++){this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X+X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y+Y*delta)));var X2=X;X=X*this.m_cos-this.m_sin*Y,Y=X2*this.m_sin+Y*this.m_cos}else{X=-1,Y=-1;for(var j=0;j<4;++j)this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].X+X*delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[0].Y+Y*delta))),X<0?X=1:Y<0?Y=1:X=-1}this.m_destPolys.push(this.m_destPoly)}}}},ClipperLib.ClipperOffset.prototype.Execute=function(){var a=arguments,ispolytree=a[0]instanceof ClipperLib.PolyTree;if(ispolytree){solution=a[0],delta=a[1];if(solution.Clear(),this.FixOrientations(),this.DoOffset(delta),(clpr=new ClipperLib.Clipper(0)).AddPaths(this.m_destPolys,ClipperLib.PolyType.ptSubject,!0),delta>0)clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftPositive,ClipperLib.PolyFillType.pftPositive);else{r=ClipperLib.Clipper.GetBounds(this.m_destPolys);if((outer=new ClipperLib.Path).push(new ClipperLib.IntPoint(r.left-10,r.bottom+10)),outer.push(new ClipperLib.IntPoint(r.right+10,r.bottom+10)),outer.push(new ClipperLib.IntPoint(r.right+10,r.top-10)),outer.push(new ClipperLib.IntPoint(r.left-10,r.top-10)),clpr.AddPath(outer,ClipperLib.PolyType.ptSubject,!0),clpr.ReverseSolution=!0,clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftNegative,ClipperLib.PolyFillType.pftNegative),1==solution.ChildCount()&&solution.Childs()[0].ChildCount()>0){var outerNode=solution.Childs()[0];solution.Childs()[0]=outerNode.Childs()[0];for(var i=1;i<outerNode.ChildCount();i++)solution.AddChild(outerNode.Childs()[i])}else solution.Clear()}}else{var clpr,solution=a[0],delta=a[1];if(ClipperLib.Clear(solution),this.FixOrientations(),this.DoOffset(delta),(clpr=new ClipperLib.Clipper(0)).AddPaths(this.m_destPolys,ClipperLib.PolyType.ptSubject,!0),delta>0)clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftPositive,ClipperLib.PolyFillType.pftPositive);else{var outer,r=ClipperLib.Clipper.GetBounds(this.m_destPolys);(outer=new ClipperLib.Path).push(new ClipperLib.IntPoint(r.left-10,r.bottom+10)),outer.push(new ClipperLib.IntPoint(r.right+10,r.bottom+10)),outer.push(new ClipperLib.IntPoint(r.right+10,r.top-10)),outer.push(new ClipperLib.IntPoint(r.left-10,r.top-10)),clpr.AddPath(outer,ClipperLib.PolyType.ptSubject,!0),clpr.ReverseSolution=!0,clpr.Execute(ClipperLib.ClipType.ctUnion,solution,ClipperLib.PolyFillType.pftNegative,ClipperLib.PolyFillType.pftNegative),solution.length>0&&solution.splice(0,1)}}},ClipperLib.ClipperOffset.prototype.OffsetPoint=function(j,k,jointype){if(this.m_sinA=this.m_normals[k].X*this.m_normals[j].Y-this.m_normals[j].X*this.m_normals[k].Y,this.m_sinA<5e-5&&this.m_sinA>-5e-5)return k;if(this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1),this.m_sinA*this.m_delta<0)this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[k].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[k].Y*this.m_delta))),this.m_destPoly.push(new ClipperLib.IntPoint(this.m_srcPoly[j])),this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[j].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[j].Y*this.m_delta)));else switch(jointype){case ClipperLib.JoinType.jtMiter:var r=this.m_normals[j].X*this.m_normals[k].X+this.m_normals[j].Y*this.m_normals[k].Y+1;r>=this.m_miterLim?this.DoMiter(j,k,r):this.DoSquare(j,k);break;case ClipperLib.JoinType.jtSquare:this.DoSquare(j,k);break;case ClipperLib.JoinType.jtRound:this.DoRound(j,k)}return k=j},ClipperLib.ClipperOffset.prototype.DoSquare=function(j,k){var dx=Math.tan(Math.atan2(this.m_sinA,this.m_normals[k].X*this.m_normals[j].X+this.m_normals[k].Y*this.m_normals[j].Y)/4);this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_delta*(this.m_normals[k].X-this.m_normals[k].Y*dx)),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_delta*(this.m_normals[k].Y+this.m_normals[k].X*dx)))),this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_delta*(this.m_normals[j].X+this.m_normals[j].Y*dx)),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_delta*(this.m_normals[j].Y-this.m_normals[j].X*dx))))},ClipperLib.ClipperOffset.prototype.DoMiter=function(j,k,r){var q=this.m_delta/r;this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+(this.m_normals[k].X+this.m_normals[j].X)*q),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+(this.m_normals[k].Y+this.m_normals[j].Y)*q)))},ClipperLib.ClipperOffset.prototype.DoRound=function(j,k){for(var X2,a=Math.atan2(this.m_sinA,this.m_normals[k].X*this.m_normals[j].X+this.m_normals[k].Y*this.m_normals[j].Y),steps=ClipperLib.Cast_Int32(ClipperLib.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(a))),X=this.m_normals[k].X,Y=this.m_normals[k].Y,i=0;i<steps;++i)this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+Y*this.m_delta))),X2=X,X=X*this.m_cos-this.m_sin*Y,Y=X2*this.m_sin+Y*this.m_cos;this.m_destPoly.push(new ClipperLib.IntPoint(ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].X+this.m_normals[j].X*this.m_delta),ClipperLib.ClipperOffset.Round(this.m_srcPoly[j].Y+this.m_normals[j].Y*this.m_delta)))},ClipperLib.Error=function(message){try{throw new Error(message)}catch(err){alert(err.message)}},ClipperLib.JS={},ClipperLib.JS.AreaOfPolygon=function(poly,scale){return scale||(scale=1),ClipperLib.Clipper.Area(poly)/(scale*scale)},ClipperLib.JS.AreaOfPolygons=function(poly,scale){scale||(scale=1);for(var area=0,i=0;i<poly.length;i++)area+=ClipperLib.Clipper.Area(poly[i]);return area/(scale*scale)},ClipperLib.JS.BoundsOfPath=function(path,scale){return ClipperLib.JS.BoundsOfPaths([path],scale)},ClipperLib.JS.BoundsOfPaths=function(paths,scale){scale||(scale=1);var bounds=ClipperLib.Clipper.GetBounds(paths);return bounds.left/=scale,bounds.bottom/=scale,bounds.right/=scale,bounds.top/=scale,bounds},ClipperLib.JS.Clean=function(polygon,delta){if(!(polygon instanceof Array))return[];var isPolygons=polygon[0]instanceof Array;polygon=ClipperLib.JS.Clone(polygon);if("number"!=typeof delta||null===delta)return ClipperLib.Error("Delta is not a number in Clean()."),polygon;if(0===polygon.length||1==polygon.length&&0===polygon[0].length||delta<0)return polygon;isPolygons||(polygon=[polygon]);for(var len,poly,result,d,p,j,i,k_length=polygon.length,results=[],k=0;k<k_length;k++)if(0!==(len=(poly=polygon[k]).length))if(len<3)result=poly,results.push(result);else{for(result=poly,d=delta*delta,p=poly[0],j=1,i=1;i<len;i++)(poly[i].X-p.X)*(poly[i].X-p.X)+(poly[i].Y-p.Y)*(poly[i].Y-p.Y)<=d||(result[j]=poly[i],p=poly[i],j++);p=poly[j-1],(poly[0].X-p.X)*(poly[0].X-p.X)+(poly[0].Y-p.Y)*(poly[0].Y-p.Y)<=d&&j--,j<len&&result.splice(j,len-j),result.length&&results.push(result)}return!isPolygons&&results.length?results=results[0]:isPolygons||0!==results.length?isPolygons&&0===results.length&&(results=[[]]):results=[],results},ClipperLib.JS.Clone=function(polygon){if(!(polygon instanceof Array))return[];if(0===polygon.length)return[];if(1==polygon.length&&0===polygon[0].length)return[[]];var isPolygons=polygon[0]instanceof Array;isPolygons||(polygon=[polygon]);var plen,i,j,result,len=polygon.length,results=new Array(len);for(i=0;i<len;i++){for(plen=polygon[i].length,result=new Array(plen),j=0;j<plen;j++)result[j]={X:polygon[i][j].X,Y:polygon[i][j].Y};results[i]=result}return isPolygons||(results=results[0]),results},ClipperLib.JS.Lighten=function(polygon,tolerance){if(!(polygon instanceof Array))return[];if("number"!=typeof tolerance||null===tolerance)return ClipperLib.Error("Tolerance is not a number in Lighten()."),ClipperLib.JS.Clone(polygon);if(0===polygon.length||1==polygon.length&&0===polygon[0].length||tolerance<0)return ClipperLib.JS.Clone(polygon);var i,j,poly,k,poly2,plen,A,B,P,rem,addlast,bxax,byay,l,ax,ay;polygon[0]instanceof Array||(polygon=[polygon]);var len=polygon.length,toleranceSq=tolerance*tolerance,results=[];for(i=0;i<len;i++)if(0!=(plen=(poly=polygon[i]).length)){for(k=0;k<1e6;k++){for(poly2=[],poly[(plen=poly.length)-1].X!=poly[0].X||poly[plen-1].Y!=poly[0].Y?(addlast=1,poly.push({X:poly[0].X,Y:poly[0].Y}),plen=poly.length):addlast=0,rem=[],j=0;j<plen-2;j++)A=poly[j],P=poly[j+1],B=poly[j+2],ax=A.X,ay=A.Y,bxax=B.X-ax,byay=B.Y-ay,0===bxax&&0===byay||((l=((P.X-ax)*bxax+(P.Y-ay)*byay)/(bxax*bxax+byay*byay))>1?(ax=B.X,ay=B.Y):l>0&&(ax+=bxax*l,ay+=byay*l)),(bxax=P.X-ax)*bxax+(byay=P.Y-ay)*byay<=toleranceSq&&(rem[j+1]=1,j++);for(poly2.push({X:poly[0].X,Y:poly[0].Y}),j=1;j<plen-1;j++)rem[j]||poly2.push({X:poly[j].X,Y:poly[j].Y});if(poly2.push({X:poly[plen-1].X,Y:poly[plen-1].Y}),addlast&&poly.pop(),!rem.length)break;poly=poly2}poly2[(plen=poly2.length)-1].X==poly2[0].X&&poly2[plen-1].Y==poly2[0].Y&&poly2.pop(),poly2.length>2&&results.push(poly2)}return!polygon[0]instanceof Array&&(results=results[0]),void 0===results&&(results=[[]]),results},ClipperLib.JS.PerimeterOfPath=function(path,closed,scale){if(void 0===path)return 0;var p1,p2,sqrt=Math.sqrt,perimeter=0,p1x=0,p1y=0,p2x=0,p2y=0,j=path.length;if(j<2)return 0;for(closed&&(path[j]=path[0],j++);--j;)p1x=(p1=path[j]).X,p1y=p1.Y,perimeter+=sqrt((p1x-(p2x=(p2=path[j-1]).X))*(p1x-p2x)+(p1y-(p2y=p2.Y))*(p1y-p2y));return closed&&path.pop(),perimeter/scale},ClipperLib.JS.PerimeterOfPaths=function(paths,closed,scale){scale||(scale=1);for(var perimeter=0,i=0;i<paths.length;i++)perimeter+=ClipperLib.JS.PerimeterOfPath(paths[i],closed,scale);return perimeter},ClipperLib.JS.ScaleDownPath=function(path,scale){var i,p;for(scale||(scale=1),i=path.length;i--;)(p=path[i]).X=p.X/scale,p.Y=p.Y/scale},ClipperLib.JS.ScaleDownPaths=function(paths,scale){var i,j,p;for(scale||(scale=1),i=paths.length;i--;)for(j=paths[i].length;j--;)(p=paths[i][j]).X=p.X/scale,p.Y=p.Y/scale},ClipperLib.JS.ScaleUpPath=function(path,scale){var i,p,round=Math.round;for(scale||(scale=1),i=path.length;i--;)(p=path[i]).X=round(p.X*scale),p.Y=round(p.Y*scale)},ClipperLib.JS.ScaleUpPaths=function(paths,scale){var i,j,p,round=Math.round;for(scale||(scale=1),i=paths.length;i--;)for(j=paths[i].length;j--;)(p=paths[i][j]).X=round(p.X*scale),p.Y=round(p.Y*scale)},ClipperLib.ExPolygons=function(){return[]},ClipperLib.ExPolygon=function(){this.outer=null,this.holes=null},ClipperLib.JS.AddOuterPolyNodeToExPolygons=function(polynode,expolygons){var ep=new ClipperLib.ExPolygon;ep.outer=polynode.Contour();var node,n,i,j,childs2,jlen,childs=polynode.Childs(),ilen=childs.length;for(ep.holes=new Array(ilen),i=0;i<ilen;i++)for(node=childs[i],ep.holes[i]=node.Contour(),j=0,jlen=(childs2=node.Childs()).length;j<jlen;j++)n=childs2[j],ClipperLib.JS.AddOuterPolyNodeToExPolygons(n,expolygons);expolygons.push(ep)},ClipperLib.JS.ExPolygonsToPaths=function(expolygons){var a,i,alen,ilen,paths=new ClipperLib.Paths;for(a=0,alen=expolygons.length;a<alen;a++)for(paths.push(expolygons[a].outer),i=0,ilen=expolygons[a].holes.length;i<ilen;i++)paths.push(expolygons[a].holes[i]);return paths},ClipperLib.JS.PolyTreeToExPolygons=function(polytree){var node,i,childs,ilen,expolygons=new ClipperLib.ExPolygons;for(i=0,ilen=(childs=polytree.Childs()).length;i<ilen;i++)node=childs[i],ClipperLib.JS.AddOuterPolyNodeToExPolygons(node,expolygons);return expolygons},module.exports=ClipperLib}));function JSClipperError(message){this.name="JSClipperError",this.message=message,this.stack=(new Error).stack}JSClipperError.prototype=Error.prototype,clipper.Error=function(message){throw new JSClipperError(message)};var DEFAULT_FONT_JSON={glyphs:{0:{ha:765,x_min:66,x_max:700,o:"m 700 497 q 683 282 700 377 q 627 121 665 187 q 528 21 589 56 q 382 -14 468 -14 q 242 21 302 -14 q 144 121 183 56 q 86 282 105 187 q 66 497 66 377 q 84 712 66 617 q 139 872 101 807 q 236 972 176 938 q 382 1007 296 1007 q 522 973 463 1007 q 621 873 582 939 q 680 713 661 808 q 700 497 700 618 m 192 497 q 202 319 192 395 q 235 193 212 243 q 293 117 257 142 q 382 92 330 92 q 471 117 434 92 q 531 192 507 142 q 565 318 554 242 q 575 497 575 395 q 565 675 575 599 q 531 801 554 751 q 471 876 507 851 q 382 901 434 901 q 293 876 330 901 q 235 801 257 851 q 202 675 212 751 q 192 497 192 599 z "},1:{ha:765,x_min:121,x_max:482,o:"m 482 0 l 363 0 l 363 619 q 363 682 363 648 q 365 748 363 715 q 367 811 366 781 q 368 864 368 841 q 348 843 357 852 q 330 826 339 834 q 311 809 321 818 q 286 787 300 800 l 186 705 l 121 789 l 380 991 l 482 991 l 482 0 z "},2:{ha:765,x_min:65,x_max:684,o:"m 684 0 l 65 0 l 65 106 l 302 364 q 393 465 353 419 q 461 553 433 510 q 505 641 490 597 q 519 736 519 684 q 508 806 519 776 q 475 858 496 837 q 425 890 454 880 q 359 901 395 901 q 243 875 295 901 q 144 808 191 849 l 75 889 q 134 935 102 913 q 201 972 165 956 q 277 997 237 987 q 361 1006 317 1006 q 478 987 426 1006 q 568 935 531 969 q 624 851 604 901 q 644 741 644 802 q 626 631 644 683 q 577 528 608 578 q 502 427 545 477 q 407 321 458 376 l 216 118 l 216 113 l 684 113 l 684 0 z "},3:{ha:765,x_min:56,x_max:682,o:"m 652 760 q 636 669 652 710 q 592 599 621 629 q 525 550 564 569 q 437 522 486 530 l 437 518 q 620 442 557 503 q 682 282 682 380 q 660 163 682 217 q 593 69 638 109 q 480 8 549 30 q 318 -14 412 -14 q 179 -2 244 -14 q 56 40 113 9 l 56 155 q 183 107 115 124 q 315 90 252 90 q 423 104 378 90 q 498 142 469 117 q 542 204 528 168 q 555 286 555 241 q 537 365 555 332 q 486 419 519 398 q 405 451 453 441 q 297 461 357 461 l 207 461 l 207 564 l 297 564 q 395 577 352 564 q 466 616 437 591 q 510 675 495 641 q 525 751 525 710 q 513 814 525 787 q 478 862 500 842 q 425 891 456 881 q 355 901 393 901 q 228 879 283 901 q 122 819 172 856 l 60 904 q 117 943 85 925 q 186 976 149 962 q 266 998 223 989 q 355 1006 308 1006 q 484 987 429 1006 q 576 936 539 969 q 633 858 614 903 q 652 760 652 813 z "},4:{ha:765,x_min:16,x_max:737,o:"m 737 222 l 593 222 l 593 0 l 473 0 l 473 222 l 16 222 l 16 330 l 465 997 l 593 997 l 593 335 l 737 335 l 737 222 m 473 335 l 473 576 q 474 656 473 614 q 477 738 475 698 q 480 812 478 777 q 482 869 481 846 l 476 869 q 464 839 471 856 q 449 806 457 823 q 431 774 440 789 q 415 747 422 758 l 136 335 l 473 335 z "},5:{ha:765,x_min:89,x_max:688,o:"m 370 608 q 495 590 437 608 q 596 534 553 571 q 663 444 639 498 q 688 318 688 389 q 665 179 688 241 q 596 75 642 117 q 484 9 551 32 q 330 -14 417 -14 q 262 -10 296 -14 q 198 0 229 -7 q 139 16 167 6 q 89 40 111 26 l 89 157 q 141 129 111 141 q 205 109 172 117 q 272 96 238 100 q 334 92 305 92 q 429 104 387 92 q 500 143 471 117 q 545 210 530 170 q 561 304 561 250 q 501 453 561 401 q 328 504 441 504 q 288 502 309 504 q 245 498 267 500 q 204 492 224 495 q 171 486 185 489 l 110 525 l 147 991 l 615 991 l 615 879 l 254 879 l 228 595 q 285 604 250 599 q 370 608 321 608 z "},6:{ha:765,x_min:77,x_max:701,o:"m 77 424 q 84 566 77 495 q 109 701 91 636 q 158 821 127 766 q 237 918 189 877 q 353 982 286 959 q 510 1006 420 1006 q 538 1005 523 1006 q 570 1003 554 1004 q 601 999 586 1001 q 627 993 615 996 l 627 888 q 573 900 603 896 q 514 904 543 904 q 407 889 453 904 q 326 848 360 875 q 270 785 292 822 q 233 704 247 749 q 212 610 218 660 q 203 505 205 559 l 211 505 q 244 551 224 530 q 289 588 263 572 q 347 612 315 603 q 419 621 379 621 q 536 601 484 621 q 625 542 588 581 q 681 447 661 503 q 701 319 701 391 q 680 180 701 242 q 620 76 659 119 q 525 9 581 33 q 400 -14 469 -14 q 273 13 332 -14 q 170 94 214 39 q 102 230 127 148 q 77 424 77 312 m 399 90 q 473 104 439 90 q 531 146 507 118 q 569 217 555 174 q 582 319 582 260 q 571 405 582 367 q 537 469 559 442 q 481 509 515 495 q 403 524 448 524 q 320 508 357 524 q 256 466 282 492 q 215 408 229 441 q 200 343 200 376 q 213 253 200 298 q 250 172 225 208 q 312 113 275 136 q 399 90 349 90 z "},7:{ha:765,x_min:61,x_max:699,o:"m 191 0 l 572 879 l 61 879 l 61 991 l 699 991 l 699 893 l 322 0 l 191 0 z "},8:{ha:765,x_min:72,x_max:694,o:"m 383 1007 q 491 992 440 1007 q 579 947 541 977 q 640 873 618 918 q 663 768 663 828 q 649 686 663 723 q 612 620 635 650 q 555 567 588 591 q 485 525 523 544 q 562 478 524 504 q 629 420 600 452 q 676 348 659 388 q 694 258 694 308 q 672 145 694 196 q 608 60 649 95 q 510 5 567 24 q 383 -14 452 -14 q 251 5 309 -14 q 153 57 193 23 q 93 141 113 92 q 72 253 72 191 q 87 345 72 304 q 128 418 102 385 q 189 475 154 450 q 264 519 224 500 q 201 565 231 541 q 151 621 172 590 q 117 688 130 651 q 104 770 104 725 q 127 873 104 829 q 189 947 150 918 q 278 992 227 977 q 383 1007 328 1007 m 193 252 q 204 185 193 216 q 238 134 215 155 q 296 101 261 113 q 380 89 332 89 q 464 101 428 89 q 525 135 500 113 q 562 188 549 157 q 574 257 574 219 q 561 321 574 292 q 523 374 547 349 q 463 420 498 398 q 386 463 429 441 l 366 472 q 237 379 280 431 q 193 252 193 326 m 382 904 q 268 868 310 904 q 225 764 225 832 q 237 697 225 725 q 270 648 249 669 q 320 609 291 626 q 385 575 350 591 q 446 608 417 590 q 496 648 475 625 q 530 699 517 670 q 542 764 542 727 q 499 868 542 832 q 382 904 456 904 z "},9:{ha:765,x_min:72,x_max:697,o:"m 697 568 q 690 426 697 497 q 665 291 683 355 q 616 171 647 227 q 536 74 585 115 q 421 10 488 33 q 264 -14 354 -14 q 235 -13 251 -14 q 204 -11 220 -12 q 174 -7 189 -9 q 147 -1 159 -5 l 147 104 q 201 92 171 96 q 260 87 231 87 q 410 119 351 87 q 504 206 469 151 q 553 333 538 260 q 571 486 568 406 l 562 486 q 530 441 549 462 q 485 404 511 420 q 427 380 459 389 q 354 371 394 371 q 237 391 290 371 q 149 450 185 411 q 92 544 112 488 q 72 672 72 600 q 93 811 72 749 q 154 917 115 873 q 249 983 193 960 q 374 1006 304 1006 q 501 979 442 1006 q 604 899 560 953 q 672 762 647 844 q 697 568 697 680 m 375 901 q 301 888 334 901 q 243 846 267 874 q 205 774 218 817 q 192 672 192 731 q 203 587 192 625 q 237 523 214 549 q 293 482 259 496 q 371 468 326 468 q 454 484 417 468 q 518 525 492 500 q 559 583 545 551 q 574 648 574 616 q 561 739 574 694 q 524 820 549 784 q 462 879 499 857 q 375 901 425 901 z "}," ":{ha:361,x_min:0,x_max:0,o:""},"!":{ha:374,x_min:100,x_max:272,o:"m 228 281 l 146 281 l 111 991 l 262 991 l 228 281 m 100 75 q 106 119 100 101 q 125 148 113 137 q 152 164 136 159 q 186 170 168 170 q 219 164 203 170 q 247 148 235 159 q 265 119 258 137 q 272 75 272 101 q 265 32 272 50 q 247 3 258 14 q 219 -14 235 -9 q 186 -20 203 -20 q 152 -14 168 -20 q 125 3 136 -9 q 106 32 113 14 q 100 75 100 50 z "},'"':{ha:558,x_min:90,x_max:468,o:"m 224 991 l 196 633 l 118 633 l 90 991 l 224 991 m 468 991 l 440 633 l 363 633 l 335 991 l 468 991 z "},"#":{ha:897,x_min:35,x_max:863,o:"m 667 606 l 624 383 l 814 383 l 814 290 l 606 290 l 550 0 l 450 0 l 507 290 l 310 290 l 254 0 l 157 0 l 210 290 l 35 290 l 35 383 l 228 383 l 272 606 l 86 606 l 86 699 l 289 699 l 345 991 l 444 991 l 389 699 l 587 699 l 644 991 l 742 991 l 685 699 l 863 699 l 863 606 l 667 606 m 328 383 l 525 383 l 568 606 l 371 606 l 328 383 z "},$:{ha:765,x_min:83,x_max:668,o:"m 668 302 q 651 216 668 255 q 603 149 634 178 q 526 102 571 121 q 424 75 481 83 l 424 -81 l 330 -81 l 330 69 q 262 72 296 69 q 195 81 227 75 q 134 96 162 87 q 83 117 105 105 l 83 233 q 135 211 106 222 q 197 191 165 200 q 264 177 230 182 q 330 171 298 171 l 330 465 q 225 508 270 486 q 152 559 181 530 q 109 625 123 588 q 94 713 94 663 q 111 796 94 758 q 158 862 127 833 q 233 908 189 890 q 330 932 277 926 l 330 1054 l 424 1054 l 424 935 q 549 917 492 931 q 652 882 606 903 l 607 783 q 522 814 569 800 q 424 832 474 828 l 424 546 q 529 503 484 525 q 606 452 575 480 q 652 388 637 424 q 668 302 668 351 m 549 302 q 542 343 549 325 q 520 377 535 362 q 482 406 506 393 q 424 431 458 418 l 424 178 q 518 220 487 187 q 549 302 549 254 m 214 711 q 219 668 214 687 q 239 632 225 648 q 275 604 252 616 q 330 579 297 591 l 330 829 q 242 788 270 819 q 214 711 214 758 z "},"%":{ha:1146,x_min:69,x_max:1076,o:"m 170 696 q 194 528 170 584 q 272 472 218 472 q 378 696 378 472 q 272 918 378 918 q 194 863 218 918 q 170 696 170 808 m 478 696 q 466 564 478 623 q 429 466 454 506 q 365 405 404 426 q 272 383 326 383 q 184 405 222 383 q 121 466 146 426 q 82 564 95 506 q 69 696 69 623 q 81 827 69 769 q 118 924 93 884 q 181 985 142 964 q 272 1006 219 1006 q 361 985 323 1006 q 426 924 399 964 q 465 827 452 884 q 478 696 478 769 m 768 298 q 792 131 768 186 q 871 75 817 75 q 977 298 977 75 q 871 521 977 521 q 792 466 817 521 q 768 298 768 410 m 1076 298 q 1064 167 1076 225 q 1027 69 1053 109 q 963 8 1002 29 q 871 -14 924 -14 q 783 8 821 -14 q 719 69 745 29 q 681 167 694 109 q 668 298 668 225 q 680 429 668 372 q 716 527 692 487 q 780 587 741 566 q 871 608 818 608 q 960 587 922 608 q 1024 527 998 566 q 1063 429 1050 487 q 1076 298 1076 372 m 903 991 l 353 0 l 245 0 l 796 991 l 903 991 z "},"&":{ha:975,x_min:74,x_max:953,o:"m 286 790 q 292 745 286 767 q 308 701 297 723 q 337 656 319 679 q 379 608 355 633 q 448 653 419 632 q 496 696 477 674 q 525 741 515 718 q 534 793 534 765 q 526 838 534 817 q 502 873 517 859 q 463 897 486 888 q 412 905 441 905 q 320 875 354 905 q 286 790 286 845 m 378 96 q 450 103 417 96 q 512 125 484 111 q 565 157 541 138 q 611 196 589 175 l 349 472 q 286 428 313 450 q 240 382 259 407 q 212 329 222 358 q 203 262 203 300 q 215 195 203 226 q 249 142 227 164 q 304 108 271 120 q 378 96 336 96 m 74 258 q 87 353 74 311 q 127 428 101 394 q 191 491 153 462 q 277 549 229 520 q 235 599 256 573 q 200 655 215 625 q 175 718 184 684 q 165 790 165 751 q 182 881 165 841 q 231 950 199 922 q 310 992 263 978 q 416 1007 357 1007 q 517 992 473 1007 q 592 950 562 978 q 640 881 623 922 q 656 790 656 841 q 639 710 656 747 q 593 641 622 673 q 528 583 565 610 q 450 532 491 556 l 689 279 q 722 319 707 299 q 748 363 736 340 q 769 412 760 386 q 785 471 778 439 l 909 471 q 885 388 899 426 q 853 317 871 351 q 813 255 836 284 q 765 199 791 227 l 953 0 l 800 0 l 686 117 q 621 62 653 86 q 551 21 588 38 q 473 -4 515 5 q 378 -14 431 -14 q 250 4 307 -14 q 154 57 193 22 q 95 143 115 92 q 74 258 74 193 z "},"'":{ha:314,x_min:90,x_max:224,o:"m 224 991 l 196 633 l 118 633 l 90 991 l 224 991 z "},"(":{ha:418,x_min:56,x_max:376,o:"m 56 380 q 68 548 56 465 q 105 708 80 630 q 169 857 130 785 q 260 991 207 928 l 376 991 q 232 704 281 861 q 183 382 183 547 q 196 221 183 301 q 232 64 208 141 q 292 -84 256 -12 q 375 -220 328 -156 l 260 -220 q 169 -89 207 -159 q 105 57 130 -19 q 68 215 80 134 q 56 380 56 296 z "},")":{ha:418,x_min:41,x_max:363,o:"m 363 380 q 351 215 363 296 q 313 57 338 134 q 249 -89 288 -19 q 158 -220 211 -159 l 43 -220 q 125 -84 90 -156 q 186 64 161 -12 q 222 221 210 141 q 235 382 235 301 q 186 704 235 547 q 41 991 137 861 l 158 991 q 249 857 211 928 q 313 708 288 785 q 351 548 338 630 q 363 380 363 465 z "},"*":{ha:765,x_min:56,x_max:708,o:"m 450 1055 l 421 789 l 690 864 l 708 733 l 452 714 l 618 493 l 497 428 l 378 671 l 271 428 l 146 493 l 310 714 l 56 733 l 75 864 l 340 789 l 311 1055 l 450 1055 z "},"+":{ha:765,x_min:69,x_max:696,o:"m 332 439 l 69 439 l 69 541 l 332 541 l 332 804 l 433 804 l 433 541 l 696 541 l 696 439 l 433 439 l 433 178 l 332 178 l 332 439 z "},",":{ha:347,x_min:43,x_max:256,o:"m 245 161 l 256 146 q 233 68 246 109 q 204 -16 220 26 q 171 -99 188 -58 q 136 -179 153 -141 l 43 -179 q 63 -93 53 -138 q 82 -4 73 -48 q 98 83 91 41 q 111 161 106 125 l 245 161 z "},"-":{ha:447,x_min:56,x_max:392,o:"m 56 315 l 56 429 l 392 429 l 392 315 l 56 315 z "},".":{ha:372,x_min:100,x_max:272,o:"m 100 75 q 106 119 100 101 q 125 148 113 137 q 152 164 136 159 q 186 170 168 170 q 219 164 203 170 q 247 148 235 159 q 265 119 258 137 q 272 75 272 101 q 265 32 272 50 q 247 3 258 14 q 219 -14 235 -9 q 186 -20 203 -20 q 152 -14 168 -20 q 125 3 136 -9 q 106 32 113 14 q 100 75 100 50 z "},"/":{ha:518,x_min:14,x_max:504,o:"m 504 991 l 135 0 l 14 0 l 383 991 l 504 991 z "},":":{ha:372,x_min:100,x_max:272,o:"m 100 75 q 106 119 100 101 q 125 148 113 137 q 152 164 136 159 q 186 170 168 170 q 219 164 203 170 q 247 148 235 159 q 265 119 258 137 q 272 75 272 101 q 265 32 272 50 q 247 3 258 14 q 219 -14 235 -9 q 186 -20 203 -20 q 152 -14 168 -20 q 125 3 136 -9 q 106 32 113 14 q 100 75 100 50 m 100 669 q 106 714 100 696 q 125 743 113 732 q 152 759 136 754 q 186 764 168 764 q 219 759 203 764 q 247 743 235 754 q 265 714 258 732 q 272 669 272 696 q 265 627 272 644 q 247 597 258 609 q 219 581 235 586 q 186 575 203 575 q 152 581 168 575 q 125 597 136 586 q 106 627 113 609 q 100 669 100 644 z "},";":{ha:372,x_min:43,x_max:272,o:"m 245 161 l 256 146 q 233 68 246 109 q 204 -16 220 26 q 171 -99 188 -58 q 136 -179 153 -141 l 43 -179 q 63 -93 53 -138 q 82 -4 73 -48 q 98 83 91 41 q 111 161 106 125 l 245 161 m 100 669 q 106 714 100 696 q 125 743 113 732 q 152 759 136 754 q 186 764 168 764 q 219 759 203 764 q 247 743 235 754 q 265 714 258 732 q 272 669 272 696 q 265 627 272 644 q 247 597 258 609 q 219 581 235 586 q 186 575 203 575 q 152 581 168 575 q 125 597 136 586 q 106 627 113 609 q 100 669 100 644 z "},"<":{ha:765,x_min:69,x_max:696,o:"m 696 161 l 69 449 l 69 518 l 696 844 l 696 736 l 197 489 l 696 271 l 696 161 z "},"=":{ha:765,x_min:69,x_max:696,o:"m 69 578 l 69 679 l 696 679 l 696 578 l 69 578 m 69 300 l 69 401 l 696 401 l 696 300 l 69 300 z "},">":{ha:765,x_min:69,x_max:696,o:"m 69 271 l 568 489 l 69 736 l 69 844 l 696 518 l 696 449 l 69 161 l 69 271 z "},"?":{ha:591,x_min:25,x_max:546,o:"m 191 281 l 191 306 q 196 376 191 345 q 214 434 201 407 q 250 487 227 461 q 306 542 272 513 q 361 592 338 570 q 399 638 385 615 q 421 689 414 662 q 428 751 428 715 q 418 811 428 784 q 388 857 408 838 q 340 887 369 876 q 273 897 311 897 q 166 880 217 897 q 68 839 115 862 l 25 937 q 144 986 80 966 q 273 1006 208 1006 q 387 988 336 1006 q 473 939 437 971 q 527 859 508 906 q 546 753 546 812 q 537 672 546 707 q 509 606 528 636 q 464 547 491 575 q 400 486 437 518 q 342 433 365 456 q 307 389 320 410 q 290 345 294 368 q 285 293 285 323 l 285 281 l 191 281 m 158 75 q 165 119 158 101 q 183 148 172 137 q 210 164 195 159 q 244 170 226 170 q 278 164 262 170 q 305 148 294 159 q 323 119 317 137 q 330 75 330 101 q 323 32 330 50 q 305 3 317 14 q 278 -14 294 -9 q 244 -20 262 -20 q 210 -14 226 -20 q 183 3 195 -9 q 165 32 172 14 q 158 75 158 50 z "},"@":{ha:1203,x_min:74,x_max:1129,o:"m 1129 496 q 1123 411 1129 454 q 1104 331 1116 369 q 1072 259 1091 292 q 1027 202 1053 227 q 968 164 1001 178 q 896 150 935 150 q 841 160 865 150 q 798 187 816 170 q 769 226 781 204 q 754 272 758 248 l 751 272 q 721 224 739 247 q 679 185 703 202 q 624 159 654 169 q 558 150 594 150 q 466 169 506 150 q 397 222 425 188 q 355 304 370 256 q 340 411 340 353 q 360 536 340 479 q 418 635 380 593 q 509 699 456 676 q 629 722 563 722 q 690 720 660 722 q 749 712 721 717 q 800 702 777 707 q 839 690 823 696 l 823 408 q 822 384 823 393 q 822 370 822 375 q 822 361 822 364 q 822 357 822 359 q 829 298 822 321 q 848 261 836 275 q 874 242 859 248 q 904 237 888 237 q 959 258 935 237 q 999 314 983 279 q 1023 397 1015 349 q 1031 497 1031 444 q 1002 668 1031 593 q 921 795 972 743 q 799 873 869 846 q 644 900 728 900 q 442 862 530 900 q 295 757 355 825 q 205 597 236 690 q 175 395 175 505 q 202 213 175 292 q 280 79 229 134 q 409 -3 332 25 q 586 -31 486 -31 q 668 -26 627 -31 q 746 -13 708 -21 q 817 6 783 -5 q 880 28 851 16 l 880 -68 q 749 -109 822 -94 q 587 -123 675 -123 q 371 -89 466 -123 q 209 12 275 -54 q 109 173 143 78 q 74 390 74 269 q 114 628 74 517 q 228 819 154 738 q 408 945 302 899 q 644 991 513 991 q 839 957 750 991 q 992 859 928 923 q 1093 703 1057 795 q 1129 496 1129 611 m 449 408 q 483 278 449 318 q 575 237 517 237 q 639 253 612 237 q 682 296 665 268 q 708 363 699 324 q 720 449 717 402 l 729 621 q 684 630 710 626 q 629 635 658 635 q 545 615 579 635 q 489 564 511 595 q 458 491 468 532 q 449 408 449 450 z "},A:{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 z "},B:{ha:863,x_min:135,x_max:786,o:"m 135 991 l 406 991 q 558 978 492 991 q 669 936 625 965 q 736 858 713 906 q 758 741 758 810 q 745 662 758 699 q 707 597 732 625 q 645 551 682 570 q 561 526 608 532 l 561 519 q 649 496 608 511 q 720 454 690 481 q 768 387 751 427 q 786 288 786 346 q 764 166 786 220 q 700 76 742 113 q 599 20 659 39 q 464 0 539 0 l 135 0 l 135 991 m 261 571 l 427 571 q 522 581 484 571 q 585 611 561 591 q 619 662 608 631 q 629 732 629 692 q 577 848 629 813 q 412 884 525 884 l 261 884 l 261 571 m 261 465 l 261 107 l 441 107 q 542 121 501 107 q 607 159 582 134 q 642 217 631 183 q 653 293 653 252 q 642 363 653 331 q 605 417 631 395 q 538 453 580 440 q 433 465 496 465 l 261 465 z "},C:{ha:838,x_min:85,x_max:798,o:"m 538 895 q 406 867 465 895 q 306 788 347 840 q 241 663 264 736 q 218 496 218 589 q 238 326 218 400 q 298 201 258 252 q 398 123 338 150 q 538 97 458 97 q 652 109 598 97 q 760 136 707 121 l 760 26 q 707 8 733 16 q 651 -4 680 1 q 590 -11 623 -9 q 517 -14 557 -14 q 324 23 406 -14 q 190 127 243 60 q 111 288 136 194 q 85 497 85 382 q 114 703 85 610 q 201 864 144 797 q 343 968 258 931 q 538 1006 428 1006 q 677 991 611 1006 q 798 947 744 976 l 745 842 q 652 879 702 863 q 538 895 602 895 z "},D:{ha:950,x_min:135,x_max:865,o:"m 865 505 q 833 285 865 380 q 739 127 800 191 q 587 32 677 64 q 383 0 497 0 l 135 0 l 135 991 l 411 991 q 599 960 515 991 q 742 868 683 929 q 833 715 801 806 q 865 505 865 625 m 732 501 q 709 672 732 600 q 644 791 687 745 q 539 861 602 838 q 397 884 477 884 l 261 884 l 261 109 l 371 109 q 641 208 550 109 q 732 501 732 307 z "},E:{ha:733,x_min:135,x_max:650,o:"m 650 0 l 135 0 l 135 991 l 650 991 l 650 880 l 261 880 l 261 574 l 624 574 l 624 464 l 261 464 l 261 111 l 650 111 l 650 0 z "},F:{ha:682,x_min:135,x_max:650,o:"m 261 0 l 135 0 l 135 991 l 650 991 l 650 880 l 261 880 l 261 530 l 624 530 l 624 419 l 261 419 l 261 0 z "},G:{ha:958,x_min:85,x_max:859,o:"m 530 524 l 859 524 l 859 37 q 783 16 821 25 q 705 0 745 6 q 621 -10 665 -7 q 526 -14 577 -14 q 338 22 420 -14 q 199 124 256 58 q 114 284 143 190 q 85 497 85 379 q 117 708 85 614 q 211 868 149 802 q 363 970 273 935 q 570 1006 454 1006 q 714 991 645 1006 q 843 947 783 976 l 794 838 q 742 859 770 849 q 684 877 713 869 q 622 890 654 885 q 559 895 591 895 q 413 867 477 895 q 306 788 349 840 q 241 663 263 736 q 218 496 218 589 q 237 334 218 408 q 296 208 256 261 q 401 126 337 155 q 557 97 466 97 q 611 99 587 97 q 657 103 636 100 q 697 110 678 106 q 733 117 715 113 l 733 412 l 530 412 l 530 524 z "},H:{ha:974,x_min:135,x_max:839,o:"m 839 0 l 713 0 l 713 463 l 261 463 l 261 0 l 135 0 l 135 991 l 261 991 l 261 574 l 713 574 l 713 991 l 839 991 l 839 0 z "},I:{ha:471,x_min:56,x_max:415,o:"m 415 0 l 56 0 l 56 69 l 172 97 l 172 895 l 56 922 l 56 991 l 415 991 l 415 922 l 298 895 l 298 97 l 415 69 l 415 0 z "},J:{ha:376,x_min:-125,x_max:252,o:"m -20 -264 q -80 -259 -54 -264 q -125 -248 -106 -255 l -125 -139 q -75 -149 -102 -145 q -18 -153 -49 -153 q 32 -146 7 -153 q 78 -123 58 -140 q 112 -76 99 -106 q 125 0 125 -46 l 125 991 l 252 991 l 252 14 q 232 -110 252 -58 q 176 -196 212 -162 q 91 -247 140 -231 q -20 -264 41 -264 z "},K:{ha:804,x_min:135,x_max:804,o:"m 804 0 l 661 0 l 355 473 l 261 396 l 261 0 l 135 0 l 135 991 l 261 991 l 261 496 l 343 610 l 650 991 l 791 991 l 439 559 l 804 0 z "},L:{ha:682,x_min:135,x_max:650,o:"m 135 0 l 135 991 l 261 991 l 261 113 l 650 113 l 650 0 l 135 0 z "},M:{ha:1208,x_min:135,x_max:1074,o:"m 545 0 l 244 868 l 239 868 q 245 768 243 818 q 250 679 248 726 q 252 593 252 631 l 252 0 l 135 0 l 135 991 l 322 991 l 602 183 l 606 183 l 886 991 l 1074 991 l 1074 0 l 947 0 l 947 602 q 949 682 947 637 q 952 769 950 728 q 957 867 955 817 l 951 867 l 648 0 l 545 0 z "},N:{ha:1013,x_min:135,x_max:878,o:"m 878 0 l 732 0 l 244 821 l 239 821 q 245 717 243 768 q 250 625 248 673 q 252 538 252 576 l 252 0 l 135 0 l 135 991 l 279 991 l 765 175 l 770 175 q 765 277 768 227 q 763 321 764 298 q 761 367 762 344 q 760 410 760 389 q 760 449 760 431 l 760 991 l 878 991 l 878 0 z "},O:{ha:1031,x_min:85,x_max:945,o:"m 945 497 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 z "},P:{ha:800,x_min:135,x_max:729,o:"m 729 701 q 710 583 729 640 q 649 482 692 526 q 536 412 606 438 q 363 386 466 386 l 261 386 l 261 0 l 135 0 l 135 991 l 380 991 q 537 972 471 991 q 646 916 603 953 q 709 825 688 879 q 729 701 729 770 m 261 493 l 349 493 q 459 504 412 493 q 537 539 506 515 q 583 601 568 563 q 599 694 599 640 q 543 837 599 791 q 370 884 488 884 l 261 884 l 261 493 z "},Q:{ha:1029,x_min:85,x_max:945,o:"m 945 497 q 928 332 945 408 q 879 194 911 255 q 799 87 847 132 q 688 17 751 43 q 763 -95 717 -47 q 871 -184 810 -144 l 789 -281 q 660 -164 719 -231 q 567 -11 602 -97 q 542 -13 555 -12 q 515 -14 528 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 z "},R:{ha:819,x_min:135,x_max:803,o:"m 261 410 l 261 0 l 135 0 l 135 991 l 376 991 q 643 922 557 991 q 729 710 729 852 q 712 607 729 651 q 668 531 696 563 q 606 479 641 500 q 533 444 570 458 l 803 0 l 654 0 l 416 410 l 261 410 m 261 517 l 372 517 q 476 529 433 517 q 546 564 519 541 q 586 622 574 587 q 599 704 599 657 q 585 787 599 753 q 543 842 571 821 q 472 874 515 864 q 370 884 429 884 l 261 884 l 261 517 z "},S:{ha:721,x_min:71,x_max:657,o:"m 657 265 q 634 148 657 199 q 567 60 610 96 q 461 5 524 24 q 321 -14 399 -14 q 180 -2 245 -14 q 71 33 115 10 l 71 154 q 123 133 94 143 q 185 114 153 122 q 252 101 218 106 q 321 96 287 96 q 481 136 429 96 q 533 253 533 177 q 523 317 533 290 q 489 367 513 344 q 422 411 464 389 q 318 457 381 432 q 213 509 258 481 q 140 572 169 537 q 97 652 111 608 q 83 754 83 697 q 105 861 83 814 q 166 940 127 907 q 260 989 205 972 q 380 1006 315 1006 q 526 990 461 1006 q 640 951 590 975 l 595 846 q 495 880 551 865 q 379 895 439 895 q 251 856 296 895 q 205 753 205 818 q 216 686 205 714 q 250 635 226 658 q 312 592 273 612 q 408 550 351 572 q 516 500 470 526 q 594 441 563 474 q 641 366 625 409 q 657 265 657 323 z "},T:{ha:721,x_min:14,x_max:707,o:"m 424 0 l 297 0 l 297 880 l 14 880 l 14 991 l 707 991 l 707 880 l 424 880 l 424 0 z "},U:{ha:970,x_min:125,x_max:844,o:"m 844 993 l 844 350 q 822 206 844 273 q 754 91 800 140 q 641 14 709 42 q 481 -14 573 -14 q 328 13 394 -14 q 216 87 261 39 q 148 202 171 135 q 125 353 125 270 l 125 991 l 252 991 l 252 346 q 310 162 252 227 q 488 97 369 97 q 591 115 548 97 q 663 167 635 134 q 704 246 690 200 q 718 347 718 292 l 718 993 l 844 993 z "},V:{ha:789,x_min:0,x_max:789,o:"m 654 991 l 789 991 l 457 0 l 330 0 l 0 991 l 134 991 l 334 363 q 368 244 353 301 q 393 136 382 186 q 419 244 404 186 q 456 367 435 301 l 654 991 z "},W:{ha:1227,x_min:14,x_max:1214,o:"m 549 991 l 682 991 l 838 411 q 858 335 848 373 q 876 261 867 297 q 891 194 884 226 q 901 136 897 162 q 908 193 904 162 q 918 257 912 223 q 929 325 923 290 q 943 393 936 360 l 1079 991 l 1214 991 l 965 0 l 838 0 l 665 636 q 647 707 656 671 q 631 776 638 744 q 615 848 623 813 q 600 777 608 814 q 585 707 593 745 q 567 632 576 669 l 403 0 l 275 0 l 14 991 l 147 991 l 298 389 q 313 324 307 357 q 326 257 320 290 q 336 193 332 224 q 345 136 341 162 q 353 195 348 161 q 365 264 358 228 q 379 339 372 301 q 396 410 387 376 l 549 991 z "},X:{ha:760,x_min:0,x_max:760,o:"m 760 0 l 616 0 l 376 431 l 127 0 l 0 0 l 307 518 l 21 991 l 155 991 l 380 612 l 607 991 l 736 991 l 450 522 l 760 0 z "},Y:{ha:732,x_min:0,x_max:732,o:"m 366 490 l 596 991 l 732 991 l 429 386 l 429 0 l 302 0 l 302 379 l 0 991 l 138 991 l 366 490 z "},Z:{ha:749,x_min:56,x_max:693,o:"m 693 0 l 56 0 l 56 98 l 538 879 l 69 879 l 69 991 l 679 991 l 679 893 l 197 113 l 693 113 l 693 0 z "},"[":{ha:421,x_min:111,x_max:386,o:"m 386 -220 l 111 -220 l 111 991 l 386 991 l 386 890 l 235 890 l 235 -118 l 386 -118 l 386 -220 z "},"\\":{ha:518,x_min:16,x_max:505,o:"m 136 991 l 505 0 l 385 0 l 16 991 l 136 991 z "},"]":{ha:421,x_min:35,x_max:310,o:"m 35 -118 l 186 -118 l 186 890 l 35 890 l 35 991 l 310 991 l 310 -220 l 35 -220 l 35 -118 z "},"^":{ha:739,x_min:28,x_max:711,o:"m 28 372 l 339 999 l 408 999 l 711 372 l 602 372 l 374 871 l 137 372 l 28 372 z "},_:{ha:571,x_min:-3,x_max:574,o:"m 574 -220 l -3 -220 l -3 -125 l 574 -125 l 574 -220 z "},"`":{ha:802,x_min:267,x_max:533,o:"m 533 842 l 452 842 q 400 889 428 861 q 346 947 372 917 q 299 1004 320 977 q 267 1050 277 1031 l 267 1064 l 415 1064 q 440 1014 426 1041 q 471 959 455 986 q 503 905 486 931 q 533 860 519 880 l 533 842 z "},a:{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 z "},b:{ha:814,x_min:118,x_max:737,o:"m 454 758 q 570 734 518 758 q 660 661 623 709 q 717 541 696 612 q 737 374 737 469 q 717 206 737 278 q 660 85 696 134 q 570 11 623 36 q 454 -14 518 -14 q 382 -5 414 -14 q 323 19 349 4 q 277 53 297 33 q 241 94 257 73 l 233 94 l 208 0 l 118 0 l 118 1055 l 241 1055 l 241 800 q 241 750 241 777 q 239 700 240 723 q 236 647 237 673 l 241 647 q 277 691 257 671 q 322 726 296 711 q 381 750 349 741 q 454 758 414 758 m 431 656 q 340 638 376 656 q 282 586 304 621 q 251 498 260 551 q 241 374 241 445 q 251 252 241 305 q 282 162 260 199 q 340 107 304 126 q 432 89 377 89 q 567 163 524 89 q 610 375 610 237 q 567 586 610 516 q 431 656 524 656 z "},c:{ha:643,x_min:77,x_max:596,o:"m 403 -14 q 275 8 334 -14 q 171 76 215 29 q 102 194 127 122 q 77 368 77 267 q 102 549 77 475 q 173 670 128 623 q 279 737 218 716 q 408 758 339 758 q 512 747 461 758 q 596 718 562 735 l 559 614 q 525 627 544 621 q 486 638 506 633 q 446 647 465 644 q 408 650 426 650 q 253 582 302 650 q 204 370 204 513 q 253 160 204 227 q 403 94 302 94 q 502 107 458 94 q 583 136 547 119 l 583 26 q 505 -3 547 7 q 403 -14 463 -14 z "},d:{ha:814,x_min:77,x_max:696,o:"m 578 100 l 572 100 q 537 56 557 77 q 491 20 517 35 q 433 -5 465 4 q 359 -14 400 -14 q 244 11 296 -14 q 155 84 192 35 q 97 204 117 132 q 77 371 77 276 q 97 539 77 467 q 155 660 117 611 q 244 733 192 709 q 359 758 296 758 q 432 749 399 758 q 491 726 465 741 q 537 691 517 711 q 572 650 557 671 l 581 650 q 576 694 578 673 q 574 730 575 711 q 572 760 572 749 l 572 1055 l 696 1055 l 696 0 l 596 0 l 578 100 m 383 89 q 470 104 435 89 q 528 152 506 120 q 561 232 550 184 q 572 343 571 279 l 572 371 q 563 493 572 439 q 532 582 554 546 q 473 637 510 618 q 382 656 437 656 q 247 582 290 656 q 204 370 204 508 q 247 158 204 228 q 383 89 290 89 z "},e:{ha:743,x_min:77,x_max:673,o:"m 412 -14 q 276 12 338 -14 q 170 85 214 37 q 101 204 125 133 q 77 367 77 275 q 99 532 77 459 q 162 655 121 604 q 259 732 203 705 q 385 758 316 758 q 505 734 452 758 q 596 666 559 710 q 653 561 633 623 q 673 425 673 500 l 673 349 l 204 349 q 259 156 208 218 q 414 94 311 94 q 478 98 448 94 q 535 107 507 101 q 588 124 562 114 q 640 146 614 134 l 640 36 q 587 14 613 23 q 533 -2 561 4 q 476 -11 506 -8 q 412 -14 447 -14 m 382 656 q 259 603 304 656 q 207 449 214 550 l 541 449 q 531 533 541 495 q 503 599 522 572 q 454 641 484 626 q 382 656 424 656 z "},f:{ha:457,x_min:20,x_max:510,o:"m 441 652 l 275 652 l 275 0 l 151 0 l 151 652 l 20 652 l 20 703 l 151 749 l 151 814 q 166 934 151 886 q 211 1010 182 982 q 281 1051 239 1039 q 376 1063 323 1063 q 450 1055 416 1063 q 510 1038 484 1047 l 478 942 q 432 955 457 949 q 380 961 408 961 q 334 955 353 961 q 301 932 314 948 q 282 887 288 916 q 275 815 275 859 l 275 745 l 441 745 l 441 652 z "},g:{ha:720,x_min:25,x_max:692,o:"m 692 745 l 692 668 l 558 650 q 590 589 577 626 q 603 505 603 552 q 587 410 603 454 q 539 334 571 366 q 459 284 507 302 q 349 267 412 267 q 319 267 334 267 q 294 269 304 267 q 272 254 283 262 q 251 235 260 245 q 236 210 242 224 q 231 180 231 197 q 239 151 231 162 q 261 134 247 140 q 294 125 275 127 q 334 123 313 123 l 453 123 q 559 107 516 123 q 630 64 603 92 q 670 0 658 37 q 682 -78 682 -37 q 660 -185 682 -138 q 593 -266 638 -233 q 478 -316 547 -298 q 314 -334 408 -334 q 187 -319 241 -334 q 97 -278 133 -305 q 43 -213 61 -251 q 25 -126 25 -174 q 38 -55 25 -85 q 74 -1 52 -24 q 126 35 96 21 q 187 57 155 50 q 140 98 159 70 q 122 161 122 125 q 144 233 122 203 q 212 292 165 263 q 159 325 183 304 q 118 374 135 347 q 93 434 102 401 q 83 501 83 467 q 100 609 83 562 q 151 690 117 656 q 233 741 184 723 q 349 758 283 758 q 400 754 374 758 q 446 745 427 751 l 692 745 m 142 -122 q 151 -169 142 -147 q 179 -206 159 -191 q 232 -231 199 -222 q 314 -240 265 -240 q 503 -201 440 -240 q 566 -89 566 -162 q 557 -38 566 -58 q 531 -7 549 -18 q 481 8 512 4 q 407 12 451 12 l 288 12 q 238 7 264 12 q 191 -14 212 1 q 156 -55 170 -28 q 142 -122 142 -81 m 204 505 q 241 389 204 427 q 345 351 277 351 q 447 389 412 351 q 482 507 482 427 q 447 630 482 591 q 343 669 411 669 q 240 629 276 669 q 204 505 204 588 z "},h:{ha:818,x_min:118,x_max:707,o:"m 583 0 l 583 479 q 548 612 583 568 q 436 656 512 656 q 344 638 381 656 q 284 586 307 621 q 251 501 261 551 q 241 386 241 451 l 241 0 l 118 0 l 118 1055 l 241 1055 l 241 742 l 236 644 l 243 644 q 283 695 260 673 q 334 730 307 716 q 393 751 362 745 q 457 758 425 758 q 644 693 581 758 q 707 486 707 629 l 707 0 l 583 0 z "},i:{ha:359,x_min:109,x_max:253,o:"m 241 0 l 118 0 l 118 745 l 241 745 l 241 0 m 109 946 q 129 1005 109 987 q 180 1023 150 1023 q 209 1019 195 1023 q 232 1005 222 1015 q 247 981 241 996 q 253 946 253 966 q 232 887 253 907 q 180 868 210 868 q 129 887 150 868 q 109 946 109 906 z "},j:{ha:359,x_min:-46,x_max:253,o:"m 45 -334 q -9 -329 12 -334 q -46 -317 -31 -324 l -46 -216 q -10 -227 -28 -223 q 32 -231 8 -231 q 66 -225 50 -231 q 93 -207 81 -220 q 112 -172 105 -194 q 118 -115 118 -150 l 118 745 l 241 745 l 241 -107 q 230 -201 241 -159 q 194 -272 218 -243 q 133 -318 170 -302 q 45 -334 96 -334 m 109 946 q 129 1005 109 987 q 180 1023 150 1023 q 209 1019 195 1023 q 232 1005 222 1015 q 247 981 241 996 q 253 946 253 966 q 232 887 253 907 q 180 868 210 868 q 129 887 150 868 q 109 946 109 906 z "},k:{ha:689,x_min:118,x_max:684,o:"m 232 385 l 323 500 l 522 745 l 665 745 l 393 422 l 684 0 l 542 0 l 314 342 l 240 286 l 240 0 l 118 0 l 118 1055 l 240 1055 l 240 571 l 229 385 l 232 385 z "},l:{ha:359,x_min:118,x_max:241,o:"m 241 0 l 118 0 l 118 1055 l 241 1055 l 241 0 z "},m:{ha:1244,x_min:118,x_max:1133,o:"m 1010 0 l 1010 479 q 976 612 1010 568 q 871 656 942 656 q 787 640 821 656 q 730 593 752 624 q 698 516 708 562 q 688 411 688 471 l 688 0 l 564 0 l 564 479 q 530 612 564 568 q 425 656 496 656 q 338 638 373 656 q 281 586 302 621 q 251 501 260 551 q 241 386 241 451 l 241 0 l 118 0 l 118 745 l 218 745 l 236 644 l 243 644 q 281 695 259 673 q 331 730 304 716 q 388 751 357 745 q 449 758 418 758 q 584 728 530 758 q 664 635 638 699 l 669 635 q 712 690 687 667 q 766 728 736 713 q 828 751 795 743 q 895 758 861 758 q 1073 693 1013 758 q 1133 486 1133 629 l 1133 0 l 1010 0 z "},n:{ha:818,x_min:118,x_max:707,o:"m 583 0 l 583 479 q 548 612 583 568 q 436 656 512 656 q 344 638 381 656 q 284 586 307 621 q 251 501 261 551 q 241 386 241 451 l 241 0 l 118 0 l 118 745 l 218 745 l 236 644 l 243 644 q 283 695 260 673 q 334 730 307 716 q 393 751 362 745 q 457 758 425 758 q 644 693 581 758 q 707 486 707 629 l 707 0 l 583 0 z "},o:{ha:802,x_min:77,x_max:725,o:"m 725 374 q 702 209 725 281 q 637 87 680 136 q 534 12 595 38 q 399 -14 474 -14 q 270 12 329 -14 q 168 87 211 38 q 101 209 125 136 q 77 374 77 281 q 99 537 77 466 q 164 658 122 609 q 267 733 206 707 q 403 758 328 758 q 532 733 473 758 q 634 658 591 707 q 701 537 677 609 q 725 374 725 466 m 204 374 q 251 160 204 232 q 401 89 297 89 q 552 160 506 89 q 597 374 597 232 q 551 586 597 515 q 400 656 505 656 q 250 586 296 656 q 204 374 204 515 z "},p:{ha:814,x_min:118,x_max:737,o:"m 454 -14 q 382 -5 414 -14 q 323 19 349 4 q 277 53 297 33 q 241 94 257 73 l 233 94 q 237 50 235 71 q 240 14 239 33 q 241 -16 241 -5 l 241 -334 l 118 -334 l 118 745 l 218 745 l 236 644 l 241 644 q 277 689 257 668 q 322 725 296 709 q 381 749 349 740 q 454 758 414 758 q 570 734 518 758 q 660 661 623 709 q 717 541 696 612 q 737 374 737 469 q 717 206 737 278 q 660 85 696 134 q 570 11 623 36 q 454 -14 518 -14 m 431 656 q 343 640 379 656 q 286 593 308 625 q 253 513 264 561 q 241 401 243 466 l 241 374 q 251 252 241 305 q 282 162 260 199 q 340 107 304 126 q 432 89 377 89 q 567 163 524 89 q 610 375 610 237 q 567 586 610 516 q 431 656 524 656 z "},q:{ha:814,x_min:77,x_max:696,o:"m 383 89 q 470 104 435 89 q 528 152 506 120 q 561 232 550 184 q 572 343 571 279 l 572 371 q 563 493 572 439 q 532 582 554 546 q 473 637 510 618 q 382 656 437 656 q 247 582 290 656 q 204 370 204 508 q 247 158 204 228 q 383 89 290 89 m 359 -14 q 244 11 296 -14 q 155 84 192 35 q 97 204 117 132 q 77 371 77 276 q 97 539 77 467 q 155 660 117 611 q 244 733 192 709 q 359 758 296 758 q 432 749 399 758 q 490 725 465 740 q 536 689 516 709 q 572 644 557 668 l 578 644 l 596 745 l 696 745 l 696 -334 l 572 -334 l 572 -16 q 574 17 572 -3 q 576 55 575 37 q 581 100 578 77 l 572 100 q 537 56 557 77 q 491 20 517 35 q 433 -5 465 4 q 359 -14 400 -14 z "},r:{ha:554,x_min:118,x_max:526,o:"m 440 758 q 484 756 460 758 q 526 751 509 755 l 510 637 q 471 643 491 641 q 433 646 451 646 q 355 628 391 646 q 295 579 320 611 q 255 502 269 547 q 241 401 241 456 l 241 0 l 118 0 l 118 745 l 218 745 l 233 608 l 239 608 q 275 665 256 637 q 318 712 294 692 q 372 746 342 733 q 440 758 402 758 z "},s:{ha:627,x_min:61,x_max:564,o:"m 564 204 q 544 109 564 150 q 487 41 524 68 q 398 0 450 14 q 281 -14 346 -14 q 154 -2 207 -14 q 61 33 101 10 l 61 146 q 108 124 82 135 q 162 106 134 114 q 221 93 191 98 q 281 87 251 87 q 356 95 325 87 q 406 116 387 102 q 434 150 425 130 q 443 195 443 170 q 436 233 443 216 q 411 266 429 250 q 362 300 393 283 q 282 338 331 317 q 194 379 233 359 q 128 425 155 399 q 86 483 101 450 q 72 561 72 515 q 91 645 72 608 q 143 707 109 682 q 224 745 177 732 q 330 758 272 758 q 451 744 396 758 q 554 707 505 730 l 511 607 q 421 641 467 627 q 326 656 374 656 q 224 633 257 656 q 191 568 191 610 q 198 527 191 545 q 225 494 206 509 q 276 462 244 478 q 355 427 308 446 q 443 386 404 406 q 508 340 481 366 q 549 282 535 315 q 564 204 564 250 z "},t:{ha:471,x_min:22,x_max:444,o:"m 343 87 q 371 89 355 87 q 400 92 386 90 q 426 97 414 94 q 444 102 438 100 l 444 8 q 422 0 435 4 q 392 -7 408 -4 q 358 -12 376 -10 q 323 -14 340 -14 q 245 -3 281 -14 q 183 35 210 8 q 142 106 157 61 q 127 220 127 151 l 127 652 l 22 652 l 22 707 l 127 760 l 180 916 l 252 916 l 252 745 l 439 745 l 439 652 l 252 652 l 252 220 q 273 121 252 154 q 343 87 294 87 z "},u:{ha:818,x_min:111,x_max:700,o:"m 600 0 l 582 100 l 575 100 q 535 49 558 71 q 484 14 511 28 q 425 -7 456 0 q 361 -14 393 -14 q 252 2 299 -14 q 174 51 205 18 q 127 136 143 84 q 111 258 111 187 l 111 745 l 235 745 l 235 265 q 271 133 235 177 q 382 89 307 89 q 474 106 437 89 q 534 158 511 124 q 567 243 557 193 q 576 358 576 293 l 576 745 l 700 745 l 700 0 l 600 0 z "},v:{ha:665,x_min:0,x_max:665,o:"m 254 0 l 0 745 l 127 745 l 262 330 q 280 273 270 308 q 300 201 290 237 q 319 132 311 164 q 330 82 328 99 l 335 82 q 347 132 338 99 q 365 201 355 164 q 385 273 375 237 q 403 330 395 308 l 538 745 l 665 745 l 411 0 l 254 0 z "},w:{ha:1036,x_min:14,x_max:1022,o:"m 684 0 l 570 418 q 563 445 567 430 q 555 477 559 460 q 546 512 551 494 q 538 547 542 530 q 518 628 528 586 l 514 628 q 496 546 505 585 q 480 476 488 512 q 464 415 471 440 l 347 0 l 204 0 l 14 745 l 143 745 l 232 349 q 245 282 239 318 q 258 212 252 247 q 269 146 264 177 q 277 96 274 115 l 281 96 q 290 143 284 113 q 303 205 296 172 q 317 270 310 238 q 332 325 325 302 l 453 745 l 586 745 l 703 325 q 716 271 709 302 q 732 207 724 239 q 745 145 739 175 q 754 96 751 115 l 758 96 q 765 143 760 113 q 775 208 769 172 q 788 280 781 243 q 803 349 795 317 l 896 745 l 1022 745 l 829 0 l 684 0 z "},x:{ha:694,x_min:24,x_max:669,o:"m 277 382 l 37 745 l 178 745 l 347 467 l 517 745 l 657 745 l 416 382 l 669 0 l 529 0 l 347 296 l 164 0 l 24 0 l 277 382 z "},y:{ha:679,x_min:7,x_max:672,o:"m 7 745 l 135 745 l 281 329 q 300 272 290 302 q 318 212 310 242 q 333 155 327 182 q 342 103 339 127 l 346 103 q 357 149 349 120 q 373 211 364 178 q 392 276 382 244 q 410 330 402 308 l 545 745 l 672 745 l 378 -97 q 337 -196 359 -152 q 286 -270 315 -239 q 217 -317 256 -300 q 123 -334 178 -334 q 62 -330 88 -334 q 18 -322 37 -326 l 18 -224 q 54 -230 33 -227 q 100 -232 76 -232 q 156 -224 132 -232 q 197 -201 180 -216 q 228 -165 215 -186 q 250 -115 240 -143 l 289 -7 l 7 745 z "},z:{ha:612,x_min:56,x_max:557,o:"m 557 0 l 56 0 l 56 85 l 419 652 l 78 652 l 78 745 l 545 745 l 545 646 l 189 93 l 557 93 l 557 0 z "},"{":{ha:492,x_min:41,x_max:457,o:"m 339 -11 q 347 -64 339 -43 q 371 -97 355 -85 q 408 -113 386 -109 q 457 -118 430 -117 l 457 -220 q 360 -208 405 -219 q 284 -173 316 -197 q 233 -111 252 -149 q 215 -21 215 -74 l 215 205 q 171 304 215 275 q 41 334 126 334 l 41 439 q 171 468 126 439 q 215 567 215 497 l 215 793 q 233 883 215 846 q 284 944 252 920 q 360 980 316 968 q 457 991 405 991 l 457 890 q 408 885 430 890 q 371 869 386 881 q 347 837 355 857 q 339 783 339 816 l 339 558 q 299 445 339 487 q 180 390 258 404 l 180 382 q 299 327 258 368 q 339 214 339 286 l 339 -11 z "},"|":{ha:765,x_min:332,x_max:433,o:"m 332 1055 l 433 1055 l 433 -334 l 332 -334 l 332 1055 z "},"}":{ha:492,x_min:35,x_max:450,o:"m 153 214 q 193 327 153 286 q 311 382 233 368 l 311 390 q 193 445 233 404 q 153 558 153 487 l 153 783 q 144 837 153 816 q 121 869 136 857 q 84 885 106 881 q 35 890 62 890 l 35 991 q 131 980 87 991 q 208 944 176 968 q 258 883 240 920 q 277 793 277 846 l 277 567 q 288 507 277 532 q 321 468 299 483 q 376 446 343 452 q 450 439 408 439 l 450 334 q 321 304 366 334 q 277 205 277 275 l 277 -21 q 258 -111 277 -74 q 208 -173 240 -149 q 131 -208 176 -197 q 35 -220 87 -219 l 35 -118 q 84 -113 62 -117 q 121 -97 106 -109 q 144 -64 136 -85 q 153 -11 153 -43 l 153 214 z "},"~":{ha:765,x_min:69,x_max:696,o:"m 359 441 q 316 460 334 452 q 282 472 297 467 q 253 478 267 476 q 224 479 239 479 q 184 473 205 479 q 144 455 164 467 q 105 429 124 444 q 69 397 86 414 l 69 507 q 237 581 137 581 q 274 579 257 581 q 310 573 291 577 q 351 560 328 568 q 406 538 374 551 q 449 519 431 527 q 484 508 468 512 q 513 502 500 503 q 542 500 527 500 q 581 506 561 500 q 622 524 602 513 q 661 550 642 535 q 696 582 680 565 l 696 472 q 528 399 629 399 q 491 400 508 399 q 455 407 474 402 q 414 419 437 411 q 359 441 391 428 z "},"¡":{ha:374,x_min:100,x_max:272,o:"m 144 458 l 227 458 l 261 -253 l 110 -253 l 144 458 m 272 664 q 266 620 272 638 q 247 591 259 602 q 220 575 235 580 q 186 570 204 570 q 153 575 168 570 q 125 591 137 580 q 106 620 113 602 q 100 664 100 638 q 106 707 100 689 q 125 736 113 724 q 153 753 137 747 q 186 758 168 758 q 220 753 204 758 q 247 736 235 747 q 266 707 259 724 q 272 664 272 689 z "},"¢":{ha:765,x_min:127,x_max:647,o:"m 635 163 q 564 134 601 144 q 475 122 526 123 l 475 -14 l 382 -14 l 382 126 q 276 160 323 135 q 196 231 229 186 q 145 343 163 276 q 127 504 127 411 q 145 668 127 600 q 196 783 163 737 q 276 855 229 829 q 382 889 323 880 l 382 1006 l 475 1006 l 475 895 q 570 881 524 892 q 647 854 616 870 l 611 750 q 576 763 595 757 q 537 775 557 770 q 497 783 517 780 q 460 786 477 786 q 304 718 353 786 q 256 505 256 649 q 305 297 256 363 q 454 231 354 231 q 554 243 509 231 q 635 272 598 256 l 635 163 z "},"£":{ha:765,x_min:46,x_max:718,o:"m 452 1004 q 583 989 524 1004 q 686 950 642 974 l 642 852 q 556 887 604 872 q 457 901 508 901 q 397 892 425 901 q 349 863 369 883 q 317 811 328 843 q 306 734 306 779 l 306 534 l 561 534 l 561 441 l 306 441 l 306 298 q 298 226 306 256 q 277 174 290 196 q 247 138 264 153 q 211 113 229 123 l 718 113 l 718 0 l 46 0 l 46 104 q 101 126 76 112 q 143 163 125 140 q 172 219 161 186 q 182 297 182 252 l 182 441 l 47 441 l 47 534 l 182 534 l 182 754 q 202 860 182 813 q 257 938 222 906 q 342 987 293 970 q 452 1004 392 1004 z "},"¤":{ha:765,x_min:83,x_max:681,o:"m 126 490 q 138 567 126 530 q 171 635 150 603 l 83 722 l 150 789 l 236 701 q 304 735 268 723 q 382 747 341 747 q 459 735 422 747 q 526 701 495 723 l 614 789 l 681 724 l 593 636 q 626 568 614 605 q 639 490 639 531 q 627 412 639 450 q 593 345 615 375 l 679 258 l 614 193 l 526 279 q 459 247 495 258 q 382 235 422 235 q 304 247 341 235 q 236 281 267 259 l 150 195 l 85 260 l 171 346 q 138 413 150 376 q 126 490 126 450 m 220 490 q 232 427 220 456 q 267 375 245 397 q 318 340 289 353 q 382 328 348 328 q 447 340 416 328 q 499 375 477 353 q 534 427 522 397 q 547 490 547 456 q 534 555 547 525 q 499 608 522 585 q 447 643 477 630 q 382 656 416 656 q 318 643 348 656 q 267 608 289 630 q 232 555 245 585 q 220 490 220 525 z "},"¥":{ha:765,x_min:20,x_max:746,o:"m 382 490 l 616 991 l 746 991 l 485 471 l 647 471 l 647 378 l 443 378 l 443 271 l 647 271 l 647 178 l 443 178 l 443 0 l 322 0 l 322 178 l 118 178 l 118 271 l 322 271 l 322 378 l 118 378 l 118 471 l 277 471 l 20 991 l 150 991 l 382 490 z "},"¦":{ha:765,x_min:332,x_max:433,o:"m 332 1055 l 433 1055 l 433 526 l 332 526 l 332 1055 m 332 196 l 433 196 l 433 -334 l 332 -334 l 332 196 z "},"§":{ha:675,x_min:82,x_max:585,o:"m 93 549 q 102 611 93 583 q 126 661 111 640 q 161 698 141 683 q 201 724 180 713 q 122 788 151 749 q 93 884 93 827 q 112 958 93 925 q 164 1015 130 991 q 245 1050 198 1038 q 351 1063 293 1063 q 470 1049 417 1063 q 572 1014 524 1036 l 534 920 q 443 952 490 939 q 347 965 395 965 q 245 945 280 965 q 211 886 211 925 q 219 852 211 868 q 247 822 227 837 q 298 791 266 807 q 378 755 330 775 q 465 714 427 736 q 530 666 503 692 q 570 607 556 640 q 585 532 585 574 q 576 468 585 496 q 554 416 568 439 q 523 376 541 393 q 486 349 505 359 q 559 286 533 323 q 585 196 585 249 q 565 110 585 148 q 508 46 545 73 q 419 7 471 20 q 301 -7 366 -7 q 175 4 228 -7 q 82 37 122 16 l 82 144 q 129 124 103 134 q 183 106 155 114 q 242 94 212 98 q 301 89 272 89 q 379 97 348 89 q 430 118 411 105 q 456 149 448 132 q 464 184 464 166 q 458 219 464 204 q 435 250 452 235 q 386 282 418 265 q 302 319 354 298 q 214 361 253 340 q 148 409 175 382 q 107 469 121 435 q 93 549 93 503 m 197 564 q 207 517 197 538 q 238 476 216 496 q 293 438 259 456 q 376 399 328 419 l 400 389 q 428 410 414 397 q 453 437 441 422 q 471 472 464 453 q 478 514 478 491 q 469 562 478 540 q 438 603 460 583 q 380 643 416 623 q 288 682 343 662 q 255 666 271 677 q 226 641 239 656 q 205 606 213 625 q 197 564 197 586 z "},"¨":{ha:802,x_min:208,x_max:593,o:"m 208 946 q 227 999 208 983 q 273 1015 246 1015 q 319 999 300 1015 q 339 946 339 982 q 319 893 339 910 q 273 876 300 876 q 227 893 246 876 q 208 946 208 910 m 463 946 q 481 999 463 983 q 528 1015 500 1015 q 552 1011 541 1015 q 573 999 564 1007 q 587 977 582 990 q 593 946 593 964 q 573 893 593 910 q 528 876 553 876 q 481 893 500 876 q 463 946 463 910 z "},"©":{ha:1156,x_min:68,x_max:1088,o:"m 604 714 q 531 699 563 714 q 477 656 499 684 q 445 587 456 628 q 433 496 433 547 q 443 402 433 443 q 474 334 453 361 q 527 291 494 306 q 604 277 559 277 q 638 279 620 277 q 676 286 656 281 q 714 295 695 290 q 750 307 733 301 l 750 218 q 717 205 734 211 q 683 194 701 199 q 644 187 665 189 q 600 184 624 184 q 479 207 531 184 q 394 271 428 229 q 342 370 359 312 q 325 497 325 427 q 343 622 325 566 q 397 720 361 679 q 485 783 433 760 q 604 806 536 806 q 692 794 647 806 q 777 764 736 783 l 734 677 q 666 705 699 695 q 604 714 633 714 m 68 496 q 86 631 68 566 q 137 753 104 696 q 217 857 170 810 q 320 936 264 903 q 442 987 377 969 q 578 1006 507 1006 q 713 987 648 1006 q 835 936 779 969 q 939 857 892 903 q 1018 753 985 810 q 1069 631 1051 696 q 1088 496 1088 566 q 1069 360 1088 425 q 1018 238 1051 295 q 939 135 985 182 q 835 56 892 89 q 713 4 779 22 q 578 -14 648 -14 q 442 4 507 -14 q 320 56 377 22 q 217 135 264 89 q 137 238 170 182 q 86 360 104 295 q 68 496 68 425 m 142 496 q 176 326 142 406 q 270 188 210 247 q 408 94 329 128 q 578 60 488 60 q 747 94 668 60 q 886 188 827 128 q 980 326 945 247 q 1014 496 1014 406 q 980 665 1014 586 q 886 804 945 745 q 747 898 827 863 q 578 932 668 932 q 408 898 488 932 q 270 804 329 863 q 176 665 210 745 q 142 496 142 586 z "},"ª":{ha:460,x_min:46,x_max:392,o:"m 330 541 l 311 596 q 286 569 299 581 q 257 549 273 557 q 222 536 241 541 q 179 532 203 532 q 125 541 150 532 q 83 567 101 549 q 56 610 66 584 q 46 671 46 636 q 94 777 46 740 q 239 817 142 813 l 306 819 l 306 840 q 285 908 306 889 q 227 928 264 928 q 163 918 194 928 q 104 893 133 908 l 72 961 q 146 991 106 979 q 227 1003 186 1003 q 352 967 311 1003 q 392 848 392 931 l 392 541 l 330 541 m 256 753 q 198 745 221 751 q 161 728 175 739 q 141 704 147 718 q 135 669 135 689 q 152 620 135 635 q 197 604 169 604 q 240 611 220 604 q 274 633 260 618 q 297 670 289 648 q 306 722 306 692 l 306 755 l 256 753 z "},"«":{ha:676,x_min:56,x_max:621,o:"m 56 375 l 265 656 l 345 603 l 183 367 l 345 131 l 265 78 l 56 357 l 56 375 m 332 375 l 542 656 l 621 603 l 460 367 l 621 131 l 542 78 l 332 357 l 332 375 z "},"¬":{ha:765,x_min:69,x_max:696,o:"m 696 541 l 696 178 l 595 178 l 595 439 l 69 439 l 69 541 l 696 541 z "},"­":{ha:447,x_min:56,x_max:392,o:"m 56 315 l 56 429 l 392 429 l 392 315 l 56 315 z "},"®":{ha:1092,x_min:61,x_max:1023,o:"m 61 494 q 124 749 61 631 q 300 933 188 866 q 543 1001 412 1001 q 785 933 673 1001 q 960 749 897 866 q 1023 494 1023 631 q 962 244 1023 361 q 789 57 901 127 q 543 -14 677 -14 q 297 56 409 -14 q 123 243 184 126 q 61 494 61 359 m 139 494 q 193 278 139 378 q 341 123 248 179 q 543 66 434 66 q 745 124 652 66 q 892 279 839 181 q 945 494 945 378 q 892 708 945 610 q 745 863 839 806 q 543 920 652 920 q 340 864 434 920 q 193 709 247 808 q 139 494 139 610 m 443 444 l 443 214 l 347 214 l 347 790 l 534 790 q 695 746 638 790 q 753 616 753 701 q 666 489 753 533 q 749 351 749 455 l 749 309 q 761 225 749 251 l 761 214 l 663 214 q 653 301 653 239 q 651 376 653 364 q 562 444 640 441 l 443 444 m 443 530 l 549 530 q 627 554 597 532 q 657 613 657 576 q 631 683 657 663 q 536 704 604 704 l 443 704 l 443 530 z "},"¯":{ha:694,x_min:-4,x_max:699,o:"m 699 1055 l -4 1055 l -4 1150 l 699 1150 l 699 1055 z "},"°":{ha:595,x_min:83,x_max:511,o:"m 83 791 q 100 874 83 836 q 146 943 117 913 q 214 989 175 972 q 297 1006 253 1006 q 380 989 341 1006 q 448 943 419 972 q 494 874 477 913 q 511 791 511 836 q 494 709 511 747 q 448 641 477 670 q 380 596 419 612 q 297 579 341 579 q 214 596 253 579 q 146 641 175 612 q 100 709 117 670 q 83 791 83 747 m 167 791 q 177 742 167 765 q 205 701 187 718 q 246 673 222 683 q 297 663 270 663 q 348 673 324 663 q 390 701 372 683 q 418 742 408 718 q 428 791 428 765 q 418 843 428 819 q 390 885 408 867 q 348 913 372 903 q 297 924 324 924 q 246 913 270 924 q 205 885 222 903 q 177 843 187 867 q 167 791 167 819 z "},"±":{ha:765,x_min:69,x_max:696,o:"m 332 439 l 69 439 l 69 541 l 332 541 l 332 804 l 433 804 l 433 541 l 696 541 l 696 439 l 433 439 l 433 178 l 332 178 l 332 439 m 69 0 l 69 102 l 696 102 l 696 0 l 69 0 z "},"²":{ha:460,x_min:33,x_max:421,o:"m 421 397 l 33 397 l 33 473 l 175 628 q 238 699 214 670 q 276 750 262 728 q 295 793 290 773 q 300 836 300 813 q 277 902 300 880 q 218 924 255 924 q 152 907 184 924 q 90 864 121 890 l 37 928 q 119 982 74 960 q 220 1004 164 1004 q 293 993 260 1004 q 349 961 326 982 q 385 908 372 939 q 397 839 397 878 q 388 776 397 805 q 359 718 378 747 q 314 658 341 689 q 253 590 288 627 l 153 484 l 421 484 l 421 397 z "},"³":{ha:460,x_min:21,x_max:418,o:"m 400 851 q 373 762 400 798 q 298 710 345 726 q 388 659 358 694 q 418 570 418 623 q 404 495 418 529 q 362 437 391 461 q 292 399 334 413 q 191 386 249 386 q 101 394 143 386 q 21 424 60 403 l 21 514 q 109 478 64 491 q 189 465 153 465 q 286 493 256 465 q 315 571 315 522 q 279 644 315 621 q 178 667 243 667 l 111 667 l 111 743 l 178 743 q 269 770 240 743 q 297 840 297 797 q 290 878 297 862 q 272 904 283 894 q 244 919 260 914 q 210 924 228 924 q 137 910 170 924 q 69 871 104 896 l 22 936 q 63 964 42 951 q 106 985 83 977 q 155 999 130 994 q 211 1004 181 1004 q 293 993 258 1004 q 353 961 329 981 q 388 912 376 941 q 400 851 400 884 z "},"´":{ha:802,x_min:267,x_max:533,o:"m 267 860 q 297 905 281 880 q 329 959 313 931 q 359 1014 345 986 q 385 1064 374 1041 l 533 1064 l 533 1050 q 501 1004 522 1031 q 453 947 479 977 q 400 889 427 917 q 349 842 372 861 l 267 842 l 267 860 z "},"µ":{ha:825,x_min:118,x_max:707,o:"m 241 265 q 277 133 241 177 q 389 89 313 89 q 481 106 444 89 q 542 158 519 124 q 574 243 564 193 q 583 358 583 293 l 583 745 l 707 745 l 707 0 l 607 0 l 589 100 l 582 100 q 500 15 549 43 q 382 -14 452 -14 q 297 2 333 -14 q 237 46 261 18 q 239 -7 238 20 q 241 -59 241 -31 q 241 -117 241 -88 l 241 -334 l 118 -334 l 118 745 l 241 745 l 241 265 z "},"¶":{ha:909,x_min:77,x_max:764,o:"m 764 -176 l 682 -176 l 682 947 l 542 947 l 542 -176 l 460 -176 l 460 379 q 361 367 418 367 q 244 384 296 367 q 154 441 191 401 q 97 547 117 481 q 77 707 77 612 q 99 873 77 806 q 161 981 121 940 q 258 1038 201 1021 q 382 1055 314 1055 l 764 1055 l 764 -176 z "},"·":{ha:372,x_min:100,x_max:272,o:"m 100 490 q 106 534 100 516 q 125 563 113 552 q 152 579 136 574 q 186 585 168 585 q 219 579 203 585 q 247 563 235 574 q 265 534 258 552 q 272 490 272 516 q 265 448 272 465 q 247 418 258 430 q 219 401 235 407 q 186 396 203 396 q 152 401 168 396 q 125 418 136 407 q 106 448 113 430 q 100 490 100 465 z "},"¸":{ha:285,x_min:24,x_max:277,o:"m 277 -195 q 229 -297 277 -260 q 79 -334 181 -334 q 49 -332 64 -334 q 24 -328 34 -330 l 24 -254 q 51 -257 34 -256 q 78 -258 67 -258 q 153 -244 126 -258 q 180 -196 180 -229 q 172 -168 180 -180 q 147 -147 163 -156 q 110 -132 132 -138 q 64 -119 89 -125 l 125 0 l 207 0 l 168 -78 q 211 -92 191 -83 q 245 -115 231 -101 q 268 -149 260 -129 q 277 -195 277 -168 z "},"¹":{ha:460,x_min:43,x_max:300,o:"m 208 991 l 300 991 l 300 397 l 201 397 l 201 747 q 202 785 201 764 q 203 825 202 805 q 205 865 204 846 q 207 899 206 884 q 184 873 197 887 q 157 848 172 860 l 93 799 l 43 864 l 208 991 z "},"º":{ha:486,x_min:45,x_max:441,o:"m 441 768 q 428 668 441 712 q 388 594 414 624 q 325 548 361 564 q 241 532 288 532 q 163 548 199 532 q 100 594 127 564 q 59 668 74 624 q 45 768 45 712 q 59 868 45 825 q 98 942 73 912 q 161 987 124 972 q 244 1003 198 1003 q 322 987 286 1003 q 385 942 359 972 q 427 868 412 912 q 441 768 441 825 m 134 768 q 159 647 134 688 q 243 606 184 606 q 326 647 300 606 q 351 768 351 688 q 326 889 351 850 q 243 928 300 928 q 159 889 184 928 q 134 768 134 850 z "},"»":{ha:676,x_min:57,x_max:623,o:"m 623 357 l 412 78 l 334 131 l 494 367 l 334 603 l 412 656 l 623 375 l 623 357 m 346 357 l 136 78 l 57 131 l 218 367 l 57 603 l 136 656 l 346 375 l 346 357 z "},"¼":{ha:1023,x_min:43,x_max:962,o:"m 208 991 l 300 991 l 300 397 l 201 397 l 201 747 q 202 785 201 764 q 203 825 202 805 q 205 865 204 846 q 207 899 206 884 q 184 873 197 887 q 157 848 172 860 l 93 799 l 43 864 l 208 991 m 815 991 l 265 0 l 159 0 l 709 991 l 815 991 m 962 131 l 878 131 l 878 1 l 781 1 l 781 131 l 526 131 l 526 206 l 782 599 l 878 599 l 878 217 l 962 217 l 962 131 m 781 217 l 781 349 q 782 411 781 378 q 785 478 783 445 q 774 458 781 471 q 760 431 768 446 q 745 404 753 417 q 730 380 736 390 l 625 217 l 781 217 z "},"½":{ha:1023,x_min:30,x_max:977,o:"m 195 991 l 287 991 l 287 397 l 189 397 l 189 747 q 189 785 189 764 q 190 825 189 805 q 192 865 191 846 q 194 899 193 884 q 172 873 184 887 q 144 848 159 860 l 80 799 l 30 864 l 195 991 m 801 991 l 251 0 l 144 0 l 694 991 l 801 991 m 977 1 l 589 1 l 589 77 l 730 231 q 793 302 769 273 q 831 354 818 331 q 850 396 845 376 q 855 439 855 416 q 833 505 855 484 q 774 527 810 527 q 708 510 739 527 q 646 467 676 493 l 593 531 q 674 586 629 564 q 775 608 720 608 q 849 596 816 608 q 905 564 882 585 q 940 512 928 543 q 953 442 953 481 q 943 379 953 408 q 915 321 933 350 q 870 261 897 292 q 808 193 843 231 l 708 87 l 977 87 l 977 1 z "},"¾":{ha:1023,x_min:21,x_max:1008,o:"m 400 851 q 373 762 400 798 q 298 710 345 726 q 388 659 358 694 q 418 570 418 623 q 404 495 418 529 q 362 437 391 461 q 292 399 334 413 q 191 386 249 386 q 101 394 143 386 q 21 424 60 403 l 21 514 q 109 478 64 491 q 189 465 153 465 q 286 493 256 465 q 315 571 315 522 q 279 644 315 621 q 178 667 243 667 l 111 667 l 111 743 l 178 743 q 269 770 240 743 q 297 840 297 797 q 290 878 297 862 q 272 904 283 894 q 244 919 260 914 q 210 924 228 924 q 137 910 170 924 q 69 871 104 896 l 22 936 q 63 964 42 951 q 106 985 83 977 q 155 999 130 994 q 211 1004 181 1004 q 293 993 258 1004 q 353 961 329 981 q 388 912 376 941 q 400 851 400 884 m 879 991 l 329 0 l 222 0 l 772 991 l 879 991 m 1008 131 l 923 131 l 923 1 l 826 1 l 826 131 l 572 131 l 572 206 l 827 599 l 923 599 l 923 217 l 1008 217 l 1008 131 m 826 217 l 826 349 q 827 411 826 378 q 830 478 828 445 q 820 458 827 471 q 806 431 813 446 q 790 404 798 417 q 776 380 782 390 l 671 217 l 826 217 z "},"¿":{ha:591,x_min:46,x_max:567,o:"m 401 458 l 401 433 q 396 363 401 394 q 377 305 391 332 q 342 252 364 277 q 286 197 320 226 q 231 147 254 170 q 193 101 208 124 q 171 51 178 77 q 164 -12 164 24 q 174 -72 164 -45 q 204 -118 184 -98 q 252 -148 223 -137 q 318 -158 281 -158 q 426 -141 375 -158 q 524 -100 477 -123 l 567 -199 q 448 -247 511 -227 q 318 -267 384 -267 q 204 -249 255 -267 q 119 -199 154 -232 q 65 -120 84 -167 q 46 -14 46 -73 q 55 68 46 33 q 82 134 64 103 q 128 193 100 164 q 192 253 155 221 q 250 306 227 283 q 285 350 272 329 q 302 394 298 371 q 307 446 307 416 l 307 458 l 401 458 m 433 664 q 427 620 433 638 q 409 591 420 602 q 381 575 397 580 q 347 570 366 570 q 314 575 330 570 q 287 591 298 580 q 268 620 275 602 q 261 664 261 638 q 268 707 261 689 q 287 736 275 724 q 314 753 298 747 q 347 758 330 758 q 381 753 366 758 q 409 736 397 747 q 427 707 420 724 q 433 664 433 689 z "},"À":{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 m 488 1071 l 406 1071 q 355 1118 382 1090 q 301 1176 327 1146 q 253 1233 275 1206 q 221 1279 232 1261 l 221 1293 l 370 1293 q 395 1243 380 1270 q 425 1188 410 1215 q 457 1135 441 1160 q 488 1089 473 1109 l 488 1071 z "},"Á":{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 m 362 1089 q 393 1135 377 1109 q 425 1188 409 1160 q 455 1243 441 1215 q 480 1293 469 1270 l 629 1293 l 629 1279 q 596 1233 618 1261 q 549 1176 575 1206 q 495 1118 523 1146 q 444 1071 468 1090 l 362 1071 l 362 1089 z "},"Â":{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 m 646 1071 l 564 1071 q 493 1127 530 1094 q 421 1197 456 1160 q 349 1127 385 1160 q 278 1071 313 1094 l 196 1071 l 196 1089 q 237 1135 214 1109 q 282 1188 260 1160 q 325 1243 305 1215 q 356 1293 345 1270 l 486 1293 q 517 1243 497 1270 q 560 1188 537 1215 q 606 1135 583 1160 q 646 1089 629 1109 l 646 1071 z "},"Ã":{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 m 524 1072 q 470 1084 496 1072 q 417 1111 443 1096 q 368 1137 391 1125 q 322 1149 344 1149 q 275 1131 292 1149 q 250 1071 259 1113 l 179 1071 q 194 1145 182 1112 q 223 1201 205 1178 q 266 1237 241 1225 q 322 1250 291 1250 q 378 1238 351 1250 q 431 1212 406 1226 q 480 1186 457 1198 q 524 1174 504 1174 q 570 1192 554 1174 q 595 1251 585 1209 l 667 1251 q 652 1178 663 1211 q 623 1121 641 1145 q 580 1085 605 1098 q 524 1072 555 1072 z "},"Ä":{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 m 231 1175 q 250 1228 231 1212 q 296 1244 269 1244 q 342 1228 322 1244 q 361 1175 361 1211 q 342 1122 361 1139 q 296 1105 322 1105 q 250 1122 269 1105 q 231 1175 231 1139 m 485 1175 q 504 1228 485 1212 q 550 1244 523 1244 q 575 1240 563 1244 q 595 1228 587 1236 q 610 1206 604 1219 q 615 1175 615 1194 q 595 1122 615 1139 q 550 1105 576 1105 q 504 1122 523 1105 q 485 1175 485 1139 z "},"Å":{ha:844,x_min:0,x_max:844,o:"m 715 0 l 607 307 l 237 307 l 127 0 l 0 0 l 364 996 l 479 996 l 844 0 l 715 0 m 567 419 l 467 707 q 457 736 463 719 q 445 774 451 754 q 433 817 439 795 q 421 860 427 839 q 410 817 416 839 q 398 773 404 794 q 386 735 392 753 q 376 707 380 718 l 278 419 l 567 419 m 575 1074 q 563 1011 575 1039 q 531 965 551 984 q 481 936 510 946 q 420 926 453 926 q 358 936 386 926 q 310 965 330 946 q 279 1011 290 984 q 269 1072 269 1038 q 279 1134 269 1107 q 310 1179 290 1160 q 358 1208 330 1198 q 420 1218 386 1218 q 481 1208 452 1218 q 530 1180 509 1198 q 563 1134 551 1161 q 575 1074 575 1107 m 496 1072 q 474 1128 496 1108 q 420 1149 453 1149 q 365 1128 386 1149 q 343 1072 343 1108 q 362 1016 343 1036 q 420 996 382 996 q 474 1016 453 996 q 496 1072 496 1036 z "},"Æ":{ha:1183,x_min:-1,x_max:1100,o:"m 1100 0 l 585 0 l 585 307 l 262 307 l 125 0 l -1 0 l 443 991 l 1100 991 l 1100 880 l 711 880 l 711 574 l 1074 574 l 1074 464 l 711 464 l 711 111 l 1100 111 l 1100 0 m 311 419 l 585 419 l 585 880 l 511 880 l 311 419 z "},"Ç":{ha:838,x_min:85,x_max:798,o:"m 538 895 q 406 867 465 895 q 306 788 347 840 q 241 663 264 736 q 218 496 218 589 q 238 326 218 400 q 298 201 258 252 q 398 123 338 150 q 538 97 458 97 q 652 109 598 97 q 760 136 707 121 l 760 26 q 707 8 733 16 q 651 -4 680 1 q 590 -11 623 -9 q 517 -14 557 -14 q 324 23 406 -14 q 190 127 243 60 q 111 288 136 194 q 85 497 85 382 q 114 703 85 610 q 201 864 144 797 q 343 968 258 931 q 538 1006 428 1006 q 677 991 611 1006 q 798 947 744 976 l 745 842 q 652 879 702 863 q 538 895 602 895 m 621 -195 q 573 -297 621 -260 q 424 -334 526 -334 q 394 -332 409 -334 q 368 -328 378 -330 l 368 -254 q 395 -257 378 -256 q 422 -258 412 -258 q 498 -244 471 -258 q 525 -196 525 -229 q 516 -168 525 -180 q 492 -147 507 -156 q 455 -132 476 -138 q 408 -119 433 -125 l 469 0 l 551 0 l 513 -78 q 555 -92 536 -83 q 590 -115 575 -101 q 613 -149 604 -129 q 621 -195 621 -168 z "},"È":{ha:733,x_min:135,x_max:650,o:"m 650 0 l 135 0 l 135 991 l 650 991 l 650 880 l 261 880 l 261 574 l 624 574 l 624 464 l 261 464 l 261 111 l 650 111 l 650 0 m 484 1071 l 402 1071 q 351 1118 378 1090 q 297 1176 323 1146 q 249 1233 271 1206 q 217 1279 228 1261 l 217 1293 l 366 1293 q 391 1243 376 1270 q 421 1188 406 1215 q 453 1135 437 1160 q 484 1089 469 1109 l 484 1071 z "},"É":{ha:733,x_min:135,x_max:650,o:"m 650 0 l 135 0 l 135 991 l 650 991 l 650 880 l 261 880 l 261 574 l 624 574 l 624 464 l 261 464 l 261 111 l 650 111 l 650 0 m 309 1089 q 340 1135 324 1109 q 372 1188 356 1160 q 402 1243 388 1215 q 427 1293 416 1270 l 576 1293 l 576 1279 q 544 1233 565 1261 q 496 1176 522 1206 q 443 1118 470 1146 q 391 1071 415 1090 l 309 1071 l 309 1089 z "},"Ê":{ha:733,x_min:135,x_max:650,o:"m 650 0 l 135 0 l 135 991 l 650 991 l 650 880 l 261 880 l 261 574 l 624 574 l 624 464 l 261 464 l 261 111 l 650 111 l 650 0 m 615 1071 l 533 1071 q 462 1127 498 1094 q 390 1197 425 1160 q 317 1127 353 1160 q 247 1071 281 1094 l 165 1071 l 165 1089 q 205 1135 182 1109 q 251 1188 229 1160 q 294 1243 274 1215 q 325 1293 314 1270 l 455 1293 q 486 1243 466 1270 q 529 1188 506 1215 q 575 1135 551 1160 q 615 1089 598 1109 l 615 1071 z "},"Ë":{ha:733,x_min:135,x_max:650,o:"m 650 0 l 135 0 l 135 991 l 650 991 l 650 880 l 261 880 l 261 574 l 624 574 l 624 464 l 261 464 l 261 111 l 650 111 l 650 0 m 201 1175 q 220 1228 201 1212 q 266 1244 239 1244 q 312 1228 292 1244 q 332 1175 332 1211 q 312 1122 332 1139 q 266 1105 292 1105 q 220 1122 239 1105 q 201 1175 201 1139 m 455 1175 q 474 1228 455 1212 q 520 1244 493 1244 q 545 1240 533 1244 q 566 1228 557 1236 q 580 1206 574 1219 q 585 1175 585 1194 q 566 1122 585 1139 q 520 1105 546 1105 q 474 1122 493 1105 q 455 1175 455 1139 z "},"Ì":{ha:471,x_min:42,x_max:415,o:"m 415 0 l 56 0 l 56 69 l 172 97 l 172 895 l 56 922 l 56 991 l 415 991 l 415 922 l 298 895 l 298 97 l 415 69 l 415 0 m 309 1071 l 227 1071 q 176 1118 203 1090 q 122 1176 148 1146 q 74 1233 96 1206 q 42 1279 53 1261 l 42 1293 l 191 1293 q 216 1243 201 1270 q 246 1188 231 1215 q 278 1135 262 1160 q 309 1089 294 1109 l 309 1071 z "},"Í":{ha:471,x_min:56,x_max:441,o:"m 415 0 l 56 0 l 56 69 l 172 97 l 172 895 l 56 922 l 56 991 l 415 991 l 415 922 l 298 895 l 298 97 l 415 69 l 415 0 m 174 1089 q 205 1135 189 1109 q 237 1188 221 1160 q 267 1243 253 1215 q 292 1293 281 1270 l 441 1293 l 441 1279 q 409 1233 430 1261 q 361 1176 387 1206 q 308 1118 335 1146 q 256 1071 280 1090 l 174 1071 l 174 1089 z "},"Î":{ha:471,x_min:12,x_max:462,o:"m 415 0 l 56 0 l 56 69 l 172 97 l 172 895 l 56 922 l 56 991 l 415 991 l 415 922 l 298 895 l 298 97 l 415 69 l 415 0 m 462 1071 l 380 1071 q 309 1127 345 1094 q 237 1197 272 1160 q 164 1127 200 1160 q 94 1071 128 1094 l 12 1071 l 12 1089 q 52 1135 29 1109 q 98 1188 75 1160 q 141 1243 121 1215 q 172 1293 161 1270 l 302 1293 q 333 1243 313 1270 q 375 1188 353 1215 q 421 1135 398 1160 q 462 1089 445 1109 l 462 1071 z "},"Ï":{ha:471,x_min:43,x_max:428,o:"m 415 0 l 56 0 l 56 69 l 172 97 l 172 895 l 56 922 l 56 991 l 415 991 l 415 922 l 298 895 l 298 97 l 415 69 l 415 0 m 43 1175 q 62 1228 43 1212 q 109 1244 81 1244 q 155 1228 135 1244 q 174 1175 174 1211 q 155 1122 174 1139 q 109 1105 135 1105 q 62 1122 81 1105 q 43 1175 43 1139 m 298 1175 q 317 1228 298 1212 q 363 1244 336 1244 q 388 1240 376 1244 q 408 1228 399 1236 q 422 1206 417 1219 q 428 1175 428 1194 q 408 1122 428 1139 q 363 1105 389 1105 q 317 1122 336 1105 q 298 1175 298 1139 z "},"Ð":{ha:950,x_min:32,x_max:865,o:"m 32 546 l 135 546 l 135 991 l 411 991 q 599 960 515 991 q 742 868 683 929 q 833 715 801 806 q 865 505 865 625 q 833 285 865 380 q 739 127 800 191 q 587 32 677 64 q 383 0 497 0 l 135 0 l 135 436 l 32 436 l 32 546 m 732 501 q 709 672 732 600 q 644 791 687 745 q 539 861 602 838 q 397 884 477 884 l 261 884 l 261 546 l 489 546 l 489 436 l 261 436 l 261 109 l 371 109 q 641 208 550 109 q 732 501 732 307 z "},"Ñ":{ha:1013,x_min:135,x_max:878,o:"m 878 0 l 732 0 l 244 821 l 239 821 q 245 717 243 768 q 250 625 248 673 q 252 538 252 576 l 252 0 l 135 0 l 135 991 l 279 991 l 765 175 l 770 175 q 765 277 768 227 q 763 321 764 298 q 761 367 762 344 q 760 410 760 389 q 760 449 760 431 l 760 991 l 878 991 l 878 0 m 614 1072 q 560 1084 587 1072 q 507 1111 533 1096 q 458 1137 481 1125 q 412 1149 434 1149 q 366 1131 382 1149 q 340 1071 349 1113 l 269 1071 q 284 1145 273 1112 q 313 1201 295 1178 q 356 1237 331 1225 q 412 1250 381 1250 q 468 1238 441 1250 q 522 1212 496 1226 q 571 1186 547 1198 q 614 1174 594 1174 q 660 1192 644 1174 q 686 1251 675 1209 l 757 1251 q 742 1178 753 1211 q 713 1121 731 1145 q 670 1085 695 1098 q 614 1072 645 1072 z "},"Ò":{ha:1031,x_min:85,x_max:945,o:"m 945 497 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 m 590 1071 l 509 1071 q 457 1118 485 1090 q 403 1176 429 1146 q 356 1233 377 1206 q 323 1279 334 1261 l 323 1293 l 472 1293 q 497 1243 483 1270 q 528 1188 512 1215 q 559 1135 543 1160 q 590 1089 576 1109 l 590 1071 z "},"Ó":{ha:1031,x_min:85,x_max:945,o:"m 945 497 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 m 441 1089 q 472 1135 456 1109 q 504 1188 488 1160 q 534 1243 520 1215 q 559 1293 549 1270 l 708 1293 l 708 1279 q 676 1233 697 1261 q 628 1176 654 1206 q 575 1118 602 1146 q 524 1071 547 1090 l 441 1071 l 441 1089 z "},"Ô":{ha:1031,x_min:85,x_max:945,o:"m 945 497 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 m 743 1071 l 661 1071 q 590 1127 627 1094 q 518 1197 553 1160 q 446 1127 481 1160 q 375 1071 410 1094 l 293 1071 l 293 1089 q 334 1135 311 1109 q 379 1188 357 1160 q 422 1243 402 1215 q 453 1293 442 1270 l 583 1293 q 614 1243 594 1270 q 657 1188 634 1215 q 703 1135 680 1160 q 743 1089 726 1109 l 743 1071 z "},"Õ":{ha:1031,x_min:85,x_max:945,o:"m 945 497 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 m 604 1072 q 550 1084 577 1072 q 498 1111 524 1096 q 448 1137 472 1125 q 403 1149 425 1149 q 356 1131 372 1149 q 330 1071 340 1113 l 260 1071 q 274 1145 263 1112 q 303 1201 286 1178 q 347 1237 321 1225 q 403 1250 372 1250 q 459 1238 431 1250 q 512 1212 486 1226 q 561 1186 538 1198 q 604 1174 585 1174 q 650 1192 635 1174 q 676 1251 666 1209 l 747 1251 q 733 1178 744 1211 q 704 1121 722 1145 q 661 1085 686 1098 q 604 1072 635 1072 z "},"Ö":{ha:1031,x_min:85,x_max:945,o:"m 945 497 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 324 23 405 -14 q 190 127 243 60 q 111 289 136 194 q 85 498 85 383 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 702 971 622 1007 q 836 868 781 935 q 917 707 890 801 q 945 497 945 613 m 218 497 q 236 330 218 404 q 290 204 254 256 q 382 124 326 152 q 515 97 438 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 q 794 665 811 591 q 741 790 777 739 q 650 868 705 841 q 517 896 594 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 m 323 1175 q 342 1228 323 1212 q 389 1244 361 1244 q 435 1228 415 1244 q 454 1175 454 1211 q 435 1122 454 1139 q 389 1105 415 1105 q 342 1122 361 1105 q 323 1175 323 1139 m 578 1175 q 597 1228 578 1212 q 643 1244 616 1244 q 668 1240 656 1244 q 688 1228 680 1236 q 703 1206 697 1219 q 708 1175 708 1194 q 688 1122 708 1139 q 643 1105 669 1105 q 597 1122 616 1105 q 578 1175 578 1139 z "},"×":{ha:765,x_min:96,x_max:671,o:"m 311 490 l 96 707 l 167 778 l 382 562 l 600 778 l 671 708 l 453 490 l 669 273 l 600 204 l 382 419 l 167 205 l 97 275 l 311 490 z "},"Ø":{ha:1031,x_min:85,x_max:945,o:"m 882 986 l 819 885 q 913 720 881 818 q 945 497 945 621 q 917 288 945 382 q 836 127 890 194 q 701 23 781 60 q 515 -14 621 -14 q 297 35 387 -14 l 244 -52 l 151 1 l 212 100 q 116 269 146 168 q 85 498 85 370 q 111 708 85 614 q 190 868 136 802 q 325 971 243 935 q 517 1007 406 1007 q 635 993 581 1007 q 734 953 690 979 l 789 1039 l 882 986 m 218 497 q 234 337 218 408 q 282 214 250 267 l 675 854 q 604 885 642 874 q 517 896 565 896 q 383 868 439 896 q 290 790 327 841 q 236 665 254 739 q 218 497 218 591 m 811 497 q 751 774 811 671 l 359 136 q 430 107 391 117 q 515 97 469 97 q 649 124 593 97 q 741 204 705 152 q 794 330 777 256 q 811 497 811 404 z "},"Ù":{ha:970,x_min:125,x_max:844,o:"m 844 993 l 844 350 q 822 206 844 273 q 754 91 800 140 q 641 14 709 42 q 481 -14 573 -14 q 328 13 394 -14 q 216 87 261 39 q 148 202 171 135 q 125 353 125 270 l 125 991 l 252 991 l 252 346 q 310 162 252 227 q 488 97 369 97 q 591 115 548 97 q 663 167 635 134 q 704 246 690 200 q 718 347 718 292 l 718 993 l 844 993 m 574 1071 l 493 1071 q 441 1118 469 1090 q 388 1176 414 1146 q 340 1233 361 1206 q 308 1279 319 1261 l 308 1293 l 456 1293 q 482 1243 467 1270 q 512 1188 496 1215 q 544 1135 528 1160 q 574 1089 560 1109 l 574 1071 z "},"Ú":{ha:970,x_min:125,x_max:844,o:"m 844 993 l 844 350 q 822 206 844 273 q 754 91 800 140 q 641 14 709 42 q 481 -14 573 -14 q 328 13 394 -14 q 216 87 261 39 q 148 202 171 135 q 125 353 125 270 l 125 991 l 252 991 l 252 346 q 310 162 252 227 q 488 97 369 97 q 591 115 548 97 q 663 167 635 134 q 704 246 690 200 q 718 347 718 292 l 718 993 l 844 993 m 400 1089 q 431 1135 415 1109 q 463 1188 447 1160 q 493 1243 479 1215 q 518 1293 507 1270 l 667 1293 l 667 1279 q 634 1233 656 1261 q 587 1176 613 1206 q 533 1118 561 1146 q 482 1071 506 1090 l 400 1071 l 400 1089 z "},"Û":{ha:970,x_min:125,x_max:844,o:"m 844 993 l 844 350 q 822 206 844 273 q 754 91 800 140 q 641 14 709 42 q 481 -14 573 -14 q 328 13 394 -14 q 216 87 261 39 q 148 202 171 135 q 125 353 125 270 l 125 991 l 252 991 l 252 346 q 310 162 252 227 q 488 97 369 97 q 591 115 548 97 q 663 167 635 134 q 704 246 690 200 q 718 347 718 292 l 718 993 l 844 993 m 707 1071 l 625 1071 q 554 1127 591 1094 q 482 1197 517 1160 q 410 1127 446 1160 q 339 1071 374 1094 l 257 1071 l 257 1089 q 298 1135 275 1109 q 343 1188 321 1160 q 386 1243 366 1215 q 417 1293 406 1270 l 547 1293 q 578 1243 558 1270 q 621 1188 598 1215 q 667 1135 644 1160 q 707 1089 690 1109 l 707 1071 z "},"Ü":{ha:970,x_min:125,x_max:844,o:"m 844 993 l 844 350 q 822 206 844 273 q 754 91 800 140 q 641 14 709 42 q 481 -14 573 -14 q 328 13 394 -14 q 216 87 261 39 q 148 202 171 135 q 125 353 125 270 l 125 991 l 252 991 l 252 346 q 310 162 252 227 q 488 97 369 97 q 591 115 548 97 q 663 167 635 134 q 704 246 690 200 q 718 347 718 292 l 718 993 l 844 993 m 293 1175 q 312 1228 293 1212 q 358 1244 331 1244 q 404 1228 385 1244 q 424 1175 424 1211 q 404 1122 424 1139 q 358 1105 385 1105 q 312 1122 331 1105 q 293 1175 293 1139 m 547 1175 q 566 1228 547 1212 q 612 1244 585 1244 q 637 1240 625 1244 q 658 1228 649 1236 q 672 1206 667 1219 q 677 1175 677 1194 q 658 1122 677 1139 q 612 1105 638 1105 q 566 1122 585 1105 q 547 1175 547 1139 z "},"Ý":{ha:732,x_min:0,x_max:732,o:"m 366 490 l 596 991 l 732 991 l 429 386 l 429 0 l 302 0 l 302 379 l 0 991 l 138 991 l 366 490 m 300 1089 q 331 1135 315 1109 q 362 1188 347 1160 q 393 1243 378 1215 q 418 1293 407 1270 l 566 1293 l 566 1279 q 534 1233 555 1261 q 487 1176 513 1206 q 433 1118 460 1146 q 382 1071 406 1090 l 300 1071 l 300 1089 z "},"Þ":{ha:800,x_min:135,x_max:729,o:"m 729 530 q 710 412 729 469 q 649 311 692 355 q 536 241 606 267 q 363 215 466 215 l 261 215 l 261 0 l 135 0 l 135 991 l 261 991 l 261 821 l 380 821 q 537 801 471 821 q 646 745 603 782 q 709 654 688 708 q 729 530 729 600 m 261 322 l 349 322 q 459 333 412 322 q 537 368 506 344 q 583 430 568 392 q 599 524 599 469 q 543 667 599 621 q 370 713 488 713 l 261 713 l 261 322 z "},"ß":{ha:836,x_min:118,x_max:774,o:"m 685 854 q 670 786 685 816 q 634 731 656 755 q 588 686 613 706 q 541 647 562 665 q 505 610 519 628 q 490 571 490 591 q 495 546 490 557 q 513 521 500 534 q 550 491 526 508 q 612 449 574 475 q 680 399 650 424 q 731 347 710 375 q 763 287 751 319 q 774 212 774 254 q 755 111 774 153 q 702 40 736 68 q 620 0 667 13 q 514 -14 572 -14 q 401 -2 448 -14 q 318 33 354 10 l 318 146 q 358 124 336 135 q 404 106 380 114 q 454 93 429 98 q 505 87 480 87 q 571 96 543 87 q 616 120 598 104 q 642 157 633 135 q 650 205 650 178 q 644 250 650 230 q 624 289 638 270 q 585 328 609 308 q 522 371 560 347 q 451 421 479 398 q 404 467 422 444 q 378 513 386 490 q 371 566 371 537 q 385 629 371 602 q 420 677 399 656 q 465 717 441 699 q 511 755 490 735 q 546 797 532 774 q 559 850 559 820 q 548 899 559 878 q 517 934 537 920 q 468 955 496 948 q 406 961 440 961 q 342 955 372 961 q 290 932 313 948 q 255 887 268 916 q 241 815 241 859 l 241 0 l 118 0 l 118 814 q 139 932 118 884 q 199 1009 161 980 q 290 1050 237 1038 q 406 1063 343 1063 q 519 1050 468 1063 q 608 1011 571 1037 q 665 946 644 985 q 685 854 685 907 z "},"à":{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 m 460 842 l 378 842 q 327 889 355 861 q 273 947 299 917 q 225 1004 247 977 q 193 1050 204 1031 l 193 1064 l 342 1064 q 367 1014 353 1041 q 397 959 382 986 q 429 905 413 931 q 460 860 446 880 l 460 842 z "},"á":{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 m 302 860 q 333 905 317 880 q 365 959 349 931 q 395 1014 381 986 q 420 1064 410 1041 l 569 1064 l 569 1050 q 537 1004 558 1031 q 489 947 515 977 q 436 889 463 917 q 385 842 408 861 l 302 842 l 302 860 z "},"â":{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 m 605 842 l 523 842 q 452 898 488 865 q 380 968 415 930 q 307 898 343 930 q 237 842 271 865 l 155 842 l 155 860 q 195 905 172 880 q 241 959 218 931 q 284 1014 264 986 q 315 1064 304 1041 l 445 1064 q 476 1014 456 1041 q 518 959 496 986 q 565 905 541 931 q 605 860 588 880 l 605 842 z "},"ã":{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 m 474 843 q 420 855 447 843 q 368 881 393 867 q 318 908 342 896 q 273 920 294 920 q 226 902 242 920 q 200 842 210 884 l 130 842 q 144 916 133 882 q 173 972 155 949 q 216 1008 191 996 q 273 1021 241 1021 q 329 1009 301 1021 q 382 983 356 997 q 431 957 408 968 q 474 945 454 945 q 520 962 505 945 q 546 1022 536 980 l 617 1022 q 603 948 614 981 q 573 892 591 916 q 530 856 555 869 q 474 843 505 843 z "},"ä":{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 m 185 946 q 204 999 185 983 q 250 1015 223 1015 q 296 999 277 1015 q 316 946 316 982 q 296 893 316 910 q 250 876 277 876 q 204 893 223 876 q 185 946 185 910 m 439 946 q 458 999 439 983 q 505 1015 477 1015 q 529 1011 517 1015 q 550 999 541 1007 q 564 977 559 990 q 570 946 570 964 q 550 893 570 910 q 505 876 530 876 q 458 893 477 876 q 439 946 439 910 z "},"å":{ha:737,x_min:64,x_max:627,o:"m 538 0 l 513 103 l 507 103 q 463 51 485 73 q 414 14 440 28 q 355 -7 387 0 q 279 -14 322 -14 q 193 0 233 -14 q 125 40 154 13 q 80 110 96 68 q 64 208 64 151 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 478 744 427 758 q 561 700 528 730 q 610 623 594 670 q 627 510 627 576 l 627 0 l 538 0 m 311 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 q 225 115 192 144 q 311 86 258 86 m 531 989 q 519 927 531 954 q 487 880 507 899 q 437 851 466 861 q 376 842 409 842 q 314 851 342 842 q 266 880 286 861 q 235 926 246 899 q 224 987 224 953 q 235 1049 224 1022 q 266 1095 246 1076 q 314 1123 286 1114 q 376 1133 342 1133 q 437 1123 408 1133 q 486 1095 465 1114 q 519 1049 507 1076 q 531 989 531 1023 m 452 987 q 430 1044 452 1023 q 376 1064 409 1064 q 320 1044 342 1064 q 299 987 299 1023 q 318 931 299 951 q 376 911 338 911 q 430 931 409 911 q 452 987 452 951 z "},"æ":{ha:1157,x_min:64,x_max:1088,o:"m 64 208 q 142 379 64 319 q 380 444 220 439 l 505 449 l 505 496 q 495 572 505 541 q 467 621 486 602 q 421 648 448 640 q 358 656 393 656 q 253 640 302 656 q 160 600 205 623 l 117 693 q 229 739 167 720 q 358 758 290 758 q 503 729 447 758 q 589 637 559 701 q 680 727 623 695 q 806 758 736 758 q 924 734 871 758 q 1013 666 976 710 q 1068 561 1049 623 q 1088 425 1088 500 l 1088 349 l 632 349 q 685 156 635 218 q 835 94 735 94 q 897 98 868 94 q 952 107 926 101 q 1004 124 979 114 q 1054 146 1029 134 l 1054 36 q 1002 14 1027 23 q 950 -2 977 4 q 894 -11 923 -8 q 832 -14 865 -14 q 670 25 739 -14 q 559 142 602 64 q 511 76 536 105 q 453 27 485 47 q 381 -3 420 7 q 292 -14 342 -14 q 202 0 243 -14 q 130 40 160 13 q 81 110 99 68 q 64 208 64 151 m 192 207 q 225 115 192 144 q 311 86 258 86 q 388 99 353 86 q 449 138 423 112 q 489 204 475 164 q 504 297 504 243 l 504 364 l 407 359 q 304 346 346 357 q 238 316 263 335 q 203 269 214 296 q 192 207 192 241 m 803 656 q 685 603 728 656 q 635 449 642 550 l 954 449 q 945 533 954 495 q 918 599 937 572 q 871 641 899 626 q 803 656 842 656 z "},"ç":{ha:643,x_min:77,x_max:596,o:"m 403 -14 q 275 8 334 -14 q 171 76 215 29 q 102 194 127 122 q 77 368 77 267 q 102 549 77 475 q 173 670 128 623 q 279 737 218 716 q 408 758 339 758 q 512 747 461 758 q 596 718 562 735 l 559 614 q 525 627 544 621 q 486 638 506 633 q 446 647 465 644 q 408 650 426 650 q 253 582 302 650 q 204 370 204 513 q 253 160 204 227 q 403 94 302 94 q 502 107 458 94 q 583 136 547 119 l 583 26 q 505 -3 547 7 q 403 -14 463 -14 m 495 -195 q 447 -297 495 -260 q 298 -334 399 -334 q 268 -332 283 -334 q 242 -328 252 -330 l 242 -254 q 269 -257 252 -256 q 296 -258 286 -258 q 372 -244 345 -258 q 399 -196 399 -229 q 390 -168 399 -180 q 366 -147 381 -156 q 329 -132 350 -138 q 282 -119 307 -125 l 343 0 l 425 0 l 387 -78 q 429 -92 410 -83 q 464 -115 449 -101 q 487 -149 478 -129 q 495 -195 495 -168 z "},"è":{ha:743,x_min:77,x_max:673,o:"m 412 -14 q 276 12 338 -14 q 170 85 214 37 q 101 204 125 133 q 77 367 77 275 q 99 532 77 459 q 162 655 121 604 q 259 732 203 705 q 385 758 316 758 q 505 734 452 758 q 596 666 559 710 q 653 561 633 623 q 673 425 673 500 l 673 349 l 204 349 q 259 156 208 218 q 414 94 311 94 q 478 98 448 94 q 535 107 507 101 q 588 124 562 114 q 640 146 614 134 l 640 36 q 587 14 613 23 q 533 -2 561 4 q 476 -11 506 -8 q 412 -14 447 -14 m 382 656 q 259 603 304 656 q 207 449 214 550 l 541 449 q 531 533 541 495 q 503 599 522 572 q 454 641 484 626 q 382 656 424 656 m 460 842 l 378 842 q 327 889 355 861 q 273 947 299 917 q 225 1004 247 977 q 193 1050 204 1031 l 193 1064 l 342 1064 q 367 1014 353 1041 q 397 959 382 986 q 429 905 413 931 q 460 860 446 880 l 460 842 z "},"é":{ha:743,x_min:77,x_max:673,o:"m 412 -14 q 276 12 338 -14 q 170 85 214 37 q 101 204 125 133 q 77 367 77 275 q 99 532 77 459 q 162 655 121 604 q 259 732 203 705 q 385 758 316 758 q 505 734 452 758 q 596 666 559 710 q 653 561 633 623 q 673 425 673 500 l 673 349 l 204 349 q 259 156 208 218 q 414 94 311 94 q 478 98 448 94 q 535 107 507 101 q 588 124 562 114 q 640 146 614 134 l 640 36 q 587 14 613 23 q 533 -2 561 4 q 476 -11 506 -8 q 412 -14 447 -14 m 382 656 q 259 603 304 656 q 207 449 214 550 l 541 449 q 531 533 541 495 q 503 599 522 572 q 454 641 484 626 q 382 656 424 656 m 322 860 q 353 905 337 880 q 385 959 369 931 q 415 1014 401 986 q 440 1064 429 1041 l 589 1064 l 589 1050 q 556 1004 578 1031 q 509 947 535 977 q 455 889 483 917 q 404 842 428 861 l 322 842 l 322 860 z "},"ê":{ha:743,x_min:77,x_max:673,o:"m 412 -14 q 276 12 338 -14 q 170 85 214 37 q 101 204 125 133 q 77 367 77 275 q 99 532 77 459 q 162 655 121 604 q 259 732 203 705 q 385 758 316 758 q 505 734 452 758 q 596 666 559 710 q 653 561 633 623 q 673 425 673 500 l 673 349 l 204 349 q 259 156 208 218 q 414 94 311 94 q 478 98 448 94 q 535 107 507 101 q 588 124 562 114 q 640 146 614 134 l 640 36 q 587 14 613 23 q 533 -2 561 4 q 476 -11 506 -8 q 412 -14 447 -14 m 382 656 q 259 603 304 656 q 207 449 214 550 l 541 449 q 531 533 541 495 q 503 599 522 572 q 454 641 484 626 q 382 656 424 656 m 602 842 l 520 842 q 449 898 486 865 q 377 968 412 930 q 304 898 340 930 q 234 842 269 865 l 152 842 l 152 860 q 193 905 170 880 q 238 959 216 931 q 281 1014 261 986 q 312 1064 301 1041 l 442 1064 q 473 1014 453 1041 q 516 959 493 986 q 562 905 538 931 q 602 860 585 880 l 602 842 z "},"ë":{ha:743,x_min:77,x_max:673,o:"m 412 -14 q 276 12 338 -14 q 170 85 214 37 q 101 204 125 133 q 77 367 77 275 q 99 532 77 459 q 162 655 121 604 q 259 732 203 705 q 385 758 316 758 q 505 734 452 758 q 596 666 559 710 q 653 561 633 623 q 673 425 673 500 l 673 349 l 204 349 q 259 156 208 218 q 414 94 311 94 q 478 98 448 94 q 535 107 507 101 q 588 124 562 114 q 640 146 614 134 l 640 36 q 587 14 613 23 q 533 -2 561 4 q 476 -11 506 -8 q 412 -14 447 -14 m 382 656 q 259 603 304 656 q 207 449 214 550 l 541 449 q 531 533 541 495 q 503 599 522 572 q 454 641 484 626 q 382 656 424 656 m 182 946 q 201 999 182 983 q 248 1015 220 1015 q 294 999 274 1015 q 313 946 313 982 q 294 893 313 910 q 248 876 274 876 q 201 893 220 876 q 182 946 182 910 m 437 946 q 456 999 437 983 q 502 1015 475 1015 q 527 1011 515 1015 q 547 999 538 1007 q 562 977 556 990 q 567 946 567 964 q 547 893 567 910 q 502 876 528 876 q 456 893 475 876 q 437 946 437 910 z "},"ì":{ha:359,x_min:-23,x_max:243,o:"m 241 0 l 118 0 l 118 745 l 241 745 l 241 0 m 243 842 l 162 842 q 111 889 138 861 q 57 947 83 917 q 9 1004 31 977 q -23 1050 -12 1031 l -23 1064 l 125 1064 q 151 1014 136 1041 q 181 959 165 986 q 213 905 197 931 q 243 860 229 880 l 243 842 z "},"í":{ha:359,x_min:118,x_max:392,o:"m 241 0 l 118 0 l 118 745 l 241 745 l 241 0 m 125 860 q 156 905 140 880 q 188 959 172 931 q 218 1014 204 986 q 243 1064 233 1041 l 392 1064 l 392 1050 q 360 1004 381 1031 q 312 947 338 977 q 259 889 286 917 q 208 842 231 861 l 125 842 l 125 860 z "},"î":{ha:359,x_min:-45,x_max:405,o:"m 241 0 l 118 0 l 118 745 l 241 745 l 241 0 m 405 842 l 323 842 q 252 898 288 865 q 180 968 215 930 q 107 898 143 930 q 37 842 71 865 l -45 842 l -45 860 q -5 905 -28 880 q 41 959 18 931 q 84 1014 64 986 q 115 1064 104 1041 l 245 1064 q 276 1014 256 1041 q 318 959 296 986 q 365 905 341 931 q 405 860 388 880 l 405 842 z "},"ï":{ha:359,x_min:-12,x_max:372,o:"m 241 0 l 118 0 l 118 745 l 241 745 l 241 0 m -12 946 q 7 999 -12 983 q 53 1015 26 1015 q 99 999 79 1015 q 119 946 119 982 q 99 893 119 910 q 53 876 79 876 q 7 893 26 876 q -12 946 -12 910 m 242 946 q 261 999 242 983 q 307 1015 280 1015 q 332 1011 320 1015 q 353 999 344 1007 q 367 977 361 990 q 372 946 372 964 q 353 893 372 910 q 307 876 333 876 q 261 893 280 876 q 242 946 242 910 z "},"ð":{ha:802,x_min:75,x_max:725,o:"m 725 389 q 702 218 725 292 q 637 92 680 143 q 534 13 595 40 q 399 -14 474 -14 q 269 9 328 -14 q 166 74 210 31 q 99 180 123 117 q 75 323 75 243 q 97 467 75 404 q 158 572 118 529 q 255 636 198 614 q 383 659 312 659 q 505 638 452 659 q 586 578 557 618 l 591 581 q 530 726 570 661 q 428 846 489 791 l 254 742 l 204 819 l 351 908 q 295 946 324 927 q 235 982 267 964 l 282 1065 q 368 1019 326 1044 q 449 965 409 995 l 603 1059 l 653 982 l 521 903 q 604 806 566 859 q 668 689 642 753 q 710 551 695 626 q 725 389 725 476 m 597 357 q 586 431 597 395 q 551 495 574 467 q 490 540 527 523 q 401 557 452 557 q 312 541 349 557 q 252 496 275 526 q 217 421 228 466 q 205 319 205 377 q 217 225 205 268 q 252 153 228 183 q 313 105 276 122 q 401 89 350 89 q 552 156 506 89 q 597 357 597 224 z "},"ñ":{ha:818,x_min:118,x_max:707,o:"m 583 0 l 583 479 q 548 612 583 568 q 436 656 512 656 q 344 638 381 656 q 284 586 307 621 q 251 501 261 551 q 241 386 241 451 l 241 0 l 118 0 l 118 745 l 218 745 l 236 644 l 243 644 q 283 695 260 673 q 334 730 307 716 q 393 751 362 745 q 457 758 425 758 q 644 693 581 758 q 707 486 707 629 l 707 0 l 583 0 m 515 843 q 461 855 488 843 q 408 881 434 867 q 359 908 382 896 q 313 920 335 920 q 267 902 283 920 q 241 842 250 884 l 170 842 q 185 916 174 882 q 214 972 196 949 q 257 1008 232 996 q 313 1021 282 1021 q 369 1009 342 1021 q 422 983 397 997 q 472 957 448 968 q 515 945 495 945 q 561 962 545 945 q 587 1022 576 980 l 658 1022 q 643 948 654 981 q 614 892 632 916 q 571 856 596 869 q 515 843 546 843 z "},"ò":{ha:802,x_min:77,x_max:725,o:"m 725 374 q 702 209 725 281 q 637 87 680 136 q 534 12 595 38 q 399 -14 474 -14 q 270 12 329 -14 q 168 87 211 38 q 101 209 125 136 q 77 374 77 281 q 99 537 77 466 q 164 658 122 609 q 267 733 206 707 q 403 758 328 758 q 532 733 473 758 q 634 658 591 707 q 701 537 677 609 q 725 374 725 466 m 204 374 q 251 160 204 232 q 401 89 297 89 q 552 160 506 89 q 597 374 597 232 q 551 586 597 515 q 400 656 505 656 q 250 586 296 656 q 204 374 204 515 m 506 842 l 425 842 q 373 889 401 861 q 319 947 345 917 q 272 1004 293 977 q 239 1050 250 1031 l 239 1064 l 388 1064 q 413 1014 399 1041 q 444 959 428 986 q 475 905 459 931 q 506 860 492 880 l 506 842 z "},"ó":{ha:802,x_min:77,x_max:725,o:"m 725 374 q 702 209 725 281 q 637 87 680 136 q 534 12 595 38 q 399 -14 474 -14 q 270 12 329 -14 q 168 87 211 38 q 101 209 125 136 q 77 374 77 281 q 99 537 77 466 q 164 658 122 609 q 267 733 206 707 q 403 758 328 758 q 532 733 473 758 q 634 658 591 707 q 701 537 677 609 q 725 374 725 466 m 204 374 q 251 160 204 232 q 401 89 297 89 q 552 160 506 89 q 597 374 597 232 q 551 586 597 515 q 400 656 505 656 q 250 586 296 656 q 204 374 204 515 m 321 860 q 352 905 336 880 q 384 959 368 931 q 414 1014 399 986 q 439 1064 428 1041 l 587 1064 l 587 1050 q 555 1004 576 1031 q 508 947 534 977 q 454 889 481 917 q 403 842 427 861 l 321 842 l 321 860 z "},"ô":{ha:802,x_min:77,x_max:725,o:"m 725 374 q 702 209 725 281 q 637 87 680 136 q 534 12 595 38 q 399 -14 474 -14 q 270 12 329 -14 q 168 87 211 38 q 101 209 125 136 q 77 374 77 281 q 99 537 77 466 q 164 658 122 609 q 267 733 206 707 q 403 758 328 758 q 532 733 473 758 q 634 658 591 707 q 701 537 677 609 q 725 374 725 466 m 204 374 q 251 160 204 232 q 401 89 297 89 q 552 160 506 89 q 597 374 597 232 q 551 586 597 515 q 400 656 505 656 q 250 586 296 656 q 204 374 204 515 m 622 842 l 540 842 q 469 898 505 865 q 397 968 432 930 q 324 898 360 930 q 254 842 288 865 l 172 842 l 172 860 q 212 905 189 880 q 258 959 235 931 q 301 1014 281 986 q 332 1064 321 1041 l 462 1064 q 493 1014 473 1041 q 535 959 513 986 q 582 905 558 931 q 622 860 605 880 l 622 842 z "},"õ":{ha:802,x_min:77,x_max:725,o:"m 725 374 q 702 209 725 281 q 637 87 680 136 q 534 12 595 38 q 399 -14 474 -14 q 270 12 329 -14 q 168 87 211 38 q 101 209 125 136 q 77 374 77 281 q 99 537 77 466 q 164 658 122 609 q 267 733 206 707 q 403 758 328 758 q 532 733 473 758 q 634 658 591 707 q 701 537 677 609 q 725 374 725 466 m 204 374 q 251 160 204 232 q 401 89 297 89 q 552 160 506 89 q 597 374 597 232 q 551 586 597 515 q 400 656 505 656 q 250 586 296 656 q 204 374 204 515 m 499 843 q 445 855 472 843 q 393 881 418 867 q 343 908 367 896 q 298 920 319 920 q 251 902 267 920 q 225 842 235 884 l 155 842 q 169 916 158 882 q 198 972 180 949 q 241 1008 216 996 q 298 1021 267 1021 q 354 1009 326 1021 q 407 983 381 997 q 456 957 433 968 q 499 945 479 945 q 545 962 530 945 q 571 1022 561 980 l 642 1022 q 628 948 639 981 q 598 892 616 916 q 555 856 581 869 q 499 843 530 843 z "},"ö":{ha:802,x_min:77,x_max:725,o:"m 725 374 q 702 209 725 281 q 637 87 680 136 q 534 12 595 38 q 399 -14 474 -14 q 270 12 329 -14 q 168 87 211 38 q 101 209 125 136 q 77 374 77 281 q 99 537 77 466 q 164 658 122 609 q 267 733 206 707 q 403 758 328 758 q 532 733 473 758 q 634 658 591 707 q 701 537 677 609 q 725 374 725 466 m 204 374 q 251 160 204 232 q 401 89 297 89 q 552 160 506 89 q 597 374 597 232 q 551 586 597 515 q 400 656 505 656 q 250 586 296 656 q 204 374 204 515 m 203 946 q 222 999 203 983 q 269 1015 241 1015 q 315 999 295 1015 q 334 946 334 982 q 315 893 334 910 q 269 876 295 876 q 222 893 241 876 q 203 946 203 910 m 458 946 q 477 999 458 983 q 523 1015 496 1015 q 548 1011 536 1015 q 568 999 559 1007 q 583 977 577 990 q 588 946 588 964 q 568 893 588 910 q 523 876 549 876 q 477 893 496 876 q 458 946 458 910 z "},"÷":{ha:765,x_min:69,x_max:696,o:"m 69 439 l 69 541 l 696 541 l 696 439 l 69 439 m 304 253 q 311 293 304 277 q 327 319 317 309 q 352 333 338 329 q 382 338 366 338 q 412 333 397 338 q 437 319 426 329 q 454 293 448 309 q 460 253 460 277 q 454 215 460 231 q 437 188 448 199 q 412 173 426 178 q 382 168 397 168 q 352 173 366 168 q 327 188 338 178 q 311 215 317 199 q 304 253 304 231 m 304 726 q 311 766 304 750 q 327 792 317 782 q 352 807 338 802 q 382 811 366 811 q 412 807 397 811 q 437 792 426 802 q 454 766 448 782 q 460 726 460 750 q 454 688 460 704 q 437 662 448 672 q 412 646 426 651 q 382 642 397 642 q 352 646 366 642 q 327 662 338 651 q 311 688 317 672 q 304 726 304 704 z "},"ø":{ha:802,x_min:78,x_max:726,o:"m 726 374 q 704 209 726 281 q 638 87 681 136 q 536 12 596 38 q 400 -14 475 -14 q 249 22 315 -14 l 203 -52 l 114 -1 l 168 87 q 102 209 125 136 q 78 374 78 281 q 101 537 78 466 q 165 658 123 609 q 268 733 208 707 q 404 758 329 758 q 485 748 447 758 q 557 720 524 739 l 603 793 l 692 743 l 637 656 q 703 535 680 606 q 726 374 726 465 m 205 374 q 212 272 205 317 q 233 193 218 228 l 503 632 q 457 650 483 644 q 401 656 432 656 q 251 586 297 656 q 205 374 205 515 m 599 374 q 572 549 599 481 l 302 111 q 348 94 323 100 q 403 89 372 89 q 553 160 507 89 q 599 374 599 232 z "},"ù":{ha:818,x_min:111,x_max:700,o:"m 600 0 l 582 100 l 575 100 q 535 49 558 71 q 484 14 511 28 q 425 -7 456 0 q 361 -14 393 -14 q 252 2 299 -14 q 174 51 205 18 q 127 136 143 84 q 111 258 111 187 l 111 745 l 235 745 l 235 265 q 271 133 235 177 q 382 89 307 89 q 474 106 437 89 q 534 158 511 124 q 567 243 557 193 q 576 358 576 293 l 576 745 l 700 745 l 700 0 l 600 0 m 470 842 l 389 842 q 337 889 365 861 q 283 947 309 917 q 236 1004 257 977 q 203 1050 214 1031 l 203 1064 l 352 1064 q 377 1014 363 1041 q 408 959 392 986 q 439 905 423 931 q 470 860 456 880 l 470 842 z "},"ú":{ha:818,x_min:111,x_max:700,o:"m 600 0 l 582 100 l 575 100 q 535 49 558 71 q 484 14 511 28 q 425 -7 456 0 q 361 -14 393 -14 q 252 2 299 -14 q 174 51 205 18 q 127 136 143 84 q 111 258 111 187 l 111 745 l 235 745 l 235 265 q 271 133 235 177 q 382 89 307 89 q 474 106 437 89 q 534 158 511 124 q 567 243 557 193 q 576 358 576 293 l 576 745 l 700 745 l 700 0 l 600 0 m 332 860 q 362 905 347 880 q 394 959 378 931 q 425 1014 410 986 q 450 1064 439 1041 l 598 1064 l 598 1050 q 566 1004 587 1031 q 518 947 545 977 q 465 889 492 917 q 414 842 437 861 l 332 842 l 332 860 z "},"û":{ha:818,x_min:111,x_max:700,o:"m 600 0 l 582 100 l 575 100 q 535 49 558 71 q 484 14 511 28 q 425 -7 456 0 q 361 -14 393 -14 q 252 2 299 -14 q 174 51 205 18 q 127 136 143 84 q 111 258 111 187 l 111 745 l 235 745 l 235 265 q 271 133 235 177 q 382 89 307 89 q 474 106 437 89 q 534 158 511 124 q 567 243 557 193 q 576 358 576 293 l 576 745 l 700 745 l 700 0 l 600 0 m 631 842 l 549 842 q 477 898 514 865 q 406 968 441 930 q 333 898 369 930 q 262 842 297 865 l 180 842 l 180 860 q 221 905 198 880 q 267 959 244 931 q 310 1014 290 986 q 340 1064 330 1041 l 471 1064 q 502 1014 481 1041 q 544 959 522 986 q 590 905 567 931 q 631 860 614 880 l 631 842 z "},"ü":{ha:818,x_min:111,x_max:700,o:"m 600 0 l 582 100 l 575 100 q 535 49 558 71 q 484 14 511 28 q 425 -7 456 0 q 361 -14 393 -14 q 252 2 299 -14 q 174 51 205 18 q 127 136 143 84 q 111 258 111 187 l 111 745 l 235 745 l 235 265 q 271 133 235 177 q 382 89 307 89 q 474 106 437 89 q 534 158 511 124 q 567 243 557 193 q 576 358 576 293 l 576 745 l 700 745 l 700 0 l 600 0 m 210 946 q 229 999 210 983 q 275 1015 248 1015 q 321 999 301 1015 q 340 946 340 982 q 321 893 340 910 q 275 876 301 876 q 229 893 248 876 q 210 946 210 910 m 464 946 q 483 999 464 983 q 529 1015 502 1015 q 554 1011 542 1015 q 574 999 566 1007 q 589 977 583 990 q 594 946 594 964 q 574 893 594 910 q 529 876 555 876 q 483 893 502 876 q 464 946 464 910 z "},"ý":{ha:679,x_min:7,x_max:672,o:"m 7 745 l 135 745 l 281 329 q 300 272 290 302 q 318 212 310 242 q 333 155 327 182 q 342 103 339 127 l 346 103 q 357 149 349 120 q 373 211 364 178 q 392 276 382 244 q 410 330 402 308 l 545 745 l 672 745 l 378 -97 q 337 -196 359 -152 q 286 -270 315 -239 q 217 -317 256 -300 q 123 -334 178 -334 q 62 -330 88 -334 q 18 -322 37 -326 l 18 -224 q 54 -230 33 -227 q 100 -232 76 -232 q 156 -224 132 -232 q 197 -201 180 -216 q 228 -165 215 -186 q 250 -115 240 -143 l 289 -7 l 7 745 m 276 860 q 307 905 291 880 q 339 959 323 931 q 369 1014 355 986 q 394 1064 383 1041 l 543 1064 l 543 1050 q 510 1004 532 1031 q 463 947 489 977 q 409 889 437 917 q 358 842 382 861 l 276 842 l 276 860 z "},"þ":{ha:814,x_min:118,x_max:737,o:"m 241 644 q 277 689 257 668 q 322 725 296 709 q 381 749 349 740 q 454 758 414 758 q 570 734 518 758 q 660 661 623 709 q 717 541 696 612 q 737 374 737 469 q 717 206 737 278 q 660 85 696 134 q 570 11 623 36 q 454 -14 518 -14 q 382 -5 414 -14 q 323 19 349 4 q 277 53 297 33 q 241 94 257 73 l 233 94 q 237 50 235 71 q 240 14 239 33 q 241 -16 241 -5 l 241 -334 l 118 -334 l 118 1055 l 241 1055 l 241 745 l 236 644 l 241 644 m 431 656 q 343 640 379 656 q 286 593 308 625 q 253 513 264 561 q 241 401 243 466 l 241 374 q 251 252 241 305 q 282 162 260 199 q 340 107 304 126 q 432 89 377 89 q 567 163 524 89 q 610 375 610 237 q 567 586 610 516 q 431 656 524 656 z "},"ÿ":{ha:679,x_min:7,x_max:672,o:"m 7 745 l 135 745 l 281 329 q 300 272 290 302 q 318 212 310 242 q 333 155 327 182 q 342 103 339 127 l 346 103 q 357 149 349 120 q 373 211 364 178 q 392 276 382 244 q 410 330 402 308 l 545 745 l 672 745 l 378 -97 q 337 -196 359 -152 q 286 -270 315 -239 q 217 -317 256 -300 q 123 -334 178 -334 q 62 -330 88 -334 q 18 -322 37 -326 l 18 -224 q 54 -230 33 -227 q 100 -232 76 -232 q 156 -224 132 -232 q 197 -201 180 -216 q 228 -165 215 -186 q 250 -115 240 -143 l 289 -7 l 7 745 m 155 946 q 174 999 155 983 q 220 1015 193 1015 q 266 999 246 1015 q 286 946 286 982 q 266 893 286 910 q 220 876 246 876 q 174 893 193 876 q 155 946 155 910 m 409 946 q 428 999 409 983 q 474 1015 447 1015 q 499 1011 487 1015 q 519 999 511 1007 q 534 977 528 990 q 539 946 539 964 q 519 893 539 910 q 474 876 500 876 q 428 893 447 876 q 409 946 409 910 z "},"ı":{ha:359,x_min:118,x_max:241,o:"m 241 0 l 118 0 l 118 745 l 241 745 l 241 0 z "},"ˆ":{ha:802,x_min:175,x_max:625,o:"m 625 842 l 543 842 q 472 898 509 865 q 400 968 435 930 q 328 898 363 930 q 257 842 292 865 l 175 842 l 175 860 q 216 905 193 880 q 261 959 239 931 q 304 1014 284 986 q 335 1064 324 1041 l 465 1064 q 496 1014 476 1041 q 539 959 516 986 q 585 905 562 931 q 625 860 608 880 l 625 842 z "},"˚":{ha:802,x_min:248,x_max:554,o:"m 554 989 q 542 927 554 954 q 510 880 530 899 q 460 851 489 861 q 399 842 432 842 q 337 851 365 842 q 289 880 309 861 q 258 926 269 899 q 248 987 248 953 q 258 1049 248 1022 q 289 1095 269 1076 q 337 1123 309 1114 q 399 1133 365 1133 q 460 1123 431 1133 q 509 1095 488 1114 q 542 1049 530 1076 q 554 989 554 1023 m 475 987 q 453 1044 475 1023 q 399 1064 432 1064 q 343 1044 365 1064 q 322 987 322 1023 q 341 931 322 951 q 399 911 361 911 q 453 931 432 911 q 475 987 475 951 z "},"˜":{ha:802,x_min:175,x_max:663,o:"m 519 843 q 466 855 492 843 q 413 881 439 867 q 363 908 387 896 q 318 920 340 920 q 271 902 288 920 q 245 842 255 884 l 175 842 q 190 916 178 882 q 219 972 201 949 q 262 1008 237 996 q 318 1021 287 1021 q 374 1009 347 1021 q 427 983 401 997 q 476 957 453 968 q 519 945 500 945 q 566 962 550 945 q 591 1022 581 980 l 663 1022 q 648 948 659 981 q 619 892 637 916 q 576 856 601 869 q 519 843 551 843 z "},"–":{ha:694,x_min:56,x_max:639,o:"m 56 315 l 56 429 l 639 429 l 639 315 l 56 315 z "},"—":{ha:1389,x_min:56,x_max:1333,o:"m 56 315 l 56 429 l 1333 429 l 1333 315 l 56 315 z "},"‘":{ha:243,x_min:16,x_max:228,o:"m 25 652 l 16 667 q 38 745 25 703 q 67 828 52 786 q 100 912 83 870 q 135 991 118 954 l 228 991 q 208 905 218 950 q 189 816 198 861 q 173 730 180 772 q 160 652 165 688 l 25 652 z "},"’":{ha:243,x_min:16,x_max:228,o:"m 218 991 l 228 977 q 205 898 218 939 q 176 815 192 857 q 143 731 160 772 q 109 652 125 690 l 16 652 q 35 737 25 692 q 54 827 45 782 q 71 913 63 871 q 83 991 78 956 l 218 991 z "},"‚":{ha:347,x_min:43,x_max:256,o:"m 245 161 l 256 146 q 233 68 246 109 q 204 -16 220 26 q 171 -99 188 -58 q 136 -179 153 -141 l 43 -179 q 63 -93 53 -138 q 82 -4 73 -48 q 98 83 91 41 q 111 161 106 125 l 245 161 z "},"“":{ha:504,x_min:16,x_max:489,o:"m 286 652 l 277 667 q 299 745 286 703 q 328 828 313 786 q 361 912 344 870 q 396 991 379 954 l 489 991 q 469 905 479 950 q 450 816 459 861 q 434 730 441 772 q 421 652 427 688 l 286 652 m 25 652 l 16 667 q 38 745 25 703 q 67 828 52 786 q 100 912 83 870 q 135 991 118 954 l 228 991 q 208 905 218 950 q 189 816 198 861 q 173 730 180 772 q 160 652 165 688 l 25 652 z "},"”":{ha:504,x_min:16,x_max:489,o:"m 218 991 l 228 977 q 205 898 218 939 q 176 815 192 857 q 143 731 160 772 q 109 652 125 690 l 16 652 q 35 737 25 692 q 54 827 45 782 q 71 913 63 871 q 83 991 78 956 l 218 991 m 479 991 l 489 977 q 466 898 479 939 q 437 815 453 857 q 404 731 421 772 q 370 652 387 690 l 277 652 q 296 737 286 692 q 315 827 306 782 q 332 913 324 871 q 345 991 339 956 l 479 991 z "},"„":{ha:608,x_min:43,x_max:517,o:"m 245 161 l 256 146 q 233 68 246 109 q 204 -16 220 26 q 171 -99 188 -58 q 136 -179 153 -141 l 43 -179 q 63 -93 53 -138 q 82 -4 73 -48 q 98 83 91 41 q 111 161 106 125 l 245 161 m 507 161 l 517 146 q 494 68 507 109 q 465 -16 481 26 q 432 -99 449 -58 q 397 -179 414 -141 l 304 -179 q 324 -93 314 -138 q 343 -4 334 -48 q 359 83 352 41 q 372 161 367 125 l 507 161 z "},"•":{ha:522,x_min:102,x_max:421,o:"m 102 507 q 114 589 102 555 q 148 645 126 623 q 198 675 169 666 q 261 685 227 685 q 323 675 294 685 q 374 645 353 666 q 409 589 396 623 q 421 507 421 555 q 409 426 421 460 q 374 371 396 392 q 323 339 353 349 q 261 329 294 329 q 198 339 227 329 q 148 371 169 349 q 114 426 126 392 q 102 507 102 460 z "},"‹":{ha:400,x_min:56,x_max:345,o:"m 56 375 l 265 656 l 345 603 l 183 367 l 345 131 l 265 78 l 56 357 l 56 375 z "},"›":{ha:400,x_min:56,x_max:345,o:"m 345 357 l 135 78 l 56 131 l 216 367 l 56 603 l 135 656 l 345 375 l 345 357 z "},"⁄":{ha:180,x_min:-239,x_max:418,o:"m 418 991 l -132 0 l -239 0 l 311 991 l 418 991 z "}},familyName:"Droid Sans",ascender:1293,descender:-334,underlinePosition:-154,underlineThickness:102,boundingBox:{yMin:-492,xMin:-352,yMax:1907,xMax:1966},resolution:1e3,original_font_information:{format:0,copyright:"Digitized data copyright © 2007, Google Corporation.",fontFamily:"Droid Sans",fontSubfamily:"Regular",uniqueID:"Ascender - Droid Sans",fullName:"Droid Sans",version:"Version 1.00 build 113",postScriptName:"DroidSans",trademark:"Droid is a trademark of Google and may be registered in certain jurisdictions.",manufacturer:"Ascender Corporation",description:"Droid Sans is a humanist sans serif typeface designed for user interfaces and electronic communication.",manufacturerURL:"http://www.ascendercorp.com/",designerURL:"http://www.ascendercorp.com/typedesigners.html",licence:"Licensed under the Apache License, Version 2.0",licenceURL:"http://®www.apache.org/licenses/LICENSE-2.0",compatibleFullName:"Droid Sans"},cssFontWeight:"normal",cssFontStyle:"normal"},fontLibrary=new(function(){function FontLib(){_classCallCheck(this,FontLib),this.fonts={},this.getFont=this.getFont.bind(this)}return _createClass(FontLib,[{key:"getFont",value:function(name){if(this.fonts[name])return this.fonts[name];if(!name)return Promise.resolve(DEFAULT_FONT_FOR_GEOMETRY);switch(name){case"arrival":return this.fonts[name]=import("./Arrival-77eeb98c.js").then((function(font){return createFont(font)})),this.fonts[name];case"chalet-parisnineteensixty":return this.fonts[name]=import("./Chalet-dd32b6b9.js").then((function(font){return createFont(font)})),this.fonts[name];case"helvetica neue":return this.fonts[name]=import("./HelveticaNeue-5123d402.js").then((function(font){return createFont(font)})),this.fonts[name];case"helvetiker":return this.fonts[name]=import("./Helvetiker-63581c1d.js").then((function(font){return createFont(font)})),this.fonts[name];case"lato":return this.fonts[name]=import("./Lato-7be5875b.js").then((function(font){return createFont(font)})),this.fonts[name];case"myriad pro":return this.fonts[name]=import("./MyriadPro-c4a42ca5.js").then((function(font){return createFont(font)})),this.fonts[name];case"proxima nova medium":return this.fonts[name]=import("./ProximaNova-20767156.js").then((function(font){return createFont(font)})),this.fonts[name];case"simon circular book":return this.fonts[name]=import("./SimonCircular-cf2e4d02.js").then((function(font){return createFont(font)})),this.fonts[name];default:return Promise.resolve(DEFAULT_FONT_FOR_GEOMETRY)}}}]),FontLib}()),createFont=function(facetypeJson){var combinedFontObject={},combinedGlyphSet={};Object.keys(DEFAULT_FONT_JSON.glyphs).forEach((function(key){combinedGlyphSet[key]=DEFAULT_FONT_JSON.glyphs[key]})),Object.keys(facetypeJson.glyphs).forEach((function(key){combinedGlyphSet[key]=facetypeJson.glyphs[key]})),Object.keys(DEFAULT_FONT_JSON).forEach((function(key){combinedFontObject[key]=DEFAULT_FONT_JSON[key]})),combinedFontObject.glyphs=combinedGlyphSet;var font=new Font(combinedFontObject);font._mSupportedCharacters=Object.keys(combinedFontObject.glyphs).join("");var unicode=font._mSupportedCharacters.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return font._mInvalidCharacters=new RegExp("[^"+unicode+"]","g"),font},DEFAULT_FONT_FOR_GEOMETRY=createFont(DEFAULT_FONT_JSON),X="x",Y="y",Z="z";var Element=function(_PubSub){_inherits(Element,PubSub);var _super=function(Derived){function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var result,Super=_getPrototypeOf(Derived);if(isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}(Element);function Element(poly,mapClass,container){var _this;_classCallCheck(this,Element),(_this=_super.call(this)).polygon=void 0,_this.mapClass=void 0,_this.container=void 0,_this.visible=void 0,_this.polygon=poly,_this.mapClass=mapClass,_this.container=container;var polygonVisible=!1!==poly.geometry.visible,imageVisible=poly.image&&poly.image.visible&&(poly.image.url||poly.image.original),labelVisible=poly.label&&poly.label.visible&&poly.label.text;return(polygonVisible||imageVisible||labelVisible)&&Element._setPolygonDefaults(poly),_this.visible=polygonVisible,_this.imageVisible=imageVisible,_this.labelVisible=labelVisible,_this.load.bind(_assertThisInitialized(_this)),_this}return _createClass(Element,null,[{key:"getDefaultMaterial",value:function(){return Element.defaultMaterial||(Element.defaultMaterial=new MeshLambertMaterial({color:0})),Element.defaultMaterial}},{key:"getTextureLoader",value:function(){return Element.textureLoader||(Element.textureLoader=new TextureLoader),Element.textureLoader}},{key:"getWeightedCenter",value:function(vertices){var center=vertices.reduce((function(a,b){return{x:a.x+b.x,y:a.y+b.y}}),{x:0,y:0});return center.x/=vertices.length,center.y/=vertices.length,center}},{key:"getBoundingCentre",value:function(vertices){var minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;return vertices.forEach((function(vertex){vertex.x>maxX&&(maxX=vertex.x),vertex.x<minX&&(minX=vertex.x),vertex.y>maxY&&(maxY=vertex.y),vertex.y<minY&&(minY=vertex.y)})),{x:(minX+maxX)/2,y:(minY+maxY)/2}}},{key:"_makeFromCoords",value:function(className,coords,mapClass){var target=new className;return target.moveTo(coords[0].x-mapClass.width/2,-coords[0].y+mapClass.height/2),coords.slice(1).forEach((function(coord){return target.lineTo(coord.x-mapClass.width/2,-coord.y+mapClass.height/2)})),target.lineTo(coords[0].x-mapClass.width/2,-coords[0].y+mapClass.height/2),target}},{key:"_setPolygonDefaults",value:function(poly){var geometry={visible:!0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:5},bevel:{size:0,thickness:0,segments:1},offset:0};return poly.layer||(poly.layer="Polygon"),poly.geometry=lodash_defaults(poly.geometry,geometry),poly.geometry.bevel=lodash_defaults(poly.geometry.bevel,geometry.bevel),poly.image&&(poly.image.position=lodash_defaults(poly.image.position,geometry.position),poly.image.rotation=lodash_defaults(poly.image.rotation,geometry.rotation),poly.image.scale=lodash_defaults(poly.image.scale,geometry.scale)),poly.label&&(poly.label.position=lodash_defaults(poly.label.position,geometry.position),poly.label.rotation=lodash_defaults(poly.label.rotation,geometry.rotation),poly.label.scale=lodash_defaults(poly.label.scale,geometry.scale),poly.label.color=poly.label.color||"#000000",poly.label.fontSize=poly.label.fontSize||20),poly}}]),_createClass(Element,[{key:"getBoundingBox",value:function(){if(this.boundingBox)return this.boundingBox;var minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,tX=-this.mapClass.width/2,tY=this.mapClass.height/2;return this.polygon.vertexes.forEach((function(vertex){vertex.x+tX>maxX&&(maxX=vertex.x+tX),vertex.x+tX<minX&&(minX=vertex.x+tX),-vertex.y+tY>maxY&&(maxY=-vertex.y+tY),-vertex.y+tY<minY&&(minY=-vertex.y+tY)})),this.boundingBox={min:{x:minX,y:minY},max:{x:maxX,y:maxY}},this.boundingBox}},{key:"load",value:function(){var _this2=this,self=this;return this.visible||this.imageVisible||this.labelVisible?new Promise((function(resolve,reject){var polygon=self.polygon,mapClass=self.mapClass;if(_this2.visible){var vertices=polygon.vertexes,scalingFactor=Math.max(mapClass.width,mapClass.height)/1e3;(_this2.imageVisible||polygon.geometry.offset)&&(vertices=Element._clip(vertices,0),vertices=Element._clip(vertices,polygon.geometry.offset),polygon.vertexes=vertices);var extrudeSettings,shape=Element._makeFromCoords(Shape$1,vertices,mapClass);polygon.holes&&(shape.holes=polygon.holes.map((function(hole){return Element._makeFromCoords(Path,hole,mapClass)}))),extrudeSettings=polygon.geometry.bevel?{bevelEnabled:!0,amount:polygon.geometry.scale.z*scalingFactor,bevelThickness:polygon.geometry.bevel.thickness*polygon.geometry.scale.z*scalingFactor,bevelSize:polygon.geometry.bevel.size*scalingFactor,bevelSegments:polygon.geometry.bevel.segments||1}:{bevelEnabled:!1,amount:polygon.geometry.scale.z*scalingFactor};var material,hasImageTexture=polygon.textures&&polygon.textures.length&&polygon.textures.filter((function(t){return t.image&&Object.keys(t.image).length})).length,intColor=Element._normalizeColor(polygon.material.color),opacity=polygon.material.opacity||1,geometry=new ExtrudeBufferGeometry(shape,extrudeSettings);if(hasImageTexture){var frontTextureObj,sideTextureObj,frontTexture=polygon.textures.find((function(t){return"front"===t.name})),sideTexture=polygon.textures.find((function(t){return"side"===t.name})),sideTextureSameAsFront=sideTexture.useFrontFaceImage,frontImg=frontTexture&&frontTexture.image&&(frontTexture.image.url||frontTexture.image.original),sideImg=sideTexture&&sideTexture.image&&(sideTexture.image.url||sideTexture.image.original);!function(geometry,textures,mapClass){geometry.computeBoundingBox();var boundingBox=geometry.boundingBox,scalingFactor=Math.max(mapClass.width,mapClass.height)/1e3,maxDimension=Math.max(mapClass.width*scalingFactor,mapClass.height*scalingFactor),sceneBounds={min:new Vector3(0,0,0),max:new Vector3(1,1,1).multiplyScalar(maxDimension)},_textures={};textures.forEach((function(t){_textures[t.name]=t}));var faceCount,meshIndex,vertexPositions=geometry.getAttribute("position"),vertexNormals=geometry.getAttribute("normal"),vertexUvs=geometry.getAttribute("uv");console.assert(vertexPositions.count==vertexNormals.count),console.assert(vertexPositions.count==vertexUvs.count),geometry.index?(console.assert(geometry.index.count%3==0),faceCount=geometry.index.count/3,meshIndex=function(faceIndex,withinFaceIndex){return geometry.index.getX(3*faceIndex+withinFaceIndex)}):(console.assert(vertexPositions.count%3==0),faceCount=vertexPositions.index.count/3,meshIndex=function(faceIndex,withinFaceIndex){return 3*faceIndex+withinFaceIndex});for(var sideTextureOptions=_textures.side||{},frontTextureOptions=_textures.front||{},sideRepeatU=null!=sideTextureOptions.repeat?sideTextureOptions.repeat.u:1,sideRepeatV=null!=sideTextureOptions.repeat?sideTextureOptions.repeat.v:1,sideOffsetU=null!=sideTextureOptions.offset?sideTextureOptions.offset.u:1,sideOffsetV=null!=sideTextureOptions.offset?sideTextureOptions.offset.v:1,sideRotation=null!=sideTextureOptions.rotation?sideTextureOptions.rotation:0,sideUseLocalScaling=sideTextureOptions.useLocalScaling||!1,frontRepeatU=null!=frontTextureOptions.repeat?frontTextureOptions.repeat.u:1,frontRepeatV=null!=frontTextureOptions.repeat?frontTextureOptions.repeat.v:1,frontOffsetU=null!=frontTextureOptions.offset?frontTextureOptions.offset.u:1,frontOffsetV=null!=frontTextureOptions.offset?frontTextureOptions.offset.v:1,frontRotation=null!=frontTextureOptions.rotation?frontTextureOptions.rotation:0,frontUseLocalScaling=frontTextureOptions.useLocalScaling||!1,i=0;i<faceCount;++i){var uDim,vDim,repeatU,repeatV,offsetU,offsetV,rotation,bounds,normalX=vertexNormals.getX(meshIndex(i,0))+vertexNormals.getX(meshIndex(i,1))+vertexNormals.getX(meshIndex(i,2)),normalY=vertexNormals.getY(meshIndex(i,0))+vertexNormals.getY(meshIndex(i,1))+vertexNormals.getY(meshIndex(i,2)),normalZ=vertexNormals.getZ(meshIndex(i,0))+vertexNormals.getZ(meshIndex(i,1))+vertexNormals.getZ(meshIndex(i,2)),absNormalX=Math.abs(normalX),absNormalY=Math.abs(normalY),absNormalZ=Math.abs(normalZ);absNormalX<=absNormalY&&absNormalX<=absNormalZ?(uDim=X,vDim=absNormalY<=absNormalZ?Y:Z):absNormalY<=absNormalX&&absNormalY<=absNormalZ?(uDim=Y,vDim=absNormalX<=absNormalZ?X:Z):(uDim=Z,vDim=absNormalX<=absNormalY?X:Y),uDim===Z&&(uDim=vDim,vDim=Z),vDim===Z||uDim===Z?(repeatU=sideRepeatU,repeatV=sideRepeatV,offsetU=sideOffsetU,offsetV=sideOffsetV,rotation=sideRotation,bounds=sideUseLocalScaling?boundingBox:sceneBounds):(repeatU=frontRepeatU,repeatV=frontRepeatV,offsetU=frontOffsetU,offsetV=frontOffsetV,rotation=frontRotation,bounds=frontUseLocalScaling?boundingBox:sceneBounds);for(var min=bounds.min,max=bounds.max,rangeU=Math.abs(max[uDim]-min[uDim]),rangeV=Math.abs(max[vDim]-min[vDim]),angle=rotation*Math.PI/180||0,c=Math.cos(angle),s=Math.sin(angle),j=0;j<3;j++){var uvU,uvV,positionX=vertexPositions.getX(meshIndex(i,j)),positionY=vertexPositions.getY(meshIndex(i,j)),positionZ=vertexPositions.getZ(meshIndex(i,j));uvU=uDim===X?repeatU*(positionX-min[uDim])/rangeU+offsetU:uDim===Y?repeatU*(positionY-min[uDim])/rangeU+offsetU:repeatU*(positionZ-min[uDim])/rangeU+offsetU,uvV=vDim===X?repeatV*(positionX-min[vDim])/rangeV+offsetV:vDim===Y?repeatV*(positionY-min[vDim])/rangeV+offsetV:repeatV*(positionZ-min[vDim])/rangeV+offsetV;var rotatedU=(uvU-=.5)*c-(uvV-=.5)*s+.5,rotatedV=uvU*s+uvV*c+.5;vertexUvs.setX(meshIndex(i,j),rotatedU),vertexUvs.setY(meshIndex(i,j),rotatedV)}}geometry.uvsNeedUpdate=!0}(geometry,polygon.textures,mapClass),frontImg&&(frontTextureObj=Element.getTextureLoader().load(frontImg,(function(){frontTextureObj.mapping=UVMapping,frontTextureObj.wrapS=RepeatWrapping,frontTextureObj.wrapT=RepeatWrapping,frontTextureObj.anisotropy=16}))),sideTextureObj=!sideTextureSameAsFront&&sideImg?Element.getTextureLoader().load(sideImg,(function(){sideTextureObj.mapping=UVMapping,sideTextureObj.wrapS=RepeatWrapping,sideTextureObj.wrapT=RepeatWrapping,sideTextureObj.anisotropy=16})):frontTextureObj;var options={color:intColor,transparent:!0,opacity:opacity,side:opacity<1?DoubleSide:FrontSide};material=sideTextureObj===frontTextureObj?new MeshLambertMaterial(_objectSpread2(_objectSpread2({},options),{map:frontTextureObj})):[new MeshLambertMaterial(_objectSpread2(_objectSpread2({},options),{map:frontTextureObj})),new MeshLambertMaterial(_objectSpread2(_objectSpread2({},options),{map:sideTextureObj}))]}else material=Element._getMaterial(polygon.material.color,opacity);var mesh=new Mesh(geometry,material);mesh.name=polygon.id,Array.isArray(mesh.material)||(mesh.material.needsUpdate=!0),mesh.translateZ(polygon.geometry.position.z*scalingFactor),self.container.add(mesh),self.mesh=mesh}_this2.imageVisible&&_this2._addImage(polygon,mapClass,resolve),_this2.labelVisible&&_this2._addLabel(polygon,mapClass,resolve)})):Promise.resolve()}},{key:"_addLabel",value:function(poly,mapClass,resolve){var _this3=this;if(poly.label.text){var scalingFactor=Math.max(mapClass.width,mapClass.height)/1e3,center=Element.getWeightedCenter(poly.vertexes),position=poly.label.position,rotationZ=poly.label.rotation.z,lines=poly.label.text.split("\n");fontLibrary.getFont(poly.label.fontFamily).then((function(font){var options={font:font,size:poly.label.fontSize*scalingFactor,height:Element.overlayHeight,bevelEnabled:!1,curveSegments:4},maxLineIndex=0,lineGeometries=lines.reverse().map((function(line,index){return line.length>lines[maxLineIndex].length&&(maxLineIndex=index),new TextGeometry(line,options)})),maxGeo=lineGeometries[maxLineIndex],maxMesh=new Mesh(maxGeo),maxSize=(new Box3).setFromObject(maxMesh).size().x,material=Element._getMaterial(poly.label.color),translation=0,linesGeometry=new Geometry;lines.forEach((function(line,index){var startPos,geometry=lineGeometries[index],label=new Mesh(geometry,material),box=(new Box3).setFromObject(label);startPos="left"===options.align?0:"right"===options.align?maxSize-box.size().x:(maxSize-box.size().x)/2,label.position.set(startPos,translation,0),label.updateMatrix(),linesGeometry.merge(label.geometry,label.matrix),translation+=1.25*options.size}));var labelMesh=new Mesh(linesGeometry,material);linesGeometry.computeBoundingBox();var boundingBox=linesGeometry.boundingBox,width=boundingBox.max.x-boundingBox.min.x,height=boundingBox.max.y-boundingBox.min.y,polygonZ=poly.geometry.position.z+poly.geometry.scale.z;labelMesh.translateX(center.x-mapClass.width/2+position.x-width/2),labelMesh.translateY(-center.y+mapClass.height/2+position.y-height/2),labelMesh.rotation.set(0,0,rotationZ*Math.PI/180),labelMesh.translateZ((Element.overlayHeight+polygonZ)*scalingFactor),_this3.container.add(labelMesh),resolve()}))}}},{key:"_addImage",value:function(polygon,mapClass,resolve){var _this4=this;this.hasImage=!0;var boundingBox=this.getBoundingBox(),texture=Element.getTextureLoader().load(polygon.image.url||polygon.image.original,(function(){var otherScale,vx=texture.image.width,vy=texture.image.height,size={x:polygon.image.viewBox.width,y:polygon.image.viewBox.height};otherScale=!1===polygon.image.useLocalScaling?scalingFactor:Math.min(boundingBox.max.x-boundingBox.min.x,boundingBox.max.y-boundingBox.min.y)/Math.max(size.x,size.y),polygon.image.fitToBounds?imageMesh.scale.set(boundingBox.max.x-boundingBox.min.x,boundingBox.max.y-boundingBox.min.y,1):polygon.image.scale&&imageMesh.scale.set(polygon.image.scale.x*otherScale*polygon.image.viewBox.width,polygon.image.scale.y*otherScale*polygon.image.viewBox.height,1),imageMesh.translateZ(Element.overlayHeight*scalingFactor),texture.repeat=new Vector2(polygon.image.viewBox.width/vx,polygon.image.viewBox.height/vy),texture.offset=new Vector2(0,(texture.image.height-polygon.image.viewBox.height)/texture.image.height),_this4.publish("texture-loaded",texture),resolve()})),material=new MeshLambertMaterial({transparent:!0,depthWrite:!1,side:DoubleSide,map:texture});texture.anisotropy=16;var imageMesh=new Mesh(new PlaneGeometry(1,1),material);imageMesh.name=polygon.id+"_image",this.container.add(imageMesh);var center,scalingFactor=Math.max(mapClass.width,mapClass.height)/1e3,vertices=polygon.vertexes;center=polygon.image.fitToBounds?Element.getBoundingCentre(vertices):Element.getWeightedCenter(vertices);var positionX=polygon.image.fitToBounds?0:polygon.image.position.x,positionY=polygon.image.fitToBounds?0:polygon.image.position.y,polygonZ=polygon.geometry.position.z+polygon.geometry.scale.z;polygon.image.position&&(imageMesh.translateX(center.x-mapClass.width/2+positionX),imageMesh.translateY(-center.y+mapClass.height/2+positionY),imageMesh.translateZ((polygonZ+polygon.image.position.z)*scalingFactor)),polygon.image.rotation&&imageMesh.rotation.set(polygon.image.rotation.x*Math.PI/180,polygon.image.rotation.y*Math.PI/180,polygon.image.rotation.z*Math.PI/180)}}],[{key:"_normalizeColor",value:function(color){var fullColor=color.replace(/#/,"");return 3===fullColor.length&&(fullColor="".concat(fullColor[0]).concat(fullColor[0]).concat(fullColor[1]).concat(fullColor[1]).concat(fullColor[2]).concat(fullColor[2])),parseInt(fullColor,16)}},{key:"_getMaterial",value:function(color,opacity){var material,intColor=Element._normalizeColor(color),materialId=opacity<1?intColor+"_"+opacity:intColor;if(Element.materials[materialId])material=Element.materials[materialId];else{var options={color:intColor,side:opacity<1?DoubleSide:FrontSide};opacity<1&&(options.transparent=!0,options.opacity=opacity),Element.materials[materialId]=new MeshLambertMaterial(options),material=Element.materials[materialId]}return material}},{key:"_clip",value:function(vertices,offset){offset/=2;for(var intScale=Element.scale,paths=vertices.map((function(v){return{X:v.x*intScale,Y:v.y*intScale}})),tries=8;0!==tries;tries--){var offsetter=new clipper.ClipperOffset;offsetter.AddPath(paths,clipper.JoinType.jtMiter,clipper.EndType.etClosedPolygon);var offsettedPaths=new clipper.Paths;try{if(offsetter.Execute(offsettedPaths,offset*intScale),offsettedPaths.length)return offsettedPaths[0].map((function(v){return{x:v.X/intScale,y:v.Y/intScale}}));offset/=2}catch(e){offset/=2}}return paths}}]),Element}();Element.materials={},Element.defaultExtrudeSettings={amount:10,bevelEnabled:!1},Element.scale=100,Element.overlayHeight=.15;var outsideReject,JSONSceneLoader$1=new(function(){function JSONSceneLoader(){_classCallCheck(this,JSONSceneLoader),this.defaultExtrudeSettings={amount:10,bevelEnabled:!1},this.materials={},this.scale=100,this.overlayHeight=.15}return _createClass(JSONSceneLoader,[{key:"load",value:function(polygons,mapClass){var _this=this;if("string"==typeof polygons)return fetch(polygons).then((function(res){return res.json()})).then((function(polys){return null==polys||0===polys.length?Promise.reject("No polygons found for venue"):_this._build(polys,mapClass)})).catch((function(e){return Promise.reject(e)}));try{return this._build(polygons,mapClass)}catch(e){return Promise.reject(e)}}},{key:"_build",value:function(polygons,mapClass){var _this2=this;console.time("JSONSceneLoader"),this.container=new Group;var visibleLayers=new Set,elements={};mapClass.layers.forEach((function(layer){!1!==layer.visible&&visibleLayers.add(layer.id)})),polygons.forEach((function(poly){var layer=poly.layer||"Polygon";if(visibleLayers.has(layer)){var e=new Element(poly,mapClass,_this2.container);elements[poly.id]=e}}));var container=this.container;return console.timeEnd("JSONSceneLoader"),Promise.resolve({container:container,elements:elements})}},{key:"loadTexture",value:function(url){var _this3=this;return new Promise((function(resolve,reject){return _this3.textureLoader.load(url,resolve,reject)}))}}]),JSONSceneLoader}()),tempObjectQueue=new Object3D,priorityLayers={Floor:1,Wall:2,"Outer Wall":2.2,Anchors:4,Anchor:4,"Anchor Store":4,Polygon:5,Kiosks:6,"Inner Wall":7,"Non Public":7.5},calculateScore=function(polygon){if(priorityLayers[polygon.layer])return priorityLayers[polygon.layer];var scale=polygon.geometry.scale,position=polygon.geometry.position;return 100+(scale?scale.z:1)+(position?position.z:0)},MapObject=function(){function MapObject(mapClass,polygonMeshesById,markerWorld,showCount,mapView){var _this=this,loadOptions=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};_classCallCheck(this,MapObject),this._flippableImagedById={},this._started=!1,this._loaderPromise=null,this._promiseResolve=null,this.objectsDictionary={},this.north=null,this.mapScale=null,this.object=new Object3D,this.textObjects=[],this.smartLabelBatchCreator=null,this.imagesToFlip=[],this.markers=[],this.seenByCamera=!1,this.threeJSMarkers=new Map,Object.assign(this,PubSub.prototype),this.mapView=mapView,this.mapClass=mapClass,this.polygonMeshesById=polygonMeshesById,this.markerWorld=markerWorld,this._showCount=showCount,this.loadMethod=loadOptions.mode,this.loadAsync=loadOptions.async,this._taskScheduler=loadOptions.taskScheduler,this.id=this.mapClass.id,this._highPriorityTasks=new FrameTaskGroup({name:"_highPriorityTasks",onComplete:this._checkIfLoaded.bind(this),priority:!this.visible&&this.loadAsync?TASK_PRIORITY_ASYNC_MAP_HIGH:TASK_PRIORITY_VISIBLE_MAP_HIGH,postponeOnAdd:!this.visible&&!this.loadAsync}),this._lowPriorityTasks=new FrameTaskGroup({name:"_lowPriorityTasks",onComplete:this._checkIfLoaded.bind(this),priority:!this.visible&&this.loadAsync?TASK_PRIORITY_ASYNC_MAP_LOW:TASK_PRIORITY_VISIBLE_MAP_LOW,postponeOnAdd:!this.visible&&!this.loadAsync}),this._markerTasks=new FrameTaskGroup({name:"_markerTasks",priority:!this.visible&&this.loadAsync?TASK_PRIORITY_ASYNC_MAP_MARKER:TASK_PRIORITY_VISIBLE_MAP_MARKER,postponeOnAdd:!this.visible}),this._mapLoadedTasks=new FrameTaskGroup({name:"_mapLoadedTasks",priority:TASK_PRIORITY_MAP_LOADED,postponeOnAdd:!this.isReady()}),this._visibilityLatch=null,this._objLoadedComplete=!1,this.smartLabelBatchCreator=new SmartLabelBatchCreator({mapView:this.mapView,debounceDelayMS:100}),this._loaderPromise=new Promise((function(resolve,reject){_this._promiseResolve=resolve,outsideReject=reject})),this._objLoaded=this._objLoaded.bind(this),this.enableImageFlipping=this.enableImageFlipping.bind(this),this.removeMarkers=this.removeMarkers.bind(this),this.addMarkers=this.addMarkers.bind(this),this.removeMarker=this.removeMarker.bind(this),this.destroy=this.destroy.bind(this)}return _createClass(MapObject,[{key:"_objLoaded",value:function(object){var _this2=this;if(object.elements){this.elements=object.elements;var elementsArray=Object.values(this.elements);elementsArray.sort((function(a,b){return null==a.sortScore&&(a.sortScore=calculateScore(a.polygon)),null==b.sortScore&&(b.sortScore=calculateScore(b.polygon)),b.sortScore-a.sortScore}));for(var min=new Vector3(1/0,1/0,0),max=new Vector3(-1/0,-1/0,0),_loop=function(){var element=_elementsArray[_i],boundingBox=element.getBoundingBox();min.min(boundingBox.min),max.max(boundingBox.max),_this2.loadAsync?_this2._addPendingHighPriorityTask("addPolygon",(function(){return _this2._addElementToScene(element)})):_this2._addElementToScene(element)},_i=0,_elementsArray=elementsArray;_i<_elementsArray.length;_i++)_loop();this.boundingBox={min:min,max:max},object=object.container}for(var children=object.children,i=0,iLen=children.length;i<iLen;++i){var child=children[i];this.objectsDictionary[child.name]=child,this.polygonMeshesById[child.name]=child}return this.object=object,this.object.userData.type="mappedin_map",this.object.userData.mapId=this.mapClass.id,this.publish("pinsNeedUpdating",!0),this._objLoadedComplete=!0,this._onRootObjectCreated(),this._checkIfLoaded(),this._promiseResolve(this)}},{key:"loadPolygonNow",value:function(polygonId){if(this.elements){var element=this.elements[polygonId];this._addElementToScene(element)}}},{key:"_addElementToScene",value:function(element){var _this3=this;if(!this.objectsDictionary[element.polygon.id]){if(element.load.bind(element),element.load(),element.hasImage&&element.on("texture-loaded",(function(texture){_this3.publish("texture-loaded",texture)})),element.mesh){var child=element.mesh;this.objectsDictionary[child.name]=child,this.polygonMeshesById[child.name]=child}if(element.polygon.image){var rotation=null!=element.polygon.image.rotation?element.polygon.image.rotation.z:0;this.mapView._imageFlippingEnabled&&this.enableImageFlipping(element.polygon.id,rotation*(Math.PI/180))}}}},{key:"load",value:function(){var _this4=this;if(!this._started){if(this._started=!0,null!=this.mapClass.object3D)return this._objLoaded(this.mapClass.object3D),this._loaderPromise;try{var publishedPolygons=this.mapClass.scene.polygons,attemptJson="json"===this.loadMethod||void 0===this.loadMethod;if(attemptJson&&publishedPolygons){var polyLocation=publishedPolygons||!1;this.loadMethodUsed="JSON - "+(publishedPolygons?"published":"live"),JSONSceneLoader$1.load(polyLocation,this.mapClass).then(this._objLoaded).catch((function(error){console.error(error),console.warn("falling back to OBJ loader"),_this4.loadMethodUsed="OBJ";var mtl=_this4.mapClass.scene.mtl,obj=_this4.mapClass.scene.obj;SceneLoader.load(obj,mtl).then(_this4._objLoaded).catch(outsideReject)}))}else{attemptJson&&console.warn("Could not use scene parser, had to fall back to OBJ loader"),this.loadMethodUsed="OBJ";var mtl=this.mapClass.scene.mtl,obj=this.mapClass.scene.obj;SceneLoader.load(obj,mtl).then(this._objLoaded).catch(outsideReject)}}catch(e){outsideReject("ERROR: No 3D files for map "+(this.mapClass.name||this.mapClass.shortName||this.mapClass.id||this.mapClass))}}return this._loaderPromise}},{key:"_dispose",value:function(objectToDispose){for(var object=objectToDispose,i=object.children.length-1;i>=0;i--)this._dispose(object.children[i]);object.destroy(),delete this.objectsDictionary[object.name],delete this.polygonMeshesById[object.name]}},{key:"destroy",value:function(){this.removeLabels(),this.removeMarkers(),this._removeThreeJSMarkers(),this.disableAllImageFlipping(),this._dispose(this.object)}},{key:"add",value:function(childObjectToAdd){var _this5=this;tempObjectQueue.add(childObjectToAdd),this.load().then((function(){1===tempObjectQueue.children.filter((function(childObject){return childObject.uuid===childObjectToAdd.uuid})).length&&_this5.object.add(childObjectToAdd)}))}},{key:"getPositionLatLon",value:function(lat,lon){var anchor=this.mapClass.georeference[0],anchorLatLon=new LatLonSpherical(anchor.target.x,anchor.target.y),targetLatLon=new LatLonSpherical(lat,lon),worldDistance=anchorLatLon.distanceTo(targetLatLon),worldBearing=(anchorLatLon.finalBearingTo(targetLatLon)+0)*Math.PI/180,mappedinDistance=worldDistance*this.getMapScale(this.mapClass),mappedinBearing=worldBearing+this.getNorth(this.mapClass),deltaX=Math.sin(mappedinBearing)*mappedinDistance,deltaY=Math.cos(mappedinBearing)*mappedinDistance;return this.mapView.convertTo3DMapPosition({x:anchor.control.x+deltaX,y:anchor.control.y-deltaY,map:this.mapClass.id})}},{key:"getMapScale",value:function(){return null==this.mapScale&&(this.mapScale=function(map){if(map.scale||map.x_scale)return 1/(map.scale||map.x_scale);var mapScale;try{var anchor1=map.georeference[0],anchor2=map.georeference[2],ll1=new LatLonSpherical(anchor1.target.x,anchor1.target.y),ll2=new LatLonSpherical(anchor2.target.x,anchor2.target.y),worldDistance=ll1.distanceTo(ll2),xDiff=anchor1.control.x-anchor2.control.x,yDiff=anchor1.control.y-anchor2.control.y;mapScale=Math.sqrt(xDiff*xDiff+yDiff*yDiff)/worldDistance}catch(e){mapScale=1,console.warn(e),console.warn("Couldn't georeference "+(map.name||map.shortName||map.id)+". Probably not enough geocoordinates.")}return mapScale}(this.mapClass)),this.mapScale}},{key:"getNorth",value:function(){return null==this.north&&(this.north=function(map){var north;try{var anchor1=map.georeference[0],anchor2=map.georeference[2],ll1=new LatLonSpherical(anchor1.target.x,anchor1.target.y),ll2=new LatLonSpherical(anchor2.target.x,anchor2.target.y);north=-((ll1.finalBearingTo(ll2)+0)*Math.PI/180-Math.atan2(anchor2.control.y-anchor1.control.y,anchor2.control.x-anchor1.control.x)-Math.PI/2)}catch(e){north=0,console.warn(e),console.warn("Couldn't georeference "+(map.name||map.shortName||map.id)+". Probably not enough geocoordinates.")}return north}(this.mapClass)),this.north}},{key:"enableImageFlipping",value:function(polygonId,rotation){if(rotation=rotation||0,!this._flippableImagedById[polygonId]&&this.object&&Object.keys(this.object).length>0){var image=this.object.getObjectByName(polygonId+"_image");if(image){var flippableImage=new FlippableImage({image:image,rotation:rotation});this.imagesToFlip.push(flippableImage),this.publish("flippablesNeedUpdating"),this.publish("render"),this._flippableImagedById[polygonId]=!0}}}},{key:"disableAllImageFlipping",value:function(){for(var i=0,iLen=this.imagesToFlip.length;i<iLen;i++)this.imagesToFlip[i].reset();this.imagesToFlip=[],this._flippableImagedById={}}},{key:"isReady",value:function(){return(this.loadAsync?this._highPriorityTasks.isComplete():this.isFullyLoaded())&&this._objLoadedComplete}},{key:"isFullyLoaded",value:function(){return this._highPriorityTasks.isComplete()&&this._lowPriorityTasks.isComplete()}},{key:"onVisible",value:function(){!0!==this._visibilityLatch&&(this.loadAsync?(this._taskScheduler.setTaskPriority(this._highPriorityTasks,TASK_PRIORITY_VISIBLE_MAP_HIGH),this._taskScheduler.setTaskPriority(this._lowPriorityTasks,TASK_PRIORITY_VISIBLE_MAP_LOW),this._taskScheduler.resumeTask(this._markerTasks)):(this._taskScheduler.resumeTask(this._highPriorityTasks),this._taskScheduler.resumeTask(this._lowPriorityTasks),this._taskScheduler.resumeTask(this._markerTasks)),this._visibilityLatch=!0)}},{key:"onInvisible",value:function(){!1!==this._visibilityLatch&&(this.loadAsync?(this._taskScheduler.setTaskPriority(this._highPriorityTasks,TASK_PRIORITY_ASYNC_MAP_HIGH),this._taskScheduler.setTaskPriority(this._lowPriorityTasks,TASK_PRIORITY_ASYNC_MAP_LOW),this._taskScheduler.postponeTask(this._markerTasks)):(this._taskScheduler.postponeTask(this._highPriorityTasks),this._taskScheduler.postponeTask(this._lowPriorityTasks),this._taskScheduler.postponeTask(this._markerTasks)),this._visibilityLatch=!1)}},{key:"addPendingMarkerTask",value:function(marker,callback){this._taskScheduler.scheduleTask(new FrameTask({name:"addMarker",group:this._markerTasks,callback:callback,userdata:{marker:marker}}))}},{key:"addPendingLowPriorityTask",value:function(name,callback){this._taskScheduler.scheduleTask(new FrameTask({name:name,group:this._lowPriorityTasks,callback:callback}))}},{key:"addPendingMapLoadedTask",value:function(name,callback){this._taskScheduler.scheduleTask(new FrameTask({name:name,group:this._mapLoadedTasks,callback:callback})),this._checkIfLoaded()}},{key:"_addPendingHighPriorityTask",value:function(name,callback){this._taskScheduler.scheduleTask(new FrameTask({name:name,group:this._highPriorityTasks,callback:callback}))}},{key:"addThreeJSMarker",value:function(options){var _this6=this;if(!(options.object instanceof Object3D))throw new Error("threeJSMarker `object` must be an instance of `Object3D`");var threeJSMarkerId=new ThreeJSMarkerHandle({mapId:this.id,object:options.object}),threeJSMarker={object:options.object};return options.object.layers.disable(0),options.object.layers.enable(CAMERA_LAYER_ANIMATED),null!=options.position&&options.object.position.copy(options.position),null!=options.rotation&&options.object.rotation.copy(options.rotation),null!=options.scale&&options.object.scale.copy(options.scale),this.threeJSMarkers.set(threeJSMarkerId,threeJSMarker),this._objLoadedComplete?this.object.add(threeJSMarker.object):this.load().then((function(){threeJSMarkerId._deleted||_this6.object.add(threeJSMarker.object)})),threeJSMarkerId}},{key:"removeThreeJSMarker",value:function(markerHandle){var threeJSMarker=this.threeJSMarkers.get(markerHandle);return null!=threeJSMarker&&(markerHandle._deleted=!0,this.threeJSMarkers.delete(markerHandle),this._objLoadedComplete&&this.object.remove(threeJSMarker.object),markerHandle._destroy(),!0)}},{key:"_removeThreeJSMarkers",value:function(){if(this._objLoadedComplete){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.threeJSMarkers.entries()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),markerHandle=_step$value[0],marker=_step$value[1];this.object.remove(marker.object),markerHandle._destroy()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}this.threeJSMarkers.clear()}},{key:"addMarkers",value:function(){for(var i=0;i<this.markers.length;i++){var marker=this.markers[i];marker._mAnchor&&(this.markerWorld.addBody(marker._mAnchor),this.markerWorld.addBody(marker._mShadowElement),this.markerWorld.addConstraint(marker._mConstraint)),this.mapView.container.appendChild(marker.div),this.publish("updateMarkerPosition",marker),marker.show(),this.publish("render")}}},{key:"removeMarker",value:function(marker){var destroy=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(marker.hide(),marker._mAnchor&&(this.markerWorld.removeConstraint(marker._mConstraint),this.markerWorld.removeBody(marker._mAnchor),this.markerWorld.removeBody(marker._mShadowElement)),destroy){this.mapView.container.contains(marker.div)&&this.mapView.container.removeChild(marker.div),marker.destroy();for(var i=0;i<this.markers.length;++i)this.markers[i]===marker&&(this.markers[i]=this.markers[this.markers.length-1],this.markers.pop(),--i);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this._markerTasks.getTasks()[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var markerTask=_step2.value;markerTask.userdata.marker===marker&&this._taskScheduler.cancelTask(markerTask)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}},{key:"removeMarkers",value:function(){for(var _this7=this,destroy=arguments.length>0&&void 0!==arguments[0]&&arguments[0],markersToRemove=this.markers.slice(),i=0;i<markersToRemove.length;++i)this.removeMarker(markersToRemove[i],destroy);if(destroy){var markersNotYetAdded=this._markerTasks.getTasks();markersNotYetAdded.forEach((function(markerTask){return _this7.removeMarker(markerTask.userdata.marker,destroy)}))}this.publish("render")}},{key:"removeLabels",value:function(){if(Array.isArray(this.textObjects)){for(var j=0,jLen=this.textObjects.length;j<jLen;++j){var textObject=this.textObjects[j];textObject.removeSelf(!0),textObject=void 0}this.textObjects=[]}}},{key:"_checkIfLoaded",value:function(){var _this8=this;this.isReady()&&this._taskScheduler.scheduleTask(new FrameTask({name:"onMapLoaded",callback:function(){_this8._taskScheduler.resumeTask(_this8._mapLoadedTasks),_this8.mapLoaded&&_typeof(_this8.mapLoaded)===("undefined"==typeof Function?"undefined":_typeof(Function))&&(_this8.mapLoaded(),_this8.mapLoaded=null)}}))}},{key:"_onRootObjectCreated",value:function(){for(var threeJSMarker in this.threeJSMarkers.values())this.object.add(threeJSMarker.object)}},{key:"_popinChildObjects",value:function(){var _this9=this;this.loadAsync||this.object.traverse((function(object){0==object.children.length&&"Mesh"==object.type&&object.material.map&&(object.visible=!1,_this9._addPendingHighPriorityTask("addPolygon",(function(){object.visible=!0,_this9._showCount>=1&&(_this9._showCount=0,_this9.publish("render:now")),_this9._showCount++})))}))}},{key:"visible",get:function(){return null!=this.object.parent}}]),MapObject}(),ThreeJSMarkerHandle=function(){function ThreeJSMarkerHandle(_ref){var mapId=_ref.mapId,object=_ref.object;_classCallCheck(this,ThreeJSMarkerHandle),this._mapId=mapId,this._object=object}return _createClass(ThreeJSMarkerHandle,[{key:"_destroy",value:function(){this._mapId=null,this._object=null}},{key:"object",get:function(){return this._object}}]),ThreeJSMarkerHandle}(),CAMERA_TILT=Math.PI/2,DEFAULT_FOCUS_ANIM_CURVE=TWEEN$1.Easing.Quadratic.InOut,START_TOP="top",START_BOTTOM="bottom",DIR_DOWN="down",DIR_UP="up",MultiFloorView=function(){function MultiFloorView(mapView,object,maps,options){var func,wait,immediate,timeout;_classCallCheck(this,MultiFloorView),this._focusMapsStart=START_TOP,this._focusMapsDir=DIR_DOWN,this._focusMapsLen=3,this._focusAnimCurve=DEFAULT_FOCUS_ANIM_CURVE,this._focusAnimDuration=900,this.rotationAxis=new Vector3(1,0,0),this.mapBoundingBoxes=[],this._helperBoundingBoxes=[],this.mapAxesHelpers=[],this.mapView=mapView,this.object=object,this.options=options,this.padding=null==options.padding?mapView.cachedPadding:options.padding,this.rotation=null==options.rotation?0:options.rotation,this.maps=maps,this.debug=options.debug,this.mapSpacing=null==options.mapSpacing?1e3:parseInt(options.mapSpacing,10),this.mapView.setViewState(VIEW_STATE.MULTI_FLOOR),this.object.children.forEach((function(child){return child.parent.remove(child)})),this.mapTilt=(null==options.mapTilt?30:options.mapTilt)*Math.PI/180,this.mapView.controls.setTilt(CAMERA_TILT),this.positionMaps(maps),this.addMaps(this.maps),this.resize=(func=this.resize.bind(this),wait=300,function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}),this.focusOnMaps=this.focusOnMaps.bind(this),this.debug&&(this.addMapBoundingBoxes(),this.addAxesHelpers())}return _createClass(MultiFloorView,[{key:"positionMaps",value:function(){var _this=this,flatMapBoundingBoxes=this.maps.map((function(mapObject,idx){var map=mapObject.object;map.rotation.z=_this.rotation*Math.PI/180;var mapBB=new Box3;return mapBB.setFromObject(map),map.rotation.z=0,mapBB})),zOffset=0;this.maps.forEach((function(mapObject,idx){var map=mapObject.object;map.setRotationFromAxisAngle(_this.rotationAxis,_this.mapTilt);var mapBottomZ=flatMapBoundingBoxes[idx].min.y*Math.sin(_this.mapTilt),mapTopZ=flatMapBoundingBoxes[idx].max.y*Math.sin(_this.mapTilt);zOffset-=Math.abs(mapTopZ),map.position.z=zOffset,zOffset-=Math.abs(mapBottomZ),zOffset-=_this.mapSpacing}));var stackBox=getMapsBoundingBox(this.maps),mapStackOffset=(stackBox.max.z-stackBox.min.z)/2;this.maps.forEach((function(mapObject,idx){var map=mapObject.object;map.position.z+=mapStackOffset,map.rotation.z=_this.rotation*Math.PI/180})),this.maps.forEach((function(mapObject,idx){if(!0===mapObject.connection){var _mapObject$connection=_slicedToArray(mapObject.connectionNodes,2),sourceNode=_mapObject$connection[0],destinationNode=_mapObject$connection[1],sourceNode3D=_this.mapView.convertTo3DMapPosition(sourceNode),destinationNode3D=_this.mapView.convertTo3DMapPosition(destinationNode),thisMap=mapObject.object,lastMap=_this.maps.find((function(m){return m.id===sourceNode.map})).object,nextMap=_this.maps.find((function(m){return m.id===destinationNode.map})).object;lastMap.updateMatrixWorld(),nextMap.updateMatrixWorld(),sourceNode3D.applyMatrix4((new Matrix4).extractRotation(lastMap.matrix)),destinationNode3D.applyMatrix4((new Matrix4).extractRotation(nextMap.matrix)),sourceNode3D.z+=lastMap.position.z,destinationNode3D.z+=nextMap.position.z;var dir=destinationNode3D.clone().sub(sourceNode3D),len=dir.length();dir=dir.normalize().multiplyScalar(.5*len);var pos=sourceNode3D.clone().add(dir);thisMap.rotation.z=0,thisMap.position.set(pos.x,pos.y,pos.z),thisMap.renderOrder=1}}))}},{key:"addMaps",value:function(maps){var _this2=this;maps.forEach((function(map){_this2.object.add(map.object),map.addMarkers&&map.addMarkers()}))}},{key:"removeMaps",value:function(){this.maps.forEach((function(mapObject){mapObject.object.position.set(0,0,0),mapObject.object.rotation.set(0,0,0),mapObject.removeMarkers&&mapObject.removeMarkers(),mapObject.object.parent&&mapObject.object.parent.remove(mapObject.object)}))}},{key:"addMapBoundingBoxes",value:function(){var _this3=this,boxColors=[16711680,65280,255,16711935,16776960,65535];this.maps.forEach((function(mapObject,idx){var map=mapObject.object,box=(new Box3).setFromObject(map),boxHelper=new Box3Helper(box,boxColors[idx]);_this3.object.add(boxHelper),_this3.mapBoundingBoxes.push(boxHelper)}))}},{key:"removeMapBoundingBoxes",value:function(){this.mapBoundingBoxes.forEach((function(bb,idx){bb.parent&&bb.parent.remove(bb)}))}},{key:"removeHelperBoundingBoxes",value:function(){this._helperBoundingBoxes.forEach((function(bb,idx){bb.parent&&bb.parent.remove(bb)}))}},{key:"addAxesHelpers",value:function(){var _this4=this,globalAxes=new AxesHelper(5e3);this.object.add(globalAxes),this.maps.forEach((function(mapObject,idx){var map=mapObject.object,objAxes=new AxesHelper(1e3);map.add(objAxes),_this4.mapAxesHelpers.push(objAxes)}))}},{key:"removeAxesHelpers",value:function(){this.mapAxesHelpers.forEach((function(ah,idx){ah.parent&&ah.parent.remove(ah)}))}},{key:"tiltMaps",value:function(tiltRad){var _this5=this;this.maps.forEach((function(mapObject,idx){mapObject.object.setRotationFromAxisAngle(_this5.rotationAxis,tiltRad)}))}},{key:"focusOnMaps",value:function(){var _this6=this,_ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$start=_ref.start,start=void 0===_ref$start?this._focusMapsStart:_ref$start,_ref$len=_ref.len,len=void 0===_ref$len?this._focusMapsLen:_ref$len,_ref$dir=_ref.dir,dir=void 0===_ref$dir?this._focusMapsDir:_ref$dir,mapIndices=_ref.mapIndices,_ref$duration=_ref.duration,duration=void 0===_ref$duration?this._focusAnimDuration:_ref$duration,_ref$curve=_ref.curve,curve=void 0===_ref$curve?this._focusAnimCurve:_ref$curve;return start===START_TOP?dir=DIR_DOWN:start===START_BOTTOM&&(dir=DIR_UP),this._focusMapsStart=start,this._focusMapsLen=len,this._focusMapsDir=dir,this._focusAnimDuration=duration,this._focusAnimCurve=curve,new Promise((function(resolve){var focusMaps=mapIndices?_this6.getMapsByIndices(mapIndices):_this6.getFocusMaps(start,dir,len),allMapsBB=getMapsBoundingBox(_this6.maps,_this6.mapSpacing),allMapsHeight=allMapsBB.max.z-allMapsBB.min.z,focusBox=getMapsBoundingBox(focusMaps,_this6.mapSpacing);focusBox.min.setX(allMapsBB.min.x),focusBox.max.setX(allMapsBB.max.x),_this6._focusBox=focusBox,_this6._scrollWindow=focusBox.max.z-focusBox.min.z;var focusBoxWidth=focusBox.max.x-focusBox.min.x,focusBoxHeight=focusBox.max.z-focusBox.min.z,minPedestal=-allMapsHeight/2+focusBoxHeight/2,maxPedestal=+allMapsHeight/2-focusBoxHeight/2,paddingBox=focusBox.clone(),canvasWidth=_this6.mapView.canvasWidth,canvasHeight=_this6.mapView.canvasHeight;if(_this6.padding.top+_this6.padding.bottom<canvasHeight){var topPaddingRatio=canvasHeight/(canvasHeight-_this6.padding.top);paddingBox.max.z=focusBox.min.z+focusBoxHeight*topPaddingRatio;var topPedestalShift=focusBoxHeight/2*topPaddingRatio-focusBoxHeight/2;maxPedestal+=topPedestalShift,minPedestal+=topPedestalShift;var bottomPaddingRatio=canvasHeight/(canvasHeight-_this6.padding.bottom);paddingBox.min.z=focusBox.max.z-focusBoxHeight*bottomPaddingRatio;var bottomPedestalShift=focusBoxHeight/2*bottomPaddingRatio-focusBoxHeight/2;maxPedestal-=bottomPedestalShift,minPedestal-=bottomPedestalShift}else console.warn("top + bottom padding cannot exceed canvas height, ignoring");if(_this6.padding.left+_this6.padding.right<canvasWidth){var leftPaddingRatio=canvasWidth/(canvasWidth-_this6.padding.left);paddingBox.min.x=focusBox.max.x-focusBoxWidth*leftPaddingRatio;var rightPaddingRatio=canvasWidth/(canvasWidth-_this6.padding.right);paddingBox.max.x=focusBox.min.x+focusBoxWidth*rightPaddingRatio}else console.warn("left + right padding cannot exceed canvas width, ignoring");var paddingBoxWidth=paddingBox.max.x-paddingBox.min.x,paddingBoxHeight=paddingBox.max.z-paddingBox.min.z,cameraX=paddingBox.min.x+paddingBoxWidth/2,cameraZ=paddingBox.min.z+paddingBoxHeight/2,FOV=_this6.mapView.controls.camera.fov;if(_this6.debug){_this6.removeHelperBoundingBoxes();var boxHelper=new Box3Helper(focusBox,16711680);_this6.object.add(boxHelper),_this6._helperBoundingBoxes.push(boxHelper);var boxHelper2=new Box3Helper(paddingBox,16776960);_this6.object.add(boxHelper2),_this6._helperBoundingBoxes.push(boxHelper2)}_this6.mapView.controls.minPedestal=minPedestal,_this6.mapView.controls.maxPedestal=maxPedestal;var zoomY=getZoom(paddingBox,paddingBoxHeight,FOV),zoomX=getZoom(paddingBox,paddingBoxWidth,FOV*_this6.mapView.controls.camera.aspect),zoom=Math.max(zoomX,zoomY);_this6.mapView.controls.expandZoomLimits(zoom);var target={zoom:zoom,rotation:0,position:{x:cameraX,y:0,z:cameraZ}},tween=_this6.mapView.controls.animateCamera(target,duration,curve,(function(){_this6.tween=tween,resolve(_this6.tween)}))}))}},{key:"getFocusMaps",value:function(start,dir,len){var focusMaps=this.maps.slice(0);return len<this.maps.length&&(start===START_TOP?focusMaps=focusMaps.slice(0,len):start===START_BOTTOM?focusMaps=focusMaps.slice(-len):"number"==typeof start&&(dir===DIR_DOWN?focusMaps=focusMaps.slice(start,start+len):dir===DIR_UP&&(focusMaps=focusMaps.slice(Math.max(start+1-len,0),start+1)))),focusMaps}},{key:"getFocusBox",value:function(){var stackBox=getMapsBoundingBox(this.maps,this.mapSpacing),stackBoxHeight=stackBox.max.z-stackBox.min.z,focusBox=this._focusBox.clone(),fbHeight=this._focusBox.max.z-this._focusBox.min.z,minPedestal=stackBox.min.z+fbHeight/2,maxPedestal=stackBox.max.z-fbHeight/2,scrollPortion=(this.mapView.controls.getPedestal()-minPedestal)/(maxPedestal-minPedestal);return focusBox.min.z=stackBox.min.z+scrollPortion*(stackBoxHeight-fbHeight),focusBox.max.z=stackBox.min.z+fbHeight+scrollPortion*(stackBoxHeight-fbHeight),focusBox}},{key:"getVisibleMaps",value:function(){var focusBox=this.getFocusBox();return this.maps.filter((function(map){return focusBox.containsBox(getBoundingBox(map.object))}))}},{key:"getVisibleMapIds",value:function(){return this.getVisibleMaps().map((function(m){return m.id}))}},{key:"getVisibleMapIndices",value:function(){for(var focusBox=this.getFocusBox(),indices=[],i=0;i<this.maps.length;i++){var map=this.maps[i];focusBox.containsBox(getBoundingBox(map.object))&&indices.push(i)}return indices}},{key:"getMapsByIndices",value:function(indices){return this.maps.filter((function(map,idx){return indices.includes(idx)}))}},{key:"scrollMapsUp",value:function(){var nextMapIndices,firstVisibleMapIdx=this.getVisibleMapIndices()[0];if(firstVisibleMapIdx>0){var firstMapToShow=firstVisibleMapIdx-1;return nextMapIndices=_toConsumableArray(new Array(this._focusMapsLen)).map((function(item,idx){return firstMapToShow+idx})),this.focusOnMaps({mapIndices:nextMapIndices})}return Promise.resolve()}},{key:"scrollMapsDown",value:function(){var nextMapIndices,visibleMapIndices=this.getVisibleMapIndices(),lastVisibleMapIdx=visibleMapIndices[visibleMapIndices.length-1];if(lastVisibleMapIdx<this.maps.length-1){var lastMapToShow=lastVisibleMapIdx+1;return nextMapIndices=_toConsumableArray(new Array(this._focusMapsLen)).map((function(item,idx){return lastMapToShow-idx})).reverse(),this.focusOnMaps({mapIndices:nextMapIndices})}return Promise.resolve()}},{key:"resize",value:function(){this.focusOnMaps()}},{key:"destroy",value:function(){this.removeMaps(),this.debug&&(this.removeMapBoundingBoxes(),this.removeHelperBoundingBoxes()),this.mapView.setViewState(VIEW_STATE.SINGLE_FLOOR),this.mapView.controls.setPosition(0,0),this.mapView.controls.setPedestal(0)}},{key:"viewPortHeight",get:function(){return this.mapView.canvasHeight-this.padding.top-this.padding.bottom}},{key:"viewPortWidth",get:function(){return this.mapView.canvasWidth-this.padding.left-this.padding.right}},{key:"mapTiltDegrees",get:function(){return 180*this.mapTilt/Math.PI},set:function(mapTiltDeg){this.mapTilt=mapTiltDeg*Math.PI/180,this.positionMaps(),this.debug&&(this.removeMapBoundingBoxes(),this.addMapBoundingBoxes())}},{key:"projections",get:function(){return _ref={maps:this.maps,width:this.mapView.canvasWidth,height:this.mapView.canvasHeight,camera:this.mapView.controls.camera},maps=_ref.maps,width=_ref.width,height=_ref.height,camera=_ref.camera,maps.map((function(mapObject){for(var minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,points=unpackBoundingBox(getBoundingBox(mapObject.object)),i=0;i<points.length;i++){var point=points[i],twoDPoint={x:((point=point.project(camera)).x+1)/2*width,y:(1-point.y)/2*height};minX=Math.min(twoDPoint.x,minX),minY=Math.min(twoDPoint.y,minY),maxX=Math.max(twoDPoint.x,maxX),maxY=Math.max(twoDPoint.y,maxY)}return{min:{x:minX,y:minY},max:{x:maxX,y:maxY}}}));var _ref,maps,width,height,camera}},{key:"bottomMapVisible",get:function(){var bottomMap=this.maps[this.maps.length-1];return this.getVisibleMaps().includes(bottomMap)}},{key:"topMapVisible",get:function(){var topMap=this.maps[0];return this.getVisibleMaps().includes(topMap)}}]),MultiFloorView}();function sortByElevation(maps){return maps.sort((function(a,b){return b.mapClass.elevation-a.mapClass.elevation}))}var getNewPanBounds=function(panBounds,mapObject){var min=panBounds.min,max=panBounds.max,margin=panBounds.margin;margin||(margin=1);var box=mapObject.boundingBox;box||(box=(new Box3).setFromObject(mapObject.object),mapObject.boundingBox=box);var newPanBounds={min:{},max:{},margin:margin};newPanBounds.min.x=Math.min(min.x,box.min.x*margin),newPanBounds.max.x=Math.max(max.x,box.max.x*margin),newPanBounds.min.y=Math.min(min.y,box.min.y*margin),newPanBounds.max.y=Math.max(max.y,box.max.y*margin);var newCenter_x=(newPanBounds.max.x+newPanBounds.min.x)/2,newCenter_y=(newPanBounds.max.y+newPanBounds.min.y)/2,newRadius=Math.sqrt(Math.pow(newPanBounds.max.x-newCenter_x,2)+Math.pow(newPanBounds.max.y-newCenter_y,2));if(newPanBounds.radius=newRadius,"function"==typeof panBounds.getCenter){var center=new Vector3;newPanBounds.center=panBounds.getCenter(center)}else newPanBounds.center=panBounds.center;return newPanBounds.margin=margin,newPanBounds},MapManager=function(){function MapManager(polygonMeshesById,markerWorld,renderer,mapView,taskScheduler){var loadOptions=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};_classCallCheck(this,MapManager),this.mapObjects=new Map,this.currentMap=void 0,this.object=new Object3D,this._showCount=0,this._mapObjectsSortedByElevationDirty=!1,this.expanded=!1,Object.assign(this,PubSub.prototype),this.polygonMeshesById=polygonMeshesById,this.markerWorld=markerWorld,this.mapView=mapView,this.renderer=renderer,this.loadOptions=loadOptions,this._loadMethod=loadOptions.mode,this.addMap=this.addMap.bind(this),this.setMap=this.setMap.bind(this),this.removeMap=this.removeMap.bind(this),this.removeAllMaps=this.removeAllMaps.bind(this),this.loadMaps=this.loadMaps.bind(this),this.expandMaps=this.expandMaps.bind(this),this.contractMaps=this.contractMaps.bind(this),this.expandPanBounds=this.expandPanBounds.bind(this),this.loadOptions.taskScheduler=taskScheduler}return _createClass(MapManager,[{key:"expandPanBounds",value:function(bounds){this.mapView.controls.panBounds=getNewPanBounds(bounds,this.currentMap)}},{key:"addMap",value:function(mapClass){var _this=this,callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._mapObjectsSortedByElevationDirty=!0;var mapObject=new MapObject(mapClass,this.polygonMeshesById,this.markerWorld,this._showCount,this.mapView,this.loadOptions);return mapObject.on("flippablesNeedUpdating",(function(value){return _this.publish("flippablesNeedUpdating",value)})),mapObject.on("render",(function(value){return _this.publish("render",value)})),mapObject.on("updateMarkerPosition",(function(marker){return _this.publish("updateMarkerPosition",marker)})),this.mapObjects.set(mapClass.id,mapObject),null==this.currentMap?(this.setMap(mapClass),mapObject.load().then(callback)):Promise.resolve().then(callback)}},{key:"setMap",value:function(mapClassOrId,callback){var _this2=this;this.setMapCallbacks||(this.setMapCallbacks=[]);var mapId=getObjectId(mapClassOrId);return callback&&this.setMapCallbacks.push(callback),new Promise((function(resolve,reject){if(_this2.mapObjects.has(mapId)){null!=_this2.currentMap&&(_this2.currentMap.textObjects.forEach((function(obj){obj instanceof SmartLabel&&obj.hide()})),_this2.currentMap.removeMarkers(),_this2.object.remove(_this2.currentMap.object)),_this2.currentMap=_this2.mapObjects.get(mapId),_this2.currentMap.addPendingMapLoadedTask("resolveSetMap",(function(){resolve(),_this2.setMapCallbacks.forEach((function(cb){return cb()})),_this2.setMapCallbacks=[]}));var loadingId=_this2.currentMap.mapClass.id;_this2.mapView.controls.zoomFactor=_this2.mapView.getMapScale()/7.9,_this2.currentMap.load().then((function(mapObject){if(!_this2.currentMap||_this2.currentMap.mapClass.id===mapObject.mapClass.id){mapObject.seenByCamera||(mapObject.seenByCamera=!0,mapObject._popinChildObjects());var newPanBounds=getNewPanBounds(_this2.mapView.controls.panBounds,_this2.currentMap);_this2.mapView.controls.panBounds=newPanBounds;var zoom=_this2.mapView.getZoomLevelForCurrentMap();_this2.mapView.controls.expandZoomLimits(zoom),_this2.object.add(_this2.currentMap.object),_this2.currentMap.addMarkers(),_this2.currentMap.textObjects.forEach((function(obj){return obj.show()})),_this2.publish("flippablesNeedUpdating",!0),_this2.publish("render")}})).catch((function(e){console.error("Error loading map ",loadingId,e)}))}else{var e={error:"Map does not exist"};console.error(e.error),_this2.setMapCallbacks.forEach((function(cb){return cb(e)})),_this2.setMapCallbacks=[],reject(e)}}))}},{key:"loadMaps",value:function(maps,startingMap){for(var _this3=this,onFirstMapLoaded=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},onDataLoaded=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},onError=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},startingMapId=getObjectId(startingMap),idx=0;idx<maps.length;idx++){var mapClass=maps[idx],mapObject=new MapObject(mapClass,this.polygonMeshesById,this.markerWorld,this._showCount,this.mapView,this.loadOptions);mapObject.on("flippablesNeedUpdating",(function(value){return _this3.publish("flippablesNeedUpdating",value)})),mapObject.on("render",(function(value){return _this3.publish("render",value)})),mapObject.on("updateMarkerPosition",(function(marker){return _this3.publish("updateMarkerPosition",marker)})),mapObject.on("texture-loaded",(function(texture){return _this3.publish("texture-loaded",texture)})),this.mapObjects.set(mapClass.id,mapObject),mapClass.id===startingMapId&&(mapObject.load().then((function(){_this3.mapView.resetCamera(),onDataLoaded()})).catch(onError),this.setMap(mapClass,onFirstMapLoaded))}}},{key:"removeMap",value:function(mapClassOrId){this._mapObjectsSortedByElevationDirty=!0;var mapId=getObjectId(mapClassOrId);if(this.mapObjects.has(mapId)){var mapObject=this.mapObjects.get(mapId);this.currentMap===mapObject&&(this.currentMap=null),mapObject.off("flippablesNeedUpdating"),mapObject.off("render"),mapObject.destroy(),this.mapObjects.delete(mapId)}this.renderer.renderLists.dispose()}},{key:"removeAllMaps",value:function(){this._mapObjectsSortedByElevationDirty=!0;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.mapObjects.values()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var mapObject=_step.value;mapObject.destroy(),mapObject=null}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this.mapObjects.clear()}},{key:"getCompoundBoundingBoxPoints",value:function(objects){this.mapView.controls.orbit.updateMatrixWorld();var camMatrixInverse=this.mapView.controls.camera.matrixWorld,camMatrix=this.mapView.controls.camera.matrixWorldInverse,newMin=new Vector3(1/0,1/0,1/0),newMax=new Vector3(-1/0,-1/0,-1/0);objects.forEach((function(object){object.applyMatrix(camMatrix),unpackBoundingBox(getBoundingBox(object)).forEach((function(pt){newMin.min(pt),newMax.max(pt)})),object.applyMatrix(camMatrixInverse)}));var newPoints=unpackBoundingBox({min:newMin,max:newMax});return newPoints.forEach((function(pt){return pt.applyMatrix4(camMatrixInverse)})),newPoints}},{key:"expandMaps",value:function(mapsToExpand,options){var mapNotFoundError,_this4=this,_options=_objectSpread2({focus:!1,debug:!1,rotation:0,duration:600},options);if(this.expanded)return Promise.resolve({maps:this.renderedMaps,projections:this.projections});if(!Array.isArray(mapsToExpand))return Promise.reject("Maps to expand are not an array");var maps=mapsToExpand.map((function(mapObject){var mapId="string"!=typeof mapObject&&null!=mapObject.id?mapObject.id:mapObject;if("string"!=typeof mapObject&&!0===mapObject.connection&&Array.isArray(mapObject.maps)){var mapGroup=mapObject.maps.map((function(connectionMap){var mapId="string"!=typeof connectionMap?connectionMap.id:connectionMap;return _this4.mapObjects.has(mapId)||(console.error("Expand maps: > Map ".concat(mapId," does not exist")),mapNotFoundError="Expand maps: > Map ".concat(mapId," does not exist")),_this4.mapObjects.get(mapId)}));mapGroup=sortByElevation(mapGroup);var geometry=new PlaneGeometry(1,1,1);!0===options.debug&&(geometry=new PlaneGeometry(500,500,10));var material=new MeshBasicMaterial({color:11184810});return{connection:!0,object:new Mesh(geometry,material),connectionNodes:mapObject.connectionNodes,mapClass:{elevation:mapGroup[0].mapClass.elevation},maps:mapGroup}}if(_this4.mapObjects.has(mapId))return _this4.mapObjects.get(mapId);console.error("Expand maps: > Map ".concat(mapId," does not exist")),mapNotFoundError="Expand maps: Map ".concat(mapId," does not exist")}));if(null!=mapNotFoundError)return Promise.reject(mapNotFoundError);var loadedMaps=(maps=sortByElevation(maps)).map((function(mapObject){return mapObject.connection&&Array.isArray(mapObject.maps)?Promise.all(mapObject.maps.map((function(m){return m.load()}))):mapObject.load()}));return Promise.all(loadedMaps).then((function(){return _this4.expanded=!0,_this4.multiFloorView=new MultiFloorView(_this4.mapView,_this4.object,maps,_options),_this4.multiFloorView.focusOnMaps(_options)})).then((function(){return _this4.renderedMaps=maps,_this4.projections=_this4.multiFloorView.projections,Promise.resolve({maps:maps,projections:_this4.projections})}))}},{key:"contractMaps",value:function(){var _this5=this,options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{focus:!1,debug:!1,duration:300};if(!this.expanded)return Promise.resolve();this.expanded=!1,this.multiFloorView.destroy(),this.object.add(this.currentMap.object),this.publish("render");var newPanBounds=getNewPanBounds(this.mapView.controls.panBounds,this);this.mapView.controls.panBounds=newPanBounds;var zoom=this.mapView.getZoomLevelForObject(this.object);return this.mapView.controls.expandZoomLimits(zoom),new Promise((function(resolve){options.focus?_this5.mapView.focusOn({boundingBox:getBoundingBox(_this5.object),padding:_this5.mapView.cachedPadding,debug:options.debug,duration:options.duration,focusZoomFactor:1,callback:resolve,tilt:.3}):resolve()}))}},{key:"mapsFullyLoaded",value:function(){var callback=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},loadedMaps=_toConsumableArray(this.mapObjects.values()).map((function(mapObject){return mapObject.connection&&Array.isArray(mapObject.maps)?Promise.all(mapObject.maps.map((function(m){return m._loaderPromise}))):mapObject._loaderPromise}));return Promise.all(loadedMaps).then(callback)}},{key:"scrollMapsUp",value:function(){return this.multiFloorView?this.multiFloorView.scrollMapsUp():(console.warn("scrollMapsUp() not supported unless multifloor is active"),Promise.reject())}},{key:"scrollMapsDown",value:function(){return this.multiFloorView?this.multiFloorView.scrollMapsDown():(console.warn("scrollMapsDown() not supported unless multifloor is active"),Promise.reject())}},{key:"tiltMaps",value:function(tilt){this.multiFloorView&&(this.multiFloorView.mapTiltDegrees=tilt)}},{key:"resize",value:function(){null!=this.multiFloorView&&this.multiFloorView.resize()}},{key:"destroy",value:function(){this.removeAllMaps(),this.object.destroy()}},{key:"mapObjectsSortedByElevation",get:function(){return!this._mapObjectsSortedByElevationDirty&&Array.isArray(this._mapObjectsSortedByElevation)||(this._mapObjectsSortedByElevation=Array.from(this.mapObjects.values()).sort((function(mapObjectA,mapObjectB){return mapObjectB.mapClass.elevation-mapObjectA.mapClass.elevation})),this._mapObjectsSortedByElevationDirty=!1),this._mapObjectsSortedByElevation}},{key:"visibleMaps",get:function(){return this.mapObjectsSortedByElevation.filter((function(mapObject){return mapObject.visible}))}}]),MapManager}(),PathColliderPoint=function(){function PathColliderPoint(_ref){var vector=_ref.vector,mapObject=_ref.mapObject,canvasWidth=_ref.canvasWidth,canvasHeight=_ref.canvasHeight,cameraObject=_ref.cameraObject,collider=_ref.collider;_classCallCheck(this,PathColliderPoint),this.width=25,this.height=25,this.x=0,this.y=0,this.cameraObject=cameraObject,this.vector=vector,this.mapObject=mapObject,this.canvasHeight=canvasHeight,this.canvasWidth=canvasWidth,this.collider=collider,this.update=this.update.bind(this)}return _createClass(PathColliderPoint,[{key:"update",value:function(_ref2){var canvasWidth=_ref2.canvasWidth,canvasHeight=_ref2.canvasHeight;this.canvasWidth=canvasWidth,this.canvasHeight=canvasHeight;var projection=this.vector.clone().applyMatrix4(this.mapObject.object.matrix).project(this.cameraObject),x=(projection.x+1)/2*this.canvasWidth-this.width/2,y=(1-projection.y)/2*this.canvasHeight-this.height/2,distanceFromCamera=projection.z;this.x=x,this.y=y,this.distanceFromCamera=distanceFromCamera}}]),PathColliderPoint}(),PathCollider=function(){function PathCollider(_ref){var collisionEngine=_ref.collisionEngine,cameraObject=_ref.cameraObject,canvasWidth=_ref.canvasWidth,canvasHeight=_ref.canvasHeight;_classCallCheck(this,PathCollider),this.pathSegments=new Map,this.collisionEngine=collisionEngine,this.cameraObject=cameraObject,this.canvasWidth=canvasWidth,this.canvasHeight=canvasHeight,this.add=this.add.bind(this),this.update=this.update.bind(this),this.remove=this.remove.bind(this),this.clear=this.clear.bind(this)}return _createClass(PathCollider,[{key:"add",value:function(pathSegment,vectorPoints,options){var _this=this,pathCollider=this.collisionEngine.add({rank:COLLISION_RANKING_TIERS.MEDIUM,userData:{type:"path"}}),mapObject=options.mapObject,pathPoints=vectorPoints.map((function(pt,idx){return new PathColliderPoint({vector:pt,cameraObject:_this.cameraObject,mapObject:mapObject,canvasWidth:_this.canvasWidth,canvasHeight:_this.canvasHeight,collider:pathCollider})}));this.pathSegments.set(pathSegment.id,{collider:pathCollider,points:pathPoints,mapObject:mapObject})}},{key:"remove",value:function(pathSegment){var segment=this.pathSegments.get(pathSegment.id);null!=segment&&(this.collisionEngine.remove(segment.collider),this.pathSegments.delete(pathSegment.id))}},{key:"clear",value:function(){var _this2=this;Array.from(this.pathSegments.values()).forEach((function(pathSegment){return _this2.collisionEngine.remove(pathSegment.collider)})),this.pathSegments.clear()}},{key:"update",value:function(_ref2){var canvasWidth=_ref2.canvasWidth,canvasHeight=_ref2.canvasHeight;this.canvasWidth=canvasWidth,this.canvasHeight=canvasHeight,Array.from(this.pathSegments.values()).forEach((function(_ref3){var collider=_ref3.collider,points=_ref3.points,mapObject=_ref3.mapObject,hitAreas={};points.forEach((function(pt,idx){pt.update({canvasWidth:canvasWidth,canvasHeight:canvasHeight}),hitAreas[idx]={collider:pt.collider,x:pt.x,y:pt.y,h:pt.height,w:pt.width}})),collider.updateHitAreas(hitAreas),collider.enabled=mapObject.visible}))}}]),PathCollider}();styleInject(".mappedin-connection-marker {\n  background-size: contain;\n  background-position: 50%;\n  background: #7ed321;\n  border-radius: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 2px solid white;\n  flex-shrink: 0;\n  z-index: 1; }\n");var SIZES_REGULAR="regular",SIZES_COMPACT="compact",ConnectionMarker=function(_Mappedin3DMarker){_inherits(ConnectionMarker,Marker);var _super=function(Derived){function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var result,Super=_getPrototypeOf(Derived);if(isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}(ConnectionMarker);function ConnectionMarker(connection,mapView,options){var _this,width,height,iconWidth,iconHeight;switch(_classCallCheck(this,ConnectionMarker),options.size){case SIZES_REGULAR:width=30,height=30,iconWidth=14,iconHeight=14;break;case SIZES_COMPACT:width=10,height=10;break;default:width=30,height=30,iconWidth=14,iconHeight=14}var _options=_objectSpread2({size:SIZES_REGULAR,scale:1,width:width,height:height,iconWidth:iconWidth,iconHeight:iconHeight},options),iconEl=drawSVGIcon({type:connection.type,direction:connection.direction,iconWidth:_options.iconWidth,iconHeight:_options.iconHeight,color:_options.color,scale:_options.scale}),position=mapView.convertTo3DMapPosition(connection);(_this=_super.call(this,mapView,{html:_options.size===SIZES_COMPACT?"<div></div>":iconEl,position:position,className:"mappedin-connection-marker",map:connection.map,options:{ignoreCollisions:!0}}))._handleOnTap=_this._handleOnTap.bind(_assertThisInitialized(_this)),_this.connection=connection;var style={width:"".concat(width*_options.scale,"px"),height:"".concat(height*_options.scale,"px"),"border-width":"".concat(2*_options.scale,"px")};return window.PointerEvent?_this.div.addEventListener("pointerup",_this._handleOnTap,!1):_this.div.addEventListener("click",_this._handleOnTap,!1),Object.assign(_this.div.style,style),_this}return _createClass(ConnectionMarker,[{key:"destroy",value:function(){window.PointerEvent?this.div.removeEventListener("pointerup",this._handleOnTap,!1):this.div.removeEventListener("click",this._handleOnTap,!1),_get(_getPrototypeOf(ConnectionMarker.prototype),"destroy",this).call(this)}},{key:"_handleOnTap",value:function(e){e.stopPropagation(),this.publish("tap",this.connection)}}]),ConnectionMarker}();styleInject(".mappedin-map-connection-layer-container {\n  pointer-events: none;\n  font-family: sans-serif;\n  -webkit-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 1px;\n  height: 1px; }\n\n.mappedin-map-connection-labels {\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  white-space: nowrap; }\n\n.mappedin-map-connection-layer {\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #969696;\n  flex-shrink: 0;\n  transform: rotateX(65.89015deg) rotateZ(-45.26367deg); }\n\n.mappedin-map-connection-bubble {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  background: rgba(255, 255, 255, 0.9);\n  color: black; }\n\n.mappedin-map-connection-label {\n  color: black;\n  font-weight: bold;\n  letter-spacing: 0.2px;\n  text-transform: uppercase; }\n\n.mappedin-destination-icon {\n  position: relative; }\n  .mappedin-destination-icon > div {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    top: -50%; }\n    .mappedin-destination-icon > div:last-child {\n      transform: scale(0.8); }\n\n.mappedin-departure-icon {\n  background: white;\n  padding: 2px;\n  border-radius: 100%; }\n");function validateDirections(directions){if(null==directions||null==directions.path)throw new Error("Navigator requires directions to be set");return!0}var MODES={SINGLEFLOOR:0,MULTIFLOOR_OVERVIEW:1,MULTIFLOOR_FOCUSED:2},Navigator=function(){function Navigator(mapView,mapManager,venue,canvasWidth,canvasHeight,camera){_classCallCheck(this,Navigator),this._virtualLayers=new Set,this._directions=void 0,this._navigationOptions=void 0,this.overviewVisible=!1,this.connectionMarkers=[],this.destinationMarker=null,this.mode=null,this.MODES=MODES,this.mapView=mapView,this.mapManager=mapManager,this.venue=venue,this.canvasWidth=canvasWidth,this.canvasHeight=canvasHeight,this.camera=camera,this.showOverview=this.showOverview.bind(this),this.hideOverview=this.hideOverview.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.setDirections=this.setDirections.bind(this),this.setOptions=this.setOptions.bind(this),this._drawVirtualLayer=this._drawVirtualLayer.bind(this),this._handleConnectionTap=this._handleConnectionTap.bind(this),this._drawConnectionMarkers=this._drawConnectionMarkers.bind(this),this._drawConnectionMarker=this._drawConnectionMarker.bind(this),this._drawDestinationMarker=this._drawDestinationMarker.bind(this),this._drawDepartureMarker=this._drawDepartureMarker.bind(this),this._removeConnectionMarkers=this._removeConnectionMarkers.bind(this),this.setScale()}return _createClass(Navigator,[{key:"_drawVirtualLayer",value:function(map){var _this=this;if(!0!==map.connection)return null;var el="";map.maps.map((function(map,index){var virtualLayerStyle=toStyleString({"margin-top":5*index+"px",width:"".concat(100*_this.scale,"px"),height:"".concat(100*_this.scale,"px")});el+='<div class="mappedin-map-connection-layer" style="'.concat(virtualLayerStyle,'"></div>')}));var connectionMaps=map.maps.map((function(m){return _this.venue.maps.find((function(map){return map.id===m.id}))})),labels=connectionMaps.length>1?"".concat(connectionMaps[0].shortName," - ").concat(connectionMaps[connectionMaps.length-1].shortName):connectionMaps[0].shortName,labelsStyle=toStyleString({width:"".concat(100*this.scale,"px"),height:"".concat(100*this.scale,"px"),"font-size":"".concat(30*this.scale,"px")}),iconEl=drawSVGIcon({type:map.connectionNodes[0].type,direction:map.connectionNodes[0].direction,iconWidth:14,iconHeight:14,scale:this.scale}),iconWrapperStyle=toStyleString({width:30*this.scale+"px",height:30*this.scale+"px"}),iconElWrapper='<div class="mappedin-connection-marker" style="'.concat(iconWrapperStyle,'">').concat(iconEl,"</div>"),bubbleStyle=toStyleString({height:46*this.scale+"px","padding-left":5*this.scale+"px","padding-right":5*this.scale+"px","border-radius":12*this.scale+"px"}),marginStyle=toStyleString({margin:5*this.scale+"px"}),labelStyle=toStyleString({margin:5*this.scale+"px","font-size":24*this.scale+"px"}),labelsEl='<div class="mappedin-map-connection-labels" style="'.concat(labelsStyle,'">\n\t\t\t\t<div class="mappedin-map-connection-bubble" style="').concat(bubbleStyle,'">\n\t\t\t\t<div style="').concat(marginStyle,'">').concat(iconElWrapper,'</div>\n\t\t\t\t<div class="mappedin-map-connection-label" style="').concat(labelStyle,'">').concat(labels,"</div>\n\t\t\t\t</div>\n\t\t\t</div>");map.maps[0].object.updateMatrixWorld();var marker=new Marker(this.mapView,{html:el+labelsEl,position:map.object.position,className:"mappedin-map-connection-layer-container",map:map.maps[0],options:{ignoreCollisions:!0}});return marker.setPosition(marker._mOriginalPosition.clone().add(map.object.position)),this.mapView.addMarker(marker),marker.show(),marker}},{key:"setDirections",value:function(directions){this._directions=directions}},{key:"setScale",value:function(){var scale=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.scale=scale}},{key:"_drawDepartureMarker",value:function(){var connectionNode=this.connections.find((function(n){return"departure"===n.type}));if(null!=connectionNode){var iconEl=drawSVGIcon({type:"start",iconWidth:14,iconHight:14,scale:this.scale,color:"black"}),mapObject=this.mapManager.mapObjects.get(connectionNode.map);mapObject.object.updateMatrixWorld();var style=toStyleString({width:"".concat(14*this.scale,"px"),height:"".concat(14*this.scale,"px")}),marker=this.mapView.createMarker('<div style="'.concat(style,'" class="mappedin-departure-icon">').concat(iconEl,"</div>"),this.mapView.convertTo3DMapPosition(connectionNode),"mappedin-departure__container",mapObject,{ignoreCollisions:!0,rotateWithCamera:!0});marker.div.style.zIndex=1,this.connectionMarkers.push(marker)}}},{key:"_drawDestinationMarker",value:function(){var connectionNode=this.connections.find((function(n){return"destination"===n.type}));if(null!=connectionNode){var _ref2,_ref2$width,width,_ref2$height,height,_ref2$color,color,_ref2$scale,scale,backIconEl,frontIconEl,style,iconEl=(_ref2={width:30,height:30,scale:this.scale,color:"red"},_ref2$width=_ref2.width,width=void 0===_ref2$width?14:_ref2$width,_ref2$height=_ref2.height,height=void 0===_ref2$height?14:_ref2$height,_ref2$color=_ref2.color,color=void 0===_ref2$color?"white":_ref2$color,_ref2$scale=_ref2.scale,backIconEl='<svg\n\t\t\theight="'.concat(width*(scale=void 0===_ref2$scale?1:_ref2$scale),'"\n\t\t\tviewBox="0 0 36 36"\n\t\t\twidth="').concat(height*scale,'"\n\t\t>\n\t\t\t<g fill="white">\n\t\t\t\t').concat(icons.get("destination-marker-back"),"\n\t\t\t</g>\n\t\t</svg>"),frontIconEl='<svg\n\t\t\theight="'.concat(width*scale,'"\n\t\t\tviewBox="0 0 36 36"\n\t\t\twidth="').concat(height*scale,'"\n\t\t>\n\t\t\t<g fill="').concat(color,'">\n\t\t\t\t').concat(icons.get("destination-marker-front"),"\n\t\t\t</g>\n\t\t</svg>"),style=toStyleString({width:width*scale+"px",height:height*scale+"px"}),'<div class="mappedin-destination-icon" style="'.concat(style,'">\n\t\t\t\t<div class="mappedin-destination-icon-back">').concat(backIconEl,'</div>\n\t\t\t\t<div class="mappedin-destination-icon-front">').concat(frontIconEl,"</div>\n\t\t\t</div>")),mapObject=this.mapManager.mapObjects.get(connectionNode.map);mapObject.object.updateMatrixWorld();var marker=this.mapView.createMarker(iconEl,this.mapView.convertTo3DMapPosition(connectionNode),"mappedin-destination__container",mapObject,{ignoreCollisions:!0});marker.div.style.zIndex=1,this.connectionMarkers.push(marker)}}},{key:"_drawConnectionMarker",value:function(connectionNode,size){var _this2=this,marker=new ConnectionMarker(connectionNode,this.mapView,{scale:this.scale,size:size}),mapObject=this.mapManager.mapObjects.get(connectionNode.map);return mapObject.object.updateMatrixWorld(),marker.setPosition(marker._mOriginalPosition.clone().add(mapObject.object.position)),mapObject.addPendingMarkerTask(marker,(function(){marker._mDeleted||(mapObject.markers.push(marker),_this2.mapView.addMarker(marker),marker.show())})),marker}},{key:"_drawConnectionMarkers",value:function(_ref){var _this3=this,_ref$mapIds=_ref.mapIds,mapIds=void 0===_ref$mapIds?[]:_ref$mapIds,_ref$compactEntranceM=_ref.compactEntranceMarkers,compactEntranceMarkers=void 0!==_ref$compactEntranceM&&_ref$compactEntranceM,_ref$size=_ref.size,size=void 0===_ref$size?SIZES_REGULAR:_ref$size;this.connectionMarkers=this.connections.filter((function(c){return(0===mapIds.length||mapIds.includes(c.map))&&"departure"!==c.type&&"destination"!==c.type})).map((function(n){var _size=compactEntranceMarkers&&n.isEntrance?SIZES_COMPACT:size;return _this3._drawConnectionMarker(n,_size)}))}},{key:"setOptions",value:function(options){this._options=_objectSpread2(_objectSpread2(_objectSpread2({},{hideLabels:!1,debug:!1,connectionsThreshold:100,combineSimilarConnections:!0,drawConnectionMarkers:!0,drawDestinationMarker:!0,drawDepartureMarker:!0,expandOptions:{},pathOptions:{connectionPathOptions:{}},focusOptions:{}}),this._options),options)}},{key:"showOverview",value:function(directions){var _this4=this,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!=directions&&this.setDirections(directions),this.setOptions(options);var cachedDirections=_objectSpread2({},this._directions);validateDirections(cachedDirections);var path=cachedDirections.path,startMap=cachedDirections.path[0].map,nextStep=function(){return Promise.resolve()};return this.mapView.removeAllPaths(),this._removeVirtualLayers(),this._removeConnectionMarkers(),(this.overviewVisible||this.mapManager.expanded)&&(nextStep=this.hideOverview),nextStep().then((function(){return _this4.mapView.setMap(startMap)})).then((function(){if(areMultiFloor(cachedDirections)){_this4._options.hideLabels&&_this4.mapView.hideAllLabels();var mapIdsInJourney=extractMapIdsFromPath(path),journey=extractMapIdsFromPath(path);if(mapIdsInJourney.length>2){var connectionMapIds=(journey=generateJourney(cachedDirections,_this4.mapManager.mapObjects,_this4._options.connectionsThreshold,_this4._options.combineSimilarConnections)).reduce((function(connectionMaps,map){return map.connection&&connectionMaps.push.apply(connectionMaps,_toConsumableArray(map.maps)),connectionMaps}),[]).map((function(m){return"string"==typeof m?m:m.id}));path=path.filter((function(n){return-1===connectionMapIds.indexOf(n.map)}))}var journeyMapObjects=journey.map((function(m){return!0===m.connection?m:_this4.mapManager.mapObjects.get(m)})),start=journeyMapObjects[0].mapClass.elevation>journeyMapObjects[journeyMapObjects.length-1].mapClass.elevation?"top":"bottom";return _this4.mapManager.expandMaps(journey,_objectSpread2({focus:!0,debug:_this4._options.debug,duration:_this4._options.animationDuration,start:start},_this4._options.expandOptions)).then((function(_ref2){var maps=_ref2.maps;_this4.mode=MODES.MULTIFLOOR_OVERVIEW,_this4.overviewVisible=!0,_this4.renderedMaps=maps,_this4.connections=generateConnections(cachedDirections,_this4.mapManager.mapObjects),_this4._options.drawConnectionMarkers&&_this4._drawConnectionMarkers({compactEntranceMarkers:!0,mapIds:_this4.renderedMaps.map((function(m){return m.id})).filter((function(x){return x}))});var _this4$_virtualLayers,markers=_this4.renderedMaps.map(_this4._drawVirtualLayer).filter((function(x){return x}));markers.length>0&&(_this4$_virtualLayers=_this4._virtualLayers).add.apply(_this4$_virtualLayers,_toConsumableArray(markers));_this4.mapView.drawPath(path,_this4._options.pathOptions),_this4._options.drawDestinationMarker&&_this4._drawDestinationMarker(),_this4._options.drawDepartureMarker&&_this4._drawDepartureMarker()}))}_this4.mode=MODES.SINGLEFLOOR,_this4.mapView.drawPath(path,_this4._options.pathOptions);var focusOptions=Object.assign({},_this4._options.focusOptions);return focusOptions.nodes=path,_this4.mapView.focusOn(focusOptions),_this4.connections=generateConnections(cachedDirections,_this4.mapManager.mapObjects),_this4._options.drawDestinationMarker&&_this4._drawDestinationMarker(),_this4._options.drawDepartureMarker&&_this4._drawDepartureMarker(),Promise.resolve()}))}},{key:"hideOverview",value:function(){var _this5=this;return this.mapView.removeAllPaths(),this._removeVirtualLayers(),this._removeConnectionMarkers(),this.mapManager.contractMaps({focus:!0}).then((function(){return _this5.overviewVisible=!1,_this5.mode=null,Promise.resolve()}))}},{key:"_handleConnectionTap",value:function(connectionMarker){var _this6=this,enterMap=connectionMarker.exitMap;"function"==typeof this.onConnectionClicked&&this.onConnectionClicked({mapId:enterMap})||this.zoomOut().then((function(){return _this6.zoomIn(enterMap)}))}},{key:"zoomIn",value:function(mapObjectOrId){var _this7=this,mapId=getObjectId(mapObjectOrId);validateDirections(this._directions);var cachedDirections=_objectSpread2({},this._directions);return this.mapView.removeAllPaths(),this._removeConnectionMarkers(),this._removeVirtualLayers(),this.mapView.setMap(mapId).then((function(){return _this7.mapManager.contractMaps({focus:!0})})).then((function(){_this7.mapView.drawPath(cachedDirections.path,_objectSpread2(_objectSpread2({},_this7._options.pathOptions),{},{drawConnectionSegments:!1}));var focusOptions=Object.assign({},_this7._options.focusOptions);return focusOptions.nodes=cachedDirections.path.filter((function(n){return n.map===mapId})),_this7.mapView.focusOn(focusOptions),_this7._options.drawConnectionMarkers&&_this7._drawConnectionMarkers({mapIds:[mapId],compactEntranceMarkers:!0}),_this7._options.drawDestinationMarker&&_this7._drawDestinationMarker(),_this7._options.drawDepartureMarker&&_this7._drawDepartureMarker(),_this7.connectionMarkers.forEach((function(m){m.on("tap",_this7._handleConnectionTap)})),_this7.overviewVisible=!1,_this7.mode=MODES.MULTIFLOOR_FOCUSED,Promise.resolve()}))}},{key:"reset",value:function(){this._options={},this._removeConnectionMarkers(),this.mapView.removeAllPaths()}},{key:"_removeConnectionMarkers",value:function(){var _this8=this;this.connectionMarkers.forEach((function(m){_this8.mapView.removeMarker(m)})),this.connectionMarkers=[]}},{key:"zoomOut",value:function(){return validateDirections(this._directions),this.mapView.removeAllPaths(),this._removeConnectionMarkers(),this.showOverview()}},{key:"_removeVirtualLayers",value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._virtualLayers[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var layer=_step.value;this.mapView.removeMarker(layer)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this._virtualLayers.clear()}},{key:"projections",get:function(){return this.mapManager.projections}}]),Navigator}();styleInject(".mappedin-tooltip__wrapper {\n  display: flex;\n  width: 1px;\n  height: 1px;\n  align-items: center;\n  justify-content: center;\n  z-index: 1; }\n\n.mappedin-tooltip {\n  top: 0;\n  transition: transform 300ms linear;\n  position: absolute;\n  font-weight: bold;\n  color: black;\n  position: absolute;\n  z-index: 1;\n  transition: opacity 300ms;\n  display: flex;\n  flex-direction: row;\n  will-change: opacity;\n  justify-content: center; }\n  .mappedin-tooltip > div {\n    flex-shrink: 0;\n    max-width: 500px;\n    background: white;\n    padding: 10px;\n    border-radius: 20px;\n    box-shadow: 0px 2px 11px rgba(0, 0, 0, 0.2); }\n  .mappedin-tooltip:before {\n    content: '';\n    width: 0;\n    height: 0;\n    top: calc(50% - 10px);\n    left: -10px;\n    position: absolute;\n    border-bottom: 10px solid transparent;\n    border-top: 10px solid transparent; }\n  .mappedin-tooltip.tooltip--anchor-top {\n    left: 0px;\n    top: 0px; }\n    .mappedin-tooltip.tooltip--anchor-top:before {\n      left: calc(50% - 10px);\n      top: calc(100% - 5px);\n      right: auto;\n      border-bottom: 10px solid transparent;\n      border-top: 10px solid white;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent; }\n  .mappedin-tooltip.tooltip--anchor-bottom {\n    left: 0px;\n    top: 0px; }\n    .mappedin-tooltip.tooltip--anchor-bottom:before {\n      left: calc(50% - 10px);\n      top: -15px;\n      right: auto;\n      border-bottom: 10px solid white;\n      border-top: 10px solid transparent;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent; }\n  .mappedin-tooltip.tooltip--anchor-right {\n    justify-content: flex-start;\n    left: 0px;\n    top: 0px; }\n    .mappedin-tooltip.tooltip--anchor-right:before {\n      left: -5px;\n      right: auto;\n      border-right: 10px solid white; }\n  .mappedin-tooltip.tooltip--anchor-left {\n    left: 0px;\n    top: 0px; }\n    .mappedin-tooltip.tooltip--anchor-left:before {\n      left: auto;\n      right: -5px;\n      border-left: 10px solid white; }\n  .mappedin-tooltip.tooltip--anchor-top-left {\n    left: 7px;\n    top: 7px; }\n    .mappedin-tooltip.tooltip--anchor-top-left:before {\n      left: auto;\n      right: -7px;\n      top: calc(100% - 13px);\n      border-bottom: 10px solid transparent;\n      border-top: 10px solid white;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent;\n      transform: rotate(-45deg); }\n  .mappedin-tooltip.tooltip--anchor-top-right {\n    left: -6px;\n    top: 7px; }\n    .mappedin-tooltip.tooltip--anchor-top-right:before {\n      left: -7px;\n      right: auto;\n      top: calc(100% - 13px);\n      border-bottom: 10px solid transparent;\n      border-top: 10px solid white;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent;\n      transform: rotate(45deg); }\n  .mappedin-tooltip.tooltip--anchor-bottom-left {\n    left: 7px;\n    top: -6px; }\n    .mappedin-tooltip.tooltip--anchor-bottom-left:before {\n      left: auto;\n      right: -7px;\n      top: -7px;\n      border-bottom: 10px solid white;\n      border-top: 10px solid transparent;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent;\n      transform: rotate(45deg); }\n  .mappedin-tooltip.tooltip--anchor-bottom-right {\n    left: -6px;\n    top: -6px; }\n    .mappedin-tooltip.tooltip--anchor-bottom-right:before {\n      left: -7px;\n      right: auto;\n      top: -7px;\n      border-bottom: 10px solid white;\n      border-top: 10px solid transparent;\n      border-left: 10px solid transparent;\n      border-right: 10px solid transparent;\n      transform: rotate(-45deg); }\n  .mappedin-tooltip.tooltip--visible {\n    opacity: 1; }\n");var ANCHOR_RIGHT="RIGHT",ANCHOR_LEFT="LEFT",ANCHOR_TOP="TOP",ANCHOR_BOTTOM="BOTTOM",ANCHOR_BOTTOM_RIGHT="BOTTOM_RIGHT",ANCHOR_BOTTOM_LEFT="BOTTOM_LEFT",ANCHOR_TOP_RIGHT="TOP_RIGHT",ANCHOR_TOP_LEFT="TOP_LEFT",ANCHOR_PRIORITY_ORDER=[ANCHOR_TOP,ANCHOR_BOTTOM,ANCHOR_LEFT,ANCHOR_RIGHT,ANCHOR_TOP_LEFT,ANCHOR_TOP_RIGHT,ANCHOR_BOTTOM_LEFT,ANCHOR_BOTTOM_RIGHT],Tooltip=function(){function Tooltip(_ref,mapView,collisionEngine){var _this$_enabledAnchorT,html=_ref.html,contentHtml=_ref.contentHtml,text=_ref.text,position=_ref.position,map=_ref.map,_ref$padding=_ref.padding,padding=void 0===_ref$padding?35:_ref$padding,selector=_ref.selector,defaultAnchorType=_ref.defaultAnchorType,enabledAnchorTypes=_ref.enabledAnchorTypes,collisionRank=_ref.collisionRank;_classCallCheck(this,Tooltip),this._enabledAnchorTypes=(_defineProperty(_this$_enabledAnchorT={},ANCHOR_RIGHT,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_LEFT,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_BOTTOM,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_TOP,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_BOTTOM_RIGHT,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_BOTTOM_LEFT,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_TOP_RIGHT,!0),_defineProperty(_this$_enabledAnchorT,ANCHOR_TOP_LEFT,!0),_this$_enabledAnchorT),this._hidden=!1,this._collisionRank=COLLISION_RANKING_TIERS.HIGH,this._defaultAnchorType=ANCHOR_LEFT,this._updateSize=this._updateSize.bind(this),this._updateCollisions=this._updateCollisions.bind(this),this._updatePosition=this._updatePosition.bind(this),this._setAnchorType=throttle(this._setAnchorType.bind(this),250),this.updateContent=this.updateContent.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.mapView=mapView,this._padding=padding,this._collisionRank=null!=collisionRank?collisionRank:this._collisionRank,this._defaultAnchorType=defaultAnchorType||ANCHOR_LEFT,this._enabledAnchorTypes=_objectSpread2(_objectSpread2(_objectSpread2({},this._enabledAnchorTypes),enabledAnchorTypes),{},_defineProperty({},defaultAnchorType,!0)),this.anchor=new Marker(mapView,{html:html||'<div class="mappedin-tooltip"><div class="mappedin-tooltip__content">'.concat(text||contentHtml,"</div></div>"),position:position,className:"mappedin-tooltip__wrapper",map:map,collisionEngine:collisionEngine,collisionRank:collisionRank,ignoreCollisions:!0,lockToAnchor:!0,userData:{type:"tooltip",tiebreakerRank:Math.random()}});var tooltipSelector=html?selector:".mappedin-tooltip";this._wrapperEl=this.anchor.div.querySelector(tooltipSelector),this._el=this._wrapperEl.firstElementChild,this.anchor.on("show",this._updateSize),this.anchor.on("collision",this._updateCollisions)}return _createClass(Tooltip,[{key:"_updateCollisionAreas",value:function(){var _areas,w=this.width,h=this.height,padding=this._padding,top={w:w,h:h,x:-w/2,y:-h-padding},left={w:w,h:h,x:-w-padding,y:-h/2},bottom={w:w,h:h,x:-w/2,y:0+padding},right={w:w,h:h,x:0+padding,y:-h/2},diagonal=this._padding/2,bottomRight={w:w,h:h,x:0+diagonal,y:0+diagonal},bottomLeft={w:w,h:h,x:-w-diagonal,y:0+diagonal},topRight={w:w,h:h,x:0+diagonal,y:-h-diagonal},topLeft={w:w,h:h,x:-w-diagonal,y:-h-diagonal},areas=(_defineProperty(_areas={},ANCHOR_BOTTOM,bottom),_defineProperty(_areas,ANCHOR_TOP,top),_defineProperty(_areas,ANCHOR_LEFT,left),_defineProperty(_areas,ANCHOR_RIGHT,right),_defineProperty(_areas,ANCHOR_BOTTOM_RIGHT,bottomRight),_defineProperty(_areas,ANCHOR_BOTTOM_LEFT,bottomLeft),_defineProperty(_areas,ANCHOR_TOP_RIGHT,topRight),_defineProperty(_areas,ANCHOR_TOP_LEFT,topLeft),_areas);bottom.occupied=null==this._anchorType||this._anchorType===ANCHOR_BOTTOM,top.occupied=null==this._anchorType||this._anchorType===ANCHOR_TOP,left.occupied=null==this._anchorType||this._anchorType===ANCHOR_LEFT,right.occupied=null==this._anchorType||this._anchorType===ANCHOR_RIGHT,bottomRight.occupied=null==this._anchorType||this._anchorType===ANCHOR_BOTTOM_RIGHT,bottomLeft.occupied=null==this._anchorType||this._anchorType===ANCHOR_BOTTOM_LEFT,topRight.occupied=null==this._anchorType||this._anchorType===ANCHOR_TOP_RIGHT,topLeft.occupied=null==this._anchorType||this._anchorType===ANCHOR_TOP_LEFT,this.anchor.setCollisionAreas(areas)}},{key:"_updateSize",value:function(){var _this$_el$getBounding=this._el.getBoundingClientRect(),w=_this$_el$getBounding.width,h=_this$_el$getBounding.height;this.width=w,this.height=h,this._updatePosition(),this._updateCollisionAreas()}},{key:"_updateCollisions",value:function(collisions){var _this=this,availableOrientations={},orientationPathCollisionCount={};for(var orientation in this._enabledAnchorTypes)this._enabledAnchorTypes[orientation]&&(availableOrientations[orientation]="open",orientationPathCollisionCount[orientation]=0);for(var _orientation in collisions)if(_orientation in availableOrientations){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=collisions[_orientation][Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var collision=_step.value;"tooltip"===collision.collider.userData.type?collision.collider.occupied&&collision.hitArea.occupied&&this.anchor.userData.tiebreakerRank<collision.collider.userData.tiebreakerRank&&(availableOrientations[_orientation]="tooltip"):"offscreen"===collision.collider.userData.type?"tooltip"!==availableOrientations[_orientation]&&(availableOrientations[_orientation]="offscreen"):"path"===collision.collider.userData.type&&("tooltip"!==availableOrientations[_orientation]&&"offscreen"!==availableOrientations[_orientation]&&(availableOrientations[_orientation]="path"),++orientationPathCollisionCount[_orientation])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}var hasOrientation=!1,selectOrientationByAvailability=function(availability){for(var minimumCollisionCount=1/0,minimumCollisionOrientation=null,_i=0,_ANCHOR_PRIORITY_ORDE=ANCHOR_PRIORITY_ORDER;_i<_ANCHOR_PRIORITY_ORDE.length;_i++){var _orientation2=_ANCHOR_PRIORITY_ORDE[_i];availableOrientations[_orientation2]===availability&&orientationPathCollisionCount[_orientation2]<minimumCollisionCount&&(minimumCollisionCount=orientationPathCollisionCount[_orientation2],minimumCollisionOrientation=_orientation2)}availableOrientations[_this._anchorType]===availability&&orientationPathCollisionCount[_this._anchorType]===minimumCollisionCount?hasOrientation=!0:availableOrientations[_this._defaultAnchorType]===availability&&orientationPathCollisionCount[_this._defaultAnchorType]===minimumCollisionCount?(_this._setAnchorType(_this._defaultAnchorType),hasOrientation=!0):null!=minimumCollisionOrientation&&(_this._setAnchorType(minimumCollisionOrientation),hasOrientation=!0)};selectOrientationByAvailability("open"),hasOrientation||selectOrientationByAvailability("path"),hasOrientation||selectOrientationByAvailability("offscreen"),this._updateCollisionAreas()}},{key:"updateContent",value:function(_ref2){var _this2=this,text=_ref2.text,html=_ref2.html;null!=text?this._el.textContent=text:this._el.innerHTML=html,setTimeout((function(){_this2._updateSize()}),0)}},{key:"_setAnchorType",value:function(orientation){this._anchorType=orientation,this._updatePosition()}},{key:"_updatePosition",value:function(){var anchorType=this._anchorType||this._defaultAnchorType,padding=this._padding;anchorType!==ANCHOR_BOTTOM_LEFT&&anchorType!==ANCHOR_BOTTOM_RIGHT&&anchorType!==ANCHOR_TOP_LEFT&&anchorType!==ANCHOR_TOP_RIGHT||(padding/=Math.SQRT2);var top=0,left=0;anchorType===ANCHOR_BOTTOM&&this._enabledAnchorTypes[ANCHOR_BOTTOM]?(top=padding,left=-this.width/2):anchorType===ANCHOR_TOP&&this._enabledAnchorTypes[ANCHOR_TOP]?(top=-this.height-padding,left=-this.width/2):anchorType===ANCHOR_RIGHT&&this._enabledAnchorTypes[ANCHOR_RIGHT]?(left=padding,top=-this.height/2):anchorType===ANCHOR_LEFT&&this._enabledAnchorTypes[ANCHOR_LEFT]?(left=-this.width-padding,top=-this.height/2):anchorType===ANCHOR_BOTTOM_LEFT&&this._enabledAnchorTypes[ANCHOR_BOTTOM_LEFT]?(top=padding,left=-this.width-padding):anchorType===ANCHOR_BOTTOM_RIGHT&&this._enabledAnchorTypes[ANCHOR_BOTTOM_RIGHT]?(top=padding,left=padding):anchorType===ANCHOR_TOP_LEFT&&this._enabledAnchorTypes[ANCHOR_TOP_LEFT]?(top=-this.height-padding,left=-this.width-padding):anchorType===ANCHOR_TOP_RIGHT&&this._enabledAnchorTypes[ANCHOR_TOP_RIGHT]&&(top=-this.height-padding,left=padding);var className=anchorType.toLowerCase().replace("_","-");this._wrapperEl.classList.item(1)&&this._wrapperEl.classList.remove(this._wrapperEl.classList.item(1)),this._wrapperEl.classList.add("tooltip--anchor-".concat(className));var clientRect=this._el.getBoundingClientRect();Object.assign(this._wrapperEl.style,{transform:"translate(".concat(left,"px, ").concat(top,"px)"),width:clientRect.width+"px",height:clientRect.height+"px"})}},{key:"show",value:function(){this._hidden&&(this._wrapperEl.style.display="flex",this.anchor.show(),this._updatePosition(),this._updateCollisionAreas(),this._hidden=!1)}},{key:"hide",value:function(){this._hidden||(this._wrapperEl.style.display="none",this.anchor.hide(),this._hidden=!0)}},{key:"destroy",value:function(){this.anchor.off("show",this._updateSize),this.anchor.off("collision",this._updateCollisions),this.mapView.removeMarker(this.anchor),this.anchor.destroy()}}]),Tooltip}(),HUE_ROTATE=2/(Math.sqrt(5)+1)*360/6,DebugUI=function(){function DebugUI(){_classCallCheck(this,DebugUI),this._element=document.createElement("div"),this._titleElement=document.createElement("select"),this._minimizeElement=document.createElement("button"),this._performancePanelElement=document.createElement("div"),this._performanceEntries=new Map,this._sortedPerformanceEntryNames=[];var performanceCategoryElement=document.createElement("option");performanceCategoryElement.value="Performance",performanceCategoryElement.innerHTML="Performance",performanceCategoryElement.selected="selected",this._titleElement.appendChild(performanceCategoryElement),this._titleElement.addEventListener("change",this._onCategoryChanged.bind(this)),this._overviewGraph=new LineGraph({width:320,height:128,seriesList:[]}),this._controlPanels=new Map,this._sortedControlPanelNames=[],this._minimized=!1,this._element.appendChild(this._titleElement),this._element.appendChild(this._minimizeElement),this._element.appendChild(this._performancePanelElement),this._performancePanelElement.appendChild(this._overviewGraph.element),this._layout(),this._minimizeElement.addEventListener("click",this._onMinimizeClicked.bind(this)),null==window.MappedinDebug&&(window.MappedinDebug={}),window.MappedinDebug.DebugUI=this}return _createClass(DebugUI,[{key:"destroy",value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._performanceEntries.values()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){_step.value.destroy()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this._controlPanels.values()[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){_step2.value.destroy()}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}this._controlPanels=null,this._performanceEntries=null,this._element=null,this._titleElement=null,this._minimizeElement=null,this._performancePanelElement=null,this._overviewGraph=null,Object.setPrototypeOf(this,null)}},{key:"reportFramePerformance",value:function(entries){var entriesChanged=!1;for(var name in entries){if(!this._performanceEntries.has(name)){var entry=new PerformanceEntry({name:name});this._performanceEntries.set(name,entry),this._performancePanelElement.appendChild(entry.element),this._sortedPerformanceEntryNames.push(name),this._sortedPerformanceEntryNames.sort(),entriesChanged=!0}this._performanceEntries.get(name).report(entries[name])}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this._performanceEntries.keys()[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var _name=_step3.value;null==entries[_name]&&this._performanceEntries.get(_name).report(0)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}entriesChanged&&this._updateLayout();var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this._performanceEntries.values()[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){if(_step4.value.series.changed()){this._overviewGraph.redraw();break}}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}},{key:"addDebugControls",value:function(categories){for(var category in categories){var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=categories[category][Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var entry=_step5.value,name=entry.name,description=entry.description,control=entry.control;this._addDebugControl(category,name,description,control)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}this._controlPanels.get(category)._updateLayout()}this._updateLayout()}},{key:"addDebugControl",value:function(category,name,description,control){this._addDebugControl(category,name,description,control),this._updateLayout(),this._controlPanels.get(category)._updateLayout()}},{key:"removeDebugControls",value:function(categories){for(var category in categories){var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=categories[category][Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var name=_step6.value;this._removeDebugControl(category,name)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}this._controlPanels.get(category)._updateLayout()}this._updateLayout()}},{key:"removeDebugControl",value:function(category,name){this._removeDebugControl(category,name),this._updateLayout(),this._controlPanels.get(category)._updateLayout()}},{key:"_addDebugControl",value:function(category,name,description,control){if(!this._controlPanels.has(category)){var panel=new DebugUIPanel({name:category});this._controlPanels.set(category,panel),this._element.appendChild(panel.element);var option=document.createElement("option");option.value=category,option.innerHTML=category;for(var titleChildren=this._titleElement.children,i=1;i<titleChildren.length&&!(titleChildren[i].value>category);++i);i===titleChildren.length?this._titleElement.appendChild(option):this._titleElement.insertBefore(option,titleChildren[i]),Object.assign(panel.element.style,{display:"hidden",position:"absolute",left:"8px",right:"8px",top:"36px"})}this._controlPanels.get(category).addControl(name,description,control)}},{key:"_removeDebugControl",value:function(category,name){this._controlPanels.get(category).removeControl(name)}},{key:"_layout",value:function(){Object.assign(this._element.style,{display:"block",position:"absolute",right:"8px",top:"8px",width:"336px","font-family":"sans-serif",background:"rgba(255, 255, 255, 0.9)",outline:"1px solid white"}),Object.assign(this._titleElement.style,{display:"block",position:"absolute",left:"8px",top:"8px","font-size":"14px"}),Object.assign(this._minimizeElement.style,{display:"block",position:"absolute",right:"8px",top:"8px",width:"30px",height:"20px"}),Object.assign(this._performancePanelElement.style,{display:"block",position:"absolute",left:"8px",right:"8px",top:"36px"}),Object.assign(this._overviewGraph.element.style,{display:"block",position:"absolute",left:"0px",right:"0px",height:"128px",border:"1px solid white",outline:"1px solid #bbb"}),this._updateLayout()}},{key:"_updateLayout",value:function(){var _this=this,selectedChild=null,_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=this._titleElement.children[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var child=_step7.value;child.selected&&(selectedChild=child);var show=child.selected&&!this._minimized;"Performance"===child.value?this._performancePanelElement.style.display=show?"block":"none":this._controlPanels.get(child.value).element.style.display=show?"block":"none"}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorNormalCompletion7||null==_iterator7.return||_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}this._minimized?this._element.style.height="36px":"Performance"===selectedChild.value?this._element.style.height=28+80*this._performanceEntries.size+128+8+16+"px":this._element.style.height=28+this._controlPanels.get(selectedChild.value).height+8+"px";for(var i=0;i<this._sortedPerformanceEntryNames.length;++i){var name=this._sortedPerformanceEntryNames[i],entry=this._performanceEntries.get(name);entry.setHue(i*HUE_ROTATE),entry.element.style.top=80*i+"px"}this._overviewGraph.setSeriesList(this._sortedPerformanceEntryNames.map((function(name){return _this._performanceEntries.get(name).series}))),this._overviewGraph.element.style.top=80*this._performanceEntries.size+8+"px",this._minimizeElement.innerHTML=this._minimized?"⇕":"⇗"}},{key:"_onMinimizeClicked",value:function(){this._minimized=!this._minimized,this._updateLayout()}},{key:"_onCategoryChanged",value:function(){this._updateLayout()}},{key:"element",get:function(){return this._element}}]),DebugUI}(),PerformanceEntry=function(){function PerformanceEntry(_ref){var name=_ref.name,hue=_ref.hue;_classCallCheck(this,PerformanceEntry),this._name=name,this.series=new TimeSeries({hue:hue}),this._graph=new LineGraph({width:320,height:52,seriesList:[this.series]}),this._element=document.createElement("div"),this._nameElement=document.createElement("div"),this._hueElement=document.createElement("div"),this._lastFrameTimeElement=document.createElement("div"),this._element.appendChild(this._graph.element),this._element.appendChild(this._nameElement),this._element.appendChild(this._hueElement),this._element.appendChild(this._lastFrameTimeElement),this._layout()}return _createClass(PerformanceEntry,[{key:"destroy",value:function(){this._element.removeChild(this._graph.element),this._element.removeChild(this._nameElement),this._element.removeChild(this._hueElement),this._element.removeChild(this._lastFrameTimeElement),this._graph.destroy(),this._element=null,this._nameElement=null,this._hueElement=null,this._lastFrameTimeElement=null}},{key:"_layout",value:function(){Object.assign(this._element.style,{display:"block",position:"absolute",left:"0px",right:"0px",height:"72px"}),Object.assign(this._hueElement.style,{display:"block",position:"absolute",left:"-1px",top:"1px",width:"12px",height:"12px","background-color":hsv2rgb$1(this.series.hue,.3,.9),border:"1px solid "+hsv2rgb$1(this.series.hue,.9,.9),"border-radius":"2px"}),Object.assign(this._nameElement.style,{display:"block",position:"absolute",left:"18px",right:"0px",top:"0px",height:"16px","font-size":"12px","text-align":"left","vertical-align":"middle"}),Object.assign(this._lastFrameTimeElement.style,{display:"block",position:"absolute",left:"0px",right:"0px",top:"0px",height:"16px","font-size":"12px","text-align":"right","vertical-align":"middle"}),Object.assign(this._graph.element.style,{display:"block",position:"absolute",left:"0px",right:"0px",bottom:"0px","text-align":"right",border:"1px solid white",outline:"1px solid "+hsv2rgb$1(this.series.hue,.2,1)}),this._nameElement.innerHTML=this._name}},{key:"report",value:function(lastFrameTime){if(this.series.report(lastFrameTime),this.series.changed()){if(this.series.length>=1){for(var sumFrameTime=0,i=0;i<this.series.length;++i)sumFrameTime+=this.series.at(i);var maximumFrameTime=this.series.maximumValue();this._lastFrameTimeElement.innerHTML="∫ "+(sumFrameTime/this.series.length).toFixed(2)+"ms, ⤒ "+maximumFrameTime.toFixed(2)+" ms"}this._graph.redraw()}}},{key:"setHue",value:function(hue){this.series.hue=hue,this._graph.setSeriesList([this.series]),this._layout()}},{key:"element",get:function(){return this._element}}]),PerformanceEntry}(),LineGraph=function(){function LineGraph(_ref2){var seriesList=_ref2.seriesList,width=_ref2.width,height=_ref2.height;_classCallCheck(this,LineGraph),this._gradients=new Map,this._canvas=document.createElement("canvas"),this._layout(width,height),this._context=this._canvas.getContext("2d"),this.setSeriesList(seriesList)}return _createClass(LineGraph,[{key:"destroy",value:function(){this._gradients=null,this._canvas=null,this._context=null,Object.setPrototypeOf(this,null)}},{key:"_layout",value:function(width,height){Object.assign(this._canvas.style,{display:"block",position:"absolute",left:"0px",right:"0px",width:width+"px",height:height+"px"}),this._canvas.width=width*window.devicePixelRatio,this._canvas.height=height*window.devicePixelRatio}},{key:"redraw",value:function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);var maximumValue=0,_iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=this._seriesList[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var series=_step8.value;maximumValue=Math.max(maximumValue,series.maximumValue())}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorNormalCompletion8||null==_iterator8.return||_iterator8.return()}finally{if(_didIteratorError8)throw _iteratorError8}}var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=this._seriesList[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var _series=_step9.value;if(_series.length>=1){this._context.beginPath();var x=1-(_series.length-1)/(_series.windowSize-1),y=1-_series.at(0)/maximumValue;this._context.moveTo(x*this._canvas.width,y*this._canvas.height);for(var i=1;i<_series.length;++i){var _x=1-(_series.length-1-i)/(_series.windowSize-1),_y=1-_series.at(i)/maximumValue;this._context.lineTo(_x*this._canvas.width,_y*this._canvas.height)}this._context.strokeStyle=this._gradients.get(_series),this._context.lineWidth=window.devicePixelRatio,this._context.stroke()}}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{_iteratorNormalCompletion9||null==_iterator9.return||_iterator9.return()}finally{if(_didIteratorError9)throw _iteratorError9}}}},{key:"setSeriesList",value:function(series){this._seriesList=series;var _iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator10=this._seriesList[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=!0){var _series2=_step10.value,gradient=this._context.createLinearGradient(0,0,0,this._canvas.height);gradient.addColorStop(0,hsv2rgb$1(_series2.hue,1,1)),gradient.addColorStop(1,hsv2rgb$1(_series2.hue,.5,.5)),this._gradients.set(_series2,gradient)}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{_iteratorNormalCompletion10||null==_iterator10.return||_iterator10.return()}finally{if(_didIteratorError10)throw _iteratorError10}}}},{key:"element",get:function(){return this._canvas}}]),LineGraph}(),TimeSeries=function(){function TimeSeries(_ref3){var _ref3$windowSize=_ref3.windowSize,windowSize=void 0===_ref3$windowSize?60:_ref3$windowSize,_ref3$totalAccumulati=_ref3.totalAccumulationCount,totalAccumulationCount=void 0===_ref3$totalAccumulati?5:_ref3$totalAccumulati,_ref3$hue=_ref3.hue,hue=void 0===_ref3$hue?0:_ref3$hue;_classCallCheck(this,TimeSeries),this.windowSize=windowSize,this.hue=hue,this._totalAccumulationCount=totalAccumulationCount,this._ringBuffer=new Array(this.windowSize).fill(0),this._ringBufferLength=0,this._ringBufferPointer=0,this._accumulatorValue=0,this._accumulatorCount=0,this._changed=!0}return _createClass(TimeSeries,[{key:"destroy",value:function(){}},{key:"report",value:function(value){this._accumulatorValue+=value,++this._accumulatorCount,this._changed=!1,this._accumulatorCount===this._totalAccumulationCount&&(this._push(this._accumulatorValue/this._totalAccumulationCount),this._accumulatorValue=0,this._accumulatorCount=0,this._changed=!0)}},{key:"at",value:function(i){if(!Number.isFinite(i)||i>=this._ringBufferLength||i<0)throw new Error("invalid index: "+i+" (length: "+this.length+")");var index=(this._ringBufferPointer+i-this._ringBufferLength+this.windowSize)%this.windowSize;return this._ringBuffer[index]}},{key:"_push",value:function(value){this._ringBuffer[this._ringBufferPointer]=value,++this._ringBufferLength,this._ringBufferLength>this.windowSize&&(this._ringBufferLength=this.windowSize),++this._ringBufferPointer,this._ringBufferPointer>=this.windowSize&&(this._ringBufferPointer=0)}},{key:"maximumValue",value:function(){for(var maximum=0,i=0;i<this._ringBufferLength;++i)maximum=Math.max(maximum,this.at(i));return maximum}},{key:"changed",value:function(){return this._changed}},{key:"length",get:function(){return this._ringBufferLength}}]),TimeSeries}();function hsv2rgb$1(h,s,v,out){var hh=h%360/60,sextant=0|hh,ff=hh-sextant,p=v*(1-s),q=v*(1-s*ff),t=v*(1-s*(1-ff)),r=0,g=0,b=0;switch(sextant){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}return"#"+toHex(r)+toHex(g)+toHex(b)}function toHex(float){var string=(255*float|0).toString(16);return 1===string.length&&(string="0"+string),string}var img$1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAkklEQVRoge3awQ3AIAxD0VAMYf+F0yUixbL8JshXuLSwIqJCwDc9QBeZEOy9p2doAQDTM7TQ2cg5Z3qGFjpHS2YjDiGDe+/0DC0cwkYpJKdnaIFMkY1kymzEIVQcwsYhbPDem56hhc5GHELGIWwcwsYhbJS+2R1CxSFsdH5iO4SMr97Y6FxPqxytVVV+HcTEIWx+9mcIqHSOm9QAAAAASUVORK5CYII=",BLUE_DOT_MODE_GHOST="ghost",BLUE_DOT_MODE_BLUE="blue",makeMeshBasicMaterial=function(color,opacity){return new MeshBasicMaterial({color:color,transparent:!0,depthTest:!1,opacity:opacity})},drawCircle=function(radius){var shape=new Shape$1,angle=0;for(shape.moveTo(radius,0);angle<=2*Math.PI;)shape.lineTo(Math.cos(angle)*radius,Math.sin(angle)*radius),angle+=Math.PI/16;return shape},materials={outer:{blue:makeMeshBasicMaterial(16777215,1),ghost:makeMeshBasicMaterial(16777215,.5)},inner:{blue:makeMeshBasicMaterial(2254591,1),grey:makeMeshBasicMaterial(14540253,1),ghost:makeMeshBasicMaterial(2254591,.5)},aura:{inner:makeMeshBasicMaterial(2254591,.2),outer:makeMeshBasicMaterial(2254591,.3)},bearing:{blue:makeMeshBasicMaterial(2254591,.7),ghost:makeMeshBasicMaterial(2254591,.4)}};materials.outer.grey=materials.outer.blue;var createAnnularGeometry=function(radius,innerRadius){var outerShape=drawCircle(radius);if(innerRadius&&innerRadius<radius){var holeShape=drawCircle(innerRadius);outerShape.holes=[holeShape]}return new ExtrudeGeometry(outerShape,{amount:0,bevelEnabled:!1,steps:2})},generateRadialUV=function(x,y,outerRadius){var v=Math.sqrt(Math.pow(x,2)+Math.pow(y,2))/outerRadius;return v>1?v=1:v<0&&(v=0),new Vector2(0,v)},radialUVGenerator=function(radius){return{generateTopUV:function(geometry,vertices,indexA,indexB,indexC){var aX=vertices[3*indexA],aY=vertices[3*indexA+1],bX=vertices[3*indexB],bY=vertices[3*indexB+1],cX=vertices[3*indexC],cY=vertices[3*indexC+1];return[generateRadialUV(aX,aY,radius),generateRadialUV(bX,bY,radius),generateRadialUV(cX,cY,radius)]},generateSideWallUV:function(){return[new Vector2(0,1),new Vector2(0,1),new Vector2(0,1),new Vector2(0,1)]}}},createSectorGeometry=function(theta,length){var rho=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Math.abs(theta)>=Math.PI)throw new Error("Sector angle too wide!");var offsetX=rho/Math.tan(theta/2),innerRadius=rho/Math.sin(theta/2),outerRadius=innerRadius+length,n=10,sectorShape=new Shape$1;sectorShape.moveTo(innerRadius*Math.cos(theta/2)-offsetX,innerRadius*Math.sin(theta/2));for(var i=0;i<n;i++)sectorShape.lineTo(outerRadius*Math.cos(theta/2-theta/n*i)-offsetX,outerRadius*Math.sin(theta/2-theta/n*i));for(var _i=0;_i<n;_i++)sectorShape.lineTo(rho*Math.cos(Math.PI/-2+Math.PI/n*_i),rho*Math.sin(Math.PI/-2+Math.PI/n*_i));return new ExtrudeGeometry(sectorShape,{amount:1,bevelEnabled:!1,UVGenerator:radialUVGenerator(length)})},getBearing=function(bearingAngle,north){return bearingAngle?degToRadians(-bearingAngle)-north+Math.PI/2:null},degToRadians=function(degrees){return degrees*Math.PI/180};var DEFAULT_RADIUS_TWEEN_PROFILE={duration:2e3,easing:TWEEN$1.Easing.Cubic.Out};function isNonNegativeNumber(n){return"number"==typeof n&&!isNaN(n)&&n>=0}var BlueDotManager=function(_PubSub){_inherits(BlueDotManager,PubSub);var _super=function(Derived){function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var result,Super=_getPrototypeOf(Derived);if(isNativeReflectConstruct()){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}(BlueDotManager);function BlueDotManager(_ref){var _this,mapManager=_ref.mapManager,mapView=_ref.mapView,_ref$minRadius=_ref.minRadius,minRadius=void 0===_ref$minRadius?8:_ref$minRadius,_ref$maxRadius=_ref.maxRadius,maxRadius=void 0===_ref$maxRadius?65:_ref$maxRadius,_ref$radiusUpdateInte=_ref.radiusUpdateInterval,radiusUpdateInterval=void 0===_ref$radiusUpdateInte?3:_ref$radiusUpdateInte,_ref$radiusTweenOptio=_ref.radiusTweenOptions,radiusTweenOptions=void 0===_ref$radiusTweenOptio?DEFAULT_RADIUS_TWEEN_PROFILE:_ref$radiusTweenOptio;if(_classCallCheck(this,BlueDotManager),(_this=_super.call(this)).mapManager=mapManager,_this.mapView=mapView,!isNonNegativeNumber(minRadius))throw new Error("Expecting minRadius parameter to be a valid number >= 0. Provided: ".concat(minRadius));if(_this.minRadius=minRadius,!isNonNegativeNumber(maxRadius))throw new Error("Expecting maxRadius parameter to be a valid number >= 0. Provided: ".concat(maxRadius));if(maxRadius<_this.minRadius)throw new Error("Expecting maxRadius parameter to be >= minRadius parameter. Provided: ".concat(maxRadius,"; minRadius = ").concat(_this.minRadius));if(_this.maxRadius=maxRadius,!isNonNegativeNumber(radiusUpdateInterval))throw new Error("Expecting radiusUpdateInterval parameter to be a valid number >= 0. Provided: ".concat(radiusUpdateInterval));return _this.radiusUpdateInterval=radiusUpdateInterval,_this.radiusTweenOptions=radiusTweenOptions,_this.state=null,_this.prevRadius=null,_this.radiusTween=null,_this.prevBearing=null,_this.bearingTween=null,_this}return _createClass(BlueDotManager,[{key:"computeNewRadius",value:function(candidateRadius){if(!isNonNegativeNumber(candidateRadius)||candidateRadius<this.minRadius)return 0;if(candidateRadius>=this.maxRadius)return this.maxRadius;if(0===this.radiusUpdateInterval)return candidateRadius;var relToZero=candidateRadius-this.minRadius;return relToZero-relToZero%this.radiusUpdateInterval+this.minRadius}},{key:"setBlueDotSizeFromZoom",value:function(cameraX){var _this2=this;this.blueDots&&this.blueDots.forEach((function(collection){var x,min,max,minZoom=_this2.mapView.controls.getZoomScaledMin(),blueDotScale=(max=5*minZoom,((x=cameraX)<(min=3*minZoom)?x:x<max?min:x*min/max)/2e3);collection.dotObject.scale.set(blueDotScale,blueDotScale,blueDotScale),collection.bearing&&collection.bearing.scale.set(blueDotScale,blueDotScale,blueDotScale)}))}},{key:"update",value:function(options){var _this3=this,mode=options.mode||BLUE_DOT_MODE_BLUE,targetMap=options.mapId||options.map&&options.map.id||this.mapManager.currentMap.id;this.positionTween&&this.positionTween.stop(),!this.state||mode===this.state.mode&&targetMap===this.state.targetMap||this.cleanup();var newRadius=this.computeNewRadius(options.radius);if(!this.blueDots){var markers=[];this.mapManager.mapObjects.forEach((function(map){var thisPosition=map.getPositionLatLon(options.coordinates.latitude,options.coordinates.longitude),thisMarker=function(mode){var auraCircle,bearingCone,radius=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,bearing=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,parent=new Object3D,grandparent=new Object3D;if(radius>=0){var auraGeom=new CylinderGeometry(1,1,10,32),auraMat=materials.aura.inner;(auraCircle=new Mesh(auraGeom,auraMat)).position.set(0,0,0),auraCircle.rotation.set(Math.PI/2,0,0),auraCircle.scale.set(radius,1,radius),grandparent.add(auraCircle)}var bearingGeom=createSectorGeometry(Math.PI/6,120,30),bearingMat=materials.bearing[mode];(new TextureLoader).load(img$1,(function(texture){bearingMat.alphaMap=texture,bearingMat.needsUpdate=!0})),(bearingCone=new Mesh(bearingGeom,bearingMat)).rotation.set(0,0,bearing),grandparent.add(bearingCone);var outerGeom=createAnnularGeometry(30,22.5),innerGeom=createAnnularGeometry(22.5),outerCircle=new Mesh(outerGeom,materials.outer[mode]),innerCircle=new Mesh(innerGeom,materials.inner[mode]);return parent.add(outerCircle),parent.add(innerCircle),grandparent.add(parent),{outerObject:grandparent,radiusObject:auraCircle,dotObject:parent,bearingObject:bearingCone}}(map.id!==targetMap&&mode===BLUE_DOT_MODE_BLUE?BLUE_DOT_MODE_GHOST:mode,0,getBearing(options.bearing,_this3.mapManager.currentMap.getNorth()));_this3.prevRadius=0;var thisMarkerHandle=_this3.mapView.createThreeJSMarker({object:thisMarker.outerObject,map:map,position:thisPosition});markers.push({handle:thisMarkerHandle,radius:thisMarker.radiusObject,dotObject:thisMarker.dotObject,bearing:thisMarker.bearingObject})})),this.blueDots=markers}this.currentPositionLatLon?(this.positionTween=new TWEEN$1.Tween(this.currentPositionLatLon).to({lat:options.coordinates.latitude,lon:options.coordinates.longitude},2e3).easing(TWEEN$1.Easing.Cubic.Out).onUpdate((function(nextPosition){_this3.currentPositionLatLon=nextPosition,_this3.blueDots.forEach((function(collection){var thisMapId=collection.handle._mapId,nextMapPosition=_this3.mapManager.mapObjects.get(thisMapId).getPositionLatLon(nextPosition.lat,nextPosition.lon);collection.handle.object.position.set(nextMapPosition.x,nextMapPosition.y,0)})),_this3.mapView.tryRendering()})),this.positionTween.start()):(this.currentPositionLatLon={lat:options.coordinates.latitude,lon:options.coordinates.longitude},this.blueDots.forEach((function(collection){var thisMapId=collection.handle._mapId,nextMapPosition=_this3.mapManager.mapObjects.get(thisMapId).getPositionLatLon(options.coordinates.latitude,options.coordinates.longitude);collection.handle.object.position.set(nextMapPosition.x,nextMapPosition.y,0)}))),Math.abs(newRadius-this.prevRadius)>=Number.EPSILON&&(null!=this.radiusTween&&this.radiusTween.stop(),this.radiusTween=new TWEEN$1.Tween({value:this.prevRadius}).to({value:newRadius},this.radiusTweenOptions.duration).easing(this.radiusTweenOptions.easing).onUpdate((function(_ref2){var intermediateRadius=_ref2.value;_this3.prevRadius=intermediateRadius,null!=_this3.blueDots&&_this3.blueDots.forEach((function(collection){if(collection.radius){var thisMapId=collection.handle._mapId,thisMap=_this3.mapManager.mapObjects.get(thisMapId),thisRadius=intermediateRadius*thisMap.getMapScale();collection.radius.scale.set(thisRadius,1,thisRadius)}})),_this3.mapView.tryRendering()})).start());var newBearing=options.bearing;options.bearing?Math.abs(newBearing-this.prevBearing)>=Number.EPSILON&&(this.bearingTween=new TWEEN$1.Tween({value:this.prevBearing}).to({value:newBearing},1e3).easing(TWEEN$1.Easing.Cubic.Out).onUpdate((function(_ref3){var intermediateBearing=_ref3.value;_this3.prevBearing=intermediateBearing,null!=_this3.blueDots&&_this3.blueDots.forEach((function(collection){collection.bearing&&(collection.bearing.visible=!0,collection.bearing.rotation.set(0,0,getBearing(intermediateBearing,_this3.mapManager.currentMap.getNorth())))})),_this3.mapView.tryRendering()})).start()):null!=this.blueDots&&this.blueDots.forEach((function(collection){collection.bearing&&(collection.bearing.visible=!1)}));this.state={mode:mode,targetMap:targetMap},this.mapView.tryRendering()}},{key:"cleanup",value:function(){var _this4=this;this.blueDots&&(this.blueDots.forEach((function(dot){dot.handle._object.children.forEach((function(child){child.geometry?child.geometry.dispose():child.children.forEach((function(grandchild){grandchild.geometry.dispose()}))})),_this4.mapView.removeThreeJSMarker(dot.handle)})),delete this.blueDots),this.state=null,null!=this.positionTween&&this.positionTween.stop(),null!=this.radiusTween&&this.radiusTween.stop()}}]),BlueDotManager}(),THREE=require("three"),VIEW_STATE={SINGLE_FLOOR:"single_floor",MULTI_FLOOR:"multi_floor"},Shaders={},Mappedin={};Mappedin.MapView=MapView,Mappedin.HoverLabel=HoverLabel,Mappedin.CameraControls=function(camera,canvas,scene,mapView){var intersection;Object.assign(this,EventDispatcher.prototype),this.camera=camera,this.canvas=canvas,this.elevation=camera.parent,this.orbit=this.elevation.parent;var TWO_PI=2*Math.PI;this.zoomSpeed=5,this.rotateSpeed=100,this.enabled=!0,this.enableZoom=!0,this.enablePan=!0,this.enablePedestal=!1,this.maxPedestal=1/0,this.minPedestal=-1/0,this.enableRotate=!0,this.minZoom=375,this.maxZoom=1e4,this.initialMinZoom=375,this.initialMaxZoom=1e4,this.ignoreZoomLimits=!1,this.minExpandedZoom=375,this.maxExpandedZoom=1e5,this.zoomFactor=1,this.panBounds={margin:1.25,min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0},center:{x:0,y:0},radius:200},this.minTilt=0,this.maxTilt=1.2,this.mouseButtons={ORBIT:MOUSE.RIGHT,ZOOM:MOUSE.MIDDLE,PAN:MOUSE.LEFT};var scope=this,cameraPlaneGeometery=new PlaneGeometry(1e6,1e6),cameraPlaneMaterial=new MeshBasicMaterial({color:0,visible:!1}),cameraPlane=new Mesh(cameraPlaneGeometery,cameraPlaneMaterial),raycaster=new Raycaster;scene.add(cameraPlane);var zoomStart,STATE_NONE=-1,STATE_ROTATE=0,STATE_DOLLY=1,STATE_PAN=2,STATE_WHEEL_ZOOM=3,STATE_TOUCH_TILT=4,STATE_TOUCH_DOLLY=5,STATE_TOUCH_PAN=6,STATE_MULTI=7,STATE_PEDESTAL=8,STATE_TOUCH_PEDESTAL=9,state=STATE_NONE,mouse=new Vector2,touches=[],touchOrigin={offsetLeft:0,offsetTop:0},rotateStart=new Vector2,rotateEnd=new Vector2,rotateDelta=new Vector2,panStart=new Vector2,panCameraStart=new Vector2,panEnd=new Vector2,panDelta=new Vector3,floorAnchor=new Vector3,dollyStart=new Vector2,dollyEnd=new Vector2,dollyDelta=new Vector2,resetZoom=!1,clock=new Clock(!0),lastWheelTime=0,stayInsideBounds=!0;this.CAMERA_EVENTS={},this.CAMERA_EVENTS.CHANGE_EVENT={type:"change"},this.CAMERA_EVENTS.PAN_START_EVENT={type:"panStart"},this.CAMERA_EVENTS.PAN_END_EVENT={type:"panEnd"},this.CAMERA_EVENTS.PEDESTAL_START_EVENT={type:"pedestalStart"},this.CAMERA_EVENTS.PEDESTAL_CHANGE_EVENT={type:"pedestalChange"},this.CAMERA_EVENTS.PEDESTAL_END_EVENT={type:"pedestalEnd"},this.CAMERA_EVENTS.ROTATE_START_EVENT={type:"rotateStart"},this.CAMERA_EVENTS.ROTATE_END_EVENT={type:"rotateEnd"},this.CAMERA_EVENTS.ZOOM_START_EVENT={type:"zoomStart"},this.CAMERA_EVENTS.ZOOM_END_EVENT={type:"zoomEnd"},this.CAMERA_EVENTS.MULTI_START_EVENT={type:"multiStart"},this.CAMERA_EVENTS.MULTI_END_EVENT={type:"multiEnd"},this.INTERACTION_EVENTS={},this.INTERACTION_EVENTS.USER_PAN_EVENT={type:"userPan"},this.INTERACTION_EVENTS.USER_PEDESTAL_EVENT={type:"userPedestal"},this.INTERACTION_EVENTS.USER_ROTATE_EVENT={type:"userRotate"},this.INTERACTION_EVENTS.USER_DOLLY_EVENT={type:"userDolly"},this.INTERACTION_EVENTS.USER_ZOOM_EVENT={type:"userZoom"},this.INTERACTION_EVENTS.USER_TILT_EVENT={type:"userTilt"};var changeEvent=this.CAMERA_EVENTS.CHANGE_EVENT,panStartEvent=this.CAMERA_EVENTS.PAN_START_EVENT,pedestalStartEvent=this.CAMERA_EVENTS.PEDESTAL_START_EVENT,pedestalChangeEvent=this.CAMERA_EVENTS.PEDESTAL_CHANGE_EVENT,panEndEvent=this.CAMERA_EVENTS.PAN_END_EVENT,rotateStartEvent=this.CAMERA_EVENTS.ROTATE_START_EVENT,rotateEndEvent=this.CAMERA_EVENTS.ROTATE_END_EVENT,zoomStartEvent=this.CAMERA_EVENTS.ZOOM_START_EVENT,zoomEndEvent=this.CAMERA_EVENTS.ZOOM_END_EVENT,multiStartEvent=this.CAMERA_EVENTS.MULTI_START_EVENT,multiEndEvent=this.CAMERA_EVENTS.MULTI_END_EVENT,userPanEvent=this.INTERACTION_EVENTS.USER_PAN_EVENT,userPedestalEvent=this.INTERACTION_EVENTS.USER_PEDESTAL_EVENT,userRotateEvent=this.INTERACTION_EVENTS.USER_ROTATE_EVENT,userDollyEvent=this.INTERACTION_EVENTS.USER_DOLLY_EVENT,userZoomEvent=this.INTERACTION_EVENTS.USER_ZOOM_EVENT,userTiltEvent=this.INTERACTION_EVENTS.USER_TILT_EVENT,dispatchPedestalChangeEvent=throttle((function(newZ){scope.dispatchEvent(_objectSpread2(_objectSpread2({},pedestalChangeEvent),{},{pedestal:newZ,scrolledToTop:scope.scrolledToTop,scrolledToBottom:scope.scrolledToBottom,scrollPercent:scope.scrollPercent}))}),100);this.addDebugControls=function(debugUI){debugUI.addDebugControls({CameraControls:[{name:"Stay Inside Bounds",description:"Ensure the camera stays inside its bounds.\n\nCaution: going too far outside-of-bounds may slow renderingsignificantly.",control:new DebugUICheckbox({current:!0,onValueChanged:function(stay){stayInsideBounds=stay}})}]})},this.removeDebugControls=function(debugUI){debugUI.removeDebugControls({CameraControls:["Stay Inside Bounds"]})},this.pan=function(right,down){isNaN(right)||isNaN(down)||scope.setPosition(scope.orbit.position.x+right,scope.orbit.position.y+down)},this.setPosition=function(x,y){if(!isNaN(x)&&!isNaN(y)){state==STATE_NONE&&scope.dispatchEvent(panStartEvent);var dx=x-scope.panBounds.center.x,dy=y-scope.panBounds.center.y,targetDistanceFromBounds=Math.sqrt(dx*dx+dy*dy);if(stayInsideBounds&&targetDistanceFromBounds>scope.panBounds.radius){var angle=Math.atan2(dy,dx),target={x:Math.cos(angle)*scope.panBounds.radius+scope.panBounds.center.x,y:Math.sin(angle)*scope.panBounds.radius+scope.panBounds.center.y};scope.orbit.position.x=target.x,scope.orbit.position.y=target.y}else scope.orbit.position.x=x,scope.orbit.position.y=y;scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(panEndEvent)}},this.setRotation=function(radians){isNaN(radians)||(state==STATE_NONE&&scope.dispatchEvent(rotateStartEvent),scope.orbit.rotation.z=radians%TWO_PI,scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(rotateEndEvent))},this.rotate=function(radians){isNaN(radians)||(state==STATE_NONE&&scope.dispatchEvent(rotateStartEvent),scope.orbit.rotation.z=(scope.orbit.rotation.z+radians)%TWO_PI,scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(rotateEndEvent))},this.setTilt=function(radians){isNaN(radians)||(state==STATE_NONE&&scope.dispatchEvent(rotateStartEvent),scope.elevation.rotation.x=stayInsideBounds?Math.max(Math.min(radians,scope.maxTilt),scope.minTilt):radians,scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(rotateEndEvent))},this.tilt=function(radians){isNaN(radians)||(state==STATE_NONE&&scope.dispatchEvent(rotateStartEvent),scope.elevation.rotation.x=stayInsideBounds?Math.max(Math.min(radians+scope.getTilt(),scope.maxTilt),scope.minTilt):radians+scope.getTilt(),scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(rotateEndEvent))},this.setZoom=function(zoom){if(!isNaN(zoom)){state==STATE_NONE&&scope.dispatchEvent(zoomStartEvent);var z=stayInsideBounds?Math.min(Math.max(zoom,scope.getZoomScaledMin()),scope.getZoomScaledMax()):zoom;scope.camera.position.z=z,scope.camera.near=z/100,scope.camera.far=100*z,scope.camera.updateProjectionMatrix(),scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(zoomEndEvent)}},this.zoom=function(zoomDelta){if(!isNaN(zoomDelta)){state==STATE_NONE&&scope.dispatchEvent(zoomStartEvent);var newZoom=scope.getZoom()-zoomDelta;scope.camera.position.z=stayInsideBounds?Math.min(Math.max(newZoom,scope.minZoom*scope.zoomFactor),scope.maxZoom*scope.zoomFactor):newZoom,scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(zoomEndEvent)}},this.zoomIn=function(duration,curve,callback){var zoom=this.getZoom();this.animateCamera({zoom:zoom/1.5},duration,curve,callback)},this.zoomOut=function(duration,curve,callback){var zoom=this.getZoom();this.animateCamera({zoom:1.5*zoom},duration,curve,callback)},this.expandZoomLimits=function(zoom,buffer){buffer||(buffer=1.2),zoom*buffer>scope.maxZoom&&(scope.maxZoom=Math.min(zoom*buffer,scope.maxExpandedZoom)),zoom/buffer<scope.minZoom&&(scope.minZoom=Math.max(zoom/buffer,scope.minExpandedZoom))},this.restrictZoomLimits=function(zoom,buffer){buffer||(buffer=1.2),zoom*buffer>scope.initialMaxZoom&&zoom*buffer<scope.maxZoom&&(scope.maxZoom=Math.max(scope.getZoom(),zoom*buffer)),zoom/buffer<scope.initialMinZoom&&zoom/buffer>scope.minZoom&&(scope.minZoom=Math.min(scope.getZoom(),zoom/buffer))},this.getPosition=function(){return{x:scope.orbit.position.x,y:scope.orbit.position.y,z:scope.orbit.position.z}},this.getPedestal=function(){return scope.orbit.position.z},Object.defineProperty(this,"setPedestal",{enumerable:!1,value:function(z){"number"!=typeof z||isNaN(z)||(scope.orbit.position.z=z,mapView.tryRendering())}}),Object.defineProperty(this,"scrollPercent",{get:function(){var min=this.minPedestal,max=this.maxPedestal,pedestal=this.getPedestal();return pedestal=Math.min(pedestal,max),100*(((pedestal=Math.max(pedestal,min))-min)/(max-min))}}),Object.defineProperty(this,"scrolledToTop",{get:function(){return 0===this.maxPedestal||Math.ceil(this.getPedestal())>=this.maxPedestal}}),Object.defineProperty(this,"scrolledToBottom",{get:function(){return 0===this.minPedestal||Math.floor(this.getPedestal())<=this.minPedestal}}),this.getRotation=function(){return scope.orbit.rotation.z},this.getTilt=function(){return scope.elevation.rotation.x},this.getZoom=function(){return scope.camera.position.z},this.isCameraMoving=function(){return state!=STATE_NONE},this.getZoomScaledMin=function(){return scope.minZoom*scope.zoomFactor},this.getZoomScaledMax=function(){var min=scope.minZoom*scope.zoomFactor;return Math.max(scope.maxZoom,1.5*min)};var tweens=new Set;function completeTween(tween){tween.isPlaying?tween.stop():tween.end(),tweens.delete(tween)}function handleMouseDownPedestal(event){var pos={x:event.clientX,y:event.clientY};scope.initialShiftPos=pos,scope.initialPedestal=scope.getPedestal(),scope.pedestalScaleFactor=getProjectionScaleFactor(scope.camera.fov,scope.canvas.clientHeight,scope.getZoom()),scope.dispatchEvent(pedestalStartEvent),scope.dispatchEvent(userPedestalEvent)}function handleMouseMovePedestal(event){event.clientX;var pos_y=event.clientY,newZ=scope.initialPedestal+scope.pedestalScaleFactor*(pos_y-scope.initialShiftPos.y);stayInsideBounds&&(newZ<scope.minPedestal?newZ=Math.max(newZ,scope.minPedestal):newZ>scope.maxPedestal&&(newZ=Math.min(newZ,scope.maxPedestal))),newZ!==scope.getPedestal()&&(scope.setPedestal(newZ),dispatchPedestalChangeEvent(newZ))}function scrollDelta(event){var delta=0;return void 0!==event.wheelDelta?delta=event.wheelDelta:void 0!==event.detail&&(delta=-event.detail),delta}function canScrollZoom(event){var delta=scrollDelta(event),currentZoom=scope.getZoom();return!(delta<0&&currentZoom==scope.getZoomScaledMax()||delta>0&&currentZoom==scope.getZoomScaledMin())}function onMouseDown(event){if(!1!==scope.enabled){if(mouseToScene(event),event.preventDefault(),state==STATE_WHEEL_ZOOM&&scope.dispatchEvent(zoomEndEvent),event.button===scope.mouseButtons.ORBIT){if(!1===scope.enableRotate)return;!function(event){rotateStart.set(event.clientX,event.clientY),scope.dispatchEvent(rotateStartEvent),scope.dispatchEvent(userRotateEvent)}(event),state=STATE_ROTATE}else if(event.button===scope.mouseButtons.ZOOM){if(!1===scope.enableZoom)return;!function(event){dollyStart.set(event.clientX,event.clientY),scope.dispatchEvent(zoomStartEvent),scope.dispatchEvent(userDollyEvent)}(event),state=STATE_DOLLY}else event.button===scope.mouseButtons.PAN&&(scope.enablePan?(pos=raycastToFloor(mouse),panStart.set(pos.x,pos.y),panCameraStart.set(scope.orbit.position.x,scope.orbit.position.y),scope.dispatchEvent(panStartEvent),scope.dispatchEvent(userPanEvent),state=STATE_PAN):scope.enablePedestal&&(handleMouseDownPedestal(event),state=STATE_PEDESTAL));var pos;state!==STATE_NONE&&(scope.canvas.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("mouseup",onMouseUp,!1),window.addEventListener("mouseout",onMouseUp,!1))}}function onMouseMove(event){var pos;if(!1!==scope.enabled)if(event.preventDefault(),mouseToScene(event),state===STATE_ROTATE){if(!1===scope.enableRotate)return;!function(event){rotateEnd.set(event.clientX,event.clientY),rotateDelta.subVectors(rotateEnd,rotateStart),scope.rotate(-rotateDelta.x/scope.rotateSpeed),scope.setTilt(scope.getTilt()-rotateDelta.y/scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.dispatchEvent(changeEvent)}(event)}else if(state===STATE_DOLLY){if(!1===scope.enableZoom)return;!function(event){dollyEnd.set(event.clientX,event.clientY),dollyDelta.subVectors(dollyEnd,dollyStart),scope.setZoom(dollyDelta.y*scope.zoomSpeed),dollyStart.copy(dollyEnd),scope.dispatchEvent(changeEvent)}(event)}else if(state===STATE_PAN){if(!1===scope.enablePan)return;pos=raycastToFloor(mouse),panEnd.set(pos.x,pos.y),panDelta.subVectors(panEnd,panStart),scope.setPosition(panCameraStart.x-panDelta.x,panCameraStart.y-panDelta.y),scope.dispatchEvent(changeEvent)}else state===STATE_WHEEL_ZOOM?(resetZoom=!0,state=STATE_NONE):state===STATE_PEDESTAL&&handleMouseMovePedestal(event)}function onMouseUp(){if(!1!==scope.enabled){switch(document.removeEventListener("mousemove",onMouseMove,!1),window.removeEventListener("mouseup",onMouseUp,!1),window.removeEventListener("mouseout",onMouseUp,!1),state){case STATE_PAN:scope.dispatchEvent(scope.CAMERA_EVENTS.PAN_END_EVENT);break;case STATE_DOLLY:scope.dispatchEvent(scope.CAMERA_EVENTS.ZOOM_END_EVENT);break;case STATE_ROTATE:scope.dispatchEvent(scope.CAMERA_EVENTS.ROTATE_END_EVENT);break;case STATE_PEDESTAL:scope.dispatchEvent(scope.CAMERA_EVENTS.PEDESTAL_END_EVENT)}state=STATE_NONE}}function onMouseWheel(event){!1===scope.enabled||!1===scope.enableZoom||state!==STATE_NONE&&state!==STATE_WHEEL_ZOOM||(event.preventDefault(),event.stopPropagation(),mouseToScene(event),canScrollZoom(event)&&(lastWheelTime=clock.getElapsedTime()),state!=STATE_WHEEL_ZOOM&&canScrollZoom(event)&&(scope.canvas.addEventListener("mousemove",onMouseMove,!1),state=STATE_WHEEL_ZOOM,zoomStart=scope.getZoom(),floorAnchor=raycastToFloor(mouse),panCameraStart.set(scope.orbit.position.x,scope.orbit.position.y),scope.dispatchEvent(zoomStartEvent)),function(event){if(!canScrollZoom(event))return lastWheelTime>0&&(scope.dispatchEvent(zoomEndEvent),scope.dispatchEvent(userZoomEvent)),lastWheelTime=0,void(state=STATE_NONE);var currentZoom=scope.getZoom(),zoom=currentZoom-scrollDelta(event)*currentZoom/1e4*scope.zoomSpeed;scope.setZoom(zoom);var zoomPercent=zoom/zoomStart;panDelta.subVectors(floorAnchor,panCameraStart).multiplyScalar(1-zoomPercent),scope.setPosition(panCameraStart.x+panDelta.x,panCameraStart.y+panDelta.y),scope.dispatchEvent(changeEvent)}(event))}function handleTouchMoveDolly(){scope.touchInputs.update(touches[0],touches[1]);var first=scope.touchInputs.first,second=scope.touchInputs.second;scope.touchAnchor1.viewCoordinate={x:first.x,y:first.y},scope.touchAnchor2.viewCoordinate={x:second.x,y:second.y};var newMatrix=function(touchAnchor1,touchAnchor2){scope.orbit.updateMatrixWorld(),scope.camera.updateProjectionMatrix();var p=scope.camera.projectionMatrix.clone(),w1=touchAnchor1.worldCoordinate,w2=touchAnchor2.worldCoordinate,nw1=touchAnchor1.reUnproject(),nw2=touchAnchor2.reUnproject(),s1=touchAnchor1.viewCoordinate,s2=touchAnchor2.viewCoordinate,xd1=w2.x-w1.x,yd1=w2.y-w1.y,angle1=Math.atan2(yd1,xd1),xd2=nw2.x-nw1.x,yd2=nw2.y-nw1.y,angle2=Math.atan2(yd2,xd2),zAngleDelta=(a=angle1,b=angle2,(b-a+Math.PI)%(2*Math.PI)+2*Math.PI%(2*Math.PI)-Math.PI),yawAdjustment=new Matrix4;var a,b;yawAdjustment.makeRotationZ(-zAngleDelta);var t=yawAdjustment.clone();t.multiply(touchAnchor1.snapHolderMatrix);var m=function(o,a,b){return o.elements[4*(a-1)+b-1]},x1=m(p,1,1)*m(t,1,1)-s1.x*m(p,3,4)*m(t,3,1),y1=m(p,1,1)*m(t,1,2)-s1.x*m(p,3,4)*m(t,3,2),z1=m(p,1,1)*m(t,1,3)-s1.x*m(p,3,4)*m(t,3,3),c1=w1.x*x1+w1.y*y1+w1.z*z1,x2=m(p,2,2)*m(t,2,1)-s1.y*m(p,3,4)*m(t,3,1),y2=m(p,2,2)*m(t,2,2)-s1.y*m(p,3,4)*m(t,3,2),z2=m(p,2,2)*m(t,2,3)-s1.y*m(p,3,4)*m(t,3,3),c2=w1.x*x2+w1.y*y2+w1.z*z2,x3=m(p,1,1)*m(t,1,1)-s2.x*m(p,3,4)*m(t,3,1),y3=m(p,1,1)*m(t,1,2)-s2.x*m(p,3,4)*m(t,3,2),z3=m(p,1,1)*m(t,1,3)-s2.x*m(p,3,4)*m(t,3,3),c3=w2.x*x3+w2.y*y3+w2.z*z3,xb=m(p,2,2)*m(t,2,1)-s2.y*m(p,3,4)*m(t,3,1),yb=m(p,2,2)*m(t,2,2)-s2.y*m(p,3,4)*m(t,3,2),zb=m(p,2,2)*m(t,2,3)-s2.y*m(p,3,4)*m(t,3,3),cb=w2.x*xb+w2.y*yb+w2.z*zb,dx1=Math.abs(x3-x1),dy1=Math.abs(y3-y1),dz1=Math.abs(z3-z1),dx2=Math.abs(x3-x2),dy2=Math.abs(y3-y2),dz2=Math.abs(z3-z2),dx3=Math.abs(xb-x1),dy3=Math.abs(yb-y1),dz3=Math.abs(zb-z1),dx4=Math.abs(xb-x2),dy4=Math.abs(yb-y2),dz4=Math.abs(zb-z2),min1=Math.min(dx1+dy1+dz1,dx2+dy2+dz2),min2=Math.min(dx3+dy3+dz3,dx4+dy4+dz4);min1<min2&&(x3=xb,y3=yb,z3=zb,c3=cb);var x4=x2*z1-x1*z2,y4=y2*z1-y1*z2,c4=c2*z1-c1*z2,x5=x3*z2-x2*z3,y5=y3*z2-y2*z3,c5=c3*z2-c2*z3,x=(c5*y4-c4*y5)/(x5*y4-x4*y5),y=(c5*x4-c4*x5)/(y5*x4-y4*x5),y6=y2*x1-y1*x2,y7=y3*x2-y2*x3,z=((c3*x2-c2*x3)*y6-(c2*x1-c1*x2)*y7)/((z3*x2-z2*x3)*y6-(z2*x1-z1*x2)*y7),finalTransformMatrix=t.clone();return finalTransformMatrix.elements[12]=x,finalTransformMatrix.elements[13]=y,finalTransformMatrix.elements[14]=z,z>0?finalTransformMatrix:null}(scope.touchAnchor1,scope.touchAnchor2);newMatrix&&function(transform){scope.orbit.updateMatrixWorld();var newAngle=new Euler;newAngle.setFromRotationMatrix(transform,"ZYX");var zoom=transform.elements[14]/Math.cos(newAngle.x),rotation=newAngle.z,vectorToGround=new Vector3(0,0,1);vectorToGround.applyEuler(newAngle),vectorToGround.setLength(zoom);var groundPosition=new Vector3;groundPosition.setFromMatrixPosition(transform),groundPosition.sub(vectorToGround),scope.setPosition(groundPosition.x,groundPosition.y),scope.setZoom(zoom),scope.setRotation(rotation)}(newMatrix),scope.orbit.updateMatrixWorld(),scope.touchAnchor1.updateAnchorState(scope.camera,first),scope.touchAnchor2.updateAnchorState(scope.camera,second)}function onTouchStart(event){var touchOriginElement;if(!1!==scope.enabled)switch(touchOriginElement=scope.canvas,touchOrigin.offsetLeft=touchOriginElement.getBoundingClientRect().left,touchOrigin.offsetTop=touchOriginElement.getBoundingClientRect().top,touchToScene(event),event.touches.length){case 1:scope.enablePedestal?(!function(event){handleMouseDownPedestal(event.touches[0])}(event),state=STATE_TOUCH_PEDESTAL):scope.enableRotate&&(!function(event){var pos=raycastToFloor(event.x?event:touches[0]);panStart.set(pos.x,pos.y),panCameraStart.set(scope.orbit.position.x,scope.orbit.position.y),scope.dispatchEvent(userPanEvent),scope.dispatchEvent(panStartEvent)}(event),state=STATE_TOUCH_PAN);break;case 2:if(!1===scope.enableZoom)return;!function(){scope.touchInputs=new InputSet(touches[0],touches[1]);var dx=touches[0].x-touches[1].x,dy=touches[0].y-touches[1].y;zoomStart=scope.getZoom();var pos={x:touches[0].x-dx/2,y:touches[0].y-dy/2};floorAnchor=raycastToFloor(pos),scope.orbit.updateMatrixWorld(),scope.touchAnchor1=new TouchAnchor(touches[0],scope.camera,cameraPlane),scope.touchAnchor2=new TouchAnchor(touches[1],scope.camera,cameraPlane),panCameraStart.set(scope.orbit.position.x,scope.orbit.position.y),scope.dispatchEvent(userDollyEvent),scope.dispatchEvent(multiStartEvent)}(),state=STATE_TOUCH_DOLLY;break;case 3:if(!1===scope.enablePan)return;!function(event){rotateStart.set(event.touches[1].clientX,event.touches[1].clientY),scope.dispatchEvent(userTiltEvent),scope.dispatchEvent(rotateStartEvent)}(event),state=STATE_TOUCH_TILT;break;default:state=STATE_NONE}}function onTouchMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),event.stopPropagation(),touchToScene(event),event.touches.length){case 3:if(!1===scope.enableRotate)return;if(state!==STATE_TOUCH_TILT)return;!function(event){rotateEnd.set(event.touches[1].clientX,event.touches[1].clientY),rotateDelta.subVectors(rotateEnd,rotateStart),scope.setTilt(scope.getTilt()-rotateDelta.y/scope.rotateSpeed),rotateStart.copy(rotateEnd)}(event);break;case 2:if(!1===scope.enableZoom)return;if(state!==STATE_TOUCH_DOLLY)return;handleTouchMoveDolly();break;case 1:scope.enablePedestal&&state===STATE_TOUCH_PEDESTAL?function(event){handleMouseMovePedestal(event.touches[0])}(event):scope.enablePan&&state===STATE_TOUCH_PAN&&function(event){var pos=raycastToFloor(event.x?event:touches[0]);panEnd.set(pos.x,pos.y),panDelta.subVectors(panEnd,panStart),scope.setPosition(panCameraStart.x-panDelta.x,panCameraStart.y-panDelta.y),scope.dispatchEvent(changeEvent)}(event);break;default:state=STATE_NONE}}function onTouchEnd(event){!1!==scope.enabled&&(state=STATE_NONE)}function onContextMenu(event){event.preventDefault()}function getTouchPos(canvas,touch){return{x:touch.clientX-touchOrigin.offsetLeft,y:touch.clientY-touchOrigin.offsetTop}}function raycastToFloor(pos){raycaster.setFromCamera(pos,camera);var intersection=raycaster.intersectObject(cameraPlane,!1)[0];return intersection?intersection.point:new Vector3}function mouseToScene(event){var evt,pos=(scope.canvas,{x:(evt=event).offsetX,y:evt.offsetY});return mouse.x=pos.x/scope.canvas.width*mapView.resolutionScale*2-1,mouse.y=-pos.y/scope.canvas.height*mapView.resolutionScale*2+1,mouse}function touchToScene(event){touches=[];for(var i=0,iLen=event.touches.length;i<iLen;i++){var touch=event.touches[i],pos=getTouchPos(scope.canvas,touch);touches.push(new Vector2(pos.x/scope.canvas.width*mapView.resolutionScale*2-1,-pos.y/scope.canvas.height*mapView.resolutionScale*2+1))}mouse=touches[0]}this.animateCamera=function(target,duration,curve,callback,options){var _options=_objectSpread2({mode:CAMERA_CONTROL_OPTIONS_cancel},options),tweenStart={},tweenEnd={},position=scope.getPosition();null!=target.position&&(void 0!==target.position.x&&(tweenStart.x=position.x,tweenEnd.x=target.position.x),void 0!==target.position.y&&(tweenStart.y=position.y,tweenEnd.y=target.position.y),void 0!==target.position.z&&(tweenStart.z=position.z,tweenEnd.z=target.position.z)),void 0!==target.zoom&&(tweenStart.zoom=stayInsideBounds?Math.min(Math.max(scope.getZoom(),scope.getZoomScaledMin()),scope.getZoomScaledMax()):scope.getZoom(),scope.viewState!==VIEW_STATE.MULTI_FLOOR&&stayInsideBounds?tweenEnd.zoom=Math.min(Math.max(target.zoom,scope.getZoomScaledMin()),scope.getZoomScaledMax()):tweenEnd.zoom=target.zoom),void 0!==target.rotation&&(tweenStart.rotation=scope.getRotation(),tweenEnd.rotation=target.rotation%(2*Math.PI)),void 0!==target.tilt&&(tweenStart.tilt=scope.getTilt(),scope.viewState!==VIEW_STATE.MULTI_FLOOR&&stayInsideBounds?tweenEnd.tilt=Math.max(Math.min(target.tilt,scope.maxTilt),scope.minTilt):tweenEnd.tilt=target.tilt);var tween=new TWEEN.Tween(tweenStart).to(tweenEnd,process.env.TESTING?0:duration).onUpdate((function(between){scope.setMulti({x:between.x,y:between.y,z:between.z},between.zoom,between.rotation,between.tilt)})).onComplete((function(){callback&&callback(),completeTween(tween)})).onStart((function(){state!=STATE_MULTI&&(state=STATE_MULTI,scope.dispatchEvent(multiStartEvent)),scope.dispatchEvent(changeEvent)})),tweensArray=Array.from(tweens),lastTween=tweensArray[tweensArray.length-1],wait=!1;return null!=lastTween&&(_options.mode===CAMERA_CONTROL_OPTIONS_chain?(wait=!0,lastTween.chain(tween)):(completeTween(lastTween),lastTween=null)),tweens.add(tween),curve?tween.easing(curve):tween.easing(TWEEN.Easing.Quadratic.In),target.doNotAutoStart||wait||(tween.start(),mapView.tryRendering()),tween._mMapAnimation=!0,tween},this.setMulti=function(position,zoom,rotation,tilt){state==STATE_NONE&&scope.dispatchEvent(multiStartEvent),null!=position&&(void 0===position.x||isNaN(position.x)||(scope.orbit.position.x=position.x),void 0===position.y||isNaN(position.y)||(scope.orbit.position.y=position.y),void 0===position.z||isNaN(position.z)||this.setPedestal(position.z)),void 0===zoom||isNaN(zoom)||(scope.camera.position.z=stayInsideBounds?Math.min(Math.max(zoom,scope.getZoomScaledMin()),scope.getZoomScaledMax()):zoom,scope.viewState===VIEW_STATE.MULTI_FLOOR?zoom>1e4&&(scope.camera.near=zoom-1e4,scope.camera.far=zoom+1e4):(scope.camera.near=zoom/100,scope.camera.far=100*zoom),scope.camera.updateProjectionMatrix()),void 0===rotation||isNaN(rotation)||(scope.orbit.rotation.z=rotation),void 0===tilt||isNaN(tilt)||(scope.elevation.rotation.x=stayInsideBounds?Math.max(Math.min(tilt,scope.maxTilt),scope.minTilt):tilt),scope.dispatchEvent(changeEvent),state==STATE_NONE&&scope.dispatchEvent(multiEndEvent)},this.getProjectionScaleFactor=getProjectionScaleFactor,this.postRender=function(){state!=STATE_PAN&&state!=STATE_TOUCH_PAN||(raycaster.setFromCamera(mouse,camera),(intersection=raycaster.intersectObject(cameraPlane,!1)[0])&&(panStart.set(intersection.point.x,intersection.point.y),panCameraStart.set(scope.orbit.position.x,scope.orbit.position.y))),state==STATE_WHEEL_ZOOM&&resetZoom&&(resetZoom=!1,zoomStart=scope.getZoom(),floorAnchor=raycastToFloor(mouse),panCameraStart.set(scope.orbit.position.x,scope.orbit.position.y)),state==STATE_MULTI&&0==TWEEN.getAll().some((function(value){return value._mMapAnimation}))&&(state=STATE_NONE,scope.dispatchEvent(multiEndEvent))},this.update=function(){TWEEN.update(),lastWheelTime>0&&state==STATE_WHEEL_ZOOM&&clock.getElapsedTime()-lastWheelTime>.2&&(lastWheelTime=0,state=STATE_NONE,scope.dispatchEvent(zoomEndEvent),scope.dispatchEvent(userZoomEvent),scope.canvas.removeEventListener("mousemove",onMouseMove,!1))},this.dispose=function(){scope.canvas.removeEventListener("contextmenu",onContextMenu,!1),scope.canvas.removeEventListener("mousedown",onMouseDown,!1),scope.canvas.removeEventListener("mousewheel",onMouseWheel,!1),scope.canvas.removeEventListener("MozMousePixelScroll",onMouseWheel,!1),scope.canvas.removeEventListener("touchstart",onTouchStart,!1),scope.canvas.removeEventListener("touchend",onTouchEnd,!1),scope.canvas.removeEventListener("touchmove",onTouchMove,!1),scope.canvas.removeEventListener("mousemove",onMouseMove,!1),window.removeEventListener("mouseup",onMouseUp,!1),window.removeEventListener("mouseout",onMouseUp,!1),scene.remove(cameraPlane)},this.canvas.addEventListener("contextmenu",onContextMenu,!1),this.canvas.addEventListener("mousedown",onMouseDown,!1),this.canvas.addEventListener("mousewheel",onMouseWheel,!1),this.canvas.addEventListener("MozMousePixelScroll",onMouseWheel,!1),this.canvas.addEventListener("touchstart",onTouchStart,!1),this.canvas.addEventListener("touchend",onTouchEnd,!1),this.canvas.addEventListener("touchmove",onTouchMove,!1)},Shaders.PathVertexShader="attribute float pathDistance;attribute vec3 pathNormal;attribute vec3 pathTangent;uniform vec2 uvScale;uniform float vertexes;uniform float complete;uniform float nearRadius;uniform float farRadius;uniform float nearZoom;uniform float farZoom;uniform float pulse;uniform float pulseLength;uniform bool pulseBulge;uniform bool pathIsVertical;uniform bool displayArrowsOnPath;uniform vec2 cameraParameters;varying float zoomLevel;varying float radius;varying vec2 fragTexcoord;varying float fragTopTextureU;varying float fragPathDistance;const float flattenFactor=0.05;float remap(float x,float xMin,float xMax,float yMin,float yMax){return(x-xMin)/(xMax-xMin)*(yMax-yMin)+yMin;}float clampRemap(float x,float xMin,float xMax,float yMin,float yMax){return clamp(remap(x,xMin,xMax,yMin,yMax),yMin,yMax);}void main(){fragPathDistance=pathDistance;vec3 origin=position-nearRadius*normal;vec3 adjustedPosition=position;zoomLevel=clampRemap(cameraParameters.x,nearZoom,farZoom,0.0,1.0);adjustedPosition+=normal*(farRadius-nearRadius)*zoomLevel;float height=dot(adjustedPosition-origin,pathNormal);float desiredHeight=max(height,0.0);if(displayArrowsOnPath){desiredHeight=desiredHeight*flattenFactor;}float flattenMagnitude=height-desiredHeight;adjustedPosition=adjustedPosition-pathNormal*flattenMagnitude;vec4 mvPosition=modelViewMatrix*vec4(adjustedPosition,1.0);gl_Position=projectionMatrix*mvPosition;fragTexcoord=uv;vec3 bitangent=cross(normal,pathTangent);fragTopTextureU=-dot(bitangent,pathNormal)*0.5+0.5;radius=mix(nearRadius,farRadius,zoomLevel);}",Shaders.PathFragmentShader="uniform float complete;uniform float nearRadius;uniform float farRadius;uniform vec2 resolution;uniform vec2 cameraParameters;uniform vec3 color;uniform float pathLength;uniform vec3 pulseColor;uniform float pulse;uniform float pulseLength;uniform bool pathIsVertical;uniform bool displayArrowsOnPath;uniform float arrowAnimationTimer;uniform sampler2D arrowTexture;varying float zoomLevel;varying float radius;varying vec2 fragTexcoord;varying float fragTopTextureU;varying float fragPathDistance;const float arrowLength=2.0;const float arrowMargin=0.1;const float arrowSpacingOnShortPath=6.0;const float arrowSpacingOnLongPath=7.5;const float longPathLength=200.;const float shortPathLength=75.;const float completeLength=0.1;float remap(float x,float xMin,float xMax,float yMin,float yMax){return(x-xMin)/(xMax-xMin)*(yMax-yMin)+yMin;}float clampRemap(float x,float xMin,float xMax,float yMin,float yMax){return clamp(remap(x,xMin,xMax,yMin,yMax),yMin,yMax);}void main(void){float completeLocation=complete*(1.0+completeLength);float completeAmount=clampRemap(fragPathDistance,completeLocation-completeLength,completeLocation,0.0,1.0);float opacity=1.0-smoothstep(0.0,1.0,completeAmount);if(opacity<=0.0){discard;}float u=fragTopTextureU;u=clamp(u*(1./(1.-arrowMargin*2.))-(1./(1.-arrowMargin*2.)-1.)/2.,0.0,1.0);float arrowSpacing=clampRemap(pathLength,shortPathLength*radius,longPathLength*radius,arrowSpacingOnShortPath,arrowSpacingOnLongPath);float expandAmount=mix(1.0,farRadius/nearRadius,zoomLevel);float effectiveArrowSpacing=arrowSpacing*1.0/expandAmount+arrowMargin*2.0;float effectiveArrowLength=arrowLength*radius*(1.-arrowMargin*2.0);float v=(fragTexcoord.x*(pathLength/effectiveArrowLength)-arrowAnimationTimer*(1.+effectiveArrowSpacing));if(mod(v,(1.+effectiveArrowSpacing))<1.){v=v-effectiveArrowSpacing*floor(v/(1.+effectiveArrowSpacing));}else{v=ceil(v/(1.+effectiveArrowSpacing));}vec2 sampleTexcoord=vec2(u,v);float arrowAmount=0.0;if(displayArrowsOnPath){arrowAmount=texture2D(arrowTexture,sampleTexcoord).r;}float pulseLocation=remap(pulse,0.0,1.0,-pulseLength,1.0+pulseLength);float pulseDistance=smoothstep(0.0,pulseLength,abs(fragPathDistance-pulseLocation));float pulseLevel=abs(1.0-pulseDistance-arrowAmount);gl_FragColor=vec4(mix(color,pulseColor,pulseLevel),opacity);}",Shaders.CompositeVertexShader=CompositeVertexShader,Shaders.CompositeFragmentShader=CompositeFragmentShader;var MULTI_FLOOR_MAX_TILT=Math.PI,MapView3D=function MapView3D(container,venue){var _this3=this,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},scope=this;Object.assign(this,PubSub.prototype),Mappedin.MapView.call(this,container,venue,options),this.type="MapView3D",window.MappedinDebug||(window.MappedinDebug={}),window.MappedinDebug.MapView3D=this,window.MappedinDebug.THREE=THREE;var markerWorldIslandSplit,hasTouched=!1,antialias=!1,disableHover=!1,disableZoomOnMapSizeChange=!1,backgroundColor=16777215,backgroundAlpha=1;function setFOV(fov){scope.controls.camera.fov=fov,scope.controls.camera.updateProjectionMatrix()}antialias="ON"==options.antialias||"OFF"!=options.antialias&&window.devicePixelRatio<=1,markerWorldIslandSplit=void 0!==options.markerWorldIslandSplit&&options.markerWorldIslandSplit,options.disableHover&&(disableHover=!0),options.disableZoomOnMapSizeChange&&(disableZoomOnMapSizeChange=!0),null!=options.loadOptions&&(this.loadOptions=options.loadOptions),this.viewState=VIEW_STATE.SINGLE_FLOOR,this.setViewState=function(state){switch(this.viewState=state,state){case VIEW_STATE.MULTI_FLOOR:this.controls.maxTilt=MULTI_FLOOR_MAX_TILT,setFOV(20),this.controls.enablePedestal=!0,this.controls.enablePan=!1,this.controls.enableRotate=!1,this.controls.enableZoom=!1,this.controls.enablePan=!1,this.controls.setPedestal(0),null!=this.mapboxOutdoorContext&&this.mapboxOutdoorContext.setShouldDrawTiles(!1);break;case VIEW_STATE.SINGLE_FLOOR:this.controls.maxTilt=1.2,this.controls.setTilt(.3),this.controls.enablePedestal=!1,this.controls.enablePan=!0,this.controls.enableRotate=!0,this.controls.enableZoom=!0,this.controls.enablePan=!0,setFOV(40),this.controls.enabled=!0,null!=this.mapboxOutdoorContext&&this.mapboxOutdoorContext.setShouldDrawTiles(!0);break;default:this.controls.maxTilt=1.2,this.controls.setTilt(.3),setFOV(40),this.controls.enabled=!0,this.controls.enablePan=!0,this.controls.enableRotate=!0,this.controls.enableZoom=!0,this.controls.enablePan=!0,null!=this.mapboxOutdoorContext&&this.mapboxOutdoorContext.setShouldDrawTiles(!0)}};var taskScheduler=new TaskScheduler({performance:!0}),atlas=new Atlas,renderer=new Renderer({multiBufferRendering:options.multiBufferRendering,alpha:options.alpha,antialias:antialias,onWebGLContextCreationError:options.onWebGLContextCreationError,onWebGLContextLost:options.onWebGLContextLost,onWebGLContextRestored:function(){options.onWebGLContextRestored&&options.onWebGLContextRestored(),atlas.onWebGLContextRestored(),scope.tryRendering()},onWebGLRendererError:options.onWebGLRendererError,backgroundColor:options.backgroundColor,backgroundAlpha:options.backgroundAlpha}),lastHover=null,highlightedPolygons={};this.scene=new Scene,this.resolutionScale=window.devicePixelRatio;var collisionEngine=new CollisionEngine({width:this.container.clientWidth,height:this.container.clientHeight}),cameraObject=new PerspectiveCamera(40,this.container.clientWidth/this.container.clientHeight,50,1e5),cameraElevation=new Object3D;cameraElevation.add(cameraObject);var cameraOrbit=new Object3D;cameraOrbit.add(cameraElevation),this.scene.add(cameraOrbit),cameraObject.updateProjectionMatrix(),cameraObject.updateMatrixWorld(!0);var renderFull=function(){renderer.render(RENDER_STATIC_AND_ANIMATED,null,scope.scene,cameraObject)};this.focusZoomFactor=1.1;var rotating=!1;function cameraRotationStarted(){rotating=!0,flippablesNeedUpdating=!0}function cameraRotationStopped(){rotating=!1,flippablesNeedUpdating=!0}var MOUSE_CLICK_TIME_THRESHOLD=300,MOUSE_CLICK_DISTANCE_THRESHOLD=30,mouseDownStart={time:0,clientc:0,clienty:0},markerWorld=new p2_1.World({applyGravity:!1,emitImpactEvent:!1,islandSplit:markerWorldIslandSplit,solver:new p2_1.GSSolver}),onCollisionStart=function(event){event.bodyA._mNumCollisions++,event.bodyB._mNumCollisions++},onCollisionEnd=function(event){event.bodyA._mNumCollisions--,event.bodyB._mNumCollisions--};markerWorld.on("beginContact",onCollisionStart),markerWorld.on("endContact",onCollisionEnd);var physicsResolution=.1,physicsTime=1,rotateWithCamera=[],flippablesNeedUpdating=!0,pathSegments=new Map,polygonMeshesById={},textLabelsByPolygonId={},smartLabels=!1;this.smartLabelOrientationDelay=650;var interactivePolygons={},textMaterials={},mapManager=new MapManager(polygonMeshesById,markerWorld,renderer.implementation.renderer,scope,taskScheduler,this.loadOptions);this.blueDotManager=new BlueDotManager({mapManager:mapManager,mapView:this}),this.scene.add(mapManager.object);var mapObjects=mapManager.mapObjects,pathCollider=new PathCollider({collisionEngine:collisionEngine,cameraObject:cameraObject,canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight});Object.defineProperty(this,"currentMap",{get:function(){return mapManager.currentMap?mapManager.currentMap.id:mapManager.mapObjects.size>0?Array.from(mapManager.mapObjects)[0].id:(console.error("No maps loaded."),null)}});var cursorPos,mouse=new Vector2,raycaster=new Raycaster,hoverLabel=new Mappedin.HoverLabel(container),getPolygon=function(polygon){return getObject(polygon,venue.polygons)};this.setMap=mapManager.setMap,this.expandMaps=mapManager.expandMaps.bind(mapManager),this.tiltMaps=mapManager.tiltMaps.bind(mapManager),this.contractMaps=mapManager.contractMaps.bind(mapManager),Object.defineProperty(this,"mapsExpanded",{get:function(){return mapManager.expanded}}),this.showOutdoorContext=function(){null==scope.mapboxOutdoorContext&&import("./Mappedin.MapboxOutdoorContext-3afc41f1.js").then((function(module){var MapboxOutdoorContext=module.default;scope.mapboxOutdoorContext=new MapboxOutdoorContext({context:renderer.getContext(),lngLat:[0,0],lngLatInMapSpace:new Vector2(0,0),mapScale:1,mapRotation:0,viewportSize:new Vector2(scope.canvasWidth,scope.canvasHeight)}),renderer.setMapboxOutdoorContext(scope.mapboxOutdoorContext),scope.mapboxOutdoorContext.on("render",(function(){return scope.tryRendering()})),null!=scope._debugUI&&scope.mapboxOutdoorContext.addDebugControls(scope._debugUI)}))},this.hideOutdoorContext=function(){null!=scope.mapboxOutdoorContext&&(null!=scope._debugUI&&scope.mapboxOutdoorContext.removeDebugControls(scope._debugUI),renderer.setMapboxOutdoorContext(null),scope.mapboxOutdoorContext.off("render"),scope.mapboxOutdoorContext.destroy(),scope.mapboxOutdoorContext=null)};var shouldShowOutdoorContext=null!=options.outdoorContext&&options.outdoorContext;function clearMouse(){mouse.x=1/0,mouse.y=1/0}function getMousePos(event){var rect=container.getBoundingClientRect();return{x:(event.clientX-rect.left)/(rect.right-rect.left)*canvasWidth,y:(event.clientY-rect.top)/(rect.bottom-rect.top)*canvasHeight}}!0===shouldShowOutdoorContext&&this.showOutdoorContext(),this.showEntireMap=function(options){options||(options={});var polygons,mapObject=mapObjects.get(scope.currentMap);return options.interactiveOnly?polygons=Object.keys(interactivePolygons):!(polygons=mapObject.object.children.map((function(mesh){return mesh.name}))).length&&mapObject.elements&&(polygons=Object.keys(mapObject.elements)),options.polygons=polygons,this.focusOn(options)},this.resetPanBounds=function(){var mapObject=mapObjects.get(scope.currentMap);scope.controls.panBounds.min=scope.controls.getPosition(),scope.controls.panBounds.max=scope.controls.getPosition();var box=mapObject.boundingBox;box||(box=(new Box3).setFromObject(mapObject.object),mapObjects.get(scope.currentMap).boundingBox=box);mapManager.expandPanBounds(box)},this.addMap=mapManager.addMap,this.removeMap=mapManager.removeMap,this.removeAllMaps=mapManager.removeAllMaps;var debugObj,calculateMouseCoordinates=function(event){cursorPos=getMousePos(event),mouse.x=cursorPos.x/canvasWidth*2-1,mouse.y=-cursorPos.y/canvasHeight*2+1},onMouseMove=function(event){event.preventDefault(),calculateMouseCoordinates(event),("touch"!=event.pointerType||null==event.pointerType&&hasTouched)&&(doHoverEffect(),hoverLabel.setPosition(cursorPos.x,cursorPos.y))},rendererDomElement=renderer.domElement(),onMouseDown=function(event){"pointer"!==rendererDomElement.style.cursor&&(rendererDomElement.style.cursor="grabbing"),mouseDownStart={time:Date.now(),clientX:event.clientX,clientY:event.clientY},incrementTouches(event)},onTouchStart=function(event){hasTouched=!0,1==event.touches.length?onMouseDown(event.touches[0]):mouseDownStart=0},onMouseUp=function(event){if("grabbing"===rendererDomElement.style.cursor&&(rendererDomElement.style.cursor="grab"),scope.touchCount&&decrementTouches(event),event.target.parentNode==container){var distance=Math.sqrt(Math.pow(event.clientX-mouseDownStart.clientX,2)+Math.pow(event.clientY-mouseDownStart.clientY,2));if(Date.now()<mouseDownStart.time+MOUSE_CLICK_TIME_THRESHOLD&&distance<=MOUSE_CLICK_DISTANCE_THRESHOLD){calculateMouseCoordinates(event);var polygons=detectPolygonsUnderMouse();if(scope.viewState===VIEW_STATE.MULTI_FLOOR&&"function"==typeof scope.onMapClicked){var mapId=detectMapUnderMouse();if(null!=mapId&&!scope.onMapClicked(mapId))return}for(var i=0,iLen=polygons.length;i<iLen;++i){var polygon=polygons[i];if(interactivePolygons[polygon]&&!scope.onPolygonClicked(polygon))return}scope.onNothingClicked()}else scope.touchCount||(scope.publish(scope.currentInteractionEvent),scope.currentInteractionEvent="")}},incrementTouches=function(event){window.PointerEvent&&"touch"==event.pointerType&&(scope.touchCount=(scope.touchCount||0)+1,1===scope.touchCount&&scope.publish("user-hands-on"))},decrementTouches=function(event){window.PointerEvent&&"touch"==event.pointerType&&(scope.touchCount=scope.touchCount-1,scope.touchCount||scope.publish("user-hands-off"))},onTouchEnd=function(event){event.preventDefault(),onMouseUp(event.changedTouches[0])},onWindowResize=function(){collisionEngine.resize({width:scope.container.clientWidth,height:scope.container.clientHeight}),mapManager.resize(),scope.tryRendering()};this.focusOnPolygon=function(polygon,changeZoom,duration,curve){return scope.focusOn({polygons:[polygon],changeZoom:changeZoom,duration:duration,curve:curve})},this.focusOnPath=function(path,polygons,changeZoom,duration,curve){return scope.focusOn({nodes:path,polygons:polygons,changeZoom:changeZoom,duration:duration,curve:curve})},this.focusOn=function(options){if(this.viewState!==VIEW_STATE.MULTI_FLOOR&&null!=options){var duration,changeZoom=void 0===options.changeZoom||options.changeZoom;duration=void 0!==options.duration?options.duration:!0===process.env.TESTING?0:200;var focusZoomFactor=void 0!==options.focusZoomFactor?options.focusZoomFactor:scope.focusZoomFactor,curve=options.curve,horizontalFovFactor=void 0!==options.horizontalFovFactor?options.horizontalFovFactor:1,verticalFovFactor=void 0!==options.verticalFovFactor?options.verticalFovFactor:1,callback=options.callback,minZoom=void 0!==options.minZoom?options.minZoom:scope.controls.minZoom,updateZoomLimits=options.updateZoomLimits||!0,targetOnMap=!1,pointCloud=[];if(options.nodes)for(var nodes=options.nodes,i=0,iLen=nodes.length;i<iLen;i++){var nodeObject=nodes[i];"string"==typeof nodeObject&&(nodeObject=getObject(nodeObject,venue.nodes)),null!=nodeObject.map&&nodeObject.map!=scope.currentMap||(pointCloud.push(scope.convertTo3DMapPosition(nodeObject)),targetOnMap=!0)}if(options.debug){debugObj&&debugObj.destroy(),debugObj=new Object3D,scope.scene.add(debugObj);var geometry=new BoxGeometry(100,100,100),material=new MeshBasicMaterial({color:65280})}if(options.points&&(options.points.forEach((function(pt){return pointCloud.push(pt)})),targetOnMap=!0),options.boundingBox){var _options$boundingBox=options.boundingBox,min=_options$boundingBox.min,max=_options$boundingBox.max;[new Vector3(min.x,min.y,min.z),new Vector3(min.x,max.y,min.z),new Vector3(max.x,min.y,min.z),new Vector3(max.x,max.y,min.z),new Vector3(min.x,min.y,max.z),new Vector3(min.x,max.y,max.z),new Vector3(max.x,min.y,max.z),new Vector3(max.x,max.y,max.z)].forEach((function(pt){if(options.debug){var cube=new Mesh(geometry,material);cube.position.set(pt.x,pt.y,pt.z),debugObj.add(cube)}pointCloud.push(pt)})),targetOnMap=!0}if(options.polygons){var polygons=options.polygons,mapObject=mapObjects.get(scope.currentMap);for(i=0,iLen=polygons.length;i<iLen;i++){var polygonId=getObjectId(polygons[i]),targetObject=mapObject.objectsDictionary[polygonId];if(targetObject)if(targetObject.geometry.attributes){for(var vertexes=targetObject.geometry.attributes.position,j=0,jLen=vertexes.count;j<jLen;j++){var vector=new Vector3;vector.set(vertexes.getX(j),vertexes.getY(j),vertexes.getZ(j)),pointCloud.push(vector)}targetOnMap=!0}else{for(var k=0,kLen=targetObject.geometry.vertices.length;k<kLen;k++)pointCloud.push(targetObject.geometry.vertices[k].clone());targetOnMap=!0}else{var mapElements=mapObject.elements;if(mapElements){var targetElement=mapElements[polygonId];if(targetElement){var boundingBox=targetElement.getBoundingBox();pointCloud.push(new Vector3(boundingBox.min.x,boundingBox.min.y,0)),pointCloud.push(new Vector3(boundingBox.min.x,boundingBox.max.y,0)),pointCloud.push(new Vector3(boundingBox.max.x,boundingBox.min.y,0)),pointCloud.push(new Vector3(boundingBox.max.x,boundingBox.max.y,0)),targetOnMap=!0}}}}}if(targetOnMap){scope.tryRendering();var padding=options.padding||this.cachedPadding||{top:0,bottom:0,left:0,right:0},frame=getCameraFrameForPoints(pointCloud,horizontalFovFactor,verticalFovFactor,padding,!0),zoomToReduceTo=scope.getZoomLevelForCurrentMap(),zoomToExpandTo=frame.zoom;updateZoomLimits&&(scope.controls.restrictZoomLimits(zoomToReduceTo),scope.controls.expandZoomLimits(zoomToExpandTo*focusZoomFactor));var cameraSettings={position:frame.position,tilt:options.tilt,rotation:options.rotation};return changeZoom&&(cameraSettings.zoom=Math.max(frame.zoom*focusZoomFactor,minZoom)),scope.controls.animateCamera(cameraSettings,duration,curve,callback)}return scope.controls.animateCamera({},duration,curve,callback)}},this.CAMERA_FRAME_PADDING_SIDES=["top","bottom","left","right"],this.CAMERA_FRAME_PADDING_UNITS={PIXELS:"pixels",PORTIONS:"portions"};var getCameraFrameForPoints=function(pointCloud,horizontalFovFactor,verticalFovFactor,padding,ignoreZoom){verticalFovFactor&&!isNaN(verticalFovFactor)||(verticalFovFactor=1),horizontalFovFactor&&!isNaN(horizontalFovFactor)||(horizontalFovFactor=1);var results={position:scope.controls.getPosition(),zoom:scope.controls.minZoom};if(null==pointCloud||0==pointCloud.length)return results;padding||(padding={top:0,bottom:0,left:0,right:0,type:scope.CAMERA_FRAME_PADDING_UNITS.PIXELS});var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=scope.CAMERA_FRAME_PADDING_SIDES[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var side=_step.value;"number"!=typeof padding[side]&&(padding[side]=0)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}if(padding.type||(padding.type=scope.CAMERA_FRAME_PADDING_UNITS.PIXELS),padding.type===scope.CAMERA_FRAME_PADDING_UNITS.PORTIONS&&(padding={top:padding.top*canvasHeight,bottom:padding.bottom*canvasHeight,left:padding.left*canvasWidth,right:padding.right*canvasWidth,type:scope.CAMERA_FRAME_PADDING_UNITS.PIXELS}),padding.left+padding.right>=canvasWidth||padding.top+padding.bottom>=canvasHeight)return results;cameraOrbit.updateMatrixWorld();var camMatrix=cameraObject.matrixWorldInverse,halfFOV=cameraObject.fov*(Math.PI/180)/2,yFov=halfFOV*verticalFovFactor,xFov=Math.atan(Math.tan(halfFOV)*(canvasWidth/canvasHeight))*horizontalFovFactor;if(1==pointCloud.length){var cameraSpacePoint=pointCloud[0].clone();cameraSpacePoint.applyMatrix4(camMatrix);var currentBoundsWidth=scope.controls.minZoom*Math.tan(xFov)*2,currentBoundsHeight=scope.controls.minZoom*Math.tan(yFov)*2,offsetX=(padding.left-padding.right)/2/canvasWidth,offsetY=(padding.top-padding.bottom)/2/canvasHeight,offsetVector=new Vector3(-offsetX*currentBoundsWidth,offsetY*currentBoundsHeight,0);return cameraSpacePoint.add(offsetVector),cameraSpacePoint.applyMatrix4(cameraObject.matrixWorld),results.position.x=cameraSpacePoint.x,results.position.y=cameraSpacePoint.y,results}for(var point,min=new Vector3(1/0,1/0,1/0),max=new Vector3(-1/0,-1/0,-1/0),i=0,iLen=pointCloud.length;i<iLen;i++)(point=pointCloud[i]).applyMatrix4(camMatrix),min.min(point),max.max(point);var originalBoundsWidth=max.x-min.x,originalBoundsHeight=max.y-min.y,containmentWidth=canvasWidth-padding.left-padding.right,containmentHeight=canvasHeight-padding.top-padding.bottom,originalBoundsCenterX=(max.x+min.x)/2,originalBoundsCenterY=(max.y+min.y)/2,widthRatio=originalBoundsWidth/containmentWidth,heightRatio=originalBoundsHeight/containmentHeight,minZoomDistance=scope.controls.getZoomScaledMin(),maxZoomDistance=scope.controls.getZoomScaledMax(),minBoundsWidth=minZoomDistance*Math.tan(xFov)*2,maxBoundsWidth=maxZoomDistance*Math.tan(xFov)*2,minimumScaleRatio=minBoundsWidth/canvasWidth,maximumScaleRatio=maxBoundsWidth/canvasWidth,scaleRatio=Math.max(widthRatio,heightRatio);ignoreZoom||(scaleRatio=Math.min(Math.max(scaleRatio,minimumScaleRatio),maximumScaleRatio));var paddedBoundsWidth=containmentWidth*scaleRatio,paddedBoundsHeight=containmentHeight*scaleRatio,boundsForScreen_min={x:originalBoundsCenterX-paddedBoundsWidth/2-padding.left*scaleRatio,y:originalBoundsCenterY-paddedBoundsHeight/2-padding.bottom*scaleRatio},boundsForScreen_max={x:originalBoundsCenterX+paddedBoundsWidth/2+padding.right*scaleRatio,y:originalBoundsCenterY+paddedBoundsHeight/2+padding.top*scaleRatio},centerX=(boundsForScreen_min.x+boundsForScreen_max.x)/2,centerY=(boundsForScreen_min.y+boundsForScreen_max.y)/2,deltaX=Math.abs(centerX-boundsForScreen_min.x),deltaY=Math.abs(centerY-boundsForScreen_min.y),distanceX=deltaX/Math.tan(xFov),distanceY=deltaY/Math.tan(yFov),cameraTarget=new Vector3;cameraTarget.set(centerX,centerY,max.z+Math.max(distanceX,distanceY)),cameraTarget.applyMatrix4(cameraObject.matrixWorld);var cameraAnchor=new Vector3;cameraAnchor.set(centerX,centerY,max.z),cameraAnchor.applyMatrix4(cameraObject.matrixWorld),cameraAnchor.sub(cameraTarget);var t=cameraTarget.z/cameraAnchor.z;return results.position.x=cameraTarget.x-cameraAnchor.x*t,results.position.y=cameraTarget.y-cameraAnchor.y*t,cameraAnchor.set(results.position.x,results.position.y,0),cameraTarget.sub(cameraAnchor),results.zoom=cameraTarget.length(),results};this.setPadding=function(padding){this.cachedPadding=padding||{top:0,bottom:0,left:0,right:0}},this.getZoomLevelForPolygon=function(polygon){var polygonId=getObjectId(polygon),pointCloud=[],target=mapObjects.get(scope.currentMap).objectsDictionary[polygonId];if(target){for(var vertexes=target.geometry.attributes?target.geometry.attributes.position:[],j=0,jLen=vertexes.count;j<jLen;j++){var vector=new Vector3;vector.set(vertexes.getX(j),vertexes.getY(j),vertexes.getZ(j)),pointCloud.push(vector)}return getCameraFrameForPoints(pointCloud,1,1,this.cachedPadding,!0).zoom}return scope.controls.getZoom()},this.getZoomLevelForCurrentMap=function(){var target=mapObjects.get(scope.currentMap).object;if(target){var box=mapObjects.get(scope.currentMap).boundingBox;if(!box)box=(new Box3).setFromObject(target),mapObjects.get(scope.currentMap).boundingBox=box;var pointCloud=[box.min.clone(),box.max.clone()];return getCameraFrameForPoints(pointCloud,1,1,this.cachedPadding,!0).zoom}return scope.controls.getZoom()},this.getZoomLevelForObject=function(object){var box;box||(box=(new Box3).setFromObject(object));var pointCloud=[box.min.clone(),box.max.clone()];return getCameraFrameForPoints(pointCloud,1,1,0,!0).zoom},this.resetCamera=function(){var forceOrigin=arguments.length>0&&void 0!==arguments[0]&&arguments[0],position={x:0,y:0};if(!forceOrigin){var box=mapObjects.get(scope.currentMap).boundingBox;box&&(position={x:(box.max.x-box.min.x)/2+box.min.x,y:(box.max.y-box.min.y)/2+box.min.y})}var zoom=scope.getZoomLevelForCurrentMap();scope.controls.expandZoomLimits(zoom);var tilt=.6,rotation=0;scope.controls.setMulti(position,zoom,rotation,tilt)},this.getMapScale=function(){return mapObjects.get(scope.currentMap).getMapScale()},this.getNorth=function(){return mapObjects.get(scope.currentMap).getNorth()},this.getPositionLatLon=function(lat,lon,map){map=null==map?scope.currentMap:getObjectId(map);var mapObj=mapObjects.get(map);if(null==mapObj)throw new Error("Invalid map: "+map);return mapObj.getPositionLatLon(lat,lon)};var rotateNode=function(element,rotation){element.style.transform="rotate("+(rotation+element._mRotationOffset)+"rad)"};this.lockNorth=function(element){var offset=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;rotateWithCamera.push(element),element._mRotationOffset=offset,rotateNode(element,scope.getNorth()+scope.controls.getRotation())},this.unlockNorth=function(element){delete element._mRotationOffset,rotateWithCamera=rotateWithCamera.filter((function(item){return item!=element}))};var setPolygonColorLater=function(polygonObject,color,textLabelColor,opacity){mapObjects.get(polygonObject.map).load().then((function(){mapObjects.get(polygonObject.map).elements&&mapObjects.get(polygonObject.map).loadPolygonNow(polygonObject.id),setPolygonColorNow(polygonObject,color,textLabelColor,opacity)}))},setPolygonColorNow=function(polygon,color,textLabelColor,opacity){var polygonId=getObjectId(polygon),polygonMesh=polygonMeshesById[polygonId];if(null!=polygonMesh){polygonMesh._MIOriginalMaterial||(polygonMesh._MIOriginalMaterial=polygonMesh.material),highlightedPolygons[polygonId]=polygonId;var newMaterial=(polygonMesh.material.length?polygonMesh.material[0]:polygonMesh.material).clone();newMaterial.color.set(color||scope.colors.select||5022204),null!=opacity?(newMaterial.transparent=!0,newMaterial.opacity=opacity):newMaterial.transparent=!1,polygonMesh.material=newMaterial,!textLabelsByPolygonId[polygonId]||textLabelColor<=0||textLabelsByPolygonId[polygonId].setColor(textLabelColor||scope.colors.textSelect||16777215),scope.tryRendering()}else console.error("Cannot set color of polygon "+polygonId+", could be bad polygon or data mismatch.")};this.setPolygonColor=function(polygon,color,textLabelColor,opacity){var polygonId=getObjectId(polygon);if(void 0===polygonMeshesById[polygonId]){var polygonObject=getPolygon(polygon);return null!=polygonObject&&null!=polygonObject.map&&null!=mapObjects.get(polygonObject.map).object?void setPolygonColorLater(polygonObject,color,textLabelColor,opacity):void console.error("Cannot set color of polygon "+polygonId+", could be bad polygon or data mismatch.")}setPolygonColorNow(polygon,color,textLabelColor,opacity)},this.clearPolygonColor=function(polygon){var polygonId=getObjectId(polygon),polygonMesh=polygonMeshesById[polygonId];polygonMesh&&(polygonMesh._MIOriginalMaterial&&(scrubMaterial(polygonMesh.material),polygonMesh.material=polygonMesh._MIOriginalMaterial,polygonMesh._MIOriginalMaterial=void 0),delete highlightedPolygons[polygonId],textLabelsByPolygonId[polygonId]&&textLabelsByPolygonId[polygonId].clearColor(),scope.tryRendering())},this.clearAllPolygonColors=function(){for(var ids=Object.keys(highlightedPolygons),i=0,iLen=ids.length;i<iLen;++i){var id=ids[i];scope.clearPolygonColor(highlightedPolygons[id])}highlightedPolygons={},scope.tryRendering(),renderer.disposeOfRenderLists()};var detectMapUnderMouse=function(){raycaster.setFromCamera(mouse,cameraObject);var mapId,intersects=raycaster.intersectObjects(mapManager.object.children,!0),_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=intersects[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var obj=_step2.value;if(null!=(mapId=obj.object.parent.userData&&"mappedin_map"===obj.object.parent.userData.type?obj.object.parent.userData.mapId:null))break}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{_iteratorNormalCompletion2||null==_iterator2.return||_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return mapId},detectPolygonsUnderMouse=function(){raycaster.setFromCamera(mouse,cameraObject);var intersects=raycaster.intersectObjects(scope.scene.children,!0).map((function(obj){return obj.object.name}));arrayUnique(intersects);for(var polygons=[],i=0,iLen=intersects.length;i<iLen;++i){var name=intersects[i];name&&interactivePolygons[name]&&polygons.push(name)}return polygons};this.addInteractivePolygon=function(polygon){var polygonId=getObjectId(polygon);interactivePolygons[polygonId]=!0},this.addInteractivePolygonsForAllLocations=function(options){options||(options={});for(var exclude=options.excludeTypes||[],filteredList=(options.locations||scope.venue.locations.slice()).filter((function(l){return!exclude.includes(l.type)})),polygons={},i=0,iLen=filteredList.length;i<iLen;++i)for(var polygonList=filteredList[i].polygons,j=0,jLen=polygonList.length;j<jLen;++j){var polygon=polygonList[j];polygons[polygon.id]||(polygons[polygon.id]=!0,scope.addInteractivePolygon(polygon))}},this.removeInteractivePolygon=function(polygon){var polygonId=getObjectId(polygon);delete interactivePolygons[polygonId]},this.removeAllInteractivePolygons=function(){for(var poly in interactivePolygons)scope.removeInteractivePolygon(poly)};var onPolygonHoverOver=function(polygon){var polygonId=getObjectId(polygon);if(polygonMeshesById[polygonId])return scope.setPolygonColor(polygonId,scope.colors.hover,-1),!1},onPolygonHoverOut=function(polygonId){var polygon=polygonMeshesById[polygonId];if(polygon&&polygon.material.color.getHex()==scope.colors.hover)return scope.clearPolygonColor(polygonId),!1};this.createMarker=function(html,position,className,map){var options=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};options.collisionEngine=collisionEngine;var marker=new MapView3D.Marker(scope,_objectSpread2({html:html,position:position,className:className,map:map},options)),mapObject=mapObjects.get(marker._mMapId);return marker.setPosition(marker._mOriginalPosition.clone().add(mapObject.object.position)),mapObject.addPendingMarkerTask(marker,(function(){marker._mDeleted||(mapObject.markers.push(marker),scope.addMarker(marker),marker.show())})),scope.tryRendering(),marker},this.createThreeJSMarker=function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null!=options.map&&null!=options.mapId)throw new Error("cannot specify both `map` and `mapId` in `create3DMarker`");var map=mapManager.currentMap;null!=options.map?map=options.map:null!=options.mapId&&(map=mapObjects.get(options.mapId));var markerHandle=map.addThreeJSMarker(options);return scope.tryRendering(RENDER_ANIMATED),markerHandle},this.removeThreeJSMarker=function(markerHandle){if(null==markerHandle._mapId)return!1;var result=!1,map=mapObjects.get(markerHandle._mapId);return map&&(result=map.removeThreeJSMarker(markerHandle)),scope.tryRendering(RENDER_ANIMATED),result},this.createTooltip=function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},tooltip=new Tooltip(_objectSpread2({},options),scope,collisionEngine),mapObject=mapObjects.get(tooltip.anchor._mMapId);return tooltip.anchor.setPosition(tooltip.anchor._mOriginalPosition.clone().add(mapObject.object.position)),mapObject.addPendingMarkerTask(tooltip.anchor,(function(){tooltip.anchor._mDeleted||(mapObject.markers.push(tooltip.anchor),scope.addMarker(tooltip.anchor),tooltip.anchor.show())})),scope.tryRendering(),tooltip},this._publishBlueDot=function(){var _this=this;if(this.blueDotManager.blueDots){var pos=this.blueDotManager.blueDots.filter((function(dot){return dot.handle._mapId===_this.currentMap}))[0].handle.object.position.clone(),mapObject=mapObjects.get(targetMap||scope.defaultMap),projection=pos.applyMatrix4(mapObject.object.matrix).project(cameraObject),x=(projection.x+1)/2*canvasWidth,y=(1-projection.y)/2*canvasHeight;this.blueDotManager.publish("update-position",{x:x,y:y})}},this.addMarker=function(marker){if(scope.container.appendChild(marker.div),marker._mPosition&&null==marker._mAnchor){var projection=marker._mPosition.clone().project(cameraObject),x=(projection.x+1)/2*canvasWidth,y=(1-projection.y)/2*canvasHeight;(isNaN(x)||isNaN(y))&&(x=0,y=0);var anchor=new p2_1.Body({mass:0,position:[x,y],angle:0,velocity:[0,0],angularVelocity:0,collisionResponse:!1,collisionGroup:0});marker._mAnchor=anchor;var shadowElement=new p2_1.Body({mass:20,position:[x,y],angle:0,damping:.9,velocity:[0,0],angularVelocity:0,collisionResponse:!marker._mIgnoreCollisions,fixedRotation:!0});marker._mOffsetWidth=marker.div.offsetWidth,marker._mOffsetHeight=marker.div.offsetHeight;var shape=new p2_1.Box({width:marker._mOffsetWidth+2*marker._mMarkerBuffer,height:marker._mOffsetHeight+2*marker._mMarkerBuffer});shadowElement.addShape(shape),marker._mShadowElement=shadowElement,shadowElement._mNumCollisions=0;var constraint=new p2_1.DistanceConstraint(anchor,shadowElement,{collideConnected:!1,distance:0});constraint.setStiffness(1e3),marker._mConstraint=constraint}addMarkerToScene(marker),marker.hide()};var addMarkerToScene=function(marker){marker._mAnchor&&(markerWorld.addBody(marker._mAnchor),markerWorld.addBody(marker._mShadowElement),markerWorld.addConstraint(marker._mConstraint)),updateMarkerPosition(marker),scope.tryRendering()};this.removeMarker=function(marker){mapObjects.get(marker._mMapId).removeMarker(marker,!0),scope.tryRendering()},this.removeTooltip=function(tooltip){tooltip.destroy(),scope.tryRendering()},this.removeAllMarkers=function(){Array.from(mapObjects.values()).forEach((function(mapObject){return mapObject.removeMarkers(!0)}))};var cameraMovementStart=function(){},cameraMovementEnd=function(){setTimeout((function(){scope.tryRendering()}),scope.smartLabelOrientationDelay)};function updateMarkerAnchorPosition(marker){var projection;if(marker._mMapId){var mapObject=mapObjects.get(marker._mMapId);projection=marker._mOriginalPosition.clone().applyMatrix4(mapObject.object.matrix).project(cameraObject)}else projection=marker._mPosition.clone().project(cameraObject);var x=(projection.x+1)/2*canvasWidth-marker._mOffsetWidth/2,y=(1-projection.y)/2*canvasHeight-marker._mOffsetHeight/2;(isNaN(x)||isNaN(y))&&(x=0,y=0),p2_1.vec2.set(marker._mAnchor.position,x,y),p2_1.vec2.set(marker._mAnchor.previousPosition,x,y)}function round100(value){return Math.trunc(100*value)/100}function updateMarkerScreenPosition(marker){var position=marker._mLockToAnchor||!marker._mIgnoreCollisions&&!marker.isColliding()?marker._mAnchor.position:marker._mShadowElement.interpolatedPosition,translateX=round100(position[0]),translateY=round100(position[1]),rotateZ=marker._mIntitialRotation;marker._mRotateWithCamera&&(rotateZ+=scope.controls.getRotation()),(marker.m_translateX!==translateX||marker.m_translateY!==translateY||marker.m_rotateZ!==rotateZ)&&marker.setTransform({x:translateX,y:translateY,rotateZ:rotateZ})}this.convertTo3DMapPosition=function(mappedInCoordinate){var mapClass=mapObjects.get(mappedInCoordinate.map||scope.currentMap).mapClass;return new Vector3(mappedInCoordinate.x-mapClass.width/2,-mappedInCoordinate.y+mapClass.height/2,1)},this.getPositionPolygon=function(polygon){var polygonId=getObjectId(polygon),polygonObject=polygon;null==polygon.map&&(polygonObject=getPolygon(polygonId));var target=mapObjects.get(polygonObject.map).objectsDictionary[polygonId];if(target){target.geometry.computeBoundingBox();var box=target.geometry.boundingBox;return new Vector3(box.min.x+(box.max.x-box.min.x)/2,box.min.y+(box.max.y-box.min.y)/2,box.max.z)}return null},this.getPositionNode=function(node){var target=node;return"string"==typeof target&&(target=getObject(node,venue.nodes)),scope.convertTo3DMapPosition(target)};var updateMarkerPosition=function(marker){updateMarkerAnchorPosition(marker),updateMarkerScreenPosition(marker)};this.createFont=MapView3D.createFont.bind(this),this.labelPolygon=function(options){if(options.smartLabels)return options.smartLabelOrientationDelay=scope.smartLabelOrientationDelay,scope.smartLabelPolygon(options);var label,font=options.font,mapObject=mapObjects.get(options.polygon.map||options.map||scope.currentMap);return navigator.userAgent.indexOf("Trident")>-1&&(options.font=DEFAULT_FONT_FOR_GEOMETRY,font=options.font),label=font instanceof Font||options.legacyLabels?new TextLabel(options,venue,mapObject,DEFAULT_FONT_FOR_GEOMETRY,polygonMeshesById,textLabelsByPolygonId,textMaterials,scope):new AtlasTextLabel(options,venue,mapObject,DEFAULT_FONT_FOR_TEXTURE,polygonMeshesById,textLabelsByPolygonId,textMaterials,scope,atlas),mapObject.addPendingLowPriorityTask("createLabel",(function(){label.create()})),scope.tryRendering(),textLabelsByPolygonId[options.polygon.id]=label,label},this.pinCollisionSpace=[],this.smartLabelPolygon=function(options){var mapObject=mapObjects.get(options.polygon.map||options.map||scope.currentMap);smartLabels=!0;var textObject=new SmartLabel(options,mapObject,polygonMeshesById,textLabelsByPolygonId,scope,scope.pinCollisionSpace,collisionEngine);return mapObject.addPendingLowPriorityTask("createTextObject",(function(){textObject.create(),mapObject.smartLabelBatchCreator.addToBatch(textObject)})),textLabelsByPolygonId[options.polygon.id]=textObject,scope.tryRendering(),textObject},this.hideAllLabels=function(){mapManager.mapObjectsSortedByElevation.map((function(m){return m.textObjects.forEach((function(t){return t.hide()}))}))},this.labelAllLocations=function(options){options||(options={});var exclude=options.excludeTypes||[],sortFunction=options.sortFunction,filteredList=(options.locations||scope.venue.locations).filter((function(l){return-1===exclude.indexOf(l.type)})),translationMap=options.translationMap||{},sortedList=filteredList;null!=sortFunction&&(sortedList=filteredList.sort(sortFunction));for(var labeledPolygons={},polygonsSortedByDistance=[],i=0,iLen=sortedList.length;i<iLen;++i)for(var locationObject=sortedList[i],polygonList=locationObject.polygons,j=0,jLen=polygonList.length;j<jLen;++j){var polygon=polygonList[j];if(!labeledPolygons[polygon.id]){var canvasBounds=polygon.canvasBounds;labeledPolygons[polygon.id]=!0;var mapClass=mapObjects.get(scope.currentMap).mapClass,d=0;if(canvasBounds){var x=canvasBounds.x-mapClass.width/2,y=-canvasBounds.y+mapClass.height/2;d=Math.sqrt(Math.pow(x,2)+Math.pow(y,2))}var locationForLabel=locationObject;null==sortFunction&&(locationForLabel=scope.getPrimaryLocationForPolygon(polygon));var text=locationForLabel.name,shortText=locationForLabel.shortName,rank=options.usePolygonRankings?polygon.rank:locationForLabel.rank,stateText="";locationForLabel.states&&locationForLabel.states.length&&(stateText=translationMap[locationForLabel.state&&locationForLabel.state.id]||locationForLabel.state&&locationForLabel.state.name);var showSmartLabelWhenImagePresent=locationForLabel.showSmartLabelWhenImagePresent;polygonsSortedByDistance.push({polygon:polygon,text:text,shortText:shortText,stateText:stateText,distance:d,rank:rank,showSmartLabelWhenImagePresent:showSmartLabelWhenImagePresent})}}var results=[];polygonsSortedByDistance.sort((function(a,b){return b.distance-a.distance}));for(var k=0,kLen=polygonsSortedByDistance.length;k<kLen;++k){var polyData=polygonsSortedByDistance[k];if(options.polygon=polyData.polygon,options.text=polyData.text,options.shortText=polyData.shortText,options.stateText=polyData.stateText,options.rank=polyData.rank,options.createDespiteImage=polyData.showSmartLabelWhenImagePresent,options.usePolygonRankings&&(options.rank=polyData.rank?polyData.rank.score:0),options.smartLabels){var position=void 0,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=polyData.polygon.entrances[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var entranceNode=_step3.value;if((!options.usePolygonRankings||!polyData.rank||polyData.rank.node==entranceNode.id)&&(position=scope.getPositionNode(entranceNode.id))){options.position=position,results.push(scope.smartLabelPolygon(options));break}}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{_iteratorNormalCompletion3||null==_iterator3.return||_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}else results.push(scope.labelPolygon(options))}return mapManager.mapObjectsSortedByElevation.forEach((function(mapObject){return mapObject.textObjects.forEach((function(obj){return obj.show()}))})),results},this.removeLabel=function(polygonId){textLabelsByPolygonId[polygonId].removeSelf(),textLabelsByPolygonId[polygonId]=null},this.removeAllLabels=function(){mapManager.mapObjectsSortedByElevation.forEach((function(mapObject){return mapObject.removeLabels()})),textLabelsByPolygonId={},smartLabels=!1,scope.pinCollisionSpace=[],renderer.disposeOfRenderLists()},this.enableImageFlippingForAllLocations=function(options){this._imageFlippingEnabled=!0,options||(options={});for(var exclude=options.excludeTypes||[],filteredList=(options.locations||scope.venue.locations.slice()).filter((function(l){return-1===exclude.indexOf(l.type)})),polygons={},i=0,iLen=filteredList.length;i<iLen;++i)for(var polygonList=filteredList[i].polygons,j=0,jLen=polygonList.length;j<jLen;++j){var polygon=polygonList[j];polygons[polygon.id]||(polygons[polygon.id]=!0,scope.enableImageFlippingForPolygon({polygon:polygon}))}},this.enableImageFlippingForPolygon=function(options){if(!(null==options||null==options.polygon&null==options.polygonId)){var polygonId=options.polygon.id||options.polygonId,polygon=options.polygon,mapObject=mapObjects.get(options.map||polygon?polygon.map:scope.currentMap),rotation=0,perspectiveId=mapObjects.get(scope.currentMap).mapClass.perspectiveId;options.rotation&&!isNaN(options.rotation)?rotation=options.rotation*(Math.PI/180):perspectiveId&&polygon&&polygon.perspectives&&polygon.perspectives[perspectiveId]&&polygon.perspectives[perspectiveId].image&&polygon.perspectives[perspectiveId].image.rotation&&!isNaN(polygon.perspectives[perspectiveId].image.rotation.z)?rotation=polygon.perspectives[perspectiveId].image.rotation.z*(Math.PI/180):options.polygon&&options.polygon.image&&options.polygon.image.rotation&&!isNaN(options.polygon.image.rotation.z)&&(rotation=options.polygon.image.rotation.z*(Math.PI/180)),polygonId&&mapObject.load().then((function(){mapObject.enableImageFlipping(polygonId,rotation)}))}},this.disableImageFlippingForAllPolygons=function(){for(var maps=Object.keys(mapObjects),i=0,iLen=maps.length;i<iLen;i++){var map=maps[i];mapObjects.get(map).disableAllImageFlipping()}},this.getPathLength=function(path){for(var length=0,i=0,iLen=path.length-1;i<iLen;++i){var node=path[i],nextNode=path[i+1];node.path.includes(nextNode)&&(length+=Math.sqrt(Math.pow(nextNode.x-node.x,2)+Math.pow(nextNode.y-node.y,2)))}return length},this.drawPath=function(path){var _this2=this,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},defaultPathOptions={color:4952290,pulseColor:16777215,pulseIterations:1/0,nearRadius:20,nearZoom:375,farZoom:1e4,drawDuration:1500,curve:TWEEN$1.Easing.Cubic.InOut,drawConnectionSegments:!0,displayArrowsOnPath:!1},connectionPathOptions=_objectSpread2({color:8311585,pulseColor:16777215,nearRadius:20,nearZoom:375,farZoom:1e4,drawDuration:800,curve:TWEEN$1.Easing.Cubic.InOut,displayArrowsOnPath:!1},options.connectionPathOptions),pulsePauseDuration=options.pulsePauseDuration||750;null!=connectionPathOptions.radius&&(console.warn("Deprecation warning: `connectionPathOptions.radius` has been deprecated. Use `connectionPathOptions.nearRadius` and `connectionPathOptions.farRadius` instead."),connectionPathOptions.nearRadius=connectionPathOptions.radius),null==connectionPathOptions.farRadius&&(connectionPathOptions.farRadius=2.3*connectionPathOptions.nearRadius);var pathOptions=_objectSpread2(_objectSpread2(_objectSpread2({},defaultPathOptions),options),{},{connectionPathOptions:connectionPathOptions});null!=options.radius&&(console.warn("Deprecation warning: `options.radius` has been deprecated. Use `options.nearRadius` and `options.farRadius` instead."),pathOptions.nearRadius=options.radius),null==pathOptions.farRadius&&(pathOptions.farRadius=2.3*pathOptions.nearRadius);var currentMap,currentSegment,segment,segmentBeginIndex=0,segments=path.reduce((function(pathSegments,node,idx){var nextNode=path[idx+1],lastNode=path[idx-1];return 0===idx?currentMap=node.map:node.map==currentMap&&null!=nextNode||(segment=scope.drawPathSegment(path.slice(segmentBeginIndex,null==nextNode?idx+1:idx),currentMap,pathOptions),segmentBeginIndex=idx,pathSegments.push(segment),null!=currentSegment&&(currentSegment.tween.chain(segment.tween),currentSegment.pulseTween.chain(segment.pulseTween),currentSegment.pulseTween.onComplete(currentSegment.resetPulse)),currentSegment=segment,null!=lastNode&&lastNode.map!=node.map&&!0===pathOptions.drawConnectionSegments&&mapManager.expanded&&(segment=scope.drawConnectionPathSegment([lastNode,node],pathOptions.connectionPathOptions),pathSegments.push(segment),null!=currentSegment&&(currentSegment.tween.chain(segment.tween),currentSegment.pulseTween.chain(segment.pulseTween),currentSegment.pulseTween.onComplete(currentSegment.resetPulse)),currentSegment=segment),currentMap=node.map),pathSegments}),[]),numPulseIterations=1,maxPulseIterations=pathOptions.pulseIterations||1/0;if(segments.length>0){var startSegment=segments[0],endSegment=segments[segments.length-1];endSegment.endPauseTween=new TWEEN$1.Tween({}).to({value:1},pulsePauseDuration).chain(startSegment.pulseTween).onUpdate((function(){return _this2.tryRendering(RENDER_TWEEN)})),endSegment.pulseTween.chain(endSegment.endPauseTween),endSegment.pulseTween.onComplete((function(){numPulseIterations>=maxPulseIterations?segments.forEach((function(s){s.pulseTween.onComplete((function(){})),s.pulseTween.stop(),s.endPauseTween&&s.endPauseTween.stop(),s.resetPulse(),scope.tryRendering(RENDER_ANIMATED)})):endSegment.resetPulse(),numPulseIterations++})),startSegment.tween.start(),startSegment.pulseTween.start(),startSegment.pulseTween.onComplete(startSegment.resetPulse)}return scope.tryRendering(RENDER_ANIMATED),segments};var textureLoader=new TextureLoader;function drawSegment(vectorPoints,path,options){var color=void 0!==(options=options||{}).color?options.color:scope.colors.path||16745292,pulseColor=void 0!==options.pulseColor?scope.colors.pathPulse:0,nearRadius=void 0!==options.nearRadius?options.nearRadius:20,farRadius=void 0!==options.farRadius?options.farRadius:nearRadius,nearZoom=void 0!==options.nearZoom?options.nearZoom:375,farZoom=void 0!==options.farZoom?options.farZoom:1e4,drawDuration=void 0!==options.drawDuration?options.drawDuration:1500,curve=options.curve||TWEEN$1.Easing.Cubic.InOut,displayArrowsOnPath=options.displayArrowsOnPath||!1,pathIsVertical=options.isConnectionPathSegment||!1,pathLength=0;if(pathIsVertical)for(var _i=1;_i<vectorPoints.length;++_i){var dx=vectorPoints[_i].x-vectorPoints[_i-1].x,dz=vectorPoints[_i].z-vectorPoints[_i-1].z;pathLength+=Math.sqrt(dx*dx+dz*dz)}else for(var _i2=1;_i2<vectorPoints.length;++_i2){var _dx=vectorPoints[_i2].x-vectorPoints[_i2-1].x,dy=vectorPoints[_i2].y-vectorPoints[_i2-1].y,_dz=vectorPoints[_i2].z-vectorPoints[_i2-1].z;pathLength+=Math.sqrt(_dx*_dx+dy*dy+_dz*_dz)}var uniforms={vertexes:{type:"f",value:1},resolution:{type:"v2",value:resolution},cameraParameters:{type:"v2",value:cameraParameters},complete:{type:"f",value:0},color:{type:"c",value:new Color(color)},pathLength:{type:"f",value:pathLength},nearRadius:{type:"f",value:nearRadius},farRadius:{type:"f",value:farRadius},nearZoom:{type:"f",value:nearZoom},farZoom:{type:"f",value:farZoom},pulseColor:{type:"c",value:new Color(pulseColor)},pulse:{type:"f",value:0},pulseLength:{type:"f",value:.075},pulseBulge:{type:"b",value:!1},pathIsVertical:{type:"b",value:pathIsVertical},arrowAnimationTimer:{type:"f",value:0},arrowTexture:{type:"t",value:textureLoader.load(icons.get("arrow"))},displayArrowsOnPath:{type:"b",value:displayArrowsOnPath}},pathCurve=new CatmullRomCurve3(vectorPoints);pathCurve.curveType="catmullrom",pathCurve.tension=0;for(var tubularSegments=30*path.length,geometry=new TubeBufferGeometry(pathCurve,tubularSegments,nearRadius,8,!1),vertexIndex=new Float32Array(geometry.attributes.position.count),_i3=path.length;_i3<vertexIndex.length;_i3++)vertexIndex[_i3]=_i3;geometry.addAttribute("vertexIndex",new BufferAttribute(vertexIndex,1));for(var pathDistance=new Float32Array(geometry.attributes.position.count),pathDistanceAttribute=new BufferAttribute(pathDistance,1),_i4=0;_i4<tubularSegments;_i4++)for(var j=0;j<=8;++j)pathDistanceAttribute.setX(9*_i4+j,_i4/tubularSegments);geometry.addAttribute("pathDistance",pathDistanceAttribute);for(var pathTangents=new Float32Array(3*geometry.attributes.normal.count),pathTangentAttribute=new BufferAttribute(pathTangents,3),_i5=0;_i5<tubularSegments;_i5++)for(var tangent=geometry.tangents[_i5],_j=0;_j<=8;++_j)pathTangentAttribute.setXYZ(9*_i5+_j,tangent.x,tangent.y,tangent.z);geometry.addAttribute("pathTangent",pathTangentAttribute);for(var pathNormals=new Float32Array(3*geometry.attributes.normal.count),pathNormalAttribute=new BufferAttribute(pathNormals,3),_i6=0;_i6<tubularSegments;_i6++){var normalX,normalY,normalZ,_tangent=geometry.tangents[_i6];pathIsVertical?(normalX=_tangent.x*_tangent.y,normalY=_tangent.y*_tangent.y-1,normalZ=_tangent.z*_tangent.y):(normalX=-_tangent.x*_tangent.z,normalY=-_tangent.y*_tangent.z,normalZ=1-_tangent.z*_tangent.z);for(var normalR=Math.sqrt(normalX*normalX+normalY*normalY+normalZ*normalZ),unitNormalX=normalX/normalR,unitNormalY=normalY/normalR,unitNormalZ=normalZ/normalR,_j2=0;_j2<=8;++_j2)pathNormalAttribute.setXYZ(9*_i6+_j2,unitNormalX,unitNormalY,unitNormalZ)}geometry.addAttribute("pathNormal",pathNormalAttribute);var material=new ShaderMaterial({uniforms:uniforms,vertexShader:Shaders.PathVertexShader,fragmentShader:Shaders.PathFragmentShader});material.transparent=!0,material.alphaTest=.5,uniforms.resolution.value.x=renderer.getBufferSize().width,uniforms.resolution.value.y=renderer.getBufferSize().height,uniforms.vertexes.value=vertexIndex.length,uniforms.arrowTexture.value.wrapS=RepeatWrapping,uniforms.arrowTexture.value.wrapT=RepeatWrapping,uniforms.arrowTexture.value.anisotropy=renderer.getMaxAnisotropy();var pathObject=new Mesh(geometry,material),tryRenderingAnimated=function(){scope.tryRendering(RENDER_ANIMATED)},pulseTween=new TWEEN$1.Tween(uniforms.pulse).to({value:1},drawDuration).easing(curve).onUpdate(tryRenderingAnimated),tween=new TWEEN$1.Tween(uniforms.complete).to({value:1},drawDuration).easing(curve).onUpdate(tryRenderingAnimated),arrowAnimationTween=new TWEEN$1.Tween(uniforms.arrowAnimationTimer).to({value:1},3e3).easing(TWEEN$1.Easing.Linear.None).repeat(1/0).onUpdate(tryRenderingAnimated);displayArrowsOnPath&&arrowAnimationTween.start();var pathSegment={id:pathObject.id,object:pathObject,tween:tween,pulseTween:pulseTween,arrowAnimationTween:arrowAnimationTween,reset:function(){uniforms.complete.value=0},resetPulse:function(){uniforms.pulse.value=0}};return pathCollider.add(pathSegment,vectorPoints,{mapObject:mapObjects.get(options.mapId)}),pathSegment}this.drawPathSegment=function(path,map){for(var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{color:16745292,pulseColor:16777215,pulseIterations:1/0,nearRadius:20,nearZoom:375,farZoom:1e4,drawDuration:1500,curve:TWEEN$1.Easing.Cubic.InOut,displayArrowsOnPath:!1},mapId=map?getObjectId(map):scope.currentMap,radius=options.nearRadius,vectorPoints=[],mapClass=mapObjects.get(mapId).mapClass,_i7=0;_i7<path.length;_i7++){var v=path[_i7],vector=new Vector3(v.x-mapClass.width/2,-v.y+mapClass.height/2,radius/2);vectorPoints.push(vector)}vectorPoints.push(vectorPoints[vectorPoints.length-1].clone().setZ(-radius)),vectorPoints.unshift(vectorPoints[0].clone().setZ(-radius));var pathSegment=drawSegment(vectorPoints,path,_objectSpread2(_objectSpread2({},options),{},{mapId:mapId}));return pathSegments.set(pathSegment.id,pathSegment),pathSegment.object.layers.disable(0),pathSegment.object.layers.enable(CAMERA_LAYER_ANIMATED),mapObjects.get(mapId).add(pathSegment.object),pathSegment},this.drawConnectionPathSegment=function(path){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{color:8246050,pulseColor:16777215,pulseIterations:1/0,nearRadius:20,nearZoom:375,farZoom:1e4,drawDuration:1500,curve:TWEEN$1.Easing.Cubic.InOut,displayArrowsOnPath:!1},startMap=mapObjects.get(path[0].map),endMap=mapObjects.get(path[1].map),startMapClass=startMap.mapClass,endMapClass=endMap.mapClass,fromNode=new Vector3(path[0].x-startMapClass.width/2,-path[0].y+startMapClass.height/2,0),toNode=new Vector3(path[1].x-endMapClass.width/2,-path[1].y+endMapClass.height/2,0),fromNodeAdjusted=fromNode.clone().applyMatrix4(startMap.object.matrix),toNodeAdjusted=toNode.clone().applyMatrix4(endMap.object.matrix),vectorPoints=splitLine(fromNodeAdjusted,toNodeAdjusted,10),pathSegment=drawSegment(vectorPoints,path,_objectSpread2(_objectSpread2({},options),{},{mapId:startMap.id,isConnectionPathSegment:!0}));return pathSegments.set(pathSegment.id,pathSegment),pathSegment.object.layers.disable(0),pathSegment.object.layers.enable(CAMERA_LAYER_ANIMATED),scope.scene.add(pathSegment.object),pathSegment},this.removePathSegment=function(pathSegment){pathSegment&&(scope.scene.remove(pathSegment.object),pathCollider.remove(pathSegment),pathSegment.object.destroy(),pathSegment.pulseTween.stop(),pathSegment.endPauseTween&&pathSegment.endPauseTween.stop(),pathSegment.tween.stop(),pathSegment.arrowAnimationTween.stop(),pathSegment.pulseTween=void 0,pathSegment.tween=void 0,pathSegment.arrowAnimationTween=void 0,pathSegments.delete(pathSegment.id))},this.removeAllPaths=function(){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=pathSegments.values()[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var segment=_step4.value;scope.removePathSegment(segment)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{_iteratorNormalCompletion4||null==_iterator4.return||_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}pathSegments.clear(),pathCollider.clear(),renderer.disposeOfRenderLists()},this.setBackgroundColor=function(color,alpha){renderer.setBackgroundColor(color,alpha)};var doHoverEffect=function(){if(!disableHover){for(var polygons=detectPolygonsUnderMouse(),hovering=!1,i=0,iLen=polygons.length;i<iLen;++i){var polygon=polygons[i];if(interactivePolygons[polygon]){if(polygon!=lastHover){lastHover&&(onPolygonHoverOut(lastHover),lastHover=null),highlightedPolygons[polygon]||(lastHover=polygon,onPolygonHoverOver(polygon));var textLabel=textLabelsByPolygonId[getObjectId(polygon)];textLabel&&textLabel.showHoverLabel?hoverLabel.show(textLabel):hoverLabel.hide()}"grab"===rendererDomElement.style.cursor&&(rendererDomElement.style.cursor="pointer"),hovering=!0;break}}0==hovering&&(lastHover&&(onPolygonHoverOut(lastHover),lastHover=null),"pointer"===rendererDomElement.style.cursor&&(rendererDomElement.style.cursor="grab"),hoverLabel.hide())}},resolution=new Vector2,setBufferSize=function(width,height){renderer.setBufferSize(width,height),cameraObject.aspect=width/height,cameraObject.updateProjectionMatrix(),cameraObject.updateMatrixWorld(!0),resolution.x=width,resolution.y=height};this.setSize=function(width,height){canvasWidth=rendererDomElement.clientWidth,canvasHeight=rendererDomElement.clientHeight;var widthThreeJS=Math.floor(width*scope.resolutionScale),heightThreeJS=Math.floor(height*scope.resolutionScale);if(!disableZoomOnMapSizeChange){var factor=rendererDomElement.width!==widthThreeJS?rendererDomElement.width/widthThreeJS:rendererDomElement.height/heightThreeJS;scope.controls.setZoom(factor*scope.controls.getZoom())}setBufferSize(widthThreeJS,heightThreeJS)};var updateLabelScreenPosition=function(textObject){var projection;if(textObject.polygon.map){var mapObject=mapObjects.get(textObject.polygon.map);projection=textObject._mOriginalPosition.clone().applyMatrix4(mapObject.object.matrix).project(cameraObject)}textObject._mOffsetWidth=0,textObject._mOffsetHeight=0;var x=(projection.x+1)/2*canvasWidth-textObject._mOffsetWidth/2,y=(1-projection.y)/2*canvasHeight-textObject._mOffsetHeight/2,distanceFromCamera=projection.z,translateX=round100(x),translateY=round100(y);textObject.setTransform({x:translateX,y:translateY,rotateZ:0,distanceFromCamera:distanceFromCamera})},measureCanvas=function(){var width=canvasWidth=rendererDomElement.clientWidth,height=canvasHeight=rendererDomElement.clientHeight,widthThreeJS=Math.floor(width*scope.resolutionScale),heightThreeJS=Math.floor(height*scope.resolutionScale);if(rendererDomElement.width!==widthThreeJS||rendererDomElement.height!==heightThreeJS){var factor=rendererDomElement.width!==widthThreeJS?rendererDomElement.width/widthThreeJS:rendererDomElement.height/heightThreeJS;scope.controls.setZoom(factor*scope.controls.getZoom()),setBufferSize(widthThreeJS,heightThreeJS)}},updateMapVisibilityFrameUpdate=new FrameUpdate({name:"updateMapVisibility",ordering:UPDATE_ORDERING_BEFORE_CAMERA,callback:function(){var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=mapManager.mapObjectsSortedByElevation[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var mapObject=_step5.value;mapObject.visible?mapObject.onVisible():mapObject.onInvisible()}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{_iteratorNormalCompletion5||null==_iterator5.return||_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}}}),updateTweensFrameUpdate=new FrameUpdate({name:"updateTweens",ordering:UPDATE_ORDERING_BEFORE_CAMERA,callback:function(){return TWEEN$1.update()}}),cameraParameters=new Vector2,cameraFrameUpdate=new FrameUpdate({name:"camera",ordering:UPDATE_ORDERING_CAMERA,callback:function(){scope.controls.update(),cameraParameters.x=scope.controls.getZoom(),cameraParameters.y=scope.controls.getTilt(),scope.controls.isCameraMoving()&&(lastHover&&(onPolygonHoverOut(lastHover),lastHover=null),hoverLabel.hovering&&hoverLabel.hide()),collisionEngine.setCameraTilt(scope.controls.getTilt()),scope.blueDotManager.setBlueDotSizeFromZoom(cameraParameters.x)}}),mapboxOutdoorContextFrameUpdate=new FrameUpdate({name:"mapboxOutdoorContextFrameUpdate",ordering:UPDATE_ORDERING_AFTER_CAMERA,callback:function(){if(null!=scope.mapboxOutdoorContext){var currentMap=scope.mapManager.currentMap,georeference0=currentMap.mapClass.georeference[0],lngLat=[georeference0.target.y,georeference0.target.x],lngLatInMapSpace=scope.convertTo3DMapPosition({x:georeference0.control.x,y:georeference0.control.y});scope.mapboxOutdoorContext.setLngLat(lngLat,lngLatInMapSpace),scope.mapboxOutdoorContext.setMapScale(currentMap.mapScale),scope.mapboxOutdoorContext.setMapRotation(currentMap.getNorth()),scope.mapboxOutdoorContext.setViewportSize(resolution),scope.mapboxOutdoorContext.update(cameraObject)}}}),rotateObjectsFrameUpdate=new FrameUpdate({name:"rotateObjects",ordering:UPDATE_ORDERING_AFTER_CAMERA,callback:function(){for(var north=scope.getNorth()+scope.controls.getRotation(),i=0,iLen=rotateWithCamera.length;i<iLen;++i)rotateNode(rotateWithCamera[i],north);rotateTextLabels(),rotateImages(),flippablesNeedUpdating=!1}}),renderStaticAndAnimatedFrameUpdate=new FrameUpdate({name:"renderStaticAndAnimated",ordering:UPDATE_ORDERING_RENDER,callback:function(){null!=scope.currentMap&&renderer.isAvailable()&&(scope.shouldMeasureCanvas&&measureCanvas(),renderer.render(RENDER_STATIC_AND_ANIMATED,null,scope.scene,cameraObject),scope.controls.postRender&&scope.controls.postRender(),null!=scope.mapboxOutdoorContext&&scope.mapboxOutdoorContext.needsReRender&&taskScheduler.scheduleUpdate(renderStaticAndAnimatedFrameUpdate))}}),renderAnimatedFrameUpdate=new FrameUpdate({name:"renderAnimated",ordering:UPDATE_ORDERING_RENDER,supersededBy:[renderStaticAndAnimatedFrameUpdate],callback:function(){null!=scope.currentMap&&renderer.isAvailable()&&(scope.shouldMeasureCanvas&&measureCanvas(),renderer.render(RENDER_ANIMATED,null,scope.scene,cameraObject),scope.controls.postRender&&scope.controls.postRender())}}),fixedTimeStep=1/30,maxSubSteps=10,lastTimeSeconds=null,updateMarkerWorldFrameUpdate=new FrameUpdate({name:"updateMarkerWorld",ordering:UPDATE_ORDERING_AFTER_RENDER,callback:function(animationTime){var timeSeconds=animationTime/1e3;lastTimeSeconds||(lastTimeSeconds=timeSeconds);var deltaTime=timeSeconds-lastTimeSeconds;markerWorld.step(fixedTimeStep,deltaTime,maxSubSteps);var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=scope.navigator._virtualLayers[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var layer=_step6.value;updateMarkerAnchorPosition(layer),updateMarkerScreenPosition(layer)}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{_iteratorNormalCompletion6||null==_iterator6.return||_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}mapManager.visibleMaps.forEach((function(mapObject){mapObject.markers.forEach(updateMarkerAnchorPosition),mapObject.markers.forEach(updateMarkerScreenPosition),scope._publishBlueDot()}))}}),updateSmartLabelsFrameUpdate=new FrameUpdate({name:"updateSmartLabels",ordering:UPDATE_ORDERING_AFTER_RENDER,callback:function(){smartLabels&&mapManager.mapObjectsSortedByElevation.forEach((function(mapObject){mapObject.textObjects.forEach((function(label){mapObject.visible?(label.enable(),updateLabelScreenPosition(label)):label.disable()}))}))}});function updatePhysics(){markerWorld.step(physicsResolution,physicsTime,physicsTime*physicsResolution)}var updatePhysicsFrameUpdate=new FrameUpdate({name:"updatePhysics",ordering:UPDATE_ORDERING_AFTER_RENDER,frameCount:15,callback:function(){pathCollider.update({canvasWidth:canvasWidth,canvasHeight:canvasHeight});var updateCollisionEngine=!0,_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=mapManager.visibleMaps[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){_step7.value.isFullyLoaded()||(updateCollisionEngine=!1)}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{_iteratorNormalCompletion7||null==_iterator7.return||_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}updateCollisionEngine&&collisionEngine.step(),updatePhysics()}}),updateDebugUIFrameUpdate=new FrameUpdate({name:"updateDebugUI",ordering:UPDATE_ORDERING_AFTER_ALL_UPDATES,frameCount:1,callback:function(){var lastFramePerformance={},_iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=taskScheduler.getUpdatesRunLastFrame().values()[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var update=_step8.value;lastFramePerformance[update.name]=update.getLastFrameTime()}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{_iteratorNormalCompletion8||null==_iterator8.return||_iterator8.return()}finally{if(_didIteratorError8)throw _iteratorError8}}_this3._debugUI.reportFramePerformance(lastFramePerformance)}});this.tryRendering=function(){var renderMode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RENDER_STATIC_AND_ANIMATED;if(null!=renderer)if(null!=this._debugUI&&taskScheduler.scheduleUpdate(updateDebugUIFrameUpdate),renderMode===RENDER_STATIC_AND_ANIMATED)taskScheduler.scheduleUpdate(updateTweensFrameUpdate),taskScheduler.scheduleUpdate(updateMapVisibilityFrameUpdate),taskScheduler.scheduleUpdate(cameraFrameUpdate),null!=scope.mapboxOutdoorContext&&taskScheduler.scheduleUpdate(mapboxOutdoorContextFrameUpdate),taskScheduler.scheduleUpdate(rotateObjectsFrameUpdate),taskScheduler.scheduleUpdate(renderStaticAndAnimatedFrameUpdate),taskScheduler.scheduleUpdate(updateMarkerWorldFrameUpdate),taskScheduler.scheduleUpdate(updateSmartLabelsFrameUpdate),taskScheduler.scheduleUpdate(updatePhysicsFrameUpdate);else if(renderMode===RENDER_ANIMATED)taskScheduler.scheduleUpdate(updateTweensFrameUpdate),taskScheduler.scheduleUpdate(renderAnimatedFrameUpdate);else{if(renderMode!==RENDER_TWEEN)throw new Error("invalid render task passed to tryRendering");taskScheduler.scheduleUpdate(updateTweensFrameUpdate)}};var rotateTextLabels=function(){var angle=cameraOrbit.rotation.z;(rotating||flippablesNeedUpdating)&&mapManager.visibleMaps.forEach((function(mapObject){for(var textObjects=mapObject.textObjects,i=0,iLen=textObjects.length;i<iLen;++i){textObjects[i].flipIfNeeded(angle)}}))},rotateImages=function(){var angle=cameraOrbit.rotation.z;(rotating||flippablesNeedUpdating)&&mapManager.visibleMaps.forEach((function(mapObject){for(var images=mapObject.imagesToFlip,i=0,iLen=images.length;i<iLen;++i){images[i].flipIfNeeded(angle)}}))},addDebugControls=function(debugUI){debugUI.addDebugControls({MapView3D:[{name:"Background Color",description:"The color of the mapview background. Will be obscured if there is a fully-opaque outdoor context.",control:new DebugUIColorPicker({current:new Color(16777215),onValueChanged:function(color){renderer.setBackgroundColor(color,renderer.backgroundAlpha),scope.tryRendering()}})},{name:"Background Opacity",description:"The opacity of the mapview background. Will be obscured if there is a fully-opaque outdoor context.",control:new DebugUIScalarSlider({minimum:0,maximum:1,step:.01,current:renderer.backgroundAlpha,onValueChanged:function(alpha){renderer.setBackgroundColor(renderer.backgroundColor,alpha),scope.tryRendering()}})}],"Mapbox Outdoor Context":[{name:"Show",description:"Show the mapbox outdoor context.",control:new DebugUICheckbox({current:null!=scope.mapboxOutdoorContext,onValueChanged:function(value){value?scope.showOutdoorContext():scope.hideOutdoorContext(),scope.tryRendering()}})}]})},removeDebugControls=function(debugUI){debugUI.removeDebugControls({MapView3D:["Background Color","Background Opacity"]})};this.showDebugUI=function(){null==this._debugUI&&(this._debugUI=new DebugUI,container.appendChild(this._debugUI.element),addDebugControls(this._debugUI),this.controls.addDebugControls(this._debugUI),null!=this.mapboxOutdoorContext&&this.mapboxOutdoorContext.addDebugControls(this._debugUI),this.tryRendering())},this.hideDebugUI=function(){null!=this._debugUI&&(container.removeChild(this._debugUI.element),removeDebugControls(this._debugUI),this.controls.removeDebugControls(this._debugUI),null!=this.mapboxOutdoorContext&&this.mapboxOutdoorContext.removeDebugControls(this._debugUI),this._debugUI.destroy(),this._debugUI=null)},container.appendChild(rendererDomElement),container.style.touchAction="auto",window.PointerEvent?(rendererDomElement.addEventListener("pointerdown",onMouseDown,!1),rendererDomElement.addEventListener("pointermove",onMouseMove,!1),rendererDomElement.addEventListener("pointerup",onMouseUp,!1),rendererDomElement.addEventListener("pointercancel",onMouseUp,!1)):(rendererDomElement.addEventListener("mousemove",onMouseMove,!1),rendererDomElement.addEventListener("mousedown",onMouseDown,!1),rendererDomElement.addEventListener("mouseup",onMouseUp,!1),rendererDomElement.addEventListener("mouseleave",onMouseMove,!1),rendererDomElement.addEventListener("touchstart",onTouchStart,!1),rendererDomElement.addEventListener("touchend",onTouchEnd,!1),rendererDomElement.addEventListener("touchcancel",onTouchEnd,!1)),window.addEventListener("resize",onWindowResize,!1),container.style.overflow="hidden",rendererDomElement.style.width="100%",rendererDomElement.style.height="100%",rendererDomElement.style.cursor="grab",this.canvasWidth=rendererDomElement.clientWidth,this.canvasHeight=rendererDomElement.clientHeight;var canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight;this.navigator=new Navigator(this,mapManager,venue,canvasWidth,canvasHeight,cameraObject),this.shouldMeasureCanvas=!0,this.setBackgroundColor(backgroundColor,backgroundAlpha),setBufferSize(Math.floor(canvasWidth*scope.resolutionScale),Math.floor(canvasHeight*scope.resolutionScale)),renderFull();var DEFAULT_FONT_FOR_TEXTURE="Sans-Serif",directionalLight=new DirectionalLight(16777215,.3);directionalLight.position.set(-150,-150,350),this.scene.add(directionalLight);var hemisphericalLight=new HemisphereLight(16777215,16777215,.77);this.scene.add(hemisphericalLight),this.controls=new Mappedin.CameraControls(cameraObject,rendererDomElement,this.scene,this),this.controls.enableZoom=!0,this.INTERACTION_EVENTS=this.controls.INTERACTION_EVENTS;var startingMap,tryRendering=function(){return _this3.tryRendering()};this.controls.addEventListener(this.controls.CAMERA_EVENTS.CHANGE_EVENT.type,tryRendering),this.controls.addEventListener(this.controls.CAMERA_EVENTS.ZOOM_START_EVENT.type,(function(){scope.publish("user-zoom-begin")})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.ROTATE_START_EVENT.type,(function(){scope.publish("user-rotate-begin"),cameraRotationStarted()})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.MULTI_START_EVENT.type,(function(){scope.publish("user-multi-begin"),clearMouse(),cameraRotationStarted()})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.PAN_START_EVENT.type,(function(){scope.publish("user-pan-begin"),clearMouse()})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.ZOOM_END_EVENT.type,(function(){scope.publish("user-zoom"),scope.publish("user-zoom-begin"),cameraMovementEnd()})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.ROTATE_END_EVENT.type,(function(){scope.publish("user-rotate"),cameraMovementEnd(),cameraRotationStopped()})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.MULTI_END_EVENT.type,(function(){scope.publish("user-multi-end"),cameraMovementEnd(),cameraRotationStopped()})),this.controls.addEventListener(this.controls.CAMERA_EVENTS.PAN_END_EVENT.type,cameraMovementEnd),this.controls.addEventListener(this.controls.INTERACTION_EVENTS.USER_PAN_EVENT.type,(function(){scope.currentInteractionEvent="user-pan"})),this.controls.addEventListener(this.controls.INTERACTION_EVENTS.USER_ROTATE_EVENT.type,(function(){scope.currentInteractionEvent="user-rotate"})),this.controls.addEventListener(this.controls.INTERACTION_EVENTS.USER_DOLLY_EVENT.type,(function(){scope.currentInteractionEvent="user-zoom"})),this.controls.addEventListener(this.controls.INTERACTION_EVENTS.USER_TILT_EVENT.type,(function(){scope.currentInteractionEvent="user-tilt"})),this.controls.addEventListener(this.controls.INTERACTION_EVENTS.USER_ZOOM_EVENT.type,(function(){scope.publish("user-zoom"),scope.currentInteractionEvent="user-zoom"}));var maps=venue.maps,targetMap=venue.venue.defaultMap;if(options&&options.firstMap&&(targetMap=getObjectId(options.firstMap)),targetMap)for(var i=0,iLen=maps.length;i<iLen;++i)if(maps[i].id===targetMap){startingMap=maps[i].id;break}if(!startingMap){var closestMap=venue.maps[0],_iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=venue.maps.slice(1)[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var map=_step9.value;closestMap=Math.abs(map.elevation)===Math.abs(closestMap.elevation)?map.elevation>closestMap.elevation?map:closestMap:Math.abs(map.elevation)<Math.abs(closestMap.elevation)?map:closestMap}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{_iteratorNormalCompletion9||null==_iterator9.return||_iterator9.return()}finally{if(_didIteratorError9)throw _iteratorError9}}startingMap=closestMap}var setFlippablesNeedUpdating=function(){var value=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];flippablesNeedUpdating=value};mapManager.on("render",tryRendering),mapManager.on("render:now",renderFull),mapManager.on("flippablesNeedUpdating",setFlippablesNeedUpdating),mapManager.on("updateMarkerPosition",updateMarkerPosition),mapManager.on("texture-loaded",(function(texture){_this3.tryRendering(),renderer.preloadTexture(texture)})),mapManager.loadMaps(maps,startingMap,options.onFirstMapLoaded,options.onDataLoaded,(function(){})),mapManager.mapsFullyLoaded(options.onMapsFullyLoaded),this.setPadding(),this.destroy=function(){this.controls.dispose(),mapManager.off("render"),mapManager.off("render:now"),mapManager.off("flippablesNeedUpdating"),mapManager.off("updateMarkerPosition"),window.PointerEvent?(rendererDomElement.removeEventListener("pointerdown",onMouseDown,!1),rendererDomElement.removeEventListener("pointermove",onMouseMove,!1),rendererDomElement.removeEventListener("pointerup",onMouseUp,!1),rendererDomElement.removeEventListener("pointercancel",onMouseUp,!1)):(rendererDomElement.removeEventListener("mousemove",onMouseMove,!1),rendererDomElement.removeEventListener("mousedown",onMouseDown,!1),rendererDomElement.removeEventListener("mouseup",onMouseUp,!1),rendererDomElement.removeEventListener("mouseleave",onMouseMove,!1),rendererDomElement.removeEventListener("touchstart",onTouchStart,!1),rendererDomElement.removeEventListener("touchend",onTouchEnd,!1),rendererDomElement.removeEventListener("touchcancel",onTouchEnd,!1)),window.removeEventListener("resize",onWindowResize,!1),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.CHANGE_EVENT.type,tryRendering),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.ZOOM_START_EVENT.type,cameraMovementStart),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.ROTATE_START_EVENT.type,cameraMovementStart),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.ROTATE_START_EVENT.type,cameraRotationStarted),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.MULTI_START_EVENT.type,cameraMovementStart),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.MULTI_START_EVENT.type,clearMouse),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.MULTI_START_EVENT.type,cameraRotationStarted),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.PAN_START_EVENT.type,cameraMovementStart),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.PAN_START_EVENT.type,clearMouse),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.ZOOM_END_EVENT.type,cameraMovementEnd),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.ROTATE_END_EVENT.type,cameraMovementEnd),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.ROTATE_END_EVENT.type,cameraRotationStopped),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.MULTI_END_EVENT.type,cameraMovementEnd),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.MULTI_END_EVENT.type,cameraRotationStopped),scope.controls.removeEventListener(scope.controls.CAMERA_EVENTS.PAN_END_EVENT.type,cameraMovementEnd),markerWorld.off("beginContact",onCollisionStart),markerWorld.off("endContact",onCollisionEnd),scope.removeAllPaths(),scope.removeAllLabels(),scope.removeAllMarkers(),scope.disableImageFlippingForAllPolygons(),collisionEngine.destroy(),mapManager.destroy(),scope.scene.destroy(),hoverLabel.destroy(),interactivePolygons={},atlas.dispose(),taskScheduler.destroy(),null!=this.mapboxOutdoorContext&&this.mapboxOutdoorContext.destroy(),renderer.destroy(),container.removeChild(rendererDomElement),null!=this._debugUI&&this.hideDebugUI(),renderer=void 0}};MapView3D.createFont=function(facetypeJson){return createFont(facetypeJson)},MapView3D.Marker=Marker,MapView3D.VIEW_STATE=VIEW_STATE;export{DebugUICheckbox as D,MapView3D as M,PubSub as P,VIEW_STATE as V,_createClass as _,_objectSpread2 as a,_classCallCheck as b,_defineProperty as c,DebugUIColorPicker as d,DebugUIScalarSlider as e,DebugUIButton as f,DebugUIDropdown as g,_slicedToArray as h,_typeof as i};
